cscope 15 $HOME/Dropbox/workspace/zeromq-4.0.5/src -q 0000002512 0000471591
	@address.cpp

20 
	~"add»ss.hµ
"

21 
	~"”r.hµ
"

22 
	~"tı_add»ss.hµ
"

23 
	~"c_add»ss.hµ
"

25 
	~<¡ršg
>

26 
	~<s¡»am
>

28 
	gzmq
::
add»ss_t
::
	$add»ss_t
 (

29 cÚ¡ 
¡d
::
¡ršg
 &
´ÙocŞ_
, cÚ¡ std::¡ršg &
add»ss_
)

30 : 
	`´ÙocŞ
 (
´ÙocŞ_
),

31 
	$add»ss
 (
add»ss_
)

33 
	`mem£t
 (&
»sŞved
, 0,  (resolved));

34 
	}
}

36 
	gzmq
::
add»ss_t
::~
	$add»ss_t
 ()

38 ià(
´ÙocŞ
 == "tcp") {

39 ià(
»sŞved
.
tı_addr
) {

40 
d–‘e
 
»sŞved
.
tı_addr
;

41 
»sŞved
.
tı_addr
 = 0;

44 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


46 ià(
´ÙocŞ
 == "ipc") {

47 ià(
»sŞved
.
c_addr
) {

48 
d–‘e
 
»sŞved
.
c_addr
;

49 
»sŞved
.
c_addr
 = 0;

53 
	}
}

55 
	gzmq
::
add»ss_t
::
	$to_¡ršg
 (
¡d
::
¡ršg
 &
addr_
) const

57 ià(
´ÙocŞ
 == "tcp") {

58 ià(
»sŞved
.
tı_addr
)

59  
»sŞved
.
tı_addr
->
	`to_¡ršg
(
addr_
);

61 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


63 ià(
´ÙocŞ
 == "ipc") {

64 ià(
»sŞved
.
c_addr
)

65  
»sŞved
.
c_addr
->
	`to_¡ršg
(
addr_
);

69 ià(!
´ÙocŞ
.
	`em±y
 (è&& !
add»ss
.empty ()) {

70 
¡d
::
¡ršg¡»am
 
s
;

71 
s
 << 
´ÙocŞ
 << "://" << 
add»ss
;

72 
addr_
 = 
s
.
	`¡r
 ();

75 
addr_
.
	`ş—r
 ();

77 
	}
}

	@address.hpp

20 #iâdeà
__ZMQ_ADDRESS_HPP_INCLUDED__


21 
	#__ZMQ_ADDRESS_HPP_INCLUDED__


	)

23 
	~<¡ršg
>

25 
Çme¥aû
 
	gzmq


27 
şass
 
	gtı_add»ss_t
;

28 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


29 
şass
 
	gc_add»ss_t
;

31 
	sadd»ss_t
 {

32 
add»ss_t
 (cÚ¡ 
¡d
::
¡ršg
 &
´ÙocŞ_
, cÚ¡ std::¡ršg &
add»ss_
);

34 ~
add»ss_t
 ();

36 cÚ¡ 
	g¡d
::
¡ršg
 
´ÙocŞ
;

37 cÚ¡ 
	g¡d
::
¡ršg
 
add»ss
;

41 
tı_add»ss_t
 *
	gtı_addr
;

42 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


43 
c_add»ss_t
 *
	gc_addr
;

45 } 
	g»sŞved
;

47 
to_¡ršg
 (
¡d
::
¡ršg
 &
addr_
) const;

	@array.hpp

20 #iâdeà
__ZMQ_ARRAY_INCLUDED__


21 
	#__ZMQ_ARRAY_INCLUDED__


	)

23 
	~<veùÜ
>

24 
	~<®gÜ™hm
>

26 
Çme¥aû
 
	gzmq


34 
	g‹m¶©e
 <
	gID
 = 0> cÏs 
	c¬¿y_™em_t


36 
public
:

38 
šlše
 
¬¿y_™em_t
 () :

39 
¬¿y_šdex
 (-1)

45 
šlše
 
vœtu®
 ~
¬¿y_™em_t
 ()

49 
šlše
 
£t_¬¿y_šdex
 (
šdex_
)

51 
¬¿y_šdex
 = 
šdex_
;

54 
šlše
 
g‘_¬¿y_šdex
 ()

56  
	g¬¿y_šdex
;

59 
	g´iv©e
:

61 
¬¿y_šdex
;

63 
¬¿y_™em_t
 (const‡rray_item_t&);

64 cÚ¡ 
	g¬¿y_™em_t
 &
	gİ”©Ü
 = (cÚ¡ 
¬¿y_™em_t
&);

71 
	g‹m¶©e
 <
ty³Çme
 
	gT
, 
	gID
 = 0> cÏs 
	c¬¿y_t


73 
´iv©e
:

75 
¬¿y_™em_t
 <
	tID
> 
	t™em_t
;

77 
	gpublic
:

79 
ty³Çme
 
	t¡d
::
	tveùÜ
 <
	tT
*>::
	tsize_ty³
 size_type;

81 
šlše
 
¬¿y_t
 ()

85 
	gšlše
 ~
¬¿y_t
 ()

89 
šlše
 
size_ty³
 
size
 ()

91  
	g™ems
.
size
 ();

94 
šlše
 
boŞ
 
em±y
 ()

96  
	g™ems
.
em±y
 ();

99 
šlše
 
	gT
 *&
	gİ”©Ü
 [] (
size_ty³
 
	gšdex_
)

101  
	g™ems
 [
šdex_
];

104 
šlše
 
push_back
 (
T
 *
™em_
)

106 ià(
	g™em_
)

107 ((
	g™em_t
*è
	g™em_
)->
£t_¬¿y_šdex
 ((è
™ems
.
size
 ());

108 
	g™ems
.
push_back
 (
™em_
);

111 
šlše
 
”a£
 (
T
 *
™em_
) {

112 
”a£
 (((
™em_t
*è
™em_
)->
g‘_¬¿y_šdex
 ());

115 
šlše
 
”a£
 (
size_ty³
 
šdex_
) {

116 ià(
	g™ems
.
back
 ())

117 ((
	g™em_t
*è
	g™ems
.
back
 ())->
£t_¬¿y_šdex
 ((è
šdex_
);

118 
	g™ems
 [
šdex_
] = 
™ems
.
back
 ();

119 
	g™ems
.
pİ_back
 ();

122 
šlše
 
sw­
 (
size_ty³
 
šdex1_
, size_ty³ 
šdex2_
)

124 ià(
	g™ems
 [
šdex1_
])

125 ((
	g™em_t
*è
	g™ems
 [
šdex1_
])->
£t_¬¿y_šdex
 ((è
šdex2_
);

126 ià(
	g™ems
 [
šdex2_
])

127 ((
	g™em_t
*è
	g™ems
 [
šdex2_
])->
£t_¬¿y_šdex
 ((è
šdex1_
);

128 
	g¡d
::
sw­
 (
™ems
 [
šdex1_
], i‹m [
šdex2_
]);

131 
šlše
 
ş—r
 ()

133 
	g™ems
.
ş—r
 ();

136 
šlše
 
size_ty³
 
šdex
 (
T
 *
™em_
)

138  (
	gsize_ty³
è((
	g™em_t
*è
	g™em_
)->
g‘_¬¿y_šdex
 ();

141 
	g´iv©e
:

143 
¡d
::
	tveùÜ
 <
	tT
*> 
	t™ems_t
;

144 
™ems_t
 
	g™ems
;

146 
¬¿y_t
 (const‡rray_t&);

147 cÚ¡ 
	g¬¿y_t
 &
	gİ”©Ü
 = (cÚ¡ 
¬¿y_t
&);

	@atomic_counter.hpp

20 #iâdeà
__ZMQ_ATOMIC_COUNTER_HPP_INCLUDED__


21 
	#__ZMQ_ATOMIC_COUNTER_HPP_INCLUDED__


	)

23 
	~"¡dšt.hµ
"

24 
	~"¶©fÜm.hµ
"

26 #ià
defšed
 
ZMQ_FORCE_MUTEXES


27 
	#ZMQ_ATOMIC_COUNTER_MUTEX


	)

28 #–ià(
defšed
 
__i386__
 || defšed 
__x86_64__
è&& defšed 
__GNUC__


29 
	#ZMQ_ATOMIC_COUNTER_X86


	)

30 #–ià
defšed
 
__ARM_ARCH_7A__
 && defšed 
__GNUC__


31 
	#ZMQ_ATOMIC_COUNTER_ARM


	)

32 #–ià
defšed
 
ZMQ_HAVE_WINDOWS


33 
	#ZMQ_ATOMIC_COUNTER_WINDOWS


	)

34 #–ià(
defšed
 
ZMQ_HAVE_SOLARIS
 || defšed 
ZMQ_HAVE_NETBSD
)

35 
	#ZMQ_ATOMIC_COUNTER_ATOMIC_H


	)

36 #–ià
defšed
 
__te__


37 
	#ZMQ_ATOMIC_COUNTER_TILE


	)

39 
	#ZMQ_ATOMIC_COUNTER_MUTEX


	)

42 #ià
defšed
 
ZMQ_ATOMIC_COUNTER_MUTEX


43 
	~"mu‹x.hµ
"

44 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_WINDOWS


45 
	~"wšdows.hµ
"

46 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_ATOMIC_H


47 
	~<©omic.h
>

48 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_TILE


49 
	~<¬ch/©omic.h
>

52 
Çme¥aû
 
	gzmq


58 şas 
	c©omic_couÁ”_t


60 
	gpublic
:

62 
ušt32_t
 
	tš‹g”_t
;

64 
šlše
 
©omic_couÁ”_t
 (
š‹g”_t
 
v®ue_
 = 0) :

65 
v®ue
 (
v®ue_
)

69 
šlše
 ~
©omic_couÁ”_t
 ()

74 
šlše
 
£t
 (
š‹g”_t
 
v®ue_
)

76 
v®ue
 = 
v®ue_
;

80 
šlše
 
š‹g”_t
 
add
 (š‹g”_ˆ
šüem’t_
)

82 
š‹g”_t
 
	gŞd_v®ue
;

84 #ià
defšed
 
ZMQ_ATOMIC_COUNTER_WINDOWS


85 
	gŞd_v®ue
 = 
IÁ”lockedExchªgeAdd
 ((
LONG
*è&
v®ue
, 
šüem’t_
);

86 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_ATOMIC_H


87 
š‹g”_t
 
	gÃw_v®ue
 = 
©omic_add_32_nv
 (&
v®ue
, 
šüem’t_
);

88 
	gŞd_v®ue
 = 
Ãw_v®ue
 - 
šüem’t_
;

89 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_TILE


90 
	gŞd_v®ue
 = 
¬ch_©omic_add
 (&
v®ue
, 
šüem’t_
);

91 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_X86


92 
__asm__
 volatile (

94 : "ô" (
Şd_v®ue
), "=m" (
	gv®ue
)

95 : "0" (
šüem’t_
), "m" (
	gv®ue
)

97 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_ARM


98 
š‹g”_t
 
	gæag
, 
	gtmp
;

99 
__asm__
 volatile (

107 : "=&r"(
Şd_v®ue
), "=&r"(
	gæag
), "=&r"(
	gtmp
), "+Qo"(
	gv®ue
)

108 : "Ir"(
šüem’t_
), "r"(&
	gv®ue
)

110 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_MUTEX


111 
	gsync
.
lock
 ();

112 
	gŞd_v®ue
 = 
v®ue
;

113 
	gv®ue
 +ğ
šüem’t_
;

114 
	gsync
.
uÆock
 ();

116 #”rÜ 
©omic_couÁ”
 
is
 
nÙ
 
im¶em’‹d
 
this
 
¶©fÜm


118  
	gŞd_v®ue
;

122 
šlše
 
boŞ
 
sub
 (
š‹g”_t
 
deüem’t
)

124 #ià
defšed
 
ZMQ_ATOMIC_COUNTER_WINDOWS


125 
LONG
 
	gd–
 = - ((LONGè
deüem’t
);

126 
š‹g”_t
 
	gŞd
 = 
IÁ”lockedExchªgeAdd
 ((
LONG
*è&
v®ue
, 
d–
);

127  
	gŞd
 - 
	gdeüem’t
 != 0;

128 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_ATOMIC_H


129 
št32_t
 
	gd–
 = - ((št32_tè
deüem’t
);

130 
š‹g”_t
 
	gnv
 = 
©omic_add_32_nv
 (&
v®ue
, 
d–
);

131  
	gnv
 != 0;

132 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_TILE


133 
št32_t
 
	gd–
 = - ((št32_tè
deüem’t
);

134 
š‹g”_t
 
	gnv
 = 
¬ch_©omic_add
 (&
v®ue
, 
d–
);

135  
	gnv
 != 0;

136 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_X86


137 
š‹g”_t
 
	gŞdv®
 = -
deüem’t
;

138 vŞ©
š‹g”_t
 *
	gv®
 = &
v®ue
;

139 
__asm__
 volatile ("lock; xaddl %0,%1"

140 : "ô" (
Şdv®
), "=m" (*
	gv®
)

141 : "0" (
Şdv®
), "m" (*
	gv®
)

143  
	gŞdv®
 !ğ
deüem’t
;

144 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_ARM


145 
š‹g”_t
 
	gŞd_v®ue
, 
	gæag
, 
	gtmp
;

146 
__asm__
 volatile (

154 : "=&r"(
Şd_v®ue
), "=&r"(
	gæag
), "=&r"(
	gtmp
), "+Qo"(
	gv®ue
)

155 : "Ir"(
deüem’t
), "r"(&
	gv®ue
)

157  
	gŞd_v®ue
 - 
	gdeüem’t
 != 0;

158 #–ià
defšed
 
ZMQ_ATOMIC_COUNTER_MUTEX


159 
	gsync
.
lock
 ();

160 
	gv®ue
 -ğ
deüem’t
;

161 
boŞ
 
	g»suÉ
 = 
v®ue
 ? 
Œue
 : 
çl£
;

162 
	gsync
.
uÆock
 ();

163  
	g»suÉ
;

165 #”rÜ 
©omic_couÁ”
 
is
 
nÙ
 
im¶em’‹d
 
this
 
¶©fÜm


169 
šlše
 
š‹g”_t
 
g‘
 ()

171  
	gv®ue
;

174 
	g´iv©e
:

176 vŞ©
š‹g”_t
 
v®ue
;

177 #ià
defšed
 
ZMQ_ATOMIC_COUNTER_MUTEX


178 
mu‹x_t
 
	gsync
;

181 
©omic_couÁ”_t
 (const‡tomic_counter_t&);

182 cÚ¡ 
	g©omic_couÁ”_t
& 
	gİ”©Ü
 = (cÚ¡ 
©omic_couÁ”_t
&);

188 #ià
defšed
 
ZMQ_ATOMIC_COUNTER_WINDOWS


189 #undeà
ZMQ_ATOMIC_COUNTER_WINDOWS


191 #ià
defšed
 
ZMQ_ATOMIC_COUNTER_ATOMIC_H


192 #undeà
ZMQ_ATOMIC_COUNTER_ATOMIC_H


194 #ià
defšed
 
ZMQ_ATOMIC_COUNTER_X86


195 #undeà
ZMQ_ATOMIC_COUNTER_X86


197 #ià
defšed
 
ZMQ_ATOMIC_COUNTER_ARM


198 #undeà
ZMQ_ATOMIC_COUNTER_ARM


200 #ià
defšed
 
ZMQ_ATOMIC_COUNTER_MUTEX


201 #undeà
ZMQ_ATOMIC_COUNTER_MUTEX


	@atomic_ptr.hpp

20 #iâdeà
__ZMQ_ATOMIC_PTR_HPP_INCLUDED__


21 
	#__ZMQ_ATOMIC_PTR_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ià
defšed
 
ZMQ_FORCE_MUTEXES


26 
	#ZMQ_ATOMIC_PTR_MUTEX


	)

27 #–ià(
defšed
 
__i386__
 || defšed 
__x86_64__
è&& defšed 
__GNUC__


28 
	#ZMQ_ATOMIC_PTR_X86


	)

29 #–ià
defšed
 
__ARM_ARCH_7A__
 && defšed 
__GNUC__


30 
	#ZMQ_ATOMIC_PTR_ARM


	)

31 #–ià
defšed
 
__te__


32 
	#ZMQ_ATOMIC_PTR_TILE


	)

33 #–ià
defšed
 
ZMQ_HAVE_WINDOWS


34 
	#ZMQ_ATOMIC_PTR_WINDOWS


	)

35 #–ià(
defšed
 
ZMQ_HAVE_SOLARIS
 || defšed 
ZMQ_HAVE_NETBSD
)

36 
	#ZMQ_ATOMIC_PTR_ATOMIC_H


	)

38 
	#ZMQ_ATOMIC_PTR_MUTEX


	)

41 #ià
defšed
 
ZMQ_ATOMIC_PTR_MUTEX


42 
	~"mu‹x.hµ
"

43 #–ià
defšed
 
ZMQ_ATOMIC_PTR_WINDOWS


44 
	~"wšdows.hµ
"

45 #–ià
defšed
 
ZMQ_ATOMIC_PTR_ATOMIC_H


46 
	~<©omic.h
>

47 #–ià
defšed
 
ZMQ_ATOMIC_PTR_TILE


48 
	~<¬ch/©omic.h
>

51 
Çme¥aû
 
	gzmq


56 
	g‹m¶©e
 <
ty³Çme
 
	gT
> cÏs 
	c©omic_±r_t


58 
	gpublic
:

61 
šlše
 
©omic_±r_t
 ()

63 
±r
 = 
NULL
;

67 
	gšlše
 ~
©omic_±r_t
 ()

74 
šlše
 
£t
 (
T
 *
±r_
)

76 
	gthis
->
	g±r
 = 
±r_
;

81 
šlše
 
T
 *
xchg
 (T *
v®_
)

83 #ià
defšed
 
ZMQ_ATOMIC_PTR_WINDOWS


84  (
	gT
*è
IÁ”lockedExchªgePoš‹r
 ((
PVOID
*è&
±r
, 
v®_
);

85 #–ià
defšed
 
ZMQ_ATOMIC_PTR_ATOMIC_H


86  (
	gT
*è
©omic_sw­_±r
 (&
±r
, 
v®_
);

87 #–ià
defšed
 
ZMQ_ATOMIC_PTR_TILE


88  (
	gT
*è
¬ch_©omic_exchªge
 (&
±r
, 
v®_
);

89 #–ià
defšed
 
ZMQ_ATOMIC_PTR_X86


90 
T
 *
	gŞd
;

91 
__asm__
 volatile (

93 : "ô" (
Şd
), "=m" (
	g±r
)

94 : "m" (
±r
), "0" (
	gv®_
));

95  
	gŞd
;

96 #–ià
defšed
 
ZMQ_ATOMIC_PTR_ARM


97 
T
* 
	gŞd
;

98 
	gæag
;

99 
__asm__
 volatile (

106 : "=&r"(
æag
), "=&r"(
	gŞd
), "+Qo"(
	g±r
)

107 : "r"(&
±r
), "r"(
	gv®_
)

109  
	gŞd
;

110 #–ià
defšed
 
ZMQ_ATOMIC_PTR_MUTEX


111 
	gsync
.
lock
 ();

112 
T
 *
	gŞd
 = (T*è
±r
;

113 
	g±r
 = 
v®_
;

114 
	gsync
.
uÆock
 ();

115  
	gŞd
;

117 #”rÜ 
©omic_±r
 
is
 
nÙ
 
im¶em’‹d
 
this
 
¶©fÜm


125 
šlše
 
T
 *
ÿs
 (T *
cmp_
, T *
v®_
)

127 #ià
defšed
 
ZMQ_ATOMIC_PTR_WINDOWS


128  (
	gT
*è
IÁ”lockedCom·»ExchªgePoš‹r
 (

129 (vŞ©
PVOID
*è&
±r
, 
v®_
, 
cmp_
);

130 #–ià
defšed
 
ZMQ_ATOMIC_PTR_ATOMIC_H


131  (
	gT
*è
©omic_ÿs_±r
 (&
±r
, 
cmp_
, 
v®_
);

132 #–ià
defšed
 
ZMQ_ATOMIC_PTR_TILE


133  (
	gT
*è
¬ch_©omic_v®_com·»_ªd_exchªge
 (&
±r
, 
cmp_
, 
v®_
);

134 #–ià
defšed
 
ZMQ_ATOMIC_PTR_X86


135 
T
 *
	gŞd
;

136 
__asm__
 volatile (

138 : "÷" (
Şd
), "=m" (
	g±r
)

139 : "r" (
v®_
), "m" (
	g±r
), "0" (
	gcmp_
)

141  
	gŞd
;

142 #–ià
defšed
 
ZMQ_ATOMIC_PTR_ARM


143 
T
 *
	gŞd
;

144 
	gæag
;

145 
__asm__
 volatile (

155 : "=&r"(
æag
), "=&r"(
	gŞd
), "+Qo"(
	g±r
)

156 : "r"(&
±r
), "r"(
	gcmp_
), "r"(
	gv®_
)

158  
	gŞd
;

159 #–ià
defšed
 
ZMQ_ATOMIC_PTR_MUTEX


160 
	gsync
.
lock
 ();

161 
T
 *
	gŞd
 = (T*è
±r
;

162 ià(
	g±r
 =ğ
cmp_
)

163 
±r
 = 
v®_
;

164 
	gsync
.
uÆock
 ();

165  
	gŞd
;

167 #”rÜ 
©omic_±r
 
is
 
nÙ
 
im¶em’‹d
 
this
 
¶©fÜm


171 
	g´iv©e
:

173 vŞ©
T
 *
±r
;

174 #ià
defšed
 
ZMQ_ATOMIC_PTR_MUTEX


175 
mu‹x_t
 
	gsync
;

178 
©omic_±r_t
 (const‡tomic_ptr_t&);

179 cÚ¡ 
	g©omic_±r_t
 &
	gİ”©Ü
 = (cÚ¡ 
©omic_±r_t
&);

185 #ià
defšed
 
ZMQ_ATOMIC_PTR_WINDOWS


186 #undeà
ZMQ_ATOMIC_PTR_WINDOWS


188 #ià
defšed
 
ZMQ_ATOMIC_PTR_ATOMIC_H


189 #undeà
ZMQ_ATOMIC_PTR_ATOMIC_H


191 #ià
defšed
 
ZMQ_ATOMIC_PTR_X86


192 #undeà
ZMQ_ATOMIC_PTR_X86


194 #ià
defšed
 
ZMQ_ATOMIC_PTR_ARM


195 #undeà
ZMQ_ATOMIC_PTR_ARM


197 #ià
defšed
 
ZMQ_ATOMIC_PTR_MUTEX


198 #undeà
ZMQ_ATOMIC_PTR_MUTEX


	@blob.hpp

20 #iâdeà
__ZMQ_BLOB_HPP_INCLUDED__


21 
	#__ZMQ_BLOB_HPP_INCLUDED__


	)

23 
	~<¡ršg
>

24 
	~<¡ršg.h
>

30 #ià(
defšed
(
__GNUC__
) && (__GNUC__ >= 3) && (__GNUC__ <= 4))

31 
Çme¥aû
 
	g¡d


33 
	g‹m¶©e
<>

34 
	gch¬_Œa™s
<>

36 
	tch¬_ty³
;

38 
	tšt_ty³
;

39 
¡»ampos
 
	tpos_ty³
;

40 
¡»amoff
 
	toff_ty³
;

41 
mb¡©e_t
 
	t¡©e_ty³
;

44 
assign
(
ch¬_ty³
& 
__c1
, cÚ¡ ch¬_ty³& 
__c2
)

45 { 
	g__c1
 = 
__c2
; }

47 
boŞ


48 
eq
(cÚ¡ 
ch¬_ty³
& 
__c1
, cÚ¡ ch¬_ty³& 
__c2
)

49 {  
	g__c1
 =ğ
__c2
; }

51 
boŞ


52 
É
(cÚ¡ 
ch¬_ty³
& 
__c1
, cÚ¡ ch¬_ty³& 
__c2
)

53 {  
	g__c1
 < 
	g__c2
; }

56 
com·»
(cÚ¡ 
ch¬_ty³
* 
__s1
, cÚ¡ ch¬_ty³* 
__s2
, 
size_t
 
__n
)

58 
size_t
 
	g__i
 = 0; __˜< 
	g__n
; ++__i)

59 ià(!
eq
(
__s1
[
__i
], 
__s2
[__i]))

60  
É
(
__s1
[
__i
], 
__s2
[__i]) ? -1 : 1;

64 
size_t


65 
Ëngth
(cÚ¡ 
ch¬_ty³
* 
__s
)

67 cÚ¡ 
ch¬_ty³
* 
	g__p
 = 
__s
;

68 
	g__p
)

69 ++
	g__p
;

70  (
	g__p
 - 
	g__s
);

73 cÚ¡ 
ch¬_ty³
*

74 
fšd
(cÚ¡ 
ch¬_ty³
* 
__s
, 
size_t
 
__n
, cÚ¡ ch¬_ty³& 
__a
)

76 cÚ¡ 
ch¬_ty³
* 
	g__p
 = 
__s
; 
size_t
(
__p
 - __sè< 
	g__n
; ++__p)

77 ià(*
	g__p
 =ğ
__a
è 
__p
;

81 
ch¬_ty³
*

82 
move
(
ch¬_ty³
* 
__s1
, cÚ¡ ch¬_ty³* 
__s2
, 
size_t
 
__n
)

83 {  (
	gch¬_ty³
*è
memmove
(
__s1
, 
__s2
, 
__n
 * (
ch¬_ty³
)); }

85 
ch¬_ty³
*

86 
cİy
(
ch¬_ty³
* 
__s1
, cÚ¡ ch¬_ty³* 
__s2
, 
size_t
 
__n
)

87 {  (
	gch¬_ty³
*è
memıy
(
__s1
, 
__s2
, 
__n
 * (
ch¬_ty³
)); }

89 
ch¬_ty³
*

90 
assign
(
ch¬_ty³
* 
__s
, 
size_t
 
__n
, ch¬_ty³ 
__a
)

92 
ch¬_ty³
* 
	g__p
 = 
__s
; __°< 
	g__s
 + 
	g__n
; ++__p)

93 
assign
(*
__p
, 
__a
);

94  
	g__s
;

97 
ch¬_ty³


98 
to_ch¬_ty³
(cÚ¡ 
št_ty³
& 
__c
)

99 {  
ch¬_ty³
(
__c
); }

101 
št_ty³


102 
to_št_ty³
(cÚ¡ 
ch¬_ty³
& 
__c
è{  
št_ty³
(__c); }

104 
boŞ


105 
eq_št_ty³
(cÚ¡ 
št_ty³
& 
__c1
, cÚ¡ iÁ_ty³& 
__c2
)

106 {  
	g__c1
 =ğ
__c2
; }

108 
št_ty³


109 
eof
(è{  
	g¡©ic_ÿ¡
<
	gšt_ty³
>(-1); }

111 
št_ty³


112 
nÙ_eof
(cÚ¡ 
št_ty³
& 
__c
)

113 {  
eq_št_ty³
(
__c
, 
eof
()è? 
št_ty³
(0) : __c; }

120 
Çme¥aû
 
	gzmq


124 
	g¡d
::
	tbasic_¡ršg
 <> 
	tblob_t
;

	@clock.cpp

20 
	~"şock.hµ
"

21 
	~"¶©fÜm.hµ
"

22 
	~"lik–y.hµ
"

23 
	~"cÚfig.hµ
"

24 
	~"”r.hµ
"

25 
	~"mu‹x.hµ
"

27 
	~<¡ddef.h
>

29 #ià
defšed
 
_MSC_VER


30 #ià
defšed
 
_WIN32_WCE


31 
	~<cmnšŒš.h
>

33 
	~<šŒš.h
>

37 #ià!
defšed
 
ZMQ_HAVE_WINDOWS


38 
	~<sys/time.h
>

41 #ià
defšed
 
HAVE_CLOCK_GETTIME
 || defšed 
HAVE_GETHRTIME


42 
	~<time.h
>

45 #ifdeà
ZMQ_HAVE_WINDOWS


46 
ULONGLONG
 (*
	tf_com·tibË_g‘_tick_couÁ64
)();

48 
	gzmq
::
mu‹x_t
 
com·tibË_g‘_tick_couÁ64_mu‹x
;

50 
ULONGLONG
 
	$com·tibË_g‘_tick_couÁ64
()

52 
com·tibË_g‘_tick_couÁ64_mu‹x
.
	`lock
();

53 
DWORD
 
s_w¿p
 = 0;

54 
DWORD
 
s_Ï¡_tick
 = 0;

55 cÚ¡ 
DWORD
 
cu¼’t_tick
 = ::
	`G‘TickCouÁ
();

56 ià(
cu¼’t_tick
 < 
s_Ï¡_tick
)

57 ++
s_w¿p
;

59 
s_Ï¡_tick
 = 
cu¼’t_tick
;

60 cÚ¡ 
ULONGLONG
 
»suÉ
 = (
¡©ic_ÿ¡
<ULONGLONG>(
s_w¿p
è<< 32è+ stic_ÿ¡<ULONGLONG>(
cu¼’t_tick
);

61 
com·tibË_g‘_tick_couÁ64_mu‹x
.
	`uÆock
();

62  
»suÉ
;

63 
	}
}

65 
f_com·tibË_g‘_tick_couÁ64
 
	$š™_com·tibË_g‘_tick_couÁ64
()

67 
f_com·tibË_g‘_tick_couÁ64
 
func
 = 
NULL
;

68 
HMODULE
 
moduË
 = ::
	`LßdLib¿ryA
("Kernel32.dll");

69 ià(
moduË
 !ğ
NULL
)

70 
func
 = 
»š‹½»t_ÿ¡
<
f_com·tibË_g‘_tick_couÁ64
>(::
	`G‘ProcAdd»ss
(
moduË
, "GetTickCount64"));

72 ià(
func
 =ğ
NULL
)

73 
func
 = 
com·tibË_g‘_tick_couÁ64
;

75  
func
;

76 
	}
}

78 
f_com·tibË_g‘_tick_couÁ64
 
	gmy_g‘_tick_couÁ64
 = 
š™_com·tibË_g‘_tick_couÁ64
();

81 
	gzmq
::
şock_t
::
	$şock_t
 () :

82 
	`Ï¡_tsc
 (
	`rdtsc
 ()),

83 #ifdeà
ZMQ_HAVE_WINDOWS


84 
	`Ï¡_time
 (
¡©ic_ÿ¡
<
ušt64_t
>((*
my_g‘_tick_couÁ64
)()))

86 
	`Ï¡_time
 (
	`now_us
 () / 1000)

89 
	}
}

91 
	gzmq
::
şock_t
::~
	$şock_t
 ()

93 
	}
}

95 
ušt64_t
 
zmq
::
şock_t
::
	$now_us
 ()

97 #ià
defšed
 
ZMQ_HAVE_WINDOWS


100 
LARGE_INTEGER
 
ticksP”SecÚd
;

101 
	`Qu”yP”fÜmªûF»qu’cy
 (&
ticksP”SecÚd
);

104 
LARGE_INTEGER
 
tick
;

105 
	`Qu”yP”fÜmªûCouÁ”
 (&
tick
);

109 
ticks_div
 = 
ticksP”SecÚd
.
QuadP¬t
 / 1000000.0;

110  (
ušt64_t
è(
tick
.
QuadP¬t
 / 
ticks_div
);

112 #–ià
defšed
 
HAVE_CLOCK_GETTIME
 && defšed 
CLOCK_MONOTONIC


115 
time¥ec
 
tv
;

116 
rc
 = 
	`şock_g‘time
 (
CLOCK_MONOTONIC
, &
tv
);

120 ifĞ
rc
 != 0) {

122 
timev®
 
tv
;

123 
rc
 = 
	`g‘timeofday
 (&
tv
, 
NULL
);

124 
	`”ºo_as£¹
 (
rc
 == 0);

125  (
tv
.
tv_£c
 * (
ušt64_t
è1000000 +v.
tv_u£c
);

127  (
tv
.
tv_£c
 * (
ušt64_t
è1000000 +v.
tv_n£c
 / 1000);

129 #–ià
defšed
 
HAVE_GETHRTIME


131  (
	`g‘h¹ime
 () / 1000);

136 
timev®
 
tv
;

137 
rc
 = 
	`g‘timeofday
 (&
tv
, 
NULL
);

138 
	`”ºo_as£¹
 (
rc
 == 0);

139  (
tv
.
tv_£c
 * (
ušt64_t
è1000000 +v.
tv_u£c
);

142 
	}
}

144 
ušt64_t
 
	gzmq
::
şock_t
::
	$now_ms
 ()

146 
ušt64_t
 
tsc
 = 
	`rdtsc
 ();

149 ià(!
tsc
)

151 #ifdeà
ZMQ_HAVE_WINDOWS


156  
¡©ic_ÿ¡
<
ušt64_t
>((*
my_g‘_tick_couÁ64
)());

158  
	`now_us
 () / 1000;

165 ià(
	`lik–y
 (
tsc
 - 
Ï¡_tsc
 <ğ(
şock_´ecisiÚ
 / 2) &&sc >=†ast_tsc))

166  
Ï¡_time
;

168 
Ï¡_tsc
 = 
tsc
;

169 #ifdeà
ZMQ_HAVE_WINDOWS


170 
Ï¡_time
 = 
¡©ic_ÿ¡
<
ušt64_t
>((*
my_g‘_tick_couÁ64
)());

172 
Ï¡_time
 = 
	`now_us
 () / 1000;

174  
Ï¡_time
;

175 
	}
}

177 
ušt64_t
 
	gzmq
::
şock_t
::
	$rdtsc
 ()

179 #ià(
defšed
 
_MSC_VER
 && (defšed 
_M_IX86
 || defšed 
_M_X64
))

180  
	`__rdtsc
 ();

181 #–ià(
defšed
 
__GNUC__
 && (defšed 
__i386__
 || defšed 
__x86_64__
))

182 
ušt32_t
 
low
, 
high
;

183 
__asm__
 vŞ©("rdtsc" : "÷" (
low
), "=d" (
high
));

184  (
ušt64_t
è
high
 << 32 | 
low
;

185 #–ià(
defšed
 
__SUNPRO_CC
 && (__SUNPRO_CC >ğ0x5100è&& (defšed 
__i386
 || \

186 
defšed
 
__amd64
 || defšed 
__x86_64
))

188 
ušt64_t
 
u64v®
;

189 
ušt32_t
 
u32v®
 [2];

190 } 
tsc
;

191 
	`asm
("rdtsc" : "÷" (
tsc
.
u32v®
 [0]), "=d" (tsc.u32val [1]));

192  
tsc
.
u64v®
;

193 #–ià
	`defšed
(
__s390__
)

194 
ušt64_t
 
tsc
;

195 
	`asm
("\t¡ck\t%0\n" : "=Q" (
tsc
) : : "cc");

196 (
tsc
);

200 
	}
}

	@clock.hpp

20 #iâdeà
__ZMQ_CLOCK_HPP_INCLUDED__


21 
	#__ZMQ_CLOCK_HPP_INCLUDED__


	)

23 
	~"¡dšt.hµ
"

25 
Çme¥aû
 
	gzmq


28 şas 
	cşock_t


30 
	gpublic
:

32 
şock_t
 ();

33 ~
şock_t
 ();

36 
ušt64_t
 
rdtsc
 ();

39 
ušt64_t
 
now_us
 ();

43 
ušt64_t
 
now_ms
 ();

45 
	g´iv©e
:

48 
ušt64_t
 
Ï¡_tsc
;

51 
ušt64_t
 
	gÏ¡_time
;

53 
şock_t
 (const clock_t&);

54 cÚ¡ 
	gşock_t
 &
	gİ”©Ü
 = (cÚ¡ 
şock_t
&);

	@command.hpp

20 #iâdeà
__ZMQ_COMMAND_HPP_INCLUDED__


21 
	#__ZMQ_COMMAND_HPP_INCLUDED__


	)

23 
	~"¡dšt.hµ
"

25 
Çme¥aû
 
	gzmq


28 
şass
 
	gobjeù_t
;

29 
şass
 
	gown_t
;

30 
	gi_’gše
;

31 
şass
 
	gpe_t
;

32 
şass
 
	gsock‘_ba£_t
;

36 
	scommªd_t


39 
	gzmq
::
objeù_t
 *
de¡š©iÚ
;

41 
	ety³_t


43 
	g¡İ
,

44 
	g¶ug
,

45 
	gown
,

46 
	g©ch
,

47 
	gbšd
,

48 
	gaùiv©e_»ad
,

49 
	gaùiv©e_wr™e
,

50 
	ghiccup
,

51 
	gpe_‹rm
,

52 
	gpe_‹rm_ack
,

53 
	g‹rm_»q
,

54 
	g‹rm
,

55 
	g‹rm_ack
,

56 
	g»­
,

57 
	g»­ed
,

58 
	gš´oc_cÚÃùed
,

59 
	gdÚe


60 } 
	gty³
;

67 } 
	g¡İ
;

71 } 
	g¶ug
;

75 
	gzmq
::
own_t
 *
objeù
;

76 } 
	gown
;

81 
i_’gše
 *
	g’gše
;

82 } 
	g©ch
;

87 
	gzmq
::
pe_t
 *
pe
;

88 } 
	gbšd
;

93 } 
	gaùiv©e_»ad
;

98 
ušt64_t
 
	gmsgs_»ad
;

99 } 
	gaùiv©e_wr™e
;

105 *
	gpe
;

106 } 
	ghiccup
;

111 } 
	gpe_‹rm
;

115 } 
	gpe_‹rm_ack
;

120 
	gzmq
::
own_t
 *
objeù
;

121 } 
	g‹rm_»q
;

125 
	glšg”
;

126 } 
	g‹rm
;

131 } 
	g‹rm_ack
;

136 
	gzmq
::
sock‘_ba£_t
 *
sock‘
;

137 } 
	g»­
;

141 } 
	g»­ed
;

146 } 
	gdÚe
;

148 } 
	g¬gs
;

	@config.hpp

20 #iâdeà
__ZMQ_CONFIG_HPP_INCLUDED__


21 
	#__ZMQ_CONFIG_HPP_INCLUDED__


	)

23 
Çme¥aû
 
	gzmq


33 
	gmes§ge_pe_g¿nuÏr™y
 = 256,

36 
	gcommªd_pe_g¿nuÏr™y
 = 16,

44 
	gšbound_pŞl_¿‹
 = 100,

50 
	gš_b©ch_size
 = 8192,

56 
	gout_b©ch_size
 = 8192,

59 
	gmax_wm_d–
 = 1024,

62 
	gmax_io_ev’ts
 = 256,

68 
	gmax_commªd_d–ay
 = 3000000,

75 
	gşock_´ecisiÚ
 = 1000000,

78 
	gpgm_max_du
 = 1500,

82 
	gsigÇËr_pÜt
 = 5905

	@ctx.cpp

20 
	~"¶©fÜm.hµ
"

21 #ifdeà
ZMQ_HAVE_WINDOWS


22 
	~"wšdows.hµ
"

24 
	~<uni¡d.h
>

27 
	~<Ãw
>

28 
	~<¡ršg.h
>

30 
	~"ùx.hµ
"

31 
	~"sock‘_ba£.hµ
"

32 
	~"io_th»ad.hµ
"

33 
	~"»­”.hµ
"

34 
	~"pe.hµ
"

35 
	~"”r.hµ
"

36 
	~"msg.hµ
"

38 #ifdeà
HAVE_LIBSODIUM


39 
	~<sodium.h
>

42 
	#ZMQ_CTX_TAG_VALUE_GOOD
 0xabadÿã

	)

43 
	#ZMQ_CTX_TAG_VALUE_BAD
 0xd—db“f

	)

45 
	$ş³d_maxsock‘
(
max_»que¡ed
)

47 ià(
max_»que¡ed
 >ğ
zmq
::
pŞËr_t
::
	`max_fds
 () && zmq::poller_t::max_fds () != -1)

48 
max_»que¡ed
 = 
zmq
::
pŞËr_t
::
	`max_fds
 () - 1;

50  
max_»que¡ed
;

51 
	}
}

53 
	gzmq
::
ùx_t
::
	$ùx_t
 () :

54 
	`g
 (
ZMQ_CTX_TAG_VALUE_GOOD
),

55 
	`¡¬tšg
 (
Œue
),

56 
	`‹rmš©šg
 (
çl£
),

57 
	`»­”
 (
NULL
),

58 
	`¦Ù_couÁ
 (0),

59 
	`¦Ùs
 (
NULL
),

60 
	`max_sock‘s
 (
	`ş³d_maxsock‘
 (
ZMQ_MAX_SOCKETS_DFLT
)),

61 
	`io_th»ad_couÁ
 (
ZMQ_IO_THREADS_DFLT
),

62 
	$v6
 (
çl£
)

64 #ifdeà
HAVE_FORK


65 
pid
 = 
	`g‘pid
();

67 
	}
}

69 
boŞ
 
	gzmq
::
ùx_t
::
	$check_g
 ()

71  
g
 =ğ
ZMQ_CTX_TAG_VALUE_GOOD
;

72 
	}
}

74 
	gzmq
::
ùx_t
::~
	$ùx_t
 ()

77 
	`zmq_as£¹
 (
sock‘s
.
	`em±y
 ());

81 
io_th»ads_t
::
size_ty³
 
i
 = 0; i !ğ
io_th»ads
.
	`size
 (); i++)

82 
io_th»ads
 [
i
]->
	`¡İ
 ();

85 
io_th»ads_t
::
size_ty³
 
i
 = 0; i !ğ
io_th»ads
.
	`size
 (); i++)

86 
d–‘e
 
io_th»ads
 [
i
];

89 
d–‘e
 
»­”
;

94 
	`ä“
 (
¦Ùs
);

98 #ifdeà
HAVE_LIBSODIUM


99 
	`¿ndomby‹s_şo£
();

103 
g
 = 
ZMQ_CTX_TAG_VALUE_BAD
;

104 
	}
}

106 
	gzmq
::
ùx_t
::
	$‹rmš©e
 ()

109 
³ndšg_cÚÃùiÚs_t
 
cİy
 = 
³ndšg_cÚÃùiÚs
;

110 
³ndšg_cÚÃùiÚs_t
::
™”©Ü
 
p
 = 
cİy
.
	`begš
 ();… !ğcİy.
	`’d
 (); ++p) {

111 
zmq
::
sock‘_ba£_t
 *
s
 = 
	`ü—‹_sock‘
 (
ZMQ_PAIR
);

112 
s
->
	`bšd
 (
p
->
fœ¡
.
	`c_¡r
 ());

113 
s
->
	`şo£
 ();

116 
¦Ù_sync
.
	`lock
 ();

117 ià(!
¡¬tšg
) {

119 #ifdeà
HAVE_FORK


120 ià(
pid
 !ğ
	`g‘pid
())

124 
sock‘s_t
::
size_ty³
 
i
 = 0; i !ğ
sock‘s
.
	`size
 (); i++)

126 
sock‘s
[
i
]->
	`g‘_mabox
()->
	`fÜked
();

129 
‹rm_mabox
.
	`fÜked
();

134 
boŞ
 
»¡¬‹d
 = 
‹rmš©šg
;

135 
‹rmš©šg
 = 
Œue
;

138 ià(!
»¡¬‹d
) {

143 
sock‘s_t
::
size_ty³
 
i
 = 0; i !ğ
sock‘s
.
	`size
 (); i++)

144 
sock‘s
 [
i
]->
	`¡İ
 ();

145 ià(
sock‘s
.
	`em±y
 ())

146 
»­”
->
	`¡İ
 ();

148 
¦Ù_sync
.
	`uÆock
();

151 
commªd_t
 
cmd
;

152 
rc
 = 
‹rm_mabox
.
	`»cv
 (&
cmd
, -1);

153 ià(
rc
 =ğ-1 && 
”ºo
 =ğ
EINTR
)

155 
	`”ºo_as£¹
 (
rc
 == 0);

156 
	`zmq_as£¹
 (
cmd
.
ty³
 =ğ
commªd_t
::
dÚe
);

157 
¦Ù_sync
.
	`lock
 ();

158 
	`zmq_as£¹
 (
sock‘s
.
	`em±y
 ());

160 
¦Ù_sync
.
	`uÆock
 ();

163 
d–‘e
 
this
;

166 
	}
}

168 
	gzmq
::
ùx_t
::
	$shutdown
 ()

170 
¦Ù_sync
.
	`lock
 ();

171 ià(!
¡¬tšg
 && !
‹rmš©šg
) {

172 
‹rmš©šg
 = 
Œue
;

177 
sock‘s_t
::
size_ty³
 
i
 = 0; i !ğ
sock‘s
.
	`size
 (); i++)

178 
sock‘s
 [
i
]->
	`¡İ
 ();

179 ià(
sock‘s
.
	`em±y
 ())

180 
»­”
->
	`¡İ
 ();

182 
¦Ù_sync
.
	`uÆock
 ();

185 
	}
}

187 
	gzmq
::
ùx_t
::
	$£t
 (
İtiÚ_
, 
İtv®_
)

189 
rc
 = 0;

190 ià(
İtiÚ_
 =ğ
ZMQ_MAX_SOCKETS
 && 
İtv®_
 >ğ1 && o±v®_ =ğ
	`ş³d_maxsock‘
 (optval_)) {

191 
İt_sync
.
	`lock
 ();

192 
max_sock‘s
 = 
İtv®_
;

193 
İt_sync
.
	`uÆock
 ();

196 ià(
İtiÚ_
 =ğ
ZMQ_IO_THREADS
 && 
İtv®_
 >= 0) {

197 
İt_sync
.
	`lock
 ();

198 
io_th»ad_couÁ
 = 
İtv®_
;

199 
İt_sync
.
	`uÆock
 ();

202 ià(
İtiÚ_
 =ğ
ZMQ_IPV6
 && 
İtv®_
 >= 0) {

203 
İt_sync
.
	`lock
 ();

204 
v6
 = (
İtv®_
 != 0);

205 
İt_sync
.
	`uÆock
 ();

208 
”ºo
 = 
EINVAL
;

209 
rc
 = -1;

211  
rc
;

212 
	}
}

214 
	gzmq
::
ùx_t
::
	$g‘
 (
İtiÚ_
)

216 
rc
 = 0;

217 ià(
İtiÚ_
 =ğ
ZMQ_MAX_SOCKETS
)

218 
rc
 = 
max_sock‘s
;

220 ià(
İtiÚ_
 =ğ
ZMQ_IO_THREADS
)

221 
rc
 = 
io_th»ad_couÁ
;

223 ià(
İtiÚ_
 =ğ
ZMQ_IPV6
)

224 
rc
 = 
v6
;

226 
”ºo
 = 
EINVAL
;

227 
rc
 = -1;

229  
rc
;

230 
	}
}

232 
	gzmq
::
sock‘_ba£_t
 *
zmq
::
ùx_t
::
	$ü—‹_sock‘
 (
ty³_
)

234 
¦Ù_sync
.
	`lock
 ();

235 ià(
	`uÆik–y
 (
¡¬tšg
)) {

237 
¡¬tšg
 = 
çl£
;

240 
İt_sync
.
	`lock
 ();

241 
mazmq
 = 
max_sock‘s
;

242 
ios
 = 
io_th»ad_couÁ
;

243 
İt_sync
.
	`uÆock
 ();

244 
¦Ù_couÁ
 = 
mazmq
 + 
ios
 + 2;

245 
¦Ùs
 = (
mabox_t
**è
	`m®loc
 ( (mabox_t*è* 
¦Ù_couÁ
);

246 
	`®loc_as£¹
 (
¦Ùs
);

249 
¦Ùs
 [
‹rm_tid
] = &
‹rm_mabox
;

252 
»­”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`»­”_t
 (
this
, 
»­”_tid
);

253 
	`®loc_as£¹
 (
»­”
);

254 
¦Ùs
 [
»­”_tid
] = 
»­”
->
	`g‘_mabox
 ();

255 
»­”
->
	`¡¬t
 ();

258 
i
 = 2; i !ğ
ios
 + 2; i++) {

259 
io_th»ad_t
 *
io_th»ad
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`io_th»ad_t
 (
this
, 
i
);

260 
	`®loc_as£¹
 (
io_th»ad
);

261 
io_th»ads
.
	`push_back
 (
io_th»ad
);

262 
¦Ùs
 [
i
] = 
io_th»ad
->
	`g‘_mabox
 ();

263 
io_th»ad
->
	`¡¬t
 ();

267 
št32_t
 
i
 = (št32_tè
¦Ù_couÁ
 - 1;

268 
i
 >ğ(
št32_t
è
ios
 + 2; i--) {

269 
em±y_¦Ùs
.
	`push_back
 (
i
);

270 
¦Ùs
 [
i
] = 
NULL
;

275 ià(
‹rmš©šg
) {

276 
¦Ù_sync
.
	`uÆock
 ();

277 
”ºo
 = 
ETERM
;

278  
NULL
;

282 ià(
em±y_¦Ùs
.
	`em±y
 ()) {

283 
¦Ù_sync
.
	`uÆock
 ();

284 
”ºo
 = 
EMFILE
;

285  
NULL
;

289 
ušt32_t
 
¦Ù
 = 
em±y_¦Ùs
.
	`back
 ();

290 
em±y_¦Ùs
.
	`pİ_back
 ();

293 
sid
 = ((è
max_sock‘_id
.
	`add
 (1)) + 1;

296 
sock‘_ba£_t
 *
s
 = sock‘_ba£_t::
	`ü—‹
 (
ty³_
, 
this
, 
¦Ù
, 
sid
);

297 ià(!
s
) {

298 
em±y_¦Ùs
.
	`push_back
 (
¦Ù
);

299 
¦Ù_sync
.
	`uÆock
 ();

300  
NULL
;

302 
sock‘s
.
	`push_back
 (
s
);

303 
¦Ùs
 [
¦Ù
] = 
s
->
	`g‘_mabox
 ();

305 
¦Ù_sync
.
	`uÆock
 ();

306  
s
;

307 
	}
}

309 
	gzmq
::
ùx_t
::
	$de¡roy_sock‘
 (
şass
 
sock‘_ba£_t
 *
sock‘_
)

311 
¦Ù_sync
.
	`lock
 ();

314 
ušt32_t
 
tid
 = 
sock‘_
->
	`g‘_tid
 ();

315 
em±y_¦Ùs
.
	`push_back
 (
tid
);

316 
¦Ùs
 [
tid
] = 
NULL
;

319 
sock‘s
.
	`”a£
 (
sock‘_
);

323 ià(
‹rmš©šg
 && 
sock‘s
.
	`em±y
 ())

324 
»­”
->
	`¡İ
 ();

326 
¦Ù_sync
.
	`uÆock
 ();

327 
	}
}

329 
	gzmq
::
objeù_t
 *
zmq
::
ùx_t
::
	$g‘_»­”
 ()

331  
»­”
;

332 
	}
}

334 
	gzmq
::
ùx_t
::
	$£nd_commªd
 (
ušt32_t
 
tid_
, cÚ¡ 
commªd_t
 &
commªd_
)

336 
¦Ùs
 [
tid_
]->
	`£nd
 (
commªd_
);

337 
	}
}

339 
	gzmq
::
io_th»ad_t
 *
zmq
::
ùx_t
::
	$choo£_io_th»ad
 (
ušt64_t
 
affš™y_
)

341 ià(
io_th»ads
.
	`em±y
 ())

342  
NULL
;

345 
mš_lßd
 = -1;

346 
io_th»ad_t
 *
£Ëùed_io_th»ad
 = 
NULL
;

347 
io_th»ads_t
::
size_ty³
 
i
 = 0; i !ğ
io_th»ads
.
	`size
 (); i++) {

348 ià(!
affš™y_
 || (affš™y_ & (
	`ušt64_t
 (1è<< 
i
))) {

349 
lßd
 = 
io_th»ads
 [
i
]->
	`g‘_lßd
 ();

350 ià(
£Ëùed_io_th»ad
 =ğ
NULL
 || 
lßd
 < 
mš_lßd
) {

351 
mš_lßd
 = 
lßd
;

352 
£Ëùed_io_th»ad
 = 
io_th»ads
 [
i
];

356  
£Ëùed_io_th»ad
;

357 
	}
}

359 
	gzmq
::
ùx_t
::
	$»gi¡”_’dpošt
 (cÚ¡ *
addr_
, 
’dpošt_t
 &
’dpošt_
)

361 
’dpošts_sync
.
	`lock
 ();

363 
boŞ
 
š£¹ed
 = 
’dpošts
.
	`š£¹
 (
’dpošts_t
::
	`v®ue_ty³
 (

364 
¡d
::
	`¡ršg
 (
addr_
), 
’dpošt_
)).
£cÚd
;

366 
’dpošts_sync
.
	`uÆock
 ();

368 ià(!
š£¹ed
) {

369 
”ºo
 = 
EADDRINUSE
;

374 
	}
}

376 
	gzmq
::
ùx_t
::
	$uÄegi¡”_’dpošts
 (
sock‘_ba£_t
 *
sock‘_
)

378 
’dpošts_sync
.
	`lock
 ();

380 
’dpošts_t
::
™”©Ü
 
™
 = 
’dpošts
.
	`begš
 ();

381 
™
 !ğ
’dpošts
.
	`’d
 ()) {

382 ià(
™
->
£cÚd
.
sock‘
 =ğ
sock‘_
) {

383 
’dpošts_t
::
™”©Ü
 
to_”a£
 = 
™
;

384 ++
™
;

385 
’dpošts
.
	`”a£
 (
to_”a£
);

388 ++
™
;

391 
’dpošts_sync
.
	`uÆock
 ();

392 
	}
}

394 
	gzmq
::
’dpošt_t
 
zmq
::
ùx_t
::
	$fšd_’dpošt
 (cÚ¡ *
addr_
)

396 
’dpošts_sync
.
	`lock
 ();

398 
’dpošts_t
::
™”©Ü
 
™
 = 
’dpošts
.
	`fšd
 (
addr_
);

399 ià(
™
 =ğ
’dpošts
.
	`’d
 ()) {

400 
’dpošts_sync
.
	`uÆock
 ();

401 
”ºo
 = 
ECONNREFUSED
;

402 
’dpošt_t
 
em±y
 = {
NULL
, 
	`İtiÚs_t
()};

403  
em±y
;

405 
’dpošt_t
 
’dpošt
 = 
™
->
£cÚd
;

411 
’dpošt
.
sock‘
->
	`šc_£qnum
 ();

413 
’dpošts_sync
.
	`uÆock
 ();

414  
’dpošt
;

415 
	}
}

417 
	gzmq
::
ùx_t
::
	$³nd_cÚÃùiÚ
 (cÚ¡ *
addr_
, 
³ndšg_cÚÃùiÚ_t
 &
³ndšg_cÚÃùiÚ_
)

419 
’dpošts_sync
.
	`lock
 ();

421 
’dpošts_t
::
™”©Ü
 
™
 = 
’dpošts
.
	`fšd
 (
addr_
);

422 ià(
™
 =ğ
’dpošts
.
	`’d
 ())

425 
³ndšg_cÚÃùiÚ_
.
’dpošt
.
sock‘
->
	`šc_£qnum
 ();

426 
³ndšg_cÚÃùiÚs
.
	`š£¹
 (
³ndšg_cÚÃùiÚs_t
::
	`v®ue_ty³
 (
¡d
::
	`¡ršg
 (
addr_
), 
³ndšg_cÚÃùiÚ_
));

431 
	`cÚÃù_š´oc_sock‘s
(
™
->
£cÚd
.
sock‘
, it->£cÚd.
İtiÚs
, 
³ndšg_cÚÃùiÚ_
, 
cÚÃù_side
);

434 
’dpošts_sync
.
	`uÆock
 ();

435 
	}
}

437 
	gzmq
::
ùx_t
::
	$cÚÃù_³ndšg
 (cÚ¡ *
addr_
, 
zmq
::
sock‘_ba£_t
 *
bšd_sock‘_
)

439 
’dpošts_sync
.
	`lock
 ();

441 
¡d
::
·œ
<
³ndšg_cÚÃùiÚs_t
::
™”©Ü
,…’dšg_cÚÃùiÚs_t::™”©Ü> 
³ndšg
 = 
³ndšg_cÚÃùiÚs
.
	`equ®_¿nge
(
addr_
);

443 
³ndšg_cÚÃùiÚs_t
::
™”©Ü
 
p
 = 
³ndšg
.
fœ¡
;… !ğ³ndšg.
£cÚd
; ++p)

445 
	`cÚÃù_š´oc_sock‘s
(
bšd_sock‘_
, 
’dpošts
[
addr_
].
İtiÚs
, 
p
->
£cÚd
, 
bšd_side
);

448 
³ndšg_cÚÃùiÚs
.
	`”a£
(
³ndšg
.
fœ¡
,…’dšg.
£cÚd
);

450 
’dpošts_sync
.
	`uÆock
 ();

451 
	}
}

453 
	gzmq
::
ùx_t
::
	$cÚÃù_š´oc_sock‘s
(
zmq
::
sock‘_ba£_t
 *
bšd_sock‘_
, 
İtiÚs_t
& 
bšd_İtiÚs
, 
³ndšg_cÚÃùiÚ_t
 &
³ndšg_cÚÃùiÚ_
, 
side
 
side_
)

455 
bšd_sock‘_
->
	`šc_£qnum
();

456 
³ndšg_cÚÃùiÚ_
.
bšd_pe
->
	`£t_tid
(
bšd_sock‘_
->
	`g‘_tid
());

458 ià(!
bšd_İtiÚs
.
»cv_id’t™y
) {

459 
msg_t
 
msg
;

460 cÚ¡ 
boŞ
 
ok
 = 
³ndšg_cÚÃùiÚ_
.
bšd_pe
->
	`»ad
 (&
msg
);

461 
	`zmq_as£¹
 (
ok
);

462 cÚ¡ 
rc
 = 
msg
.
	`şo£
 ();

463 
	`”ºo_as£¹
 (
rc
 == 0);

466 ià(
side_
 =ğ
bšd_side
)

468 
commªd_t
 
cmd
;

469 
cmd
.
ty³
 = 
commªd_t
::
bšd
;

470 
cmd
.
¬gs
.
bšd
.
pe
 = 
³ndšg_cÚÃùiÚ_
.
bšd_pe
;

471 
bšd_sock‘_
->
	`´oûss_commªd
(
cmd
);

472 
bšd_sock‘_
->
	`£nd_š´oc_cÚÃùed
(
³ndšg_cÚÃùiÚ_
.
’dpošt
.
sock‘
);

476 
³ndšg_cÚÃùiÚ_
.
cÚÃù_pe
->
	`£nd_bšd
(
bšd_sock‘_
,…’dšg_cÚÃùiÚ_.
bšd_pe
, 
çl£
);

479 
¢dhwm
 = 0;

480 ià(
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.
¢dhwm
 !ğ0 && 
bšd_İtiÚs
.
rcvhwm
 != 0)

481 
¢dhwm
 = 
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.¢dhwm + 
bšd_İtiÚs
.
rcvhwm
;

482 
rcvhwm
 = 0;

483 ià(
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.
rcvhwm
 !ğ0 && 
bšd_İtiÚs
.
¢dhwm
 != 0)

484 
rcvhwm
 = 
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.rcvhwm + 
bšd_İtiÚs
.
¢dhwm
;

486 
boŞ
 
cÚæ©e
 = 
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.conflate &&

487 (
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.
ty³
 =ğ
ZMQ_DEALER
 ||

488 
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.
ty³
 =ğ
ZMQ_PULL
 ||

489 
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.
ty³
 =ğ
ZMQ_PUSH
 ||

490 
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.
ty³
 =ğ
ZMQ_PUB
 ||

491 
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.
ty³
 =ğ
ZMQ_SUB
);

493 
hwms
 [2] = {
cÚæ©e
? -1 : 
¢dhwm
, cÚæ©e? -1 : 
rcvhwm
};

494 
³ndšg_cÚÃùiÚ_
.
cÚÃù_pe
->
	`£t_hwms
(
hwms
 [1], hwms [0]);

495 
³ndšg_cÚÃùiÚ_
.
bšd_pe
->
	`£t_hwms
(
hwms
 [0], hwms [1]);

497 ià(
³ndšg_cÚÃùiÚ_
.
’dpošt
.
İtiÚs
.
»cv_id’t™y
) {

498 
msg_t
 
id
;

499 
rc
 = 
id
.
	`š™_size
 (
bšd_İtiÚs
.
id’t™y_size
);

500 
	`”ºo_as£¹
 (
rc
 == 0);

501 
	`memıy
 (
id
.
	`d©a
 (), 
bšd_İtiÚs
.
id’t™y
, bšd_İtiÚs.
id’t™y_size
);

502 
id
.
	`£t_æags
 (
msg_t
::
id’t™y
);

503 
boŞ
 
wr™‹n
 = 
³ndšg_cÚÃùiÚ_
.
bšd_pe
->
	`wr™e
 (&
id
);

504 
	`zmq_as£¹
 (
wr™‹n
);

505 
³ndšg_cÚÃùiÚ_
.
bšd_pe
->
	`æush
 ();

507 
	}
}

512 
	gzmq
::
©omic_couÁ”_t
 
zmq
::
ùx_t
::
max_sock‘_id
;

	@ctx.hpp

20 #iâdeà
__ZMQ_CTX_HPP_INCLUDED__


21 
	#__ZMQ_CTX_HPP_INCLUDED__


	)

23 
	~<m­
>

24 
	~<veùÜ
>

25 
	~<¡ršg
>

26 
	~<¡d¬g.h
>

28 
	~"mabox.hµ
"

29 
	~"¬¿y.hµ
"

30 
	~"cÚfig.hµ
"

31 
	~"mu‹x.hµ
"

32 
	~"¡dšt.hµ
"

33 
	~"İtiÚs.hµ
"

34 
	~"©omic_couÁ”.hµ
"

36 
Çme¥aû
 
	gzmq


39 
şass
 
	gobjeù_t
;

40 
şass
 
	gio_th»ad_t
;

41 
şass
 
	gsock‘_ba£_t
;

42 
şass
 
	g»­”_t
;

43 
şass
 
	gpe_t
;

48 
	s’dpošt_t


50 
sock‘_ba£_t
 *
	gsock‘
;

51 
İtiÚs_t
 
	gİtiÚs
;

54 
	s³ndšg_cÚÃùiÚ_t


56 
’dpošt_t
 
	g’dpošt
;

57 
pe_t
* 
	gcÚÃù_pe
;

58 
pe_t
* 
	gbšd_pe
;

64 şas 
	cùx_t


66 
	gpublic
:

69 
ùx_t
 ();

72 
boŞ
 
check_g
 ();

78 
‹rmš©e
 ();

87 
shutdown
();

90 
£t
 (
İtiÚ_
, 
İtv®_
);

91 
g‘
 (
İtiÚ_
);

94 
	gzmq
::
sock‘_ba£_t
 *
ü—‹_sock‘
 (
ty³_
);

95 
de¡roy_sock‘
 (
zmq
::
sock‘_ba£_t
 *
sock‘_
);

98 
£nd_commªd
 (
ušt32_t
 
tid_
, cÚ¡ 
commªd_t
 &
commªd_
);

103 
	gzmq
::
io_th»ad_t
 *
choo£_io_th»ad
 (
ušt64_t
 
affš™y_
);

106 
	gzmq
::
objeù_t
 *
g‘_»­”
 ();

109 
»gi¡”_’dpošt
 (cÚ¡ *
addr_
, 
’dpošt_t
 &
’dpošt_
);

110 
uÄegi¡”_’dpošts
 (
zmq
::
sock‘_ba£_t
 *
sock‘_
);

111 
’dpošt_t
 
fšd_’dpošt
 (cÚ¡ *
addr_
);

112 
³nd_cÚÃùiÚ
 (cÚ¡ *
addr_
, 
³ndšg_cÚÃùiÚ_t
 &
³ndšg_cÚÃùiÚ_
);

113 
cÚÃù_³ndšg
 (cÚ¡ *
addr_
, 
zmq
::
sock‘_ba£_t
 *
bšd_sock‘_
);

116 
	g‹rm_tid
 = 0,

117 
	g»­”_tid
 = 1

120 ~
ùx_t
 ();

122 
	g´iv©e
:

126 
ušt32_t
 
g
;

131 
	g¬¿y_t
 <
	tsock‘_ba£_t
> 
	tsock‘s_t
;

132 
sock‘s_t
 
	gsock‘s
;

135 
	g¡d
::
	tveùÜ
 <
	tušt32_t
> 
	tem±y_¦Ùs_t
;

136 
em±y_¦Ùs_t
 
	gem±y_¦Ùs
;

140 
boŞ
 
	g¡¬tšg
;

143 
boŞ
 
	g‹rmš©šg
;

149 
mu‹x_t
 
	g¦Ù_sync
;

152 
	gzmq
::
»­”_t
 *
»­”
;

155 
	g¡d
::
	tveùÜ
 <
	tzmq
::
	tio_th»ad_t
*> 
	tio_th»ads_t
;

156 
io_th»ads_t
 
	gio_th»ads
;

159 
ušt32_t
 
	g¦Ù_couÁ
;

160 
mabox_t
 **
	g¦Ùs
;

163 
mabox_t
 
	g‹rm_mabox
;

166 
	g¡d
::
	tm­
 <
	t¡d
::
	t¡ršg
, 
	t’dpošt_t
> 
	t’dpošts_t
;

167 
’dpošts_t
 
	g’dpošts
;

170 
	g¡d
::
	tmuÉim­
 <
	t¡d
::
	t¡ršg
, 
	t³ndšg_cÚÃùiÚ_t
> 
	t³ndšg_cÚÃùiÚs_t
;

171 
³ndšg_cÚÃùiÚs_t
 
	g³ndšg_cÚÃùiÚs
;

174 
mu‹x_t
 
	g’dpošts_sync
;

177 
©omic_couÁ”_t
 
	gmax_sock‘_id
;

180 
	gmax_sock‘s
;

183 
	gio_th»ad_couÁ
;

186 
boŞ
 
	gv6
;

189 
mu‹x_t
 
	gİt_sync
;

191 
ùx_t
 (const ctx_t&);

192 cÚ¡ 
	gùx_t
 &
	gİ”©Ü
 = (cÚ¡ 
ùx_t
&);

194 #ifdeà
HAVE_FORK


196 
pid_t
 
	gpid
;

198 
	eside
 { 
	gcÚÃù_side
, 
	gbšd_side
 };

199 
cÚÃù_š´oc_sock‘s
(
zmq
::
sock‘_ba£_t
 *
bšd_sock‘_
, 
İtiÚs_t
& 
bšd_İtiÚs
, 
³ndšg_cÚÃùiÚ_t
 &
³ndšg_cÚÃùiÚ_
, 
side
 
side_
);

	@curve_client.cpp

20 
	~"¶©fÜm.hµ
"

22 #ifdeà
HAVE_LIBSODIUM


24 
	~<sodium.h
>

26 #ifdeà
ZMQ_HAVE_WINDOWS


27 
	~"wšdows.hµ
"

30 
	~"msg.hµ
"

31 
	~"£ssiÚ_ba£.hµ
"

32 
	~"”r.hµ
"

33 
	~"curve_ş›Á.hµ
"

34 
	~"wœe.hµ
"

36 
	gzmq
::
curve_ş›Á_t
::
	$curve_ş›Á_t
 (cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

37 
	`mechªism_t
 (
İtiÚs_
),

38 
	$¡©e
 (
£nd_h–lo
)

40 
	`memıy
 (
public_key
, 
İtiÚs_
.
curve_public_key
, 
üy±o_box_PUBLICKEYBYTES
);

41 
	`memıy
 (
£ü‘_key
, 
İtiÚs_
.
curve_£ü‘_key
, 
üy±o_box_SECRETKEYBYTES
);

42 
	`memıy
 (
£rv”_key
, 
İtiÚs_
.
curve_£rv”_key
, 
üy±o_box_PUBLICKEYBYTES
);

45 cÚ¡ 
rc
 = 
	`üy±o_box_key·œ
 (
ú_public
, 
ú_£ü‘
);

46 
	`zmq_as£¹
 (
rc
 == 0);

47 
	}
}

49 
	gzmq
::
curve_ş›Á_t
::~
	$curve_ş›Á_t
 ()

51 
	}
}

53 
zmq
::
curve_ş›Á_t
::
	$Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
)

55 
rc
 = 0;

57 
¡©e
) {

58 
£nd_h–lo
:

59 
rc
 = 
	`´oduû_h–lo
 (
msg_
);

60 ià(
rc
 == 0)

61 
¡©e
 = 
ex³ù_w–come
;

63 
£nd_š™Ÿ‹
:

64 
rc
 = 
	`´oduû_š™Ÿ‹
 (
msg_
);

65 ià(
rc
 == 0)

66 
¡©e
 = 
ex³ù_»ady
;

69 
”ºo
 = 
EAGAIN
;

70 
rc
 = -1;

72  
rc
;

73 
	}
}

75 
	gzmq
::
curve_ş›Á_t
::
	$´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
)

77 
rc
 = 0;

79 
¡©e
) {

80 
ex³ù_w–come
:

81 
rc
 = 
	`´oûss_w–come
 (
msg_
);

82 ià(
rc
 == 0)

83 
¡©e
 = 
£nd_š™Ÿ‹
;

85 
ex³ù_»ady
:

86 
rc
 = 
	`´oûss_»ady
 (
msg_
);

87 ià(
rc
 == 0)

88 
¡©e
 = 
cÚÃùed
;

91 
”ºo
 = 
EPROTO
;

92 
rc
 = -1;

95 ià(
rc
 == 0) {

96 
rc
 = 
msg_
->
	`şo£
 ();

97 
	`”ºo_as£¹
 (
rc
 == 0);

98 
rc
 = 
msg_
->
	`š™
 ();

99 
	`”ºo_as£¹
 (
rc
 == 0);

101  
rc
;

102 
	}
}

104 
	gzmq
::
curve_ş›Á_t
::
	$’code
 (
msg_t
 *
msg_
)

106 
	`zmq_as£¹
 (
¡©e
 =ğ
cÚÃùed
);

108 
ušt8_t
 
æags
 = 0;

109 ià(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
)

110 
æags
 |= 0x01;

112 
ušt8_t
 
mes§ge_nÚû
 [
üy±o_box_NONCEBYTES
];

113 
	`memıy
 (
mes§ge_nÚû
, "CurveZMQMESSAGEC", 16);

114 
	`memıy
 (
mes§ge_nÚû
 + 16, &
ú_nÚû
, 8);

116 cÚ¡ 
size_t
 
mËn
 = 
üy±o_box_ZEROBYTES
 + 1 + 
msg_
->
	`size
 ();

118 
ušt8_t
 *
mes§ge_¶aš‹xt
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
	`m®loc
 (
mËn
));

119 
	`®loc_as£¹
 (
mes§ge_¶aš‹xt
);

121 
	`mem£t
 (
mes§ge_¶aš‹xt
, 0, 
üy±o_box_ZEROBYTES
);

122 
mes§ge_¶aš‹xt
 [
üy±o_box_ZEROBYTES
] = 
æags
;

123 
	`memıy
 (
mes§ge_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 1,

124 
msg_
->
	`d©a
 (), msg_->
	`size
 ());

126 
ušt8_t
 *
mes§ge_box
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
	`m®loc
 (
mËn
));

127 
	`®loc_as£¹
 (
mes§ge_box
);

129 
rc
 = 
	`üy±o_box_aá”nm
 (
mes§ge_box
, 
mes§ge_¶aš‹xt
,

130 
mËn
, 
mes§ge_nÚû
, 
ú_´ecom
);

131 
	`zmq_as£¹
 (
rc
 == 0);

133 
rc
 = 
msg_
->
	`şo£
 ();

134 
	`zmq_as£¹
 (
rc
 == 0);

136 
rc
 = 
msg_
->
	`š™_size
 (16 + 
mËn
 - 
üy±o_box_BOXZEROBYTES
);

137 
	`zmq_as£¹
 (
rc
 == 0);

139 
ušt8_t
 *
mes§ge
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

141 
	`memıy
 (
mes§ge
, "\x07MESSAGE", 8);

142 
	`memıy
 (
mes§ge
 + 8, &
ú_nÚû
, 8);

143 
	`memıy
 (
mes§ge
 + 16, 
mes§ge_box
 + 
üy±o_box_BOXZEROBYTES
,

144 
mËn
 - 
üy±o_box_BOXZEROBYTES
);

146 
	`ä“
 (
mes§ge_¶aš‹xt
);

147 
	`ä“
 (
mes§ge_box
);

149 
ú_nÚû
++;

152 
	}
}

154 
	gzmq
::
curve_ş›Á_t
::
	$decode
 (
msg_t
 *
msg_
)

156 
	`zmq_as£¹
 (
¡©e
 =ğ
cÚÃùed
);

158 ià(
msg_
->
	`size
 () < 33) {

159 
”ºo
 = 
EPROTO
;

163 cÚ¡ 
ušt8_t
 *
mes§ge
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

164 ià(
	`memcmp
 (
mes§ge
, "\x07MESSAGE", 8)) {

165 
”ºo
 = 
EPROTO
;

169 
ušt8_t
 
mes§ge_nÚû
 [
üy±o_box_NONCEBYTES
];

170 
	`memıy
 (
mes§ge_nÚû
, "CurveZMQMESSAGES", 16);

171 
	`memıy
 (
mes§ge_nÚû
 + 16, 
mes§ge
 + 8, 8);

173 cÚ¡ 
size_t
 
ş’
 = 
üy±o_box_BOXZEROBYTES
 + (
msg_
->
	`size
 () - 16);

175 
ušt8_t
 *
mes§ge_¶aš‹xt
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
	`m®loc
 (
ş’
));

176 
	`®loc_as£¹
 (
mes§ge_¶aš‹xt
);

178 
ušt8_t
 *
mes§ge_box
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
	`m®loc
 (
ş’
));

179 
	`®loc_as£¹
 (
mes§ge_box
);

181 
	`mem£t
 (
mes§ge_box
, 0, 
üy±o_box_BOXZEROBYTES
);

182 
	`memıy
 (
mes§ge_box
 + 
üy±o_box_BOXZEROBYTES
,

183 
mes§ge
 + 16, 
msg_
->
	`size
 () - 16);

185 
rc
 = 
	`üy±o_box_İ’_aá”nm
 (
mes§ge_¶aš‹xt
, 
mes§ge_box
,

186 
ş’
, 
mes§ge_nÚû
, 
ú_´ecom
);

187 ià(
rc
 == 0) {

188 
rc
 = 
msg_
->
	`şo£
 ();

189 
	`zmq_as£¹
 (
rc
 == 0);

191 
rc
 = 
msg_
->
	`š™_size
 (
ş’
 - 1 - 
üy±o_box_ZEROBYTES
);

192 
	`zmq_as£¹
 (
rc
 == 0);

194 cÚ¡ 
ušt8_t
 
æags
 = 
mes§ge_¶aš‹xt
 [
üy±o_box_ZEROBYTES
];

195 ià(
æags
 & 0x01)

196 
msg_
->
	`£t_æags
 (
msg_t
::
mÜe
);

198 
	`memıy
 (
msg_
->
	`d©a
 (),

199 
mes§ge_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 1,

200 
msg_
->
	`size
 ());

203 
”ºo
 = 
EPROTO
;

205 
	`ä“
 (
mes§ge_¶aš‹xt
);

206 
	`ä“
 (
mes§ge_box
);

208  
rc
;

209 
	}
}

211 
boŞ
 
	gzmq
::
curve_ş›Á_t
::
	$is_hªdshake_com¶‘e
 () const

213  
¡©e
 =ğ
cÚÃùed
;

214 
	}
}

216 
	gzmq
::
curve_ş›Á_t
::
	$´oduû_h–lo
 (
msg_t
 *
msg_
)

218 
ušt8_t
 
h–lo_nÚû
 [
üy±o_box_NONCEBYTES
];

219 
ušt8_t
 
h–lo_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 64];

220 
ušt8_t
 
h–lo_box
 [
üy±o_box_BOXZEROBYTES
 + 80];

223 
	`memıy
 (
h–lo_nÚû
, "CurveZMQHELLO---", 16);

224 
	`memıy
 (
h–lo_nÚû
 + 16, &
ú_nÚû
, 8);

227 
	`mem£t
 (
h–lo_¶aš‹xt
, 0,  hello_plaintext);

229 
rc
 = 
	`üy±o_box
 (
h–lo_box
, 
h–lo_¶aš‹xt
,

230  
h–lo_¶aš‹xt
,

231 
h–lo_nÚû
, 
£rv”_key
, 
ú_£ü‘
);

232 
	`zmq_as£¹
 (
rc
 == 0);

234 
rc
 = 
msg_
->
	`š™_size
 (200);

235 
	`”ºo_as£¹
 (
rc
 == 0);

236 
ušt8_t
 *
h–lo
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

238 
	`memıy
 (
h–lo
, "\x05HELLO", 6);

240 
	`memıy
 (
h–lo
 + 6, "\1\0", 2);

242 
	`mem£t
 (
h–lo
 + 8, 0, 72);

244 
	`memıy
 (
h–lo
 + 80, 
ú_public
, 
üy±o_box_PUBLICKEYBYTES
);

246 
	`memıy
 (
h–lo
 + 112, 
h–lo_nÚû
 + 16, 8);

248 
	`memıy
 (
h–lo
 + 120, 
h–lo_box
 + 
üy±o_box_BOXZEROBYTES
, 80);

250 
ú_nÚû
++;

253 
	}
}

255 
	gzmq
::
curve_ş›Á_t
::
	$´oûss_w–come
 (
msg_t
 *
msg_
)

257 ià(
msg_
->
	`size
 () != 168) {

258 
”ºo
 = 
EPROTO
;

262 cÚ¡ 
ušt8_t
 * 
w–come
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

263 ià(
	`memcmp
 (
w–come
, "\x07WELCOME", 8)) {

264 
”ºo
 = 
EPROTO
;

268 
ušt8_t
 
w–come_nÚû
 [
üy±o_box_NONCEBYTES
];

269 
ušt8_t
 
w–come_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 128];

270 
ušt8_t
 
w–come_box
 [
üy±o_box_BOXZEROBYTES
 + 144];

273 
	`mem£t
 (
w–come_box
, 0, 
üy±o_box_BOXZEROBYTES
);

274 
	`memıy
 (
w–come_box
 + 
üy±o_box_BOXZEROBYTES
, 
w–come
 + 24, 144);

276 
	`memıy
 (
w–come_nÚû
, "WELCOME-", 8);

277 
	`memıy
 (
w–come_nÚû
 + 8, 
w–come
 + 8, 16);

279 
rc
 = 
	`üy±o_box_İ’
 (
w–come_¶aš‹xt
, 
w–come_box
,

280  
w–come_box
,

281 
w–come_nÚû
, 
£rv”_key
, 
ú_£ü‘
);

282 ià(
rc
 != 0) {

283 
”ºo
 = 
EPROTO
;

287 
	`memıy
 (
ú_£rv”
, 
w–come_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
, 32);

288 
	`memıy
 (
ú_cook›
, 
w–come_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 32, 16 + 80);

291 
rc
 = 
	`üy±o_box_befÜ’m
 (
ú_´ecom
, 
ú_£rv”
, 
ú_£ü‘
);

292 
	`zmq_as£¹
 (
rc
 == 0);

295 
	}
}

297 
	gzmq
::
curve_ş›Á_t
::
	$´oduû_š™Ÿ‹
 (
msg_t
 *
msg_
)

299 
ušt8_t
 
vouch_nÚû
 [
üy±o_box_NONCEBYTES
];

300 
ušt8_t
 
vouch_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 64];

301 
ušt8_t
 
vouch_box
 [
üy±o_box_BOXZEROBYTES
 + 80];

304 
	`mem£t
 (
vouch_¶aš‹xt
, 0, 
üy±o_box_ZEROBYTES
);

305 
	`memıy
 (
vouch_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
, 
ú_public
, 32);

306 
	`memıy
 (
vouch_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 32, 
£rv”_key
, 32);

308 
	`memıy
 (
vouch_nÚû
, "VOUCH---", 8);

309 
	`¿ndomby‹s
 (
vouch_nÚû
 + 8, 16);

311 
rc
 = 
	`üy±o_box
 (
vouch_box
, 
vouch_¶aš‹xt
,

312  
vouch_¶aš‹xt
,

313 
vouch_nÚû
, 
ú_£rv”
, 
£ü‘_key
);

314 
	`zmq_as£¹
 (
rc
 == 0);

317 
ušt8_t
 
š™Ÿ‹_nÚû
 [
üy±o_box_NONCEBYTES
];

318 
ušt8_t
 
š™Ÿ‹_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 128 + 256];

319 
ušt8_t
 
š™Ÿ‹_box
 [
üy±o_box_BOXZEROBYTES
 + 144 + 256];

322 
	`mem£t
 (
š™Ÿ‹_¶aš‹xt
, 0, 
üy±o_box_ZEROBYTES
);

323 
	`memıy
 (
š™Ÿ‹_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
,

324 
public_key
, 32);

325 
	`memıy
 (
š™Ÿ‹_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 32,

326 
vouch_nÚû
 + 8, 16);

327 
	`memıy
 (
š™Ÿ‹_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 48,

328 
vouch_box
 + 
üy±o_box_BOXZEROBYTES
, 80);

331 
ušt8_t
 *
±r
 = 
š™Ÿ‹_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 128;

334 cÚ¡ *
sock‘_ty³
 = 
	`sock‘_ty³_¡ršg
 (
İtiÚs
.
ty³
);

335 
±r
 +ğ
	`add_´İ”ty
 (±r, "Sock‘-Ty³", 
sock‘_ty³
, 
	`¡¾’
 (socket_type));

338 ià(
İtiÚs
.
ty³
 =ğ
ZMQ_REQ


339 || 
İtiÚs
.
ty³
 =ğ
ZMQ_DEALER


340 || 
İtiÚs
.
ty³
 =ğ
ZMQ_ROUTER
)

341 
±r
 +ğ
	`add_´İ”ty
 (ptr, "Identity",

342 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

344 cÚ¡ 
size_t
 
mËn
 = 
±r
 - 
š™Ÿ‹_¶aš‹xt
;

346 
	`memıy
 (
š™Ÿ‹_nÚû
, "CurveZMQINITIATE", 16);

347 
	`memıy
 (
š™Ÿ‹_nÚû
 + 16, &
ú_nÚû
, 8);

349 
rc
 = 
	`üy±o_box
 (
š™Ÿ‹_box
, 
š™Ÿ‹_¶aš‹xt
,

350 
mËn
, 
š™Ÿ‹_nÚû
, 
ú_£rv”
, 
ú_£ü‘
);

351 
	`zmq_as£¹
 (
rc
 == 0);

353 
rc
 = 
msg_
->
	`š™_size
 (113 + 
mËn
 - 
üy±o_box_BOXZEROBYTES
);

354 
	`”ºo_as£¹
 (
rc
 == 0);

356 
ušt8_t
 *
š™Ÿ‹
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

358 
	`memıy
 (
š™Ÿ‹
, "\x08INITIATE", 9);

360 
	`memıy
 (
š™Ÿ‹
 + 9, 
ú_cook›
, 96);

362 
	`memıy
 (
š™Ÿ‹
 + 105, &
ú_nÚû
, 8);

364 
	`memıy
 (
š™Ÿ‹
 + 113, 
š™Ÿ‹_box
 + 
üy±o_box_BOXZEROBYTES
,

365 
mËn
 - 
üy±o_box_BOXZEROBYTES
);

366 
ú_nÚû
++;

369 
	}
}

371 
	gzmq
::
curve_ş›Á_t
::
	$´oûss_»ady
 (
msg_t
 *
msg_
)

373 ià(
msg_
->
	`size
 () < 30) {

374 
”ºo
 = 
EPROTO
;

378 cÚ¡ 
ušt8_t
 *
»ady
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

379 ià(
	`memcmp
 (
»ady
, "\x05READY", 6)) {

380 
”ºo
 = 
EPROTO
;

384 cÚ¡ 
size_t
 
ş’
 = (
msg_
->
	`size
 (è- 14è+ 
üy±o_box_BOXZEROBYTES
;

386 
ušt8_t
 
»ady_nÚû
 [
üy±o_box_NONCEBYTES
];

387 
ušt8_t
 
»ady_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 256];

388 
ušt8_t
 
»ady_box
 [
üy±o_box_BOXZEROBYTES
 + 16 + 256];

390 
	`mem£t
 (
»ady_box
, 0, 
üy±o_box_BOXZEROBYTES
);

391 
	`memıy
 (
»ady_box
 + 
üy±o_box_BOXZEROBYTES
,

392 
»ady
 + 14, 
ş’
 - 
üy±o_box_BOXZEROBYTES
);

394 
	`memıy
 (
»ady_nÚû
, "CurveZMQREADY---", 16);

395 
	`memıy
 (
»ady_nÚû
 + 16, 
»ady
 + 6, 8);

397 
rc
 = 
	`üy±o_box_İ’_aá”nm
 (
»ady_¶aš‹xt
, 
»ady_box
,

398 
ş’
, 
»ady_nÚû
, 
ú_´ecom
);

400 ià(
rc
 != 0) {

401 
”ºo
 = 
EPROTO
;

405 
rc
 = 
	`·r£_m‘ad©a
 (
»ady_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
,

406 
ş’
 - 
üy±o_box_ZEROBYTES
);

407  
rc
;

408 
	}
}

	@curve_client.hpp

20 #iâdeà
__ZMQ_CURVE_CLIENT_HPP_INCLUDED__


21 
	#__ZMQ_CURVE_CLIENT_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ifdeà
HAVE_LIBSODIUM


26 
	~<sodium.h
>

28 #ià
üy±o_box_NONCEBYTES
 != 24 \

29 || 
	güy±o_box_PUBLICKEYBYTES
 != 32 \

30 || 
üy±o_box_SECRETKEYBYTES
 != 32 \

31 || 
üy±o_box_ZEROBYTES
 != 32 \

32 || 
üy±o_box_BOXZEROBYTES
 != 16

36 
	~"mechªism.hµ
"

37 
	~"İtiÚs.hµ
"

39 
Çme¥aû
 
zmq


42 
şass
 
msg_t
;

43 
şass
 
	g£ssiÚ_ba£_t
;

45 şas 
	ccurve_ş›Á_t
 : 
public
 
mechªism_t


47 
public
:

49 
curve_ş›Á_t
 (cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

50 
	gvœtu®
 ~
curve_ş›Á_t
 ();

53 
vœtu®
 
Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
);

54 
vœtu®
 
´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
);

55 
vœtu®
 
’code
 (
msg_t
 *
msg_
);

56 
vœtu®
 
decode
 (
msg_t
 *
msg_
);

57 
vœtu®
 
boŞ
 
is_hªdshake_com¶‘e
 () const;

59 
	g´iv©e
:

61 
	e¡©e_t
 {

62 
£nd_h–lo
,

63 
	gex³ù_w–come
,

64 
	g£nd_š™Ÿ‹
,

65 
	gex³ù_»ady
,

66 
	gcÚÃùed


70 
¡©e_t
 
	g¡©e
;

73 
ušt8_t
 
	gpublic_key
 [
üy±o_box_PUBLICKEYBYTES
];

76 
ušt8_t
 
	g£ü‘_key
 [
üy±o_box_SECRETKEYBYTES
];

79 
ušt8_t
 
	gú_public
 [
üy±o_box_PUBLICKEYBYTES
];

82 
ušt8_t
 
	gú_£ü‘
 [
üy±o_box_SECRETKEYBYTES
];

85 
ušt8_t
 
	g£rv”_key
 [
üy±o_box_PUBLICKEYBYTES
];

88 
ušt8_t
 
	gú_£rv”
 [
üy±o_box_PUBLICKEYBYTES
];

91 
ušt8_t
 
	gú_cook›
 [16 + 80];

94 
ušt8_t
 
	gú_´ecom
 [
üy±o_box_BEFORENMBYTES
];

97 
ušt64_t
 
	gú_nÚû
;

99 
´oduû_h–lo
 (
msg_t
 *
msg_
);

100 
´oûss_w–come
 (
msg_t
 *
msg_
);

101 
´oduû_š™Ÿ‹
 (
msg_t
 *
msg_
);

102 
´oûss_»ady
 (
msg_t
 *
msg_
);

	@curve_server.cpp

20 
	~"¶©fÜm.hµ
"

22 #ifdeà
HAVE_LIBSODIUM


23 
	~<sodium.h
>

25 #ifdeà
ZMQ_HAVE_WINDOWS


26 
	~"wšdows.hµ
"

29 
	~"msg.hµ
"

30 
	~"£ssiÚ_ba£.hµ
"

31 
	~"”r.hµ
"

32 
	~"curve_£rv”.hµ
"

33 
	~"wœe.hµ
"

35 
	gzmq
::
curve_£rv”_t
::
	$curve_£rv”_t
 (
£ssiÚ_ba£_t
 *
£ssiÚ_
,

36 cÚ¡ 
¡d
::
¡ršg
 &
³”_add»ss_
,

37 cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

38 
	`mechªism_t
 (
İtiÚs_
),

39 
	`£ssiÚ
 (
£ssiÚ_
),

40 
	`³”_add»ss
 (
³”_add»ss_
),

41 
	`¡©e
 (
ex³ù_h–lo
),

42 
	`ex³ùšg_z­_»¶y
 (
çl£
),

43 
	$ú_nÚû
 (1)

46 
	`memıy
 (
£ü‘_key
, 
İtiÚs_
.
curve_£ü‘_key
, 
üy±o_box_SECRETKEYBYTES
);

49 cÚ¡ 
rc
 = 
	`üy±o_box_key·œ
 (
ú_public
, 
ú_£ü‘
);

50 
	`zmq_as£¹
 (
rc
 == 0);

51 
	}
}

53 
	gzmq
::
curve_£rv”_t
::~
	$curve_£rv”_t
 ()

55 
	}
}

57 
zmq
::
curve_£rv”_t
::
	$Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
)

59 
rc
 = 0;

61 
¡©e
) {

62 
£nd_w–come
:

63 
rc
 = 
	`´oduû_w–come
 (
msg_
);

64 ià(
rc
 == 0)

65 
¡©e
 = 
ex³ù_š™Ÿ‹
;

67 
£nd_»ady
:

68 
rc
 = 
	`´oduû_»ady
 (
msg_
);

69 ià(
rc
 == 0)

70 
¡©e
 = 
cÚÃùed
;

73 
”ºo
 = 
EAGAIN
;

74 
rc
 = -1;

77  
rc
;

78 
	}
}

80 
	gzmq
::
curve_£rv”_t
::
	$´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
)

82 
rc
 = 0;

84 
¡©e
) {

85 
ex³ù_h–lo
:

86 
rc
 = 
	`´oûss_h–lo
 (
msg_
);

87 ià(
rc
 == 0)

88 
¡©e
 = 
£nd_w–come
;

90 
ex³ù_š™Ÿ‹
:

91 
rc
 = 
	`´oûss_š™Ÿ‹
 (
msg_
);

92 ià(
rc
 == 0)

93 
¡©e
 = 
ex³ùšg_z­_»¶y
? 
ex³ù_z­_»¶y
: 
£nd_»ady
;

96 
”ºo
 = 
EPROTO
;

97 
rc
 = -1;

100 ià(
rc
 == 0) {

101 
rc
 = 
msg_
->
	`şo£
 ();

102 
	`”ºo_as£¹
 (
rc
 == 0);

103 
rc
 = 
msg_
->
	`š™
 ();

104 
	`”ºo_as£¹
 (
rc
 == 0);

106  
rc
;

107 
	}
}

109 
	gzmq
::
curve_£rv”_t
::
	$’code
 (
msg_t
 *
msg_
)

111 
	`zmq_as£¹
 (
¡©e
 =ğ
cÚÃùed
);

113 cÚ¡ 
size_t
 
mËn
 = 
üy±o_box_ZEROBYTES
 + 1 + 
msg_
->
	`size
 ();

115 
ušt8_t
 
mes§ge_nÚû
 [
üy±o_box_NONCEBYTES
];

116 
	`memıy
 (
mes§ge_nÚû
, "CurveZMQMESSAGES", 16);

117 
	`memıy
 (
mes§ge_nÚû
 + 16, &
ú_nÚû
, 8);

119 
ušt8_t
 
æags
 = 0;

120 ià(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
)

121 
æags
 |= 0x01;

123 
ušt8_t
 *
mes§ge_¶aš‹xt
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
	`m®loc
 (
mËn
));

124 
	`®loc_as£¹
 (
mes§ge_¶aš‹xt
);

126 
	`mem£t
 (
mes§ge_¶aš‹xt
, 0, 
üy±o_box_ZEROBYTES
);

127 
mes§ge_¶aš‹xt
 [
üy±o_box_ZEROBYTES
] = 
æags
;

128 
	`memıy
 (
mes§ge_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 1,

129 
msg_
->
	`d©a
 (), msg_->
	`size
 ());

131 
ušt8_t
 *
mes§ge_box
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
	`m®loc
 (
mËn
));

132 
	`®loc_as£¹
 (
mes§ge_box
);

134 
rc
 = 
	`üy±o_box_aá”nm
 (
mes§ge_box
, 
mes§ge_¶aš‹xt
,

135 
mËn
, 
mes§ge_nÚû
, 
ú_´ecom
);

136 
	`zmq_as£¹
 (
rc
 == 0);

138 
rc
 = 
msg_
->
	`şo£
 ();

139 
	`zmq_as£¹
 (
rc
 == 0);

141 
rc
 = 
msg_
->
	`š™_size
 (16 + 
mËn
 - 
üy±o_box_BOXZEROBYTES
);

142 
	`zmq_as£¹
 (
rc
 == 0);

144 
ušt8_t
 *
mes§ge
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

146 
	`memıy
 (
mes§ge
, "\x07MESSAGE", 8);

147 
	`memıy
 (
mes§ge
 + 8, &
ú_nÚû
, 8);

148 
	`memıy
 (
mes§ge
 + 16, 
mes§ge_box
 + 
üy±o_box_BOXZEROBYTES
,

149 
mËn
 - 
üy±o_box_BOXZEROBYTES
);

151 
	`ä“
 (
mes§ge_¶aš‹xt
);

152 
	`ä“
 (
mes§ge_box
);

154 
ú_nÚû
++;

157 
	}
}

159 
	gzmq
::
curve_£rv”_t
::
	$decode
 (
msg_t
 *
msg_
)

161 
	`zmq_as£¹
 (
¡©e
 =ğ
cÚÃùed
);

163 ià(
msg_
->
	`size
 () < 33) {

164 
”ºo
 = 
EPROTO
;

168 cÚ¡ 
ušt8_t
 *
mes§ge
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

169 ià(
	`memcmp
 (
mes§ge
, "\x07MESSAGE", 8)) {

170 
”ºo
 = 
EPROTO
;

174 
ušt8_t
 
mes§ge_nÚû
 [
üy±o_box_NONCEBYTES
];

175 
	`memıy
 (
mes§ge_nÚû
, "CurveZMQMESSAGEC", 16);

176 
	`memıy
 (
mes§ge_nÚû
 + 16, 
mes§ge
 + 8, 8);

178 cÚ¡ 
size_t
 
ş’
 = 
üy±o_box_BOXZEROBYTES
 + 
msg_
->
	`size
 () - 16;

180 
ušt8_t
 *
mes§ge_¶aš‹xt
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
	`m®loc
 (
ş’
));

181 
	`®loc_as£¹
 (
mes§ge_¶aš‹xt
);

183 
ušt8_t
 *
mes§ge_box
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
	`m®loc
 (
ş’
));

184 
	`®loc_as£¹
 (
mes§ge_box
);

186 
	`mem£t
 (
mes§ge_box
, 0, 
üy±o_box_BOXZEROBYTES
);

187 
	`memıy
 (
mes§ge_box
 + 
üy±o_box_BOXZEROBYTES
,

188 
mes§ge
 + 16, 
msg_
->
	`size
 () - 16);

190 
rc
 = 
	`üy±o_box_İ’_aá”nm
 (
mes§ge_¶aš‹xt
, 
mes§ge_box
,

191 
ş’
, 
mes§ge_nÚû
, 
ú_´ecom
);

192 ià(
rc
 == 0) {

193 
rc
 = 
msg_
->
	`şo£
 ();

194 
	`zmq_as£¹
 (
rc
 == 0);

196 
rc
 = 
msg_
->
	`š™_size
 (
ş’
 - 1 - 
üy±o_box_ZEROBYTES
);

197 
	`zmq_as£¹
 (
rc
 == 0);

199 cÚ¡ 
ušt8_t
 
æags
 = 
mes§ge_¶aš‹xt
 [
üy±o_box_ZEROBYTES
];

200 ià(
æags
 & 0x01)

201 
msg_
->
	`£t_æags
 (
msg_t
::
mÜe
);

203 
	`memıy
 (
msg_
->
	`d©a
 (),

204 
mes§ge_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 1,

205 
msg_
->
	`size
 ());

208 
”ºo
 = 
EPROTO
;

210 
	`ä“
 (
mes§ge_¶aš‹xt
);

211 
	`ä“
 (
mes§ge_box
);

213  
rc
;

214 
	}
}

216 
	gzmq
::
curve_£rv”_t
::
	$z­_msg_avaabË
 ()

218 ià(
¡©e
 !ğ
ex³ù_z­_»¶y
) {

219 
”ºo
 = 
EFSM
;

222 cÚ¡ 
rc
 = 
	`»ûive_ªd_´oûss_z­_»¶y
 ();

223 ià(
rc
 == 0)

224 
¡©e
 = 
£nd_»ady
;

225  
rc
;

226 
	}
}

228 
boŞ
 
	gzmq
::
curve_£rv”_t
::
	$is_hªdshake_com¶‘e
 () const

230  
¡©e
 =ğ
cÚÃùed
;

231 
	}
}

233 
	gzmq
::
curve_£rv”_t
::
	$´oûss_h–lo
 (
msg_t
 *
msg_
)

235 ià(
msg_
->
	`size
 () != 200) {

236 
”ºo
 = 
EPROTO
;

240 cÚ¡ 
ušt8_t
 * cÚ¡ 
h–lo
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

241 ià(
	`memcmp
 (
h–lo
, "\x05HELLO", 6)) {

242 
”ºo
 = 
EPROTO
;

246 cÚ¡ 
ušt8_t
 
majÜ
 = 
h–lo
 [6];

247 cÚ¡ 
ušt8_t
 
mšÜ
 = 
h–lo
 [7];

249 ià(
majÜ
 !ğ1 || 
mšÜ
 != 0) {

250 
”ºo
 = 
EPROTO
;

255 
	`memıy
 (
ú_ş›Á
, 
h–lo
 + 80, 32);

257 
ušt8_t
 
h–lo_nÚû
 [
üy±o_box_NONCEBYTES
];

258 
ušt8_t
 
h–lo_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 64];

259 
ušt8_t
 
h–lo_box
 [
üy±o_box_BOXZEROBYTES
 + 80];

261 
	`memıy
 (
h–lo_nÚû
, "CurveZMQHELLO---", 16);

262 
	`memıy
 (
h–lo_nÚû
 + 16, 
h–lo
 + 112, 8);

264 
	`mem£t
 (
h–lo_box
, 0, 
üy±o_box_BOXZEROBYTES
);

265 
	`memıy
 (
h–lo_box
 + 
üy±o_box_BOXZEROBYTES
, 
h–lo
 + 120, 80);

268 
rc
 = 
	`üy±o_box_İ’
 (
h–lo_¶aš‹xt
, 
h–lo_box
,

269  
h–lo_box
,

270 
h–lo_nÚû
, 
ú_ş›Á
, 
£ü‘_key
);

271 ià(
rc
 != 0) {

272 
”ºo
 = 
EPROTO
;

276  
rc
;

277 
	}
}

279 
	gzmq
::
curve_£rv”_t
::
	$´oduû_w–come
 (
msg_t
 *
msg_
)

281 
ušt8_t
 
cook›_nÚû
 [
üy±o_£ü‘box_NONCEBYTES
];

282 
ušt8_t
 
cook›_¶aš‹xt
 [
üy±o_£ü‘box_ZEROBYTES
 + 64];

283 
ušt8_t
 
cook›_ch”‹xt
 [
üy±o_£ü‘box_BOXZEROBYTES
 + 80];

287 
	`memıy
 (
cook›_nÚû
, "COOKIE--", 8);

288 
	`¿ndomby‹s
 (
cook›_nÚû
 + 8, 16);

291 
	`mem£t
 (
cook›_¶aš‹xt
, 0, 
üy±o_£ü‘box_ZEROBYTES
);

292 
	`memıy
 (
cook›_¶aš‹xt
 + 
üy±o_£ü‘box_ZEROBYTES
,

293 
ú_ş›Á
, 32);

294 
	`memıy
 (
cook›_¶aš‹xt
 + 
üy±o_£ü‘box_ZEROBYTES
 + 32,

295 
ú_£ü‘
, 32);

298 
	`¿ndomby‹s
 (
cook›_key
, 
üy±o_£ü‘box_KEYBYTES
);

301 
rc
 = 
	`üy±o_£ü‘box
 (
cook›_ch”‹xt
, 
cook›_¶aš‹xt
,

302  
cook›_¶aš‹xt
,

303 
cook›_nÚû
, 
cook›_key
);

304 
	`zmq_as£¹
 (
rc
 == 0);

306 
ušt8_t
 
w–come_nÚû
 [
üy±o_box_NONCEBYTES
];

307 
ušt8_t
 
w–come_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 128];

308 
ušt8_t
 
w–come_ch”‹xt
 [
üy±o_box_BOXZEROBYTES
 + 144];

312 
	`memıy
 (
w–come_nÚû
, "WELCOME-", 8);

313 
	`¿ndomby‹s
 (
w–come_nÚû
 + 8, 
üy±o_box_NONCEBYTES
 - 8);

316 
	`mem£t
 (
w–come_¶aš‹xt
, 0, 
üy±o_box_ZEROBYTES
);

317 
	`memıy
 (
w–come_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
, 
ú_public
, 32);

318 
	`memıy
 (
w–come_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 32,

319 
cook›_nÚû
 + 8, 16);

320 
	`memıy
 (
w–come_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 48,

321 
cook›_ch”‹xt
 + 
üy±o_£ü‘box_BOXZEROBYTES
, 80);

323 
rc
 = 
	`üy±o_box
 (
w–come_ch”‹xt
, 
w–come_¶aš‹xt
,

324  
w–come_¶aš‹xt
,

325 
w–come_nÚû
, 
ú_ş›Á
, 
£ü‘_key
);

326 
	`zmq_as£¹
 (
rc
 == 0);

328 
rc
 = 
msg_
->
	`š™_size
 (168);

329 
	`”ºo_as£¹
 (
rc
 == 0);

331 
ušt8_t
 * cÚ¡ 
w–come
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

332 
	`memıy
 (
w–come
, "\x07WELCOME", 8);

333 
	`memıy
 (
w–come
 + 8, 
w–come_nÚû
 + 8, 16);

334 
	`memıy
 (
w–come
 + 24, 
w–come_ch”‹xt
 + 
üy±o_box_BOXZEROBYTES
, 144);

337 
	}
}

339 
	gzmq
::
curve_£rv”_t
::
	$´oûss_š™Ÿ‹
 (
msg_t
 *
msg_
)

341 ià(
msg_
->
	`size
 () < 257) {

342 
”ºo
 = 
EPROTO
;

346 cÚ¡ 
ušt8_t
 *
š™Ÿ‹
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

347 ià(
	`memcmp
 (
š™Ÿ‹
, "\x08INITIATE", 9)) {

348 
”ºo
 = 
EPROTO
;

352 
ušt8_t
 
cook›_nÚû
 [
üy±o_£ü‘box_NONCEBYTES
];

353 
ušt8_t
 
cook›_¶aš‹xt
 [
üy±o_£ü‘box_ZEROBYTES
 + 64];

354 
ušt8_t
 
cook›_box
 [
üy±o_£ü‘box_BOXZEROBYTES
 + 80];

357 
	`mem£t
 (
cook›_box
, 0, 
üy±o_£ü‘box_BOXZEROBYTES
);

358 
	`memıy
 (
cook›_box
 + 
üy±o_£ü‘box_BOXZEROBYTES
, 
š™Ÿ‹
 + 25, 80);

360 
	`memıy
 (
cook›_nÚû
, "COOKIE--", 8);

361 
	`memıy
 (
cook›_nÚû
 + 8, 
š™Ÿ‹
 + 9, 16);

363 
rc
 = 
	`üy±o_£ü‘box_İ’
 (
cook›_¶aš‹xt
, 
cook›_box
,

364  
cook›_box
,

365 
cook›_nÚû
, 
cook›_key
);

366 ià(
rc
 != 0) {

367 
”ºo
 = 
EPROTO
;

372 ià(
	`memcmp
 (
cook›_¶aš‹xt
 + 
üy±o_£ü‘box_ZEROBYTES
, 
ú_ş›Á
, 32)

373 || 
	`memcmp
 (
cook›_¶aš‹xt
 + 
üy±o_£ü‘box_ZEROBYTES
 + 32, 
ú_£ü‘
, 32)) {

374 
”ºo
 = 
EPROTO
;

378 cÚ¡ 
size_t
 
ş’
 = (
msg_
->
	`size
 (è- 113è+ 
üy±o_box_BOXZEROBYTES
;

380 
ušt8_t
 
š™Ÿ‹_nÚû
 [
üy±o_box_NONCEBYTES
];

381 
ušt8_t
 
š™Ÿ‹_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 128 + 256];

382 
ušt8_t
 
š™Ÿ‹_box
 [
üy±o_box_BOXZEROBYTES
 + 144 + 256];

385 
	`mem£t
 (
š™Ÿ‹_box
, 0, 
üy±o_box_BOXZEROBYTES
);

386 
	`memıy
 (
š™Ÿ‹_box
 + 
üy±o_box_BOXZEROBYTES
,

387 
š™Ÿ‹
 + 113, 
ş’
 - 
üy±o_box_BOXZEROBYTES
);

389 
	`memıy
 (
š™Ÿ‹_nÚû
, "CurveZMQINITIATE", 16);

390 
	`memıy
 (
š™Ÿ‹_nÚû
 + 16, 
š™Ÿ‹
 + 105, 8);

392 
rc
 = 
	`üy±o_box_İ’
 (
š™Ÿ‹_¶aš‹xt
, 
š™Ÿ‹_box
,

393 
ş’
, 
š™Ÿ‹_nÚû
, 
ú_ş›Á
, 
ú_£ü‘
);

394 ià(
rc
 != 0) {

395 
”ºo
 = 
EPROTO
;

399 cÚ¡ 
ušt8_t
 *
ş›Á_key
 = 
š™Ÿ‹_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
;

401 
ušt8_t
 
vouch_nÚû
 [
üy±o_box_NONCEBYTES
];

402 
ušt8_t
 
vouch_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 64];

403 
ušt8_t
 
vouch_box
 [
üy±o_box_BOXZEROBYTES
 + 80];

406 
	`mem£t
 (
vouch_box
, 0, 
üy±o_box_BOXZEROBYTES
);

407 
	`memıy
 (
vouch_box
 + 
üy±o_box_BOXZEROBYTES
,

408 
š™Ÿ‹_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 48, 80);

410 
	`memıy
 (
vouch_nÚû
, "VOUCH---", 8);

411 
	`memıy
 (
vouch_nÚû
 + 8,

412 
š™Ÿ‹_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 32, 16);

414 
rc
 = 
	`üy±o_box_İ’
 (
vouch_¶aš‹xt
, 
vouch_box
,

415  
vouch_box
,

416 
vouch_nÚû
, 
ş›Á_key
, 
ú_£ü‘
);

417 ià(
rc
 != 0) {

418 
”ºo
 = 
EPROTO
;

423 ià(
	`memcmp
 (
vouch_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
, 
ú_ş›Á
, 32)) {

424 
”ºo
 = 
EPROTO
;

429 
rc
 = 
	`üy±o_box_befÜ’m
 (
ú_´ecom
, 
ú_ş›Á
, 
ú_£ü‘
);

430 
	`zmq_as£¹
 (
rc
 == 0);

433 
rc
 = 
£ssiÚ
->
	`z­_cÚÃù
 ();

434 ià(
rc
 == 0) {

435 
	`£nd_z­_»que¡
 (
ş›Á_key
);

436 
rc
 = 
	`»ûive_ªd_´oûss_z­_»¶y
 ();

437 ià(
rc
 != 0) {

438 ià(
”ºo
 !ğ
EAGAIN
)

440 
ex³ùšg_z­_»¶y
 = 
Œue
;

444  
	`·r£_m‘ad©a
 (
š™Ÿ‹_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
 + 128,

445 
ş’
 - 
üy±o_box_ZEROBYTES
 - 128);

446 
	}
}

448 
	gzmq
::
curve_£rv”_t
::
	$´oduû_»ady
 (
msg_t
 *
msg_
)

450 
ušt8_t
 
»ady_nÚû
 [
üy±o_box_NONCEBYTES
];

451 
ušt8_t
 
»ady_¶aš‹xt
 [
üy±o_box_ZEROBYTES
 + 256];

452 
ušt8_t
 
»ady_box
 [
üy±o_box_BOXZEROBYTES
 + 16 + 256];

455 
	`mem£t
 (
»ady_¶aš‹xt
, 0, 
üy±o_box_ZEROBYTES
);

456 
ušt8_t
 *
±r
 = 
»ady_¶aš‹xt
 + 
üy±o_box_ZEROBYTES
;

459 cÚ¡ *
sock‘_ty³
 = 
	`sock‘_ty³_¡ršg
 (
İtiÚs
.
ty³
);

460 
±r
 +ğ
	`add_´İ”ty
 (±r, "Sock‘-Ty³", 
sock‘_ty³
, 
	`¡¾’
 (socket_type));

463 ià(
İtiÚs
.
ty³
 =ğ
ZMQ_REQ


464 || 
İtiÚs
.
ty³
 =ğ
ZMQ_DEALER


465 || 
İtiÚs
.
ty³
 =ğ
ZMQ_ROUTER
)

466 
±r
 +ğ
	`add_´İ”ty
 (ptr, "Identity",

467 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

469 cÚ¡ 
size_t
 
mËn
 = 
±r
 - 
»ady_¶aš‹xt
;

471 
	`memıy
 (
»ady_nÚû
, "CurveZMQREADY---", 16);

472 
	`memıy
 (
»ady_nÚû
 + 16, &
ú_nÚû
, 8);

474 
rc
 = 
	`üy±o_box_aá”nm
 (
»ady_box
, 
»ady_¶aš‹xt
,

475 
mËn
, 
»ady_nÚû
, 
ú_´ecom
);

476 
	`zmq_as£¹
 (
rc
 == 0);

478 
rc
 = 
msg_
->
	`š™_size
 (14 + 
mËn
 - 
üy±o_box_BOXZEROBYTES
);

479 
	`”ºo_as£¹
 (
rc
 == 0);

481 
ušt8_t
 *
»ady
 = 
¡©ic_ÿ¡
 <ušt8_ˆ*> (
msg_
->
	`d©a
 ());

483 
	`memıy
 (
»ady
, "\x05READY", 6);

485 
	`memıy
 (
»ady
 + 6, &
ú_nÚû
, 8);

487 
	`memıy
 (
»ady
 + 14, 
»ady_box
 + 
üy±o_box_BOXZEROBYTES
,

488 
mËn
 - 
üy±o_box_BOXZEROBYTES
);

490 
ú_nÚû
++;

493 
	}
}

495 
	gzmq
::
curve_£rv”_t
::
	$£nd_z­_»que¡
 (cÚ¡ 
ušt8_t
 *
key
)

497 
rc
;

498 
msg_t
 
msg
;

501 
rc
 = 
msg
.
	`š™
 ();

502 
	`”ºo_as£¹
 (
rc
 == 0);

503 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

504 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

505 
	`”ºo_as£¹
 (
rc
 == 0);

508 
rc
 = 
msg
.
	`š™_size
 (3);

509 
	`”ºo_as£¹
 (
rc
 == 0);

510 
	`memıy
 (
msg
.
	`d©a
 (), "1.0", 3);

511 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

512 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

513 
	`”ºo_as£¹
 (
rc
 == 0);

516 
rc
 = 
msg
.
	`š™_size
 (1);

517 
	`”ºo_as£¹
 (
rc
 == 0);

518 
	`memıy
 (
msg
.
	`d©a
 (), "1", 1);

519 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

520 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

521 
	`”ºo_as£¹
 (
rc
 == 0);

524 
rc
 = 
msg
.
	`š™_size
 (
İtiÚs
.
z­_domaš
.
	`Ëngth
 ());

525 
	`”ºo_as£¹
 (
rc
 == 0);

526 
	`memıy
 (
msg
.
	`d©a
 (), 
İtiÚs
.
z­_domaš
.
	`c_¡r
 (), o±iÚs.z­_domaš.
	`Ëngth
 ());

527 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

528 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

529 
	`”ºo_as£¹
 (
rc
 == 0);

532 
rc
 = 
msg
.
	`š™_size
 (
³”_add»ss
.
	`Ëngth
 ());

533 
	`”ºo_as£¹
 (
rc
 == 0);

534 
	`memıy
 (
msg
.
	`d©a
 (), 
³”_add»ss
.
	`c_¡r
 (),…“r_add»ss.
	`Ëngth
 ());

535 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

536 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

537 
	`”ºo_as£¹
 (
rc
 == 0);

540 
rc
 = 
msg
.
	`š™_size
 (
İtiÚs
.
id’t™y_size
);

541 
	`”ºo_as£¹
 (
rc
 == 0);

542 
	`memıy
 (
msg
.
	`d©a
 (), 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

543 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

544 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

545 
	`”ºo_as£¹
 (
rc
 == 0);

548 
rc
 = 
msg
.
	`š™_size
 (5);

549 
	`”ºo_as£¹
 (
rc
 == 0);

550 
	`memıy
 (
msg
.
	`d©a
 (), "CURVE", 5);

551 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

552 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

553 
	`”ºo_as£¹
 (
rc
 == 0);

556 
rc
 = 
msg
.
	`š™_size
 (
üy±o_box_PUBLICKEYBYTES
);

557 
	`”ºo_as£¹
 (
rc
 == 0);

558 
	`memıy
 (
msg
.
	`d©a
 (), 
key
, 
üy±o_box_PUBLICKEYBYTES
);

559 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

560 
	`”ºo_as£¹
 (
rc
 == 0);

561 
	}
}

563 
	gzmq
::
curve_£rv”_t
::
	$»ûive_ªd_´oûss_z­_»¶y
 ()

565 
rc
 = 0;

566 
msg_t
 
msg
 [7];

569 
i
 = 0; i < 7; i++) {

570 
rc
 = 
msg
 [
i
].
	`š™
 ();

571 
	`”ºo_as£¹
 (
rc
 == 0);

574 
i
 = 0; i < 7; i++) {

575 
rc
 = 
£ssiÚ
->
	`»ad_z­_msg
 (&
msg
 [
i
]);

576 ià(
rc
 == -1)

578 ià((
msg
 [
i
].
	`æags
 (è& 
msg_t
::
mÜe
) == (i < 6? 0: msg_t::more)) {

579 
”ºo
 = 
EPROTO
;

580 
rc
 = -1;

585 ià(
rc
 != 0)

586 
”rÜ
;

589 ià(
msg
 [0].
	`size
 () > 0) {

590 
rc
 = -1;

591 
”ºo
 = 
EPROTO
;

592 
”rÜ
;

596 ià(
msg
 [1].
	`size
 (è!ğ3 || 
	`memcmp
 (msg [1].
	`d©a
 (), "1.0", 3)) {

597 
rc
 = -1;

598 
”ºo
 = 
EPROTO
;

599 
”rÜ
;

603 ià(
msg
 [2].
	`size
 (è!ğ1 || 
	`memcmp
 (msg [2].
	`d©a
 (), "1", 1)) {

604 
rc
 = -1;

605 
”ºo
 = 
EPROTO
;

606 
”rÜ
;

610 ià(
msg
 [3].
	`size
 (è!ğ3 || 
	`memcmp
 (msg [3].
	`d©a
 (), "200", 3)) {

611 
rc
 = -1;

612 
”ºo
 = 
EACCES
;

613 
”rÜ
;

617 
rc
 = 
	`·r£_m‘ad©a
 (
¡©ic_ÿ¡
 <cÚ¡ *> (
msg
 [6].
	`d©a
 ()),

618 
msg
 [6].
	`size
 ());

620 
”rÜ
:

621 
i
 = 0; i < 7; i++) {

622 cÚ¡ 
rc2
 = 
msg
 [
i
].
	`şo£
 ();

623 
	`”ºo_as£¹
 (
rc2
 == 0);

626  
rc
;

627 
	}
}

	@curve_server.hpp

20 #iâdeà
__ZMQ_CURVE_SERVER_HPP_INCLUDED__


21 
	#__ZMQ_CURVE_SERVER_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ifdeà
HAVE_LIBSODIUM


26 
	~<sodium.h
>

28 #ià
üy±o_box_NONCEBYTES
 != 24 \

29 || 
	güy±o_box_PUBLICKEYBYTES
 != 32 \

30 || 
üy±o_box_SECRETKEYBYTES
 != 32 \

31 || 
üy±o_box_ZEROBYTES
 != 32 \

32 || 
üy±o_box_BOXZEROBYTES
 != 16 \

33 || 
üy±o_£ü‘box_NONCEBYTES
 != 24 \

34 || 
üy±o_£ü‘box_ZEROBYTES
 != 32 \

35 || 
üy±o_£ü‘box_BOXZEROBYTES
 != 16

39 
	~"mechªism.hµ
"

40 
	~"İtiÚs.hµ
"

42 
Çme¥aû
 
zmq


45 
şass
 
msg_t
;

46 
şass
 
	g£ssiÚ_ba£_t
;

48 şas 
	ccurve_£rv”_t
 : 
public
 
mechªism_t


50 
public
:

52 
curve_£rv”_t
 (
£ssiÚ_ba£_t
 *
£ssiÚ_
,

53 cÚ¡ 
¡d
::
¡ršg
 &
³”_add»ss_
,

54 cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

55 
	gvœtu®
 ~
curve_£rv”_t
 ();

58 
vœtu®
 
Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
);

59 
vœtu®
 
´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
);

60 
vœtu®
 
’code
 (
msg_t
 *
msg_
);

61 
vœtu®
 
decode
 (
msg_t
 *
msg_
);

62 
vœtu®
 
z­_msg_avaabË
 ();

63 
vœtu®
 
boŞ
 
is_hªdshake_com¶‘e
 () const;

65 
	g´iv©e
:

67 
	e¡©e_t
 {

68 
ex³ù_h–lo
,

69 
	g£nd_w–come
,

70 
	gex³ù_š™Ÿ‹
,

71 
	gex³ù_z­_»¶y
,

72 
	g£nd_»ady
,

73 
	gcÚÃùed


76 
£ssiÚ_ba£_t
 * cÚ¡ 
	g£ssiÚ
;

78 cÚ¡ 
	g¡d
::
¡ršg
 
³”_add»ss
;

81 
¡©e_t
 
	g¡©e
;

84 
boŞ
 
	gex³ùšg_z­_»¶y
;

86 
ušt64_t
 
	gú_nÚû
;

89 
ušt8_t
 
	g£ü‘_key
 [
üy±o_box_SECRETKEYBYTES
];

92 
ušt8_t
 
	gú_public
 [
üy±o_box_PUBLICKEYBYTES
];

95 
ušt8_t
 
	gú_£ü‘
 [
üy±o_box_SECRETKEYBYTES
];

98 
ušt8_t
 
	gú_ş›Á
 [
üy±o_box_PUBLICKEYBYTES
];

101 
ušt8_t
 
	gcook›_key
 [
üy±o_£ü‘box_KEYBYTES
];

104 
ušt8_t
 
	gú_´ecom
 [
üy±o_box_BEFORENMBYTES
];

106 
´oûss_h–lo
 (
msg_t
 *
msg_
);

107 
´oduû_w–come
 (
msg_t
 *
msg_
);

108 
´oûss_š™Ÿ‹
 (
msg_t
 *
msg_
);

109 
´oduû_»ady
 (
msg_t
 *
msg_
);

111 
£nd_z­_»que¡
 (cÚ¡ 
ušt8_t
 *
key
);

112 
»ûive_ªd_´oûss_z­_»¶y
 ();

	@dbuffer.hpp

20 #iâdeà
__ZMQ_DBUFFER_HPP_INCLUDED__


21 
	#__ZMQ_DBUFFER_HPP_INCLUDED__


	)

23 
	~<¡dlib.h
>

24 
	~<¡ddef.h
>

25 
	~<®gÜ™hm
>

27 
	~"mu‹x.hµ
"

28 
	~"msg.hµ
"

30 
Çme¥aû
 
	gzmq


47 
	g‹m¶©e
 <
ty³Çme
 
	gT
> 
şass
 
	gdbufãr_t
;

49 
	g‹m¶©e
 <> 
şass
 
	gdbufãr_t
<
	gmsg_t
>

51 
	gpublic
:

53 
šlše
 
dbufãr_t
 ()

54 : 
back
 (&
¡Üage
[0])

55 , 
äÚt
 (&
¡Üage
[1])

56 , 
has_msg
 (
çl£
)

58 
	gback
->
š™
 ();

59 
	gäÚt
->
š™
 ();

62 
	gšlše
 ~
dbufãr_t
()

64 
	gback
->
şo£
 ();

65 
	gäÚt
->
şo£
 ();

68 
šlše
 
wr™e
 (cÚ¡ 
msg_t
 &
v®ue_
)

70 
	gmsg_t
& 
	gxv®ue
 = 
cÚ¡_ÿ¡
<
msg_t
&>(
v®ue_
);

72 
zmq_as£¹
 (
xv®ue
.
check
 ());

73 
	gback
->
move
 (
xv®ue
);

75 
zmq_as£¹
 (
back
->
check
 ());

77 ià(
	gsync
.
Œy_lock
 ())

79 
	g¡d
::
sw­
 (
back
, 
äÚt
);

80 
	ghas_msg
 = 
Œue
;

82 
	gsync
.
uÆock
 ();

86 
šlše
 
boŞ
 
»ad
 (
msg_t
 *
v®ue_
)

88 ià(!
	gv®ue_
)

89  
	gçl£
;

92 
scİed_lock_t
 
lock
 (
sync
);

93 ià(!
	ghas_msg
)

94  
	gçl£
;

96 
zmq_as£¹
 (
äÚt
->
check
 ());

98 *
	gv®ue_
 = *
äÚt
;

99 
	gäÚt
->
š™
 ();

101 
	ghas_msg
 = 
çl£
;

102  
	gŒue
;

107 
šlše
 
boŞ
 
check_»ad
 ()

109 
scİed_lock_t
 
lock
 (
sync
);

111  
	ghas_msg
;

114 
šlše
 
boŞ
 
´obe
 (boŞ (*
â
)(
msg_t
 &))

116 
scİed_lock_t
 
lock
 (
sync
);

117  (*
	gâ
è(*
	gäÚt
);

121 
	g´iv©e
:

122 
msg_t
 
¡Üage
[2];

123 
msg_t
 *
	gback
, *
	gäÚt
;

125 
mu‹x_t
 
	gsync
;

126 
boŞ
 
	ghas_msg
;

129 
dbufãr_t
 (const dbuffer_t&);

130 cÚ¡ 
	gdbufãr_t
 &
	gİ”©Ü
 = (cÚ¡ 
dbufãr_t
&);

	@dealer.cpp

20 
	~"d—Ër.hµ
"

21 
	~"”r.hµ
"

22 
	~"msg.hµ
"

24 
	gzmq
::
d—Ër_t
::
	$d—Ër_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

25 
	`sock‘_ba£_t
 (
·»Á_
, 
tid_
, 
sid_
),

26 
	$´obe_rou‹r
 (
çl£
)

28 
İtiÚs
.
ty³
 = 
ZMQ_DEALER
;

29 
	}
}

31 
	gzmq
::
d—Ër_t
::~
	$d—Ër_t
 ()

33 
	}
}

35 
zmq
::
d—Ër_t
::
	$x©ch_pe
 (
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
)

38 (è
subsüibe_to_®l_
;

40 
	`zmq_as£¹
 (
pe_
);

42 ià(
´obe_rou‹r
) {

43 
msg_t
 
´obe_msg_
;

44 
rc
 = 
´obe_msg_
.
	`š™
 ();

45 
	`”ºo_as£¹
 (
rc
 == 0);

47 
rc
 = 
pe_
->
	`wr™e
 (&
´obe_msg_
);

49 
pe_
->
	`æush
 ();

51 
rc
 = 
´obe_msg_
.
	`şo£
 ();

52 
	`”ºo_as£¹
 (
rc
 == 0);

55 
fq
.
	`©ch
 (
pe_
);

56 
lb
.
	`©ch
 (
pe_
);

57 
	}
}

59 
	gzmq
::
d—Ër_t
::
	$x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
,

60 
size_t
 
İtv®Ën_
)

62 
boŞ
 
is_št
 = (
İtv®Ën_
 ==  ());

63 
v®ue
 = 
is_št
? *((*è
İtv®_
): 0;

65 
İtiÚ_
) {

66 
ZMQ_PROBE_ROUTER
:

67 ià(
is_št
 && 
v®ue
 >= 0) {

68 
´obe_rou‹r
 = (
v®ue
 != 0);

77 
”ºo
 = 
EINVAL
;

79 
	}
}

81 
	gzmq
::
d—Ër_t
::
	$x£nd
 (
msg_t
 *
msg_
)

83  
	`£ndpe
 (
msg_
, 
NULL
);

84 
	}
}

86 
	gzmq
::
d—Ër_t
::
	$x»cv
 (
msg_t
 *
msg_
)

88  
	`»cvpe
 (
msg_
, 
NULL
);

89 
	}
}

91 
boŞ
 
	gzmq
::
d—Ër_t
::
	$xhas_š
 ()

93  
fq
.
	`has_š
 ();

94 
	}
}

96 
boŞ
 
	gzmq
::
d—Ër_t
::
	$xhas_out
 ()

98  
lb
.
	`has_out
 ();

99 
	}
}

101 
	gzmq
::
d—Ër_t
::
	$x»ad_aùiv©ed
 (
pe_t
 *
pe_
)

103 
fq
.
	`aùiv©ed
 (
pe_
);

104 
	}
}

106 
	gzmq
::
d—Ër_t
::
	$xwr™e_aùiv©ed
 (
pe_t
 *
pe_
)

108 
lb
.
	`aùiv©ed
 (
pe_
);

109 
	}
}

111 
	gzmq
::
d—Ër_t
::
	$xpe_‹rmš©ed
 (
pe_t
 *
pe_
)

113 
fq
.
	`pe_‹rmš©ed
 (
pe_
);

114 
lb
.
	`pe_‹rmš©ed
 (
pe_
);

115 
	}
}

117 
	gzmq
::
d—Ër_t
::
	$£ndpe
 (
msg_t
 *
msg_
, 
pe_t
 **
pe_
)

119  
lb
.
	`£ndpe
 (
msg_
, 
pe_
);

120 
	}
}

122 
	gzmq
::
d—Ër_t
::
	$»cvpe
 (
msg_t
 *
msg_
, 
pe_t
 **
pe_
)

124  
fq
.
	`»cvpe
 (
msg_
, 
pe_
);

125 
	}
}

	@dealer.hpp

20 #iâdeà
__ZMQ_DEALER_HPP_INCLUDED__


21 
	#__ZMQ_DEALER_HPP_INCLUDED__


	)

23 
	~"sock‘_ba£.hµ
"

24 
	~"£ssiÚ_ba£.hµ
"

25 
	~"fq.hµ
"

26 
	~"lb.hµ
"

28 
Çme¥aû
 
	gzmq


31 
şass
 
	gùx_t
;

32 
şass
 
	gmsg_t
;

33 
şass
 
	gpe_t
;

34 
şass
 
	gio_th»ad_t
;

35 
şass
 
	gsock‘_ba£_t
;

37 şas 
	cd—Ër_t
 :

38 
public
 
sock‘_ba£_t


40 
public
:

42 
d—Ër_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid
);

43 ~
d—Ër_t
 ();

45 
	g´Ùeùed
:

48 
x©ch_pe
 (
zmq
::
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
);

49 
x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
, 
size_t
 
İtv®Ën_
);

50 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

51 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

52 
boŞ
 
xhas_š
 ();

53 
boŞ
 
xhas_out
 ();

54 
x»ad_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

55 
xwr™e_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

56 
xpe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

59 
£ndpe
 (
zmq
::
msg_t
 *
msg_
, zmq::
pe_t
 **
pe_
);

60 
»cvpe
 (
zmq
::
msg_t
 *
msg_
, zmq::
pe_t
 **
pe_
);

62 
	g´iv©e
:

66 
fq_t
 
fq
;

67 
lb_t
 
	glb
;

70 
boŞ
 
	g´obe_rou‹r
;

72 
d—Ër_t
 (const dealer_t&);

73 cÚ¡ 
	gd—Ër_t
 &
	gİ”©Ü
 = (cÚ¡ 
d—Ër_t
&);

	@decoder.hpp

20 #iâdeà
__ZMQ_DECODER_HPP_INCLUDED__


21 
	#__ZMQ_DECODER_HPP_INCLUDED__


	)

23 
	~<¡ddef.h
>

24 
	~<¡ršg.h
>

25 
	~<¡dlib.h
>

26 
	~<®gÜ™hm
>

28 
	~"”r.hµ
"

29 
	~"msg.hµ
"

30 
	~"i_decod”.hµ
"

31 
	~"¡dšt.hµ
"

33 
Çme¥aû
 
	gzmq


46 
	g‹m¶©e
 <
ty³Çme
 
	gT
> cÏs 
	cdecod”_ba£_t
 : 
public
 
i_decod”


48 
public
:

50 
šlše
 
decod”_ba£_t
 (
size_t
 
bufsize_
) :

51 
Ãxt
 (
NULL
),

52 
»ad_pos
 (
NULL
),

53 
to_»ad
 (0),

54 
bufsize
 (
bufsize_
)

56 
	gbuf
 = (*è
m®loc
 (
bufsize_
);

57 
®loc_as£¹
 (
buf
);

62 
šlše
 
	gvœtu®
 ~
decod”_ba£_t
 ()

64 
ä“
 (
buf
);

68 
šlše
 
g‘_bufãr
 (**
d©a_
, 
size_t
 *
size_
)

78 ià(
	gto_»ad
 >ğ
bufsize
) {

79 *
d©a_
 = 
»ad_pos
;

80 *
	gsize_
 = 
to_»ad
;

84 *
	gd©a_
 = 
buf
;

85 *
	gsize_
 = 
bufsize
;

94 
šlše
 
decode
 (cÚ¡ *
d©a_
, 
size_t
 
size_
,

95 
size_t
 &
by‹s_u£d_
)

97 
	gby‹s_u£d_
 = 0;

102 ià(
	gd©a_
 =ğ
»ad_pos
) {

103 
zmq_as£¹
 (
size_
 <ğ
to_»ad
);

104 
	g»ad_pos
 +ğ
size_
;

105 
	gto_»ad
 -ğ
size_
;

106 
	gby‹s_u£d_
 = 
size_
;

108 !
	gto_»ad
) {

109 cÚ¡ 
	grc
 = (
¡©ic_ÿ¡
 <
T
*> (
this
)->*
Ãxt
) ();

110 ià(
	grc
 != 0)

111  
rc
;

116 
	gby‹s_u£d_
 < 
	gsize_
) {

118 cÚ¡ 
size_t
 
	gto_cİy
 = 
¡d
::
mš
 (
to_»ad
, 
size_
 - 
by‹s_u£d_
);

119 
memıy
 (
»ad_pos
, 
d©a_
 + 
by‹s_u£d_
, 
to_cİy
);

120 
	g»ad_pos
 +ğ
to_cİy
;

121 
	gto_»ad
 -ğ
to_cİy
;

122 
	gby‹s_u£d_
 +ğ
to_cİy
;

125 
	gto_»ad
 == 0) {

126 cÚ¡ 
rc
 = (
¡©ic_ÿ¡
 <
T
*> (
this
)->*
Ãxt
) ();

127 ià(
	grc
 != 0)

128  
rc
;

135 
	g´Ùeùed
:

139 (
T
::*
	t¡•_t
) ();

143 
šlše
 
Ãxt_¡•
 (*
»ad_pos_
, 
size_t
 
to_»ad_
, 
¡•_t
 
Ãxt_
)

145 
	g»ad_pos
 = (*è
»ad_pos_
;

146 
	gto_»ad
 = 
to_»ad_
;

147 
	gÃxt
 = 
Ãxt_
;

150 
	g´iv©e
:

155 
¡•_t
 
Ãxt
;

158 *
	g»ad_pos
;

161 
size_t
 
	gto_»ad
;

164 
size_t
 
	gbufsize
;

165 *
	gbuf
;

167 
decod”_ba£_t
 (const decoder_base_t&);

168 cÚ¡ 
	gdecod”_ba£_t
 &
	gİ”©Ü
 = (cÚ¡ 
decod”_ba£_t
&);

	@devpoll.cpp

20 
	~"devpŞl.hµ
"

21 #ià
defšed
 
ZMQ_USE_DEVPOLL


23 
	~<sys/devpŞl.h
>

24 
	~<sys/time.h
>

25 
	~<sys/ty³s.h
>

26 
	~<sys/¡©.h
>

27 
	~<sys/ioùl.h
>

28 
	~<fú.h
>

29 
	~<uni¡d.h
>

30 
	~<lim™s.h
>

31 
	~<®gÜ™hm
>

33 
	~"devpŞl.hµ
"

34 
	~"”r.hµ
"

35 
	~"cÚfig.hµ
"

36 
	~"i_pŞl_ev’ts.hµ
"

38 
	gzmq
::
devpŞl_t
::
	$devpŞl_t
 () :

39 
	$¡İpšg
 (
çl£
)

41 
devpŞl_fd
 = 
	`İ’
 ("/dev/pŞl", 
O_RDWR
);

42 
	`”ºo_as£¹
 (
devpŞl_fd
 != -1);

43 
	}
}

45 
	gzmq
::
devpŞl_t
::~
	$devpŞl_t
 ()

47 
wÜk”
.
	`¡İ
 ();

48 
	`şo£
 (
devpŞl_fd
);

49 
	}
}

51 
	gzmq
::
devpŞl_t
::
	$devpŞl_ùl
 (
fd_t
 
fd_
, 
ev’ts_
)

53 
pŞlfd
 
pfd
 = {
fd_
, 
ev’ts_
, 0};

54 
ssize_t
 
rc
 = 
	`wr™e
 (
devpŞl_fd
, &
pfd
, …fd);

55 
	`zmq_as£¹
 (
rc
 =ğ 
pfd
);

56 
	}
}

58 
	gzmq
::
devpŞl_t
::
hªdË_t
 
zmq
::devpŞl_t::
	$add_fd
 (
fd_t
 
fd_
,

59 
i_pŞl_ev’ts
 *
»aùÜ_
)

62 
fd_bË_t
::
size_ty³
 
sz
 = 
fd_bË
.
	`size
 ();

63 ià(
sz
 <ğ(
fd_bË_t
::
size_ty³
è
fd_
) {

64 
fd_bË
.
	`»size
 (
fd_
 + 1);

65 
sz
 !ğ(
fd_bË_t
::
size_ty³
è(
fd_
 + 1)) {

66 
fd_bË
 [
sz
].
v®id
 = 
çl£
;

67 ++
sz
;

71 
	`zmq_as£¹
 (!
fd_bË
 [
fd_
].
v®id
);

73 
fd_bË
 [
fd_
].
ev’ts
 = 0;

74 
fd_bË
 [
fd_
].
»aùÜ
 = 
»aùÜ_
;

75 
fd_bË
 [
fd_
].
v®id
 = 
Œue
;

76 
fd_bË
 [
fd_
].
acû±ed
 = 
çl£
;

78 
	`devpŞl_ùl
 (
fd_
, 0);

79 
³ndšg_li¡
.
	`push_back
 (
fd_
);

82 
	`adju¡_lßd
 (1);

84  
fd_
;

85 
	}
}

87 
	gzmq
::
devpŞl_t
::
	$rm_fd
 (
hªdË_t
 
hªdË_
)

89 
	`zmq_as£¹
 (
fd_bË
 [
hªdË_
].
v®id
);

91 
	`devpŞl_ùl
 (
hªdË_
, 
POLLREMOVE
);

92 
fd_bË
 [
hªdË_
].
v®id
 = 
çl£
;

95 
	`adju¡_lßd
 (-1);

96 
	}
}

98 
	gzmq
::
devpŞl_t
::
	$£t_pŞlš
 (
hªdË_t
 
hªdË_
)

100 
	`devpŞl_ùl
 (
hªdË_
, 
POLLREMOVE
);

101 
fd_bË
 [
hªdË_
].
ev’ts
 |ğ
POLLIN
;

102 
	`devpŞl_ùl
 (
hªdË_
, 
fd_bË
 [hªdË_].
ev’ts
);

103 
	}
}

105 
	gzmq
::
devpŞl_t
::
	$»£t_pŞlš
 (
hªdË_t
 
hªdË_
)

107 
	`devpŞl_ùl
 (
hªdË_
, 
POLLREMOVE
);

108 
fd_bË
 [
hªdË_
].
ev’ts
 &ğ~((è
POLLIN
);

109 
	`devpŞl_ùl
 (
hªdË_
, 
fd_bË
 [hªdË_].
ev’ts
);

110 
	}
}

112 
	gzmq
::
devpŞl_t
::
	$£t_pŞlout
 (
hªdË_t
 
hªdË_
)

114 
	`devpŞl_ùl
 (
hªdË_
, 
POLLREMOVE
);

115 
fd_bË
 [
hªdË_
].
ev’ts
 |ğ
POLLOUT
;

116 
	`devpŞl_ùl
 (
hªdË_
, 
fd_bË
 [hªdË_].
ev’ts
);

117 
	}
}

119 
	gzmq
::
devpŞl_t
::
	$»£t_pŞlout
 (
hªdË_t
 
hªdË_
)

121 
	`devpŞl_ùl
 (
hªdË_
, 
POLLREMOVE
);

122 
fd_bË
 [
hªdË_
].
ev’ts
 &ğ~((è
POLLOUT
);

123 
	`devpŞl_ùl
 (
hªdË_
, 
fd_bË
 [hªdË_].
ev’ts
);

124 
	}
}

126 
	gzmq
::
devpŞl_t
::
	$¡¬t
 ()

128 
wÜk”
.
	`¡¬t
 (
wÜk”_routše
, 
this
);

129 
	}
}

131 
	gzmq
::
devpŞl_t
::
	$¡İ
 ()

133 
¡İpšg
 = 
Œue
;

134 
	}
}

136 
	gzmq
::
devpŞl_t
::
	$max_fds
 ()

139 
	}
}

141 
	gzmq
::
devpŞl_t
::
	$loİ
 ()

143 !
¡İpšg
) {

145 
pŞlfd
 
ev_buf
 [
max_io_ev’ts
];

146 
dvpŞl
 
pŞl_»q
;

148 
³ndšg_li¡_t
::
size_ty³
 
i
 = 0; i < 
³ndšg_li¡
.
	`size
 (); i ++)

149 
fd_bË
 [
³ndšg_li¡
 [
i
]].
acû±ed
 = 
Œue
;

150 
³ndšg_li¡
.
	`ş—r
 ();

153 
timeout
 = (è
	`execu‹_tim”s
 ();

157 
pŞl_»q
.
dp_fds
 = &
ev_buf
 [0];

158 #ià
defšed
 
ZMQ_HAVE_SOLARIS


159 
pŞl_»q
.
dp_nfds
 = 
¡d
::
	`mš
 ((è
max_io_ev’ts
, 
OPEN_MAX
 - 1);

161 
pŞl_»q
.
dp_nfds
 = 
max_io_ev’ts
;

163 
pŞl_»q
.
dp_timeout
 = 
timeout
 ?imeout : -1;

164 
n
 = 
	`ioùl
 (
devpŞl_fd
, 
DP_POLL
, &
pŞl_»q
);

165 ià(
n
 =ğ-1 && 
”ºo
 =ğ
EINTR
)

167 
	`”ºo_as£¹
 (
n
 != -1);

169 
i
 = 0; i < 
n
; i ++) {

171 
fd_’Œy_t
 *
fd_±r
 = &
fd_bË
 [
ev_buf
 [
i
].
fd
];

172 ià(!
fd_±r
->
v®id
 || !fd_±r->
acû±ed
)

174 ià(
ev_buf
 [
i
].
»v’ts
 & (
POLLERR
 | 
POLLHUP
))

175 
fd_±r
->
»aùÜ
->
	`š_ev’t
 ();

176 ià(!
fd_±r
->
v®id
 || !fd_±r->
acû±ed
)

178 ià(
ev_buf
 [
i
].
»v’ts
 & 
POLLOUT
)

179 
fd_±r
->
»aùÜ
->
	`out_ev’t
 ();

180 ià(!
fd_±r
->
v®id
 || !fd_±r->
acû±ed
)

182 ià(
ev_buf
 [
i
].
»v’ts
 & 
POLLIN
)

183 
fd_±r
->
»aùÜ
->
	`š_ev’t
 ();

186 
	}
}

188 
	gzmq
::
devpŞl_t
::
	$wÜk”_routše
 (*
¬g_
)

190 ((
devpŞl_t
*è
¬g_
)->
	`loİ
 ();

191 
	}
}

	@devpoll.hpp

20 #iâdeà
__ZMQ_DEVPOLL_HPP_INCLUDED__


21 
	#__ZMQ_DEVPOLL_HPP_INCLUDED__


	)

24 
	~"pŞËr.hµ
"

25 #ià
defšed
 
ZMQ_USE_DEVPOLL


27 
	~<veùÜ
>

29 
	~"fd.hµ
"

30 
	~"th»ad.hµ
"

31 
	~"pŞËr_ba£.hµ
"

33 
Çme¥aû
 
	gzmq


36 
	gi_pŞl_ev’ts
;

40 şas 
	cdevpŞl_t
 : 
public
 
pŞËr_ba£_t


42 
public
:

44 
fd_t
 
	thªdË_t
;

46 
devpŞl_t
 ();

47 ~
devpŞl_t
 ();

50 
hªdË_t
 
add_fd
 (
fd_t
 
fd_
, 
zmq
::
i_pŞl_ev’ts
 *
ev’ts_
);

51 
rm_fd
 (
hªdË_t
 
hªdË_
);

52 
£t_pŞlš
 (
hªdË_t
 
hªdË_
);

53 
»£t_pŞlš
 (
hªdË_t
 
hªdË_
);

54 
£t_pŞlout
 (
hªdË_t
 
hªdË_
);

55 
»£t_pŞlout
 (
hªdË_t
 
hªdË_
);

56 
¡¬t
 ();

57 
¡İ
 ();

59 
max_fds
 ();

61 
	g´iv©e
:

64 
wÜk”_routše
 (*
¬g_
);

67 
loİ
 ();

70 
fd_t
 
	gdevpŞl_fd
;

72 
	sfd_’Œy_t


74 
	gev’ts
;

75 
	gzmq
::
i_pŞl_ev’ts
 *
»aùÜ
;

76 
boŞ
 
	gv®id
;

77 
boŞ
 
	gacû±ed
;

80 
	g¡d
::
	tveùÜ
 <
	tfd_’Œy_t
> 
	tfd_bË_t
;

81 
fd_bË_t
 
	gfd_bË
;

83 
	g¡d
::
	tveùÜ
 <
	tfd_t
> 
	t³ndšg_li¡_t
;

84 
³ndšg_li¡_t
 
	g³ndšg_li¡
;

87 
devpŞl_ùl
 (
fd_t
 
fd_
, 
ev’ts_
);

90 
boŞ
 
	g¡İpšg
;

93 
th»ad_t
 
	gwÜk”
;

95 
devpŞl_t
 (const devpoll_t&);

96 cÚ¡ 
	gdevpŞl_t
 &
	gİ”©Ü
 = (cÚ¡ 
devpŞl_t
&);

99 
devpŞl_t
 
	tpŞËr_t
;

	@dist.cpp

20 
	~"di¡.hµ
"

21 
	~"pe.hµ
"

22 
	~"”r.hµ
"

23 
	~"msg.hµ
"

24 
	~"lik–y.hµ
"

26 
	gzmq
::
di¡_t
::
	$di¡_t
 () :

27 
	`m©chšg
 (0),

28 
	`aùive
 (0),

29 
	`–igibË
 (0),

30 
	$mÜe
 (
çl£
)

32 
	}
}

34 
	gzmq
::
di¡_t
::~
	$di¡_t
 ()

36 
	`zmq_as£¹
 (
pes
.
	`em±y
 ());

37 
	}
}

39 
	gzmq
::
di¡_t
::
	$©ch
 (
pe_t
 *
pe_
)

44 ià(
mÜe
) {

45 
pes
.
	`push_back
 (
pe_
);

46 
pes
.
	`sw­
 (
–igibË
,…es.
	`size
 () - 1);

47 
–igibË
++;

50 
pes
.
	`push_back
 (
pe_
);

51 
pes
.
	`sw­
 (
aùive
,…es.
	`size
 () - 1);

52 
aùive
++;

53 
–igibË
++;

55 
	}
}

57 
	gzmq
::
di¡_t
::
	$m©ch
 (
pe_t
 *
pe_
)

60 ià(
pes
.
	`šdex
 (
pe_
è< 
m©chšg
)

64 ià(
pes
.
	`šdex
 (
pe_
è>ğ
–igibË
)

68 
pes
.
	`sw­
 (pes.
	`šdex
 (
pe_
), 
m©chšg
);

69 
m©chšg
++;

70 
	}
}

72 
	gzmq
::
di¡_t
::
	$unm©ch
 ()

74 
m©chšg
 = 0;

75 
	}
}

77 
	gzmq
::
di¡_t
::
	$pe_‹rmš©ed
 (
pe_t
 *
pe_
)

81 ià(
pes
.
	`šdex
 (
pe_
è< 
m©chšg
) {

82 
pes
.
	`sw­
 (pes.
	`šdex
 (
pe_
), 
m©chšg
 - 1);

83 
m©chšg
--;

85 ià(
pes
.
	`šdex
 (
pe_
è< 
aùive
) {

86 
pes
.
	`sw­
 (pes.
	`šdex
 (
pe_
), 
aùive
 - 1);

87 
aùive
--;

89 ià(
pes
.
	`šdex
 (
pe_
è< 
–igibË
) {

90 
pes
.
	`sw­
 (pes.
	`šdex
 (
pe_
), 
–igibË
 - 1);

91 
–igibË
--;

94 
pes
.
	`”a£
 (
pe_
);

95 
	}
}

97 
	gzmq
::
di¡_t
::
	$aùiv©ed
 (
pe_t
 *
pe_
)

100 
pes
.
	`sw­
 (pes.
	`šdex
 (
pe_
), 
–igibË
);

101 
–igibË
++;

105 ià(!
mÜe
) {

106 
pes
.
	`sw­
 (
–igibË
 - 1, 
aùive
);

107 
aùive
++;

109 
	}
}

111 
	gzmq
::
di¡_t
::
	$£nd_to_®l
 (
msg_t
 *
msg_
)

113 
m©chšg
 = 
aùive
;

114  
	`£nd_to_m©chšg
 (
msg_
);

115 
	}
}

117 
	gzmq
::
di¡_t
::
	$£nd_to_m©chšg
 (
msg_t
 *
msg_
)

120 
boŞ
 
msg_mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
 ? 
Œue
 : 
çl£
;

123 
	`di¡ribu‹
 (
msg_
);

126 ià(!
msg_mÜe
)

127 
aùive
 = 
–igibË
;

129 
mÜe
 = 
msg_mÜe
;

132 
	}
}

134 
	gzmq
::
di¡_t
::
	$di¡ribu‹
 (
msg_t
 *
msg_
)

137 ià(
m©chšg
 == 0) {

138 
rc
 = 
msg_
->
	`şo£
 ();

139 
	`”ºo_as£¹
 (
rc
 == 0);

140 
rc
 = 
msg_
->
	`š™
 ();

141 
	`”ºo_as£¹
 (
rc
 == 0);

145 ià(
msg_
->
	`is_vsm
 ()) {

146 
pes_t
::
size_ty³
 
i
 = 0; i < 
m©chšg
; ++i)

147 if(!
	`wr™e
 (
pes
 [
i
], 
msg_
))

148 --
i
;

149 
rc
 = 
msg_
->
	`şo£
();

150 
	`”ºo_as£¹
 (
rc
 == 0);

151 
rc
 = 
msg_
->
	`š™
 ();

152 
	`”ºo_as£¹
 (
rc
 == 0);

158 
msg_
->
	`add_»fs
 ((è
m©chšg
 - 1);

161 
çed
 = 0;

162 
pes_t
::
size_ty³
 
i
 = 0; i < 
m©chšg
; ++i)

163 ià(!
	`wr™e
 (
pes
 [
i
], 
msg_
)) {

164 ++
çed
;

165 --
i
;

167 ià(
	`uÆik–y
 (
çed
))

168 
msg_
->
	`rm_»fs
 (
çed
);

172 
rc
 = 
msg_
->
	`š™
 ();

173 
	`”ºo_as£¹
 (
rc
 == 0);

174 
	}
}

176 
boŞ
 
	gzmq
::
di¡_t
::
	$has_out
 ()

178  
Œue
;

179 
	}
}

181 
boŞ
 
	gzmq
::
di¡_t
::
	$wr™e
 (
pe_t
 *
pe_
, 
msg_t
 *
msg_
)

183 ià(!
pe_
->
	`wr™e
 (
msg_
)) {

184 
pes
.
	`sw­
 (pes.
	`šdex
 (
pe_
), 
m©chšg
 - 1);

185 
m©chšg
--;

186 
pes
.
	`sw­
 (pes.
	`šdex
 (
pe_
), 
aùive
 - 1);

187 
aùive
--;

188 
pes
.
	`sw­
 (
aùive
, 
–igibË
 - 1);

189 
–igibË
--;

190  
çl£
;

192 ià(!(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
))

193 
pe_
->
	`æush
 ();

194  
Œue
;

195 
	}
}

	@dist.hpp

20 #iâdeà
__ZMQ_DIST_HPP_INCLUDED__


21 
	#__ZMQ_DIST_HPP_INCLUDED__


	)

23 
	~<veùÜ
>

25 
	~"¬¿y.hµ
"

26 
	~"pe.hµ
"

28 
Çme¥aû
 
	gzmq


31 
şass
 
	gpe_t
;

32 
şass
 
	gmsg_t
;

36 şas 
	cdi¡_t


38 
	gpublic
:

40 
di¡_t
 ();

41 ~
di¡_t
 ();

44 
©ch
 (
zmq
::
pe_t
 *
pe_
);

47 
aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

51 
m©ch
 (
zmq
::
pe_t
 *
pe_
);

54 
unm©ch
 ();

57 
pe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

60 
£nd_to_m©chšg
 (
zmq
::
msg_t
 *
msg_
);

63 
£nd_to_®l
 (
zmq
::
msg_t
 *
msg_
);

65 
boŞ
 
has_out
 ();

67 
	g´iv©e
:

71 
boŞ
 
wr™e
 (
zmq
::
pe_t
 *
pe_
, zmq::
msg_t
 *
msg_
);

74 
di¡ribu‹
 (
zmq
::
msg_t
 *
msg_
);

77 
	g¬¿y_t
 <
	tzmq
::
	tpe_t
, 2> 
	tpes_t
;

78 
pes_t
 
	gpes
;

81 
	gpes_t
::
size_ty³
 
m©chšg
;

86 
	gpes_t
::
size_ty³
 
aùive
;

93 
	gpes_t
::
size_ty³
 
–igibË
;

96 
boŞ
 
	gmÜe
;

98 
di¡_t
 (const dist_t&);

99 cÚ¡ 
	gdi¡_t
 &
	gİ”©Ü
 = (cÚ¡ 
di¡_t
&);

	@encoder.hpp

20 #iâdeà
__ZMQ_ENCODER_HPP_INCLUDED__


21 
	#__ZMQ_ENCODER_HPP_INCLUDED__


	)

23 #ià
defšed
(
_MSC_VER
)

24 #iâdeà
NOMINMAX


25 
	#NOMINMAX


	)

29 
	~<¡ddef.h
>

30 
	~<¡ršg.h
>

31 
	~<¡dlib.h
>

32 
	~<®gÜ™hm
>

34 
	~"”r.hµ
"

35 
	~"msg.hµ
"

36 
	~"i_’cod”.hµ
"

38 
Çme¥aû
 
	gzmq


45 
	g‹m¶©e
 <
ty³Çme
 
	gT
> cÏs 
	c’cod”_ba£_t
 : 
public
 
i_’cod”


47 
public
:

49 
šlše
 
’cod”_ba£_t
 (
size_t
 
bufsize_
) :

50 
bufsize
 (
bufsize_
),

51 
š_´og»ss
 (
NULL
)

53 
	gbuf
 = (*è
m®loc
 (
bufsize_
);

54 
®loc_as£¹
 (
buf
);

59 
šlše
 
	gvœtu®
 ~
’cod”_ba£_t
 ()

61 
ä“
 (
buf
);

67 
šlše
 
size_t
 
’code
 (**
d©a_
, size_ˆ
size_
)

69 *
	gbufãr
 = !*
d©a_
 ? 
buf
 : *data_;

70 
size_t
 
	gbufãrsize
 = !*
d©a_
 ? 
bufsize
 : 
size_
;

72 ià(
	gš_´og»ss
 =ğ
NULL
)

75 
size_t
 
	gpos
 = 0;

76 
	gpos
 < 
	gbufãrsize
) {

81 ià(!
	gto_wr™e
) {

82 ià(
	gÃw_msg_æag
) {

83 
	grc
 = 
š_´og»ss
->
şo£
 ();

84 
”ºo_as£¹
 (
rc
 == 0);

85 
	grc
 = 
š_´og»ss
->
š™
 ();

86 
”ºo_as£¹
 (
rc
 == 0);

87 
	gš_´og»ss
 = 
NULL
;

90 (
	g¡©ic_ÿ¡
 <
	gT
*> (
	gthis
)->*
	gÃxt
) ();

103 ià(!
	gpos
 && !*
	gd©a_
 && 
	gto_wr™e
 >ğ
bufãrsize
) {

104 *
d©a_
 = 
wr™e_pos
;

105 
	gpos
 = 
to_wr™e
;

106 
	gwr™e_pos
 = 
NULL
;

107 
	gto_wr™e
 = 0;

108  
	gpos
;

112 
size_t
 
	gto_cİy
 = 
¡d
::
mš
 (
to_wr™e
, 
bufãrsize
 - 
pos
);

113 
memıy
 (
bufãr
 + 
pos
, 
wr™e_pos
, 
to_cİy
);

114 
	gpos
 +ğ
to_cİy
;

115 
	gwr™e_pos
 +ğ
to_cİy
;

116 
	gto_wr™e
 -ğ
to_cİy
;

119 *
	gd©a_
 = 
bufãr
;

120  
	gpos
;

123 
lßd_msg
 (
msg_t
 *
msg_
)

125 
zmq_as£¹
 (
š_´og»ss
 =ğ
NULL
);

126 
	gš_´og»ss
 = 
msg_
;

127 (
	g¡©ic_ÿ¡
 <
	gT
*> (
	gthis
)->*
	gÃxt
) ();

130 
	g´Ùeùed
:

133 (
T
::*
	t¡•_t
) ();

137 
šlše
 
Ãxt_¡•
 (*
wr™e_pos_
, 
size_t
 
to_wr™e_
,

138 
¡•_t
 
Ãxt_
, 
boŞ
 
Ãw_msg_æag_
)

140 
	gwr™e_pos
 = (*è
wr™e_pos_
;

141 
	gto_wr™e
 = 
to_wr™e_
;

142 
	gÃxt
 = 
Ãxt_
;

143 
	gÃw_msg_æag
 = 
Ãw_msg_æag_
;

146 
	g´iv©e
:

149 *
wr™e_pos
;

152 
size_t
 
	gto_wr™e
;

156 
¡•_t
 
	gÃxt
;

158 
boŞ
 
	gÃw_msg_æag
;

161 
size_t
 
	gbufsize
;

162 *
	gbuf
;

164 
’cod”_ba£_t
 (constƒncoder_base_t&);

165 
	gİ”©Ü
 = (cÚ¡ 
’cod”_ba£_t
&);

167 
	g´Ùeùed
:

169 
msg_t
 *
š_´og»ss
;

	@epoll.cpp

20 
	~"•Şl.hµ
"

21 #ià
defšed
 
ZMQ_USE_EPOLL


23 
	~<sys/•Şl.h
>

24 
	~<¡dlib.h
>

25 
	~<¡ršg.h
>

26 
	~<uni¡d.h
>

27 
	~<®gÜ™hm
>

28 
	~<Ãw
>

30 
	~"•Şl.hµ
"

31 
	~"”r.hµ
"

32 
	~"cÚfig.hµ
"

33 
	~"i_pŞl_ev’ts.hµ
"

35 
	gzmq
::
•Şl_t
::
	$•Şl_t
 () :

36 
	$¡İpšg
 (
çl£
)

38 
•Şl_fd
 = 
	`•Şl_ü—‹
 (1);

39 
	`”ºo_as£¹
 (
•Şl_fd
 != -1);

40 
	}
}

42 
	gzmq
::
•Şl_t
::~
	$•Şl_t
 ()

45 
wÜk”
.
	`¡İ
 ();

47 
	`şo£
 (
•Şl_fd
);

48 
»tœed_t
::
™”©Ü
 
™
 = 
»tœed
.
	`begš
 (); iˆ!ğ»tœed.
	`’d
 (); ++it)

49 
d–‘e
 *
™
;

50 
	}
}

52 
	gzmq
::
•Şl_t
::
hªdË_t
 
zmq
::•Şl_t::
	$add_fd
 (
fd_t
 
fd_
, 
i_pŞl_ev’ts
 *
ev’ts_
)

54 
pŞl_’Œy_t
 *
³
 = 
	`Ãw
 (
¡d
::
nÙhrow
)…oll_entry_t;

55 
	`®loc_as£¹
 (
³
);

59 
	`mem£t
 (
³
, 0,  (
pŞl_’Œy_t
));

61 
³
->
fd
 = 
fd_
;

62 
³
->
ev
.
ev’ts
 = 0;

63 
³
->
ev
.
d©a
.
±r
 =…e;

64 
³
->
ev’ts
 = 
ev’ts_
;

66 
rc
 = 
	`•Şl_ùl
 (
•Şl_fd
, 
EPOLL_CTL_ADD
, 
fd_
, &
³
->
ev
);

67 
	`”ºo_as£¹
 (
rc
 != -1);

70 
	`adju¡_lßd
 (1);

72  
³
;

73 
	}
}

75 
	gzmq
::
•Şl_t
::
	$rm_fd
 (
hªdË_t
 
hªdË_
)

77 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

78 
rc
 = 
	`•Şl_ùl
 (
•Şl_fd
, 
EPOLL_CTL_DEL
, 
³
->
fd
, &³->
ev
);

79 
	`”ºo_as£¹
 (
rc
 != -1);

80 
³
->
fd
 = 
»tœed_fd
;

81 
»tœed
.
	`push_back
 (
³
);

84 
	`adju¡_lßd
 (-1);

85 
	}
}

87 
	gzmq
::
•Şl_t
::
	$£t_pŞlš
 (
hªdË_t
 
hªdË_
)

89 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

90 
³
->
ev
.
ev’ts
 |ğ
EPOLLIN
;

91 
rc
 = 
	`•Şl_ùl
 (
•Şl_fd
, 
EPOLL_CTL_MOD
, 
³
->
fd
, &³->
ev
);

92 
	`”ºo_as£¹
 (
rc
 != -1);

93 
	}
}

95 
	gzmq
::
•Şl_t
::
	$»£t_pŞlš
 (
hªdË_t
 
hªdË_
)

97 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

98 
³
->
ev
.
ev’ts
 &ğ~((è
EPOLLIN
);

99 
rc
 = 
	`•Şl_ùl
 (
•Şl_fd
, 
EPOLL_CTL_MOD
, 
³
->
fd
, &³->
ev
);

100 
	`”ºo_as£¹
 (
rc
 != -1);

101 
	}
}

103 
	gzmq
::
•Şl_t
::
	$£t_pŞlout
 (
hªdË_t
 
hªdË_
)

105 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

106 
³
->
ev
.
ev’ts
 |ğ
EPOLLOUT
;

107 
rc
 = 
	`•Şl_ùl
 (
•Şl_fd
, 
EPOLL_CTL_MOD
, 
³
->
fd
, &³->
ev
);

108 
	`”ºo_as£¹
 (
rc
 != -1);

109 
	}
}

111 
	gzmq
::
•Şl_t
::
	$»£t_pŞlout
 (
hªdË_t
 
hªdË_
)

113 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

114 
³
->
ev
.
ev’ts
 &ğ~((è
EPOLLOUT
);

115 
rc
 = 
	`•Şl_ùl
 (
•Şl_fd
, 
EPOLL_CTL_MOD
, 
³
->
fd
, &³->
ev
);

116 
	`”ºo_as£¹
 (
rc
 != -1);

117 
	}
}

119 
	gzmq
::
•Şl_t
::
	$¡¬t
 ()

121 
wÜk”
.
	`¡¬t
 (
wÜk”_routše
, 
this
);

122 
	}
}

124 
	gzmq
::
•Şl_t
::
	$¡İ
 ()

126 
¡İpšg
 = 
Œue
;

127 
	}
}

129 
	gzmq
::
•Şl_t
::
	$max_fds
 ()

132 
	}
}

134 
	gzmq
::
•Şl_t
::
	$loİ
 ()

136 
•Şl_ev’t
 
ev_buf
 [
max_io_ev’ts
];

138 !
¡İpšg
) {

141 
timeout
 = (è
	`execu‹_tim”s
 ();

144 
n
 = 
	`•Şl_wa™
 (
•Şl_fd
, &
ev_buf
 [0], 
max_io_ev’ts
,

145 
timeout
 ?imeout : -1);

146 ià(
n
 == -1) {

147 
	`”ºo_as£¹
 (
”ºo
 =ğ
EINTR
);

151 
i
 = 0; i < 
n
; i ++) {

152 
pŞl_’Œy_t
 *
³
 = (ÕŞl_’Œy_t*è
ev_buf
 [
i
].
d©a
.
±r
);

154 ià(
³
->
fd
 =ğ
»tœed_fd
)

156 ià(
ev_buf
 [
i
].
ev’ts
 & (
EPOLLERR
 | 
EPOLLHUP
))

157 
³
->
ev’ts
->
	`š_ev’t
 ();

158 ià(
³
->
fd
 =ğ
»tœed_fd
)

160 ià(
ev_buf
 [
i
].
ev’ts
 & 
EPOLLOUT
)

161 
³
->
ev’ts
->
	`out_ev’t
 ();

162 ià(
³
->
fd
 =ğ
»tœed_fd
)

164 ià(
ev_buf
 [
i
].
ev’ts
 & 
EPOLLIN
)

165 
³
->
ev’ts
->
	`š_ev’t
 ();

169 
»tœed_t
::
™”©Ü
 
™
 = 
»tœed
.
	`begš
 (); iˆ!ğ»tœed.
	`’d
 ();

170 ++
™
)

171 
d–‘e
 *
™
;

172 
»tœed
.
	`ş—r
 ();

174 
	}
}

176 
	gzmq
::
•Şl_t
::
	$wÜk”_routše
 (*
¬g_
)

178 ((
•Şl_t
*è
¬g_
)->
	`loİ
 ();

179 
	}
}

	@epoll.hpp

20 #iâdeà
__ZMQ_EPOLL_HPP_INCLUDED__


21 
	#__ZMQ_EPOLL_HPP_INCLUDED__


	)

24 
	~"pŞËr.hµ
"

25 #ià
defšed
 
ZMQ_USE_EPOLL


27 
	~<veùÜ
>

28 
	~<sys/•Şl.h
>

30 
	~"fd.hµ
"

31 
	~"th»ad.hµ
"

32 
	~"pŞËr_ba£.hµ
"

34 
Çme¥aû
 
	gzmq


37 
	gi_pŞl_ev’ts
;

42 şas 
	c•Şl_t
 : 
public
 
pŞËr_ba£_t


44 
public
:

46 * 
	thªdË_t
;

48 
•Şl_t
 ();

49 ~
•Şl_t
 ();

52 
hªdË_t
 
add_fd
 (
fd_t
 
fd_
, 
zmq
::
i_pŞl_ev’ts
 *
ev’ts_
);

53 
rm_fd
 (
hªdË_t
 
hªdË_
);

54 
£t_pŞlš
 (
hªdË_t
 
hªdË_
);

55 
»£t_pŞlš
 (
hªdË_t
 
hªdË_
);

56 
£t_pŞlout
 (
hªdË_t
 
hªdË_
);

57 
»£t_pŞlout
 (
hªdË_t
 
hªdË_
);

58 
¡¬t
 ();

59 
¡İ
 ();

61 
max_fds
 ();

63 
	g´iv©e
:

66 
wÜk”_routše
 (*
¬g_
);

69 
loİ
 ();

72 
fd_t
 
	g•Şl_fd
;

74 
	spŞl_’Œy_t


76 
fd_t
 
	gfd
;

77 
•Şl_ev’t
 
	gev
;

78 
	gzmq
::
i_pŞl_ev’ts
 *
ev’ts
;

82 
	g¡d
::
	tveùÜ
 <
	tpŞl_’Œy_t
*> 
	t»tœed_t
;

83 
»tœed_t
 
	g»tœed
;

86 
boŞ
 
	g¡İpšg
;

89 
th»ad_t
 
	gwÜk”
;

91 
•Şl_t
 (constƒpoll_t&);

92 cÚ¡ 
	g•Şl_t
 &
	gİ”©Ü
 = (cÚ¡ 
•Şl_t
&);

95 
•Şl_t
 
	tpŞËr_t
;

	@err.cpp

20 
	~"”r.hµ
"

21 
	~"¶©fÜm.hµ
"

23 cÚ¡ *
	gzmq
::
	$”ºo_to_¡ršg
 (
”ºo_
)

25 
”ºo_
) {

26 #ià
defšed
 
ZMQ_HAVE_WINDOWS


27 
ENOTSUP
:

29 
EPROTONOSUPPORT
:

31 
ENOBUFS
:

33 
ENETDOWN
:

35 
EADDRINUSE
:

37 
EADDRNOTAVAIL
:

39 
ECONNREFUSED
:

41 
EINPROGRESS
:

44 
EFSM
:

46 
ENOCOMPATPROTO
:

48 
ETERM
:

50 
EMTHREAD
:

53 #ià
defšed
 
_MSC_VER


54 #´agm¨
	`w¬nšg
 (
push
)

55 #´agm¨
	`w¬nšg
 (
di§bË
:4996)

57  
	`¡»¼Ü
 (
”ºo_
);

58 #ià
defšed
 
_MSC_VER


59 #´agm¨
	`w¬nšg
 (
pİ
)

62 
	}
}

64 
	gzmq
::
	$zmq_abÜt
(cÚ¡ *
”rmsg_
)

66 #ià
defšed
 
ZMQ_HAVE_WINDOWS


69 
ULONG_PTR
 
exŒa_šfo
 [1];

70 
exŒa_šfo
 [0] = (
ULONG_PTR
è
”rmsg_
;

71 
	`Rai£Exû±iÚ
 (0x40000015, 
EXCEPTION_NONCONTINUABLE
, 1, 
exŒa_šfo
);

73 ()
”rmsg_
;

74 
	`abÜt
 ();

76 
	}
}

78 #ifdeà
ZMQ_HAVE_WINDOWS


80 cÚ¡ *
	gzmq
::
	$w§_”rÜ
()

82 
no
 = 
	`WSAG‘La¡E¼Ü
 ();

84 ià(
no
 =ğ
WSAEWOULDBLOCK
)

85  
NULL
;

87  
	`w§_”rÜ_no
 (
no
);

88 
	}
}

90 cÚ¡ *
	gzmq
::
	$w§_”rÜ_no
 (
no_
)

96 (
no_
 =ğ
WSABASEERR
) ?

98 (
no_
 =ğ
WSAEINTR
) ?

100 (
no_
 =ğ
WSAEBADF
) ?

102 (
no_
 =ğ
WSAEACCES
) ?

104 (
no_
 =ğ
WSAEFAULT
) ?

106 (
no_
 =ğ
WSAEINVAL
) ?

108 (
no_
 =ğ
WSAEMFILE
) ?

110 (
no_
 =ğ
WSAEWOULDBLOCK
) ?

112 (
no_
 =ğ
WSAEINPROGRESS
) ?

114 (
no_
 =ğ
WSAEALREADY
) ?

116 (
no_
 =ğ
WSAENOTSOCK
) ?

118 (
no_
 =ğ
WSAEDESTADDRREQ
) ?

120 (
no_
 =ğ
WSAEMSGSIZE
) ?

122 (
no_
 =ğ
WSAEPROTOTYPE
) ?

124 (
no_
 =ğ
WSAENOPROTOOPT
) ?

126 (
no_
 =ğ
WSAEPROTONOSUPPORT
) ?

128 (
no_
 =ğ
WSAESOCKTNOSUPPORT
) ?

130 (
no_
 =ğ
WSAEOPNOTSUPP
) ?

132 (
no_
 =ğ
WSAEPFNOSUPPORT
) ?

134 (
no_
 =ğ
WSAEAFNOSUPPORT
) ?

136 (
no_
 =ğ
WSAEADDRINUSE
) ?

138 (
no_
 =ğ
WSAEADDRNOTAVAIL
) ?

140 (
no_
 =ğ
WSAENETDOWN
) ?

142 (
no_
 =ğ
WSAENETUNREACH
) ?

144 (
no_
 =ğ
WSAENETRESET
) ?

146 (
no_
 =ğ
WSAECONNABORTED
) ?

148 (
no_
 =ğ
WSAECONNRESET
) ?

150 (
no_
 =ğ
WSAENOBUFS
) ?

152 (
no_
 =ğ
WSAEISCONN
) ?

154 (
no_
 =ğ
WSAENOTCONN
) ?

156 (
no_
 =ğ
WSAESHUTDOWN
) ?

158 (
no_
 =ğ
WSAETOOMANYREFS
) ?

160 (
no_
 =ğ
WSAETIMEDOUT
) ?

162 (
no_
 =ğ
WSAECONNREFUSED
) ?

164 (
no_
 =ğ
WSAELOOP
) ?

166 (
no_
 =ğ
WSAENAMETOOLONG
) ?

168 (
no_
 =ğ
WSAEHOSTDOWN
) ?

170 (
no_
 =ğ
WSAEHOSTUNREACH
) ?

172 (
no_
 =ğ
WSAENOTEMPTY
) ?

174 (
no_
 =ğ
WSAEPROCLIM
) ?

176 (
no_
 =ğ
WSAEUSERS
) ?

178 (
no_
 =ğ
WSAEDQUOT
) ?

180 (
no_
 =ğ
WSAESTALE
) ?

182 (
no_
 =ğ
WSAEREMOTE
) ?

184 (
no_
 =ğ
WSASYSNOTREADY
) ?

186 (
no_
 =ğ
WSAVERNOTSUPPORTED
) ?

188 (
no_
 =ğ
WSANOTINITIALISED
) ?

190 (
no_
 =ğ
WSAHOST_NOT_FOUND
) ?

192 (
no_
 =ğ
WSATRY_AGAIN
) ?

194 (
no_
 =ğ
WSANO_RECOVERY
) ?

196 (
no_
 =ğ
WSANO_DATA
) ?

199 
	}
}

201 
	gzmq
::
	$wš_”rÜ
 (*
bufãr_
, 
size_t
 
bufãr_size_
)

203 
DWORD
 
”rcode
 = 
	`G‘La¡E¼Ü
 ();

204 #ià
defšed
 
_WIN32_WCE


205 
DWORD
 
rc
 = 
	`FÜm©Mes§ge
 (
FORMAT_MESSAGE_FROM_SYSTEM
 |

206 
FORMAT_MESSAGE_IGNORE_INSERTS
, 
NULL
, 
”rcode
, 
	`MAKELANGID
(
LANG_NEUTRAL
,

207 
SUBLANG_DEFAULT
), (
LPWSTR
)
bufãr_
, 
bufãr_size_
 / (
wch¬_t
), 
NULL
 );

209 
DWORD
 
rc
 = 
	`FÜm©Mes§geA
 (
FORMAT_MESSAGE_FROM_SYSTEM
 |

210 
FORMAT_MESSAGE_IGNORE_INSERTS
, 
NULL
, 
”rcode
, 
	`MAKELANGID
(
LANG_NEUTRAL
,

211 
SUBLANG_DEFAULT
), 
bufãr_
, (
DWORD
è
bufãr_size_
, 
NULL
 );

213 
	`zmq_as£¹
 (
rc
);

214 
	}
}

216 
	gzmq
::
	$w§_”rÜ_to_”ºo
 (
”rcode
)

218 
”rcode
) {

220 
WSAEINTR
:

221  
EINTR
;

223 
WSAEBADF
:

224  
EBADF
;

226 
WSAEACCES
:

227  
EACCES
;

229 
WSAEFAULT
:

230  
EFAULT
;

232 
WSAEINVAL
:

233  
EINVAL
;

235 
WSAEMFILE
:

236  
EMFILE
;

238 
WSAEWOULDBLOCK
:

239  
EBUSY
;

241 
WSAEINPROGRESS
:

242  
EAGAIN
;

244 
WSAEALREADY
:

245  
EAGAIN
;

247 
WSAENOTSOCK
:

248  
ENOTSOCK
;

250 
WSAEDESTADDRREQ
:

251  
EFAULT
;

253 
WSAEMSGSIZE
:

254  
EMSGSIZE
;

256 
WSAEPROTOTYPE
:

257  
EFAULT
;

259 
WSAENOPROTOOPT
:

260  
EINVAL
;

262 
WSAEPROTONOSUPPORT
:

263  
EPROTONOSUPPORT
;

265 
WSAESOCKTNOSUPPORT
:

266  
EFAULT
;

268 
WSAEOPNOTSUPP
:

269  
EFAULT
;

271 
WSAEPFNOSUPPORT
:

272  
EPROTONOSUPPORT
;

274 
WSAEAFNOSUPPORT
:

275  
EAFNOSUPPORT
;

277 
WSAEADDRINUSE
:

278  
EADDRINUSE
;

280 
WSAEADDRNOTAVAIL
:

281  
EADDRNOTAVAIL
;

283 
WSAENETDOWN
:

284  
ENETDOWN
;

286 
WSAENETUNREACH
:

287  
ENETUNREACH
;

289 
WSAENETRESET
:

290  
ENETRESET
;

292 
WSAECONNABORTED
:

293  
ECONNABORTED
;

295 
WSAECONNRESET
:

296  
ECONNRESET
;

298 
WSAENOBUFS
:

299  
ENOBUFS
;

301 
WSAEISCONN
:

302  
EFAULT
;

304 
WSAENOTCONN
:

305  
ENOTCONN
;

307 
WSAESHUTDOWN
:

308  
EFAULT
;

310 
WSAETOOMANYREFS
:

311  
EFAULT
;

313 
WSAETIMEDOUT
:

314  
ETIMEDOUT
;

316 
WSAECONNREFUSED
:

317  
ECONNREFUSED
;

319 
WSAELOOP
:

320  
EFAULT
;

322 
WSAENAMETOOLONG
:

323  
EFAULT
;

325 
WSAEHOSTDOWN
:

326  
EAGAIN
;

328 
WSAEHOSTUNREACH
:

329  
EHOSTUNREACH
;

331 
WSAENOTEMPTY
:

332  
EFAULT
;

334 
WSAEPROCLIM
:

335  
EFAULT
;

337 
WSAEUSERS
:

338  
EFAULT
;

340 
WSAEDQUOT
:

341  
EFAULT
;

343 
WSAESTALE
:

344  
EFAULT
;

346 
WSAEREMOTE
:

347  
EFAULT
;

349 
WSASYSNOTREADY
:

350  
EFAULT
;

352 
WSAVERNOTSUPPORTED
:

353  
EFAULT
;

355 
WSANOTINITIALISED
:

356  
EFAULT
;

358 
WSAHOST_NOT_FOUND
:

359  
EFAULT
;

361 
WSATRY_AGAIN
:

362  
EFAULT
;

364 
WSANO_RECOVERY
:

365  
EFAULT
;

367 
WSANO_DATA
:

368  
EFAULT
;

370 
	`w§_as£¹
 (
çl£
);

374 
	}
}

	@err.hpp

20 #iâdeà
__ZMQ_ERR_HPP_INCLUDED__


21 
	#__ZMQ_ERR_HPP_INCLUDED__


	)

24 
	~"../šşude/zmq.h
"

26 
	~<as£¹.h
>

27 #ià
defšed
 
_WIN32_WCE


28 
	~"..\buds\msvc\”ºo.hµ
"

30 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

33 
	~<¡dlib.h
>

34 
	~<¡dio.h
>

36 
	~"¶©fÜm.hµ
"

37 
	~"lik–y.hµ
"

39 #ifdeà
ZMQ_HAVE_WINDOWS


40 
	~"wšdows.hµ
"

42 
	~<Ãtdb.h
>

46 #iâdeà
EPROTO


47 
	#EPROTO
 0

	)

50 
Çme¥aû
 
	gzmq


52 cÚ¡ *
”ºo_to_¡ršg
 (
”ºo_
);

53 
zmq_abÜt
 (cÚ¡ *
”rmsg_
);

56 #ifdeà
ZMQ_HAVE_WINDOWS


58 
Çme¥aû
 
	gzmq


60 cÚ¡ *
w§_”rÜ
 ();

61 cÚ¡ *
w§_”rÜ_no
 (
no_
);

62 
wš_”rÜ
 (*
bufãr_
, 
size_t
 
bufãr_size_
);

63 
w§_”rÜ_to_”ºo
 (
”rcode
);

67 
	#w§_as£¹
(
x
) \

69 ià(
	`uÆik–y
 (!(
x
))) {\

70 cÚ¡ *
”r¡r
 = 
zmq
::
	`w§_”rÜ
 ();\

71 ià(
”r¡r
 !ğ
NULL
) {\

72 
	`årštf
 (
¡d”r
, "As£¹iÚ faed: % (%s:%d)\n", 
”r¡r
, \

73 
__FILE__
, 
__LINE__
);\

74 
zmq
::
	`zmq_abÜt
 (
”r¡r
);\

77 } 
çl£
)

	)

80 
	#w§_as£¹_no
(
no
) \

82 cÚ¡ *
”r¡r
 = 
zmq
::
	`w§_”rÜ_no
 (
no
);\

83 ià(
”r¡r
 !ğ
NULL
) {\

84 
	`årštf
 (
¡d”r
, "As£¹iÚ faed: % (%s:%d)\n", 
”r¡r
, \

85 
__FILE__
, 
__LINE__
);\

86 
zmq
::
	`zmq_abÜt
 (
”r¡r
);\

88 } 
çl£
)

	)

91 
	#wš_as£¹
(
x
) \

93 ià(
	`uÆik–y
 (!(
x
))) {\

94 
”r¡r
 [256];\

95 
zmq
::
	`wš_”rÜ
 (
”r¡r
, 256);\

96 
	`årštf
 (
¡d”r
, "As£¹iÚ faed: % (%s:%d)\n", 
”r¡r
, \

97 
__FILE__
, 
__LINE__
);\

98 
zmq
::
	`zmq_abÜt
 (
”r¡r
);\

100 } 
çl£
)

	)

107 
	#zmq_as£¹
(
x
) \

109 ià(
	`uÆik–y
 (!(
x
))) {\

110 
	`årštf
 (
¡d”r
, "Assertion failed: %s (%s:%d)\n", #x, \

111 
__FILE__
, 
__LINE__
);\

112 
zmq
::
	`zmq_abÜt
 (#x);\

114 } 
çl£
)

	)

117 
	#”ºo_as£¹
(
x
) \

119 ià(
	`uÆik–y
 (!(
x
))) {\

120 cÚ¡ *
”r¡r
 = 
	`¡»¼Ü
 (
”ºo
);\

121 
	`årštf
 (
¡d”r
, "% (%s:%d)\n", 
”r¡r
, 
__FILE__
, 
__LINE__
);\

122 
zmq
::
	`zmq_abÜt
 (
”r¡r
);\

124 } 
çl£
)

	)

127 
	#posix_as£¹
(
x
) \

129 ià(
	`uÆik–y
 (
x
)) {\

130 cÚ¡ *
”r¡r
 = 
	`¡»¼Ü
 (
x
);\

131 
	`årštf
 (
¡d”r
, "% (%s:%d)\n", 
”r¡r
, 
__FILE__
, 
__LINE__
);\

132 
zmq
::
	`zmq_abÜt
 (
”r¡r
);\

134 } 
çl£
)

	)

137 
	#gai_as£¹
(
x
) \

139 ià(
	`uÆik–y
 (
x
)) {\

140 cÚ¡ *
”r¡r
 = 
	`gai_¡»¼Ü
 (
x
);\

141 
	`årštf
 (
¡d”r
, "% (%s:%d)\n", 
”r¡r
, 
__FILE__
, 
__LINE__
);\

142 
zmq
::
	`zmq_abÜt
 (
”r¡r
);\

144 } 
çl£
)

	)

147 
	#®loc_as£¹
(
x
) \

149 ià(
	`uÆik–y
 (!
x
)) {\

150 
	`årštf
 (
¡d”r
, "FATAL ERROR: OUT OF MEMORY (%s:%d)\n",\

151 
__FILE__
, 
__LINE__
);\

152 
zmq
::
	`zmq_abÜt
 ("FATAL ERROR: OUT OF MEMORY");\

154 } 
çl£
)

	)

	@fd.hpp

20 #iâdeà
__ZMQ_FD_HPP_INCLUDED__


21 
	#__ZMQ_FD_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ifdeà
ZMQ_HAVE_WINDOWS


26 
	~"wšdows.hµ
"

29 
Çme¥aû
 
	gzmq


31 #ifdeà
ZMQ_HAVE_WINDOWS


32 #ià
defšed
 
_MSC_VER
 &&_MSC_VER <= 1400

33 
UINT_PTR
 
	tfd_t
;

34 ’um {
	g»tœed_fd
 = (
fd_t
)(~0)};

36 
SOCKET
 
	tfd_t
;

37 ’um {
	g»tœed_fd
 = (
fd_t
)
INVALID_SOCKET
};

40 
	tfd_t
;

41 ’um {
	g»tœed_fd
 = -1};

	@fq.cpp

20 
	~"fq.hµ
"

21 
	~"pe.hµ
"

22 
	~"”r.hµ
"

23 
	~"msg.hµ
"

25 
	gzmq
::
fq_t
::
	$fq_t
 () :

26 
	`aùive
 (0),

27 
	`cu¼’t
 (0),

28 
	$mÜe
 (
çl£
)

30 
	}
}

32 
	gzmq
::
fq_t
::~
	$fq_t
 ()

34 
	`zmq_as£¹
 (
pes
.
	`em±y
 ());

35 
	}
}

37 
	gzmq
::
fq_t
::
	$©ch
 (
pe_t
 *
pe_
)

39 
pes
.
	`push_back
 (
pe_
);

40 
pes
.
	`sw­
 (
aùive
,…es.
	`size
 () - 1);

41 
aùive
++;

42 
	}
}

44 
	gzmq
::
fq_t
::
	$pe_‹rmš©ed
 (
pe_t
 *
pe_
)

46 cÚ¡ 
pes_t
::
size_ty³
 
šdex
 = 
pes
.
	`šdex
 (
pe_
);

50 ià(
šdex
 < 
aùive
) {

51 
aùive
--;

52 
pes
.
	`sw­
 (
šdex
, 
aùive
);

53 ià(
cu¼’t
 =ğ
aùive
)

54 
cu¼’t
 = 0;

56 
pes
.
	`”a£
 (
pe_
);

57 
	}
}

59 
	gzmq
::
fq_t
::
	$aùiv©ed
 (
pe_t
 *
pe_
)

62 
pes
.
	`sw­
 (pes.
	`šdex
 (
pe_
), 
aùive
);

63 
aùive
++;

64 
	}
}

66 
	gzmq
::
fq_t
::
	$»cv
 (
msg_t
 *
msg_
)

68  
	`»cvpe
 (
msg_
, 
NULL
);

69 
	}
}

71 
	gzmq
::
fq_t
::
	$»cvpe
 (
msg_t
 *
msg_
, 
pe_t
 **
pe_
)

74 
rc
 = 
msg_
->
	`şo£
 ();

75 
	`”ºo_as£¹
 (
rc
 == 0);

78 
aùive
 > 0) {

82 
boŞ
 
ãtched
 = 
pes
 [
cu¼’t
]->
	`»ad
 (
msg_
);

87 ià(
ãtched
) {

88 ià(
pe_
)

89 *
pe_
 = 
pes
 [
cu¼’t
];

90 
mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::mÜe? 
Œue
: 
çl£
;

91 ià(!
mÜe
)

92 
cu¼’t
 = (cu¼’ˆ+ 1è% 
aùive
;

99 
	`zmq_as£¹
 (!
mÜe
);

101 
aùive
--;

102 
pes
.
	`sw­
 (
cu¼’t
, 
aùive
);

103 ià(
cu¼’t
 =ğ
aùive
)

104 
cu¼’t
 = 0;

109 
rc
 = 
msg_
->
	`š™
 ();

110 
	`”ºo_as£¹
 (
rc
 == 0);

111 
”ºo
 = 
EAGAIN
;

113 
	}
}

115 
boŞ
 
	gzmq
::
fq_t
::
	$has_š
 ()

118 ià(
mÜe
)

119  
Œue
;

125 
aùive
 > 0) {

126 ià(
pes
 [
cu¼’t
]->
	`check_»ad
 ())

127  
Œue
;

130 
aùive
--;

131 
pes
.
	`sw­
 (
cu¼’t
, 
aùive
);

132 ià(
cu¼’t
 =ğ
aùive
)

133 
cu¼’t
 = 0;

136  
çl£
;

137 
	}
}

	@fq.hpp

20 #iâdeà
__ZMQ_FQ_HPP_INCLUDED__


21 
	#__ZMQ_FQ_HPP_INCLUDED__


	)

23 
	~"¬¿y.hµ
"

24 
	~"pe.hµ
"

25 
	~"msg.hµ
"

27 
Çme¥aû
 
	gzmq


34 şas 
	cfq_t


36 
	gpublic
:

38 
fq_t
 ();

39 ~
fq_t
 ();

41 
©ch
 (
pe_t
 *
pe_
);

42 
aùiv©ed
 (
pe_t
 *
pe_
);

43 
pe_‹rmš©ed
 (
pe_t
 *
pe_
);

45 
»cv
 (
msg_t
 *
msg_
);

46 
»cvpe
 (
msg_t
 *
msg_
, 
pe_t
 **
pe_
);

47 
boŞ
 
has_š
 ();

49 
	g´iv©e
:

52 
¬¿y_t
 <
	tpe_t
, 1> 
	tpes_t
;

53 
pes_t
 
	gpes
;

57 
	gpes_t
::
size_ty³
 
aùive
;

60 
	gpes_t
::
size_ty³
 
cu¼’t
;

64 
boŞ
 
	gmÜe
;

66 
fq_t
 (const fq_t&);

67 cÚ¡ 
	gfq_t
 &
	gİ”©Ü
 = (cÚ¡ 
fq_t
&);

	@i_decoder.hpp

20 #iâdeà
__ZMQ_I_DECODER_HPP_INCLUDED__


21 
	#__ZMQ_I_DECODER_HPP_INCLUDED__


	)

23 
	~"¡dšt.hµ
"

25 
Çme¥aû
 
	gzmq


28 
şass
 
	gmsg_t
;

32 şas 
	ci_decod”


34 
	gpublic
:

35 
vœtu®
 ~
i_decod”
 () {}

37 
vœtu®
 
g‘_bufãr
 (**
d©a_
, 
size_t
 *
size_
) = 0;

43 
vœtu®
 
decode
 (cÚ¡ *
d©a_
, 
size_t
 
size_
,

44 
size_t
 &
´oûs£d
) = 0;

46 
vœtu®
 
msg_t
 *
msg
 () = 0;

	@i_encoder.hpp

20 #iâdeà
__ZMQ_I_ENCODER_HPP_INCLUDED__


21 
	#__ZMQ_I_ENCODER_HPP_INCLUDED__


	)

23 
	~"¡dšt.hµ
"

25 
Çme¥aû
 
	gzmq


29 
şass
 
	gmsg_t
;

33 
	si_’cod”


35 
	gvœtu®
 ~
i_’cod”
 () {}

41 
vœtu®
 
size_t
 
’code
 (**
d©a_
, size_ˆ
size
) = 0;

44 
vœtu®
 
lßd_msg
 (
msg_t
 *
msg_
) = 0;

	@i_engine.hpp

20 #iâdeà
__ZMQ_I_ENGINE_HPP_INCLUDED__


21 
	#__ZMQ_I_ENGINE_HPP_INCLUDED__


	)

23 
Çme¥aû
 
	gzmq


26 
şass
 
	gio_th»ad_t
;

30 
	si_’gše


32 
	gvœtu®
 ~
i_’gše
 () {}

35 
vœtu®
 
¶ug
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
,

36 
şass
 
£ssiÚ_ba£_t
 *
£ssiÚ_
) = 0;

40 
vœtu®
 
‹rmš©e
 () = 0;

44 
vœtu®
 
»¡¬t_šput
 () = 0;

48 
vœtu®
 
»¡¬t_ouut
 () = 0;

50 
vœtu®
 
z­_msg_avaabË
 () = 0;

	@i_poll_events.hpp

20 #iâdeà
__ZMQ_I_POLL_EVENTS_HPP_INCLUDED__


21 
	#__ZMQ_I_POLL_EVENTS_HPP_INCLUDED__


	)

23 
Çme¥aû
 
	gzmq


29 
	si_pŞl_ev’ts


31 
	gvœtu®
 ~
i_pŞl_ev’ts
 () {}

34 
vœtu®
 
š_ev’t
 () = 0;

37 
vœtu®
 
out_ev’t
 () = 0;

40 
vœtu®
 
tim”_ev’t
 (
id_
) = 0;

	@io_object.cpp

20 
	~"io_objeù.hµ
"

21 
	~"io_th»ad.hµ
"

22 
	~"”r.hµ
"

24 
	gzmq
::
io_objeù_t
::
	$io_objeù_t
 (
io_th»ad_t
 *
io_th»ad_
) :

25 
	$pŞËr
 (
NULL
)

27 ià(
io_th»ad_
)

28 
	`¶ug
 (
io_th»ad_
);

29 
	}
}

31 
	gzmq
::
io_objeù_t
::~
	$io_objeù_t
 ()

33 
	}
}

35 
zmq
::
io_objeù_t
::
	$¶ug
 (
io_th»ad_t
 *
io_th»ad_
)

37 
	`zmq_as£¹
 (
io_th»ad_
);

38 
	`zmq_as£¹
 (!
pŞËr
);

41 
pŞËr
 = 
io_th»ad_
->
	`g‘_pŞËr
 ();

42 
	}
}

44 
	gzmq
::
io_objeù_t
::
	$uÅlug
 ()

46 
	`zmq_as£¹
 (
pŞËr
);

50 
pŞËr
 = 
NULL
;

51 
	}
}

53 
	gzmq
::
io_objeù_t
::
hªdË_t
 
zmq
::io_objeù_t::
	$add_fd
 (
fd_t
 
fd_
)

55  
pŞËr
->
	`add_fd
 (
fd_
, 
this
);

56 
	}
}

58 
	gzmq
::
io_objeù_t
::
	$rm_fd
 (
hªdË_t
 
hªdË_
)

60 
pŞËr
->
	`rm_fd
 (
hªdË_
);

61 
	}
}

63 
	gzmq
::
io_objeù_t
::
	$£t_pŞlš
 (
hªdË_t
 
hªdË_
)

65 
pŞËr
->
	`£t_pŞlš
 (
hªdË_
);

66 
	}
}

68 
	gzmq
::
io_objeù_t
::
	$»£t_pŞlš
 (
hªdË_t
 
hªdË_
)

70 
pŞËr
->
	`»£t_pŞlš
 (
hªdË_
);

71 
	}
}

73 
	gzmq
::
io_objeù_t
::
	$£t_pŞlout
 (
hªdË_t
 
hªdË_
)

75 
pŞËr
->
	`£t_pŞlout
 (
hªdË_
);

76 
	}
}

78 
	gzmq
::
io_objeù_t
::
	$»£t_pŞlout
 (
hªdË_t
 
hªdË_
)

80 
pŞËr
->
	`»£t_pŞlout
 (
hªdË_
);

81 
	}
}

83 
	gzmq
::
io_objeù_t
::
	$add_tim”
 (
timeout_
, 
id_
)

85 
pŞËr
->
	`add_tim”
 (
timeout_
, 
this
, 
id_
);

86 
	}
}

88 
	gzmq
::
io_objeù_t
::
	$ÿnûl_tim”
 (
id_
)

90 
pŞËr
->
	`ÿnûl_tim”
 (
this
, 
id_
);

91 
	}
}

93 
	gzmq
::
io_objeù_t
::
	$š_ev’t
 ()

95 
	`zmq_as£¹
 (
çl£
);

96 
	}
}

98 
	gzmq
::
io_objeù_t
::
	$out_ev’t
 ()

100 
	`zmq_as£¹
 (
çl£
);

101 
	}
}

103 
	gzmq
::
io_objeù_t
::
	$tim”_ev’t
 ()

105 
	`zmq_as£¹
 (
çl£
);

106 
	}
}

	@io_object.hpp

20 #iâdeà
__ZMQ_IO_OBJECT_HPP_INCLUDED__


21 
	#__ZMQ_IO_OBJECT_HPP_INCLUDED__


	)

23 
	~<¡ddef.h
>

25 
	~"¡dšt.hµ
"

26 
	~"pŞËr.hµ
"

27 
	~"i_pŞl_ev’ts.hµ
"

29 
Çme¥aû
 
	gzmq


32 
şass
 
	gio_th»ad_t
;

38 şas 
	cio_objeù_t
 : 
public
 
i_pŞl_ev’ts


40 
public
:

42 
io_objeù_t
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
 = 
NULL
);

43 ~
io_objeù_t
 ();

47 
¶ug
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
);

48 
uÅlug
 ();

50 
	g´Ùeùed
:

52 
pŞËr_t
::
	thªdË_t
 handle_t;

55 
hªdË_t
 
add_fd
 (
fd_t
 
fd_
);

56 
rm_fd
 (
hªdË_t
 
hªdË_
);

57 
£t_pŞlš
 (
hªdË_t
 
hªdË_
);

58 
»£t_pŞlš
 (
hªdË_t
 
hªdË_
);

59 
£t_pŞlout
 (
hªdË_t
 
hªdË_
);

60 
»£t_pŞlout
 (
hªdË_t
 
hªdË_
);

61 
add_tim”
 (
timout_
, 
id_
);

62 
ÿnûl_tim”
 (
id_
);

65 
š_ev’t
 ();

66 
out_ev’t
 ();

67 
tim”_ev’t
 (
id_
);

69 
	g´iv©e
:

71 
pŞËr_t
 *
pŞËr
;

73 
io_objeù_t
 (const io_object_t&);

74 cÚ¡ 
	gio_objeù_t
 &
	gİ”©Ü
 = (cÚ¡ 
io_objeù_t
&);

	@io_thread.cpp

20 
	~<Ãw
>

22 
	~"io_th»ad.hµ
"

23 
	~"¶©fÜm.hµ
"

24 
	~"”r.hµ
"

25 
	~"ùx.hµ
"

27 
	gzmq
::
io_th»ad_t
::
	$io_th»ad_t
 (
ùx_t
 *
ùx_
, 
ušt32_t
 
tid_
) :

28 
	$objeù_t
 (
ùx_
, 
tid_
)

30 
pŞËr
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
pŞËr_t
;

31 
	`®loc_as£¹
 (
pŞËr
);

33 
mabox_hªdË
 = 
pŞËr
->
	`add_fd
 (
mabox
.
	`g‘_fd
 (), 
this
);

34 
pŞËr
->
	`£t_pŞlš
 (
mabox_hªdË
);

35 
	}
}

37 
	gzmq
::
io_th»ad_t
::~
	$io_th»ad_t
 ()

39 
d–‘e
 
pŞËr
;

40 
	}
}

42 
	gzmq
::
io_th»ad_t
::
	$¡¬t
 ()

45 
pŞËr
->
	`¡¬t
 ();

46 
	}
}

48 
	gzmq
::
io_th»ad_t
::
	$¡İ
 ()

50 
	`£nd_¡İ
 ();

51 
	}
}

53 
	gzmq
::
mabox_t
 *
zmq
::
io_th»ad_t
::
	$g‘_mabox
 ()

55  &
mabox
;

56 
	}
}

58 
	gzmq
::
io_th»ad_t
::
	$g‘_lßd
 ()

60  
pŞËr
->
	`g‘_lßd
 ();

61 
	}
}

63 
	gzmq
::
io_th»ad_t
::
	$š_ev’t
 ()

68 
commªd_t
 
cmd
;

69 
rc
 = 
mabox
.
	`»cv
 (&
cmd
, 0);

71 
rc
 =ğ0 || 
”ºo
 =ğ
EINTR
) {

72 ià(
rc
 == 0)

73 
cmd
.
de¡š©iÚ
->
	`´oûss_commªd
 (cmd);

74 
rc
 = 
mabox
.
	`»cv
 (&
cmd
, 0);

77 
	`”ºo_as£¹
 (
rc
 !ğ0 && 
”ºo
 =ğ
EAGAIN
);

78 
	}
}

80 
	gzmq
::
io_th»ad_t
::
	$out_ev’t
 ()

83 
	`zmq_as£¹
 (
çl£
);

84 
	}
}

86 
	gzmq
::
io_th»ad_t
::
	$tim”_ev’t
 ()

89 
	`zmq_as£¹
 (
çl£
);

90 
	}
}

92 
	gzmq
::
pŞËr_t
 *
zmq
::
io_th»ad_t
::
	$g‘_pŞËr
 ()

94 
	`zmq_as£¹
 (
pŞËr
);

95  
pŞËr
;

96 
	}
}

98 
	gzmq
::
io_th»ad_t
::
	$´oûss_¡İ
 ()

100 
pŞËr
->
	`rm_fd
 (
mabox_hªdË
);

101 
pŞËr
->
	`¡İ
 ();

102 
	}
}

	@io_thread.hpp

20 #iâdeà
__ZMQ_IO_THREAD_HPP_INCLUDED__


21 
	#__ZMQ_IO_THREAD_HPP_INCLUDED__


	)

23 
	~<veùÜ
>

25 
	~"¡dšt.hµ
"

26 
	~"objeù.hµ
"

27 
	~"pŞËr.hµ
"

28 
	~"i_pŞl_ev’ts.hµ
"

29 
	~"mabox.hµ
"

31 
Çme¥aû
 
	gzmq


34 
şass
 
	gùx_t
;

39 
şass
 
	gio_th»ad_t
 : 
public
 
objeù_t
,…ubliø
	gi_pŞl_ev’ts


41 
	gpublic
:

43 
io_th»ad_t
 (
zmq
::
ùx_t
 *
ùx_
, 
ušt32_t
 
tid_
);

47 ~
io_th»ad_t
 ();

50 
¡¬t
 ();

53 
¡İ
 ();

56 
mabox_t
 *
g‘_mabox
 ();

59 
š_ev’t
 ();

60 
out_ev’t
 ();

61 
tim”_ev’t
 (
id_
);

64 
pŞËr_t
 *
g‘_pŞËr
 ();

67 
´oûss_¡İ
 ();

70 
g‘_lßd
 ();

72 
	g´iv©e
:

75 
mabox_t
 
mabox
;

78 
	gpŞËr_t
::
hªdË_t
 
mabox_hªdË
;

81 
pŞËr_t
 *
	gpŞËr
;

83 
io_th»ad_t
 (const io_thread_t&);

84 cÚ¡ 
	gio_th»ad_t
 &
	gİ”©Ü
 = (cÚ¡ 
io_th»ad_t
&);

	@ip.cpp

20 
	~".hµ
"

21 
	~"”r.hµ
"

22 
	~"¶©fÜm.hµ
"

24 #ià
defšed
 
ZMQ_HAVE_WINDOWS


25 
	~"wšdows.hµ
"

27 
	~<fú.h
>

28 
	~<sys/ty³s.h
>

29 
	~<sys/sock‘.h
>

30 
	~<Ãtdb.h
>

31 
	~<Ãtš‘/š.h
>

32 
	~<Ãtš‘/tı.h
>

35 #ià
defšed
 
ZMQ_HAVE_OPENVMS


36 
	~<ioùl.h
>

39 
	gzmq
::
fd_t
 
zmq
::
	$İ’_sock‘
 (
domaš_
, 
ty³_
, 
´ÙocŞ_
)

43 #ià
defšed
 
ZMQ_HAVE_SOCK_CLOEXEC


44 
ty³_
 |ğ
SOCK_CLOEXEC
;

47 
fd_t
 
s
 = 
	`sock‘
 (
domaš_
, 
ty³_
, 
´ÙocŞ_
);

48 #ifdeà
ZMQ_HAVE_WINDOWS


49 ià(
s
 =ğ
INVALID_SOCKET
)

50  
INVALID_SOCKET
;

52 ià(
s
 == -1)

59 #ià!
defšed
 
ZMQ_HAVE_SOCK_CLOEXEC
 && defšed 
FD_CLOEXEC


60 
rc
 = 
	`fú
 (
s
, 
F_SETFD
, 
FD_CLOEXEC
);

61 
	`”ºo_as£¹
 (
rc
 != -1);

65 #ià
defšed
 
ZMQ_HAVE_WINDOWS
 && defšed 
HANDLE_FLAG_INHERIT


66 
BOOL
 
brc
 = 
	`S‘HªdËInfÜm©iÚ
 ((
HANDLE
è
s
, 
HANDLE_FLAG_INHERIT
, 0);

67 
	`wš_as£¹
 (
brc
);

70  
s
;

71 
	}
}

73 
	gzmq
::
	$unblock_sock‘
 (
fd_t
 
s_
)

75 #ià
defšed
 
ZMQ_HAVE_WINDOWS


76 
u_lÚg
 
nÚblock
 = 1;

77 
rc
 = 
	`ioùlsock‘
 (
s_
, 
FIONBIO
, &
nÚblock
);

78 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

79 #–ià
defšed
 
ZMQ_HAVE_OPENVMS


80 
nÚblock
 = 1;

81 
rc
 = 
	`ioùl
 (
s_
, 
FIONBIO
, &
nÚblock
);

82 
	`”ºo_as£¹
 (
rc
 != -1);

84 
æags
 = 
	`fú
 (
s_
, 
F_GETFL
, 0);

85 ià(
æags
 == -1)

86 
æags
 = 0;

87 
rc
 = 
	`fú
 (
s_
, 
F_SETFL
, 
æags
 | 
O_NONBLOCK
);

88 
	`”ºo_as£¹
 (
rc
 != -1);

90 
	}
}

92 
	gzmq
::
	$’abË_v4_m­pšg
 (
fd_t
 
s_
)

94 (è
s_
;

96 #ifdeà
IPV6_V6ONLY


97 #ifdeà
ZMQ_HAVE_WINDOWS


98 
DWORD
 
æag
 = 0;

100 
æag
 = 0;

102 
rc
 = 
	`£tsockİt
 (
s_
, 
IPPROTO_IPV6
, 
IPV6_V6ONLY
, (cÚ¡ *è&
æag
,

103  (
æag
));

104 #ifdeà
ZMQ_HAVE_WINDOWS


105 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

107 
	`”ºo_as£¹
 (
rc
 == 0);

110 
	}
}

112 
boŞ
 
	gzmq
::
	$g‘_³”__add»ss
 (
fd_t
 
sockfd_
, 
¡d
::
¡ršg
 &
_addr_
)

114 
rc
;

115 
sockaddr_¡Üage
 
ss
;

117 #ià
defšed
 
ZMQ_HAVE_HPUX
 || defšed 
ZMQ_HAVE_WINDOWS


118 
add¾’
 = 
¡©ic_ÿ¡
 <> ( 
ss
);

120 
sockËn_t
 
add¾’
 =  
ss
;

122 
rc
 = 
	`g‘³”Çme
 (
sockfd_
, (
sockaddr
*è&
ss
, &
add¾’
);

123 #ifdeà
ZMQ_HAVE_WINDOWS


124 ià(
rc
 =ğ
SOCKET_ERROR
) {

125 
	`w§_as£¹
 (
	`WSAG‘La¡E¼Ü
 (è!ğ
WSANOTINITIALISED
 &&

126 
	`WSAG‘La¡E¼Ü
 (è!ğ
WSAEFAULT
 &&

127 
	`WSAG‘La¡E¼Ü
 (è!ğ
WSAEINPROGRESS
 &&

128 
	`WSAG‘La¡E¼Ü
 (è!ğ
WSAENOTSOCK
);

129  
çl£
;

132 ià(
rc
 == -1) {

133 
	`”ºo_as£¹
 (
”ºo
 !ğ
EBADF
 &&

134 
”ºo
 !ğ
EFAULT
 &&

135 
”ºo
 !ğ
EINVAL
 &&

136 
”ºo
 !ğ
ENOTSOCK
);

137  
çl£
;

141 
ho¡
 [
NI_MAXHOST
];

142 
rc
 = 
	`g‘Çmešfo
 ((
sockaddr
*è&
ss
, 
add¾’
, 
ho¡
,  host,

143 
NULL
, 0, 
NI_NUMERICHOST
);

144 ià(
rc
 != 0)

145  
çl£
;

147 
_addr_
 = 
ho¡
;

148  
Œue
;

149 
	}
}

	@ip.hpp

20 #iâdeà
__ZMQ_IP_HPP_INCLUDED__


21 
	#__ZMQ_IP_HPP_INCLUDED__


	)

23 
	~<¡ršg
>

24 
	~"fd.hµ
"

26 
Çme¥aû
 
	gzmq


30 
fd_t
 
İ’_sock‘
 (
domaš_
, 
ty³_
, 
´ÙocŞ_
);

33 
unblock_sock‘
 (
fd_t
 
s_
);

36 
’abË_v4_m­pšg
 (
fd_t
 
s_
);

40 
boŞ
 
g‘_³”__add»ss
 (
fd_t
 
sockfd_
, 
¡d
::
¡ršg
 &
_addr_
);

	@ipc_address.cpp

20 
	~"c_add»ss.hµ
"

22 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


24 
	~"”r.hµ
"

26 
	~<¡ršg
>

27 
	~<s¡»am
>

29 
	gzmq
::
c_add»ss_t
::
	$c_add»ss_t
 ()

31 
	`mem£t
 (&
add»ss
, 0,  (address));

32 
	}
}

34 
	gzmq
::
c_add»ss_t
::
	$c_add»ss_t
 (cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§_Ën
)

36 
	`zmq_as£¹
(
§
 && 
§_Ën
 > 0);

38 
	`mem£t
 (&
add»ss
, 0,  (address));

39 ià(
§
->
§_çmy
 =ğ
AF_UNIX
) {

40 
	`memıy
(&
add»ss
, 
§
, 
§_Ën
);

42 
	}
}

44 
	gzmq
::
c_add»ss_t
::~
	$c_add»ss_t
 ()

46 
	}
}

48 
zmq
::
c_add»ss_t
::
	$»sŞve
 (cÚ¡ *
·th_
)

50 ià(
	`¡¾’
 (
·th_
è>ğ (
add»ss
.
sun_·th
)) {

51 
”ºo
 = 
ENAMETOOLONG
;

54 #ià
defšed
 
ZMQ_HAVE_LINUX


55 ià(
·th_
[0] == '@' && !path_[1]) {

56 
”ºo
 = 
EINVAL
;

61 
add»ss
.
sun_çmy
 = 
AF_UNIX
;

62 
	`¡rıy
 (
add»ss
.
sun_·th
, 
·th_
);

63 #ià
defšed
 
ZMQ_HAVE_LINUX


65 ià(
·th_
[0] == '@')

66 *
add»ss
.
sun_·th
 = '\0';

69 
	}
}

71 
	gzmq
::
c_add»ss_t
::
	$to_¡ršg
 (
¡d
::
¡ršg
 &
addr_
)

73 ià(
add»ss
.
sun_çmy
 !ğ
AF_UNIX
) {

74 
addr_
.
	`ş—r
 ();

78 
¡d
::
¡ršg¡»am
 
s
;

79 #ià!
defšed
 
ZMQ_HAVE_LINUX


80 
s
 << "c://" << 
add»ss
.
sun_·th
;

82 
s
 << "ipc://";

83 ià(!
add»ss
.
sun_·th
[0] &&‡ddress.sun_path[1])

84 
s
 << "@" << 
add»ss
.
sun_·th
 + 1;

86 
s
 << 
add»ss
.
sun_·th
;

88 
addr_
 = 
s
.
	`¡r
 ();

90 
	}
}

92 cÚ¡ 
sockaddr
 *
	gzmq
::
c_add»ss_t
::
	$addr
 () const

94  (
sockaddr
*è&
add»ss
;

95 
	}
}

97 
sockËn_t
 
	gzmq
::
c_add»ss_t
::
	$add¾’
 () const

99 #ià
defšed
 
ZMQ_HAVE_LINUX


100 ià(!
add»ss
.
sun_·th
[0] &&‡ddress.sun_path[1])

101  (
sockËn_t
è
	`¡¾’
(
add»ss
.
sun_·th
 + 1è+  (
§_çmy_t
) + 1;

103  (
sockËn_t
è (
add»ss
);

104 
	}
}

	@ipc_address.hpp

20 #iâdeà
__ZMQ_IPC_ADDRESS_HPP_INCLUDED__


21 
	#__ZMQ_IPC_ADDRESS_HPP_INCLUDED__


	)

23 
	~<¡ršg
>

25 
	~"¶©fÜm.hµ
"

27 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


29 
	~<sys/sock‘.h
>

30 
	~<sys/un.h
>

32 
Çme¥aû
 
	gzmq


35 şas 
	cc_add»ss_t


37 
	gpublic
:

39 
c_add»ss_t
 ();

40 
c_add»ss_t
 (cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§_Ën
);

41 ~
c_add»ss_t
 ();

44 
»sŞve
 (cÚ¡ * 
·th_
);

47 
to_¡ršg
 (
¡d
::
¡ršg
 &
addr_
);

49 cÚ¡ 
sockaddr
 *
addr
 () const;

50 
sockËn_t
 
add¾’
 () const;

52 
	g´iv©e
:

54 
sockaddr_un
 
add»ss
;

56 
c_add»ss_t
 (const ipc_address_t&);

57 cÚ¡ 
	gc_add»ss_t
 &
	gİ”©Ü
 = (cÚ¡ 
c_add»ss_t
&);

	@ipc_connecter.cpp

20 
	~"c_cÚÃù”.hµ
"

22 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


24 
	~<Ãw
>

25 
	~<¡ršg
>

27 
	~"¡»am_’gše.hµ
"

28 
	~"io_th»ad.hµ
"

29 
	~"¶©fÜm.hµ
"

30 
	~"¿ndom.hµ
"

31 
	~"”r.hµ
"

32 
	~".hµ
"

33 
	~"add»ss.hµ
"

34 
	~"c_add»ss.hµ
"

35 
	~"£ssiÚ_ba£.hµ
"

37 
	~<uni¡d.h
>

38 
	~<sys/ty³s.h
>

39 
	~<sys/sock‘.h
>

40 
	~<sys/un.h
>

42 
	gzmq
::
c_cÚÃù”_t
::
	$c_cÚÃù”_t
 (
şass
 
io_th»ad_t
 *
io_th»ad_
,

43 
şass
 
£ssiÚ_ba£_t
 *
£ssiÚ_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

44 cÚ¡ 
add»ss_t
 *
addr_
, 
boŞ
 
d–ayed_¡¬t_
) :

45 
	`own_t
 (
io_th»ad_
, 
İtiÚs_
),

46 
	`io_objeù_t
 (
io_th»ad_
),

47 
	`addr
 (
addr_
),

48 
	`s
 (
»tœed_fd
),

49 
	`hªdË_v®id
 (
çl£
),

50 
	`d–ayed_¡¬t
 (
d–ayed_¡¬t_
),

51 
	`tim”_¡¬‹d
 (
çl£
),

52 
	`£ssiÚ
 (
£ssiÚ_
),

53 
	$cu¼’t_»cÚÃù_ivl
(
İtiÚs
.
»cÚÃù_ivl
)

55 
	`zmq_as£¹
 (
addr
);

56 
	`zmq_as£¹
 (
addr
->
´ÙocŞ
 == "ipc");

57 
addr
->
	`to_¡ršg
 (
’dpošt
);

58 
sock‘
 = 
£ssiÚ
-> 
	`g‘_sock‘
();

59 
	}
}

61 
	gzmq
::
c_cÚÃù”_t
::~
	$c_cÚÃù”_t
 ()

63 
	`zmq_as£¹
 (!
tim”_¡¬‹d
);

64 
	`zmq_as£¹
 (!
hªdË_v®id
);

65 
	`zmq_as£¹
 (
s
 =ğ
»tœed_fd
);

66 
	}
}

68 
	gzmq
::
c_cÚÃù”_t
::
	$´oûss_¶ug
 ()

70 ià(
d–ayed_¡¬t
)

71 
	`add_»cÚÃù_tim”
 ();

73 
	`¡¬t_cÚÃùšg
 ();

74 
	}
}

76 
	gzmq
::
c_cÚÃù”_t
::
	$´oûss_‹rm
 (
lšg”_
)

78 ià(
tim”_¡¬‹d
) {

79 
	`ÿnûl_tim”
 (
»cÚÃù_tim”_id
);

80 
tim”_¡¬‹d
 = 
çl£
;

83 ià(
hªdË_v®id
) {

84 
	`rm_fd
 (
hªdË
);

85 
hªdË_v®id
 = 
çl£
;

88 ià(
s
 !ğ
»tœed_fd
)

89 
	`şo£
 ();

91 
own_t
::
	`´oûss_‹rm
 (
lšg”_
);

92 
	}
}

94 
	gzmq
::
c_cÚÃù”_t
::
	$š_ev’t
 ()

99 
	`out_ev’t
 ();

100 
	}
}

102 
	gzmq
::
c_cÚÃù”_t
::
	$out_ev’t
 ()

104 
fd_t
 
fd
 = 
	`cÚÃù
 ();

105 
	`rm_fd
 (
hªdË
);

106 
hªdË_v®id
 = 
çl£
;

109 ià(
fd
 =ğ
»tœed_fd
) {

110 
	`şo£
 ();

111 
	`add_»cÚÃù_tim”
();

115 
¡»am_’gše_t
 *
’gše
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

116 
	`¡»am_’gše_t
 (
fd
, 
İtiÚs
, 
’dpošt
);

117 
	`®loc_as£¹
 (
’gše
);

120 
	`£nd_©ch
 (
£ssiÚ
, 
’gše
);

123 
	`‹rmš©e
 ();

125 
sock‘
->
	`ev’t_cÚÃùed
 (
’dpošt
, 
fd
);

126 
	}
}

128 
	gzmq
::
c_cÚÃù”_t
::
	$tim”_ev’t
 (
id_
)

130 
	`zmq_as£¹
 (
id_
 =ğ
»cÚÃù_tim”_id
);

131 
tim”_¡¬‹d
 = 
çl£
;

132 
	`¡¬t_cÚÃùšg
 ();

133 
	}
}

135 
	gzmq
::
c_cÚÃù”_t
::
	$¡¬t_cÚÃùšg
 ()

138 
rc
 = 
	`İ’
 ();

141 ià(
rc
 == 0) {

142 
hªdË
 = 
	`add_fd
 (
s
);

143 
hªdË_v®id
 = 
Œue
;

144 
	`out_ev’t
 ();

149 ià(
rc
 =ğ-1 && 
”ºo
 =ğ
EINPROGRESS
) {

150 
hªdË
 = 
	`add_fd
 (
s
);

151 
hªdË_v®id
 = 
Œue
;

152 
	`£t_pŞlout
 (
hªdË
);

153 
sock‘
->
	`ev’t_cÚÃù_d–ayed
 (
’dpošt
, 
	`zmq_”ºo
());

158 ià(
s
 !ğ
»tœed_fd
)

159 
	`şo£
 ();

160 
	`add_»cÚÃù_tim”
 ();

162 
	}
}

164 
	gzmq
::
c_cÚÃù”_t
::
	$add_»cÚÃù_tim”
()

166 
rc_ivl
 = 
	`g‘_Ãw_»cÚÃù_ivl
();

167 
	`add_tim”
 (
rc_ivl
, 
»cÚÃù_tim”_id
);

168 
sock‘
->
	`ev’t_cÚÃù_»Œ›d
 (
’dpošt
, 
rc_ivl
);

169 
tim”_¡¬‹d
 = 
Œue
;

170 
	}
}

172 
	gzmq
::
c_cÚÃù”_t
::
	$g‘_Ãw_»cÚÃù_ivl
 ()

175 
this_š‹rv®
 = 
cu¼’t_»cÚÃù_ivl
 +

176 (
	`g’”©e_¿ndom
 (è% 
İtiÚs
.
»cÚÃù_ivl
);

180 ià(
İtiÚs
.
»cÚÃù_ivl_max
 > 0 &&

181 
İtiÚs
.
»cÚÃù_ivl_max
 > o±iÚs.
»cÚÃù_ivl
) {

184 
cu¼’t_»cÚÃù_ivl
 = current_reconnect_ivl * 2;

185 if(
cu¼’t_»cÚÃù_ivl
 >ğ
İtiÚs
.
»cÚÃù_ivl_max
) {

186 
cu¼’t_»cÚÃù_ivl
 = 
İtiÚs
.
»cÚÃù_ivl_max
;

189  
this_š‹rv®
;

190 
	}
}

192 
	gzmq
::
c_cÚÃù”_t
::
	$İ’
 ()

194 
	`zmq_as£¹
 (
s
 =ğ
»tœed_fd
);

197 
s
 = 
	`İ’_sock‘
 (
AF_UNIX
, 
SOCK_STREAM
, 0);

198 ià(
s
 == -1)

202 
	`unblock_sock‘
 (
s
);

205 
rc
 = ::
	`cÚÃù
 (

206 
s
, 
addr
->
»sŞved
.
c_addr
->
	`addr
 (),

207 
addr
->
»sŞved
.
c_addr
->
	`add¾’
 ());

210 ià(
rc
 == 0)

215 ià(
rc
 =ğ-1 && 
”ºo
 =ğ
EINTR
) {

216 
”ºo
 = 
EINPROGRESS
;

222 
	}
}

224 
	gzmq
::
c_cÚÃù”_t
::
	$şo£
 ()

226 
	`zmq_as£¹
 (
s
 !ğ
»tœed_fd
);

227 
rc
 = ::
	`şo£
 (
s
);

228 
	`”ºo_as£¹
 (
rc
 == 0);

229 
sock‘
->
	`ev’t_şo£d
 (
’dpošt
, 
s
);

230 
s
 = 
»tœed_fd
;

232 
	}
}

234 
	gzmq
::
fd_t
 
zmq
::
c_cÚÃù”_t
::
	$cÚÃù
 ()

238 
”r
 = 0;

239 #ià
defšed
 
ZMQ_HAVE_HPUX


240 
Ën
 =  (
”r
);

242 
sockËn_t
 
Ën
 =  (
”r
);

244 
rc
 = 
	`g‘sockİt
 (
s
, 
SOL_SOCKET
, 
SO_ERROR
, (*è&
”r
, &
Ën
);

245 ià(
rc
 == -1)

246 
”r
 = 
”ºo
;

247 ià(
”r
 != 0) {

251 
”ºo
 = 
”r
;

252 
	`”ºo_as£¹
 (
”ºo
 =ğ
ECONNREFUSED
 ||ƒ¼nØ=ğ
ECONNRESET
 ||

253 
”ºo
 =ğ
ETIMEDOUT
 ||ƒ¼nØ=ğ
EHOSTUNREACH
 ||

254 
”ºo
 =ğ
ENETUNREACH
 ||ƒ¼nØ=ğ
ENETDOWN
);

256  
»tœed_fd
;

259 
fd_t
 
»suÉ
 = 
s
;

260 
s
 = 
»tœed_fd
;

261  
»suÉ
;

262 
	}
}

	@ipc_connecter.hpp

20 #iâdeà
__IPC_CONNECTER_HPP_INCLUDED__


21 
	#__IPC_CONNECTER_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


27 
	~"fd.hµ
"

28 
	~"own.hµ
"

29 
	~"¡dšt.hµ
"

30 
	~"io_objeù.hµ
"

32 
Çme¥aû
 
	gzmq


35 
şass
 
	gio_th»ad_t
;

36 
şass
 
	g£ssiÚ_ba£_t
;

37 
	gadd»ss_t
;

39 
şass
 
	gc_cÚÃù”_t
 : 
public
 
own_t
,…ubliø
	gio_objeù_t


41 
	gpublic
:

45 
c_cÚÃù”_t
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
,

46 
zmq
::
£ssiÚ_ba£_t
 *
£ssiÚ_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

47 cÚ¡ 
add»ss_t
 *
addr_
, 
boŞ
 
d–ayed_¡¬t_
);

48 ~
c_cÚÃù”_t
 ();

50 
	g´iv©e
:

53 ’um {
»cÚÃù_tim”_id
 = 1};

56 
´oûss_¶ug
 ();

57 
´oûss_‹rm
 (
lšg”_
);

60 
š_ev’t
 ();

61 
out_ev’t
 ();

62 
tim”_ev’t
 (
id_
);

65 
¡¬t_cÚÃùšg
 ();

68 
add_»cÚÃù_tim”
();

73 
g‘_Ãw_»cÚÃù_ivl
 ();

78 
İ’
 ();

81 
şo£
 ();

85 
fd_t
 
cÚÃù
 ();

88 cÚ¡ 
add»ss_t
 *
	gaddr
;

91 
fd_t
 
	gs
;

94 
hªdË_t
 
	ghªdË
;

98 
boŞ
 
	ghªdË_v®id
;

101 cÚ¡ 
boŞ
 
	gd–ayed_¡¬t
;

104 
boŞ
 
	gtim”_¡¬‹d
;

107 
	gzmq
::
£ssiÚ_ba£_t
 *
£ssiÚ
;

110 
	gcu¼’t_»cÚÃù_ivl
;

113 
	g¡d
::
¡ršg
 
’dpošt
;

116 
	gzmq
::
sock‘_ba£_t
 *
sock‘
;

118 
c_cÚÃù”_t
 (const ipc_connecter_t&);

119 cÚ¡ 
	gc_cÚÃù”_t
 &
	gİ”©Ü
 = (cÚ¡ 
c_cÚÃù”_t
&);

	@ipc_listener.cpp

20 
	~"c_li¡’”.hµ
"

22 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


24 
	~<Ãw
>

26 
	~<¡ršg.h
>

28 
	~"¡»am_’gše.hµ
"

29 
	~"c_add»ss.hµ
"

30 
	~"io_th»ad.hµ
"

31 
	~"£ssiÚ_ba£.hµ
"

32 
	~"cÚfig.hµ
"

33 
	~"”r.hµ
"

34 
	~".hµ
"

35 
	~"sock‘_ba£.hµ
"

37 
	~<uni¡d.h
>

38 
	~<sys/sock‘.h
>

39 
	~<fú.h
>

40 
	~<sys/un.h
>

42 
	gzmq
::
c_li¡’”_t
::
	$c_li¡’”_t
 (
io_th»ad_t
 *
io_th»ad_
,

43 
sock‘_ba£_t
 *
sock‘_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

44 
	`own_t
 (
io_th»ad_
, 
İtiÚs_
),

45 
	`io_objeù_t
 (
io_th»ad_
),

46 
	`has_fe
 (
çl£
),

47 
	`s
 (
»tœed_fd
),

48 
	$sock‘
 (
sock‘_
)

50 
	}
}

52 
	gzmq
::
c_li¡’”_t
::~
	$c_li¡’”_t
 ()

54 
	`zmq_as£¹
 (
s
 =ğ
»tœed_fd
);

55 
	}
}

57 
	gzmq
::
c_li¡’”_t
::
	$´oûss_¶ug
 ()

60 
hªdË
 = 
	`add_fd
 (
s
);

61 
	`£t_pŞlš
 (
hªdË
);

62 
	}
}

64 
	gzmq
::
c_li¡’”_t
::
	$´oûss_‹rm
 (
lšg”_
)

66 
	`rm_fd
 (
hªdË
);

67 
	`şo£
 ();

68 
own_t
::
	`´oûss_‹rm
 (
lšg”_
);

69 
	}
}

71 
	gzmq
::
c_li¡’”_t
::
	$š_ev’t
 ()

73 
fd_t
 
fd
 = 
	`acû±
 ();

77 ià(
fd
 =ğ
»tœed_fd
) {

78 
sock‘
->
	`ev’t_acû±_çed
 (
’dpošt
, 
	`zmq_”ºo
());

83 
¡»am_’gše_t
 *
’gše
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

84 
	`¡»am_’gše_t
 (
fd
, 
İtiÚs
, 
’dpošt
);

85 
	`®loc_as£¹
 (
’gše
);

89 
io_th»ad_t
 *
io_th»ad
 = 
	`choo£_io_th»ad
 (
İtiÚs
.
affš™y
);

90 
	`zmq_as£¹
 (
io_th»ad
);

93 
£ssiÚ_ba£_t
 *
£ssiÚ
 = sessiÚ_ba£_t::
	`ü—‹
 (
io_th»ad
, 
çl£
, 
sock‘
,

94 
İtiÚs
, 
NULL
);

95 
	`”ºo_as£¹
 (
£ssiÚ
);

96 
£ssiÚ
->
	`šc_£qnum
 ();

97 
	`Ïunch_chd
 (
£ssiÚ
);

98 
	`£nd_©ch
 (
£ssiÚ
, 
’gše
, 
çl£
);

99 
sock‘
->
	`ev’t_acû±ed
 (
’dpošt
, 
fd
);

100 
	}
}

102 
	gzmq
::
c_li¡’”_t
::
	$g‘_add»ss
 (
¡d
::
¡ršg
 &
addr_
)

104 
sockaddr_¡Üage
 
ss
;

105 #ifdeà
ZMQ_HAVE_HPUX


106 
¦
 =  (
ss
);

108 
sockËn_t
 
¦
 =  (
ss
);

110 
rc
 = 
	`g‘sockÇme
 (
s
, (
sockaddr
 *è&
ss
, &
¦
);

111 ià(
rc
 != 0) {

112 
addr_
.
	`ş—r
 ();

113  
rc
;

116 
c_add»ss_t
 
	`addr
 ((
sockaddr
 *è&
ss
, 
¦
);

117  
addr
.
	`to_¡ršg
 (
addr_
);

118 
	}
}

120 
	gzmq
::
c_li¡’”_t
::
	$£t_add»ss
 (cÚ¡ *
addr_
)

123 
¡d
::
¡ršg
 
	`addr
 (
addr_
);

126 ià(
addr
[0] == '*') {

127 *
tmp¡r
 = 
	`‹m²am
 (
NULL
, NULL);

128 
addr
.
	`assign
 (
tmp¡r
);

129 
	`ä“
 (
tmp¡r
);

134 ::
	`uÆšk
 (
addr
.
	`c_¡r
());

135 
f’ame
.
	`ş—r
 ();

138 
c_add»ss_t
 
add»ss
;

139 
rc
 = 
add»ss
.
	`»sŞve
 (
addr
.
	`c_¡r
());

140 ià(
rc
 != 0)

144 
s
 = 
	`İ’_sock‘
 (
AF_UNIX
, 
SOCK_STREAM
, 0);

145 ià(
s
 == -1)

148 
add»ss
.
	`to_¡ršg
 (
’dpošt
);

151 
rc
 = 
	`bšd
 (
s
, 
add»ss
.
	`addr
 (),‡dd»ss.
	`add¾’
 ());

152 ià(
rc
 != 0)

153 
”rÜ
;

155 
f’ame
.
	`assign
 (
addr
.
	`c_¡r
());

156 
has_fe
 = 
Œue
;

159 
rc
 = 
	`li¡’
 (
s
, 
İtiÚs
.
backlog
);

160 ià(
rc
 != 0)

161 
”rÜ
;

163 
sock‘
->
	`ev’t_li¡’šg
 (
’dpošt
, 
s
);

166 
”rÜ
:

167 
”r
 = 
”ºo
;

168 
	`şo£
 ();

169 
”ºo
 = 
”r
;

171 
	}
}

173 
	gzmq
::
c_li¡’”_t
::
	$şo£
 ()

175 
	`zmq_as£¹
 (
s
 !ğ
»tœed_fd
);

176 
rc
 = ::
	`şo£
 (
s
);

177 
	`”ºo_as£¹
 (
rc
 == 0);

179 
s
 = 
»tœed_fd
;

183 ià(
has_fe
 && !
f’ame
.
	`em±y
 ()) {

184 
rc
 = ::
	`uÆšk
(
f’ame
.
	`c_¡r
 ());

185 ià(
rc
 != 0) {

186 
sock‘
->
	`ev’t_şo£_çed
 (
’dpošt
, 
	`zmq_”ºo
());

191 
sock‘
->
	`ev’t_şo£d
 (
’dpošt
, 
s
);

193 
	}
}

195 
	gzmq
::
fd_t
 
zmq
::
c_li¡’”_t
::
	$acû±
 ()

200 
	`zmq_as£¹
 (
s
 !ğ
»tœed_fd
);

201 
fd_t
 
sock
 = ::
	`acû±
 (
s
, 
NULL
, NULL);

202 ià(
sock
 == -1) {

203 
	`”ºo_as£¹
 (
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
EWOULDBLOCK
 ||

204 
”ºo
 =ğ
EINTR
 ||ƒ¼nØ=ğ
ECONNABORTED
 ||ƒ¼nØ=ğ
EPROTO
 ||

205 
”ºo
 =ğ
ENFILE
);

206  
»tœed_fd
;

208  
sock
;

209 
	}
}

	@ipc_listener.hpp

20 #iâdeà
__ZMQ_IPC_LISTENER_HPP_INCLUDED__


21 
	#__ZMQ_IPC_LISTENER_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


27 
	~<¡ršg
>

29 
	~"fd.hµ
"

30 
	~"own.hµ
"

31 
	~"¡dšt.hµ
"

32 
	~"io_objeù.hµ
"

34 
Çme¥aû
 
	gzmq


37 
şass
 
	gio_th»ad_t
;

38 
şass
 
	gsock‘_ba£_t
;

40 
şass
 
	gc_li¡’”_t
 : 
public
 
own_t
,…ubliø
	gio_objeù_t


42 
	gpublic
:

44 
c_li¡’”_t
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
,

45 
zmq
::
sock‘_ba£_t
 *
sock‘_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

46 ~
c_li¡’”_t
 ();

49 
£t_add»ss
 (cÚ¡ *
addr_
);

52 
g‘_add»ss
 (
¡d
::
¡ršg
 &
addr_
);

54 
	g´iv©e
:

57 
´oûss_¶ug
 ();

58 
´oûss_‹rm
 (
lšg”_
);

61 
š_ev’t
 ();

64 
şo£
 ();

69 
fd_t
 
acû±
 ();

72 
boŞ
 
	ghas_fe
;

75 
	g¡d
::
¡ršg
 
f’ame
;

78 
fd_t
 
	gs
;

81 
hªdË_t
 
	ghªdË
;

84 
	gzmq
::
sock‘_ba£_t
 *
sock‘
;

87 
	g¡d
::
¡ršg
 
’dpošt
;

89 
c_li¡’”_t
 (const ipc_listener_t&);

90 cÚ¡ 
	gc_li¡’”_t
 &
	gİ”©Ü
 = (cÚ¡ 
c_li¡’”_t
&);

	@kqueue.cpp

20 
	~"kqueue.hµ
"

21 #ià
defšed
 
ZMQ_USE_KQUEUE


23 
	~<sys/time.h
>

24 
	~<sys/ty³s.h
>

25 
	~<sys/ev’t.h
>

26 
	~<¡dlib.h
>

27 
	~<uni¡d.h
>

28 
	~<®gÜ™hm
>

29 
	~<Ãw
>

31 
	~"kqueue.hµ
"

32 
	~"”r.hµ
"

33 
	~"cÚfig.hµ
"

34 
	~"i_pŞl_ev’ts.hµ
"

35 
	~"lik–y.hµ
"

39 #ià
defšed
 
ZMQ_HAVE_NETBSD


40 
	#kev’t_ud©a_t
 
šŒ_t


	)

42 
	#kev’t_ud©a_t
 *

	)

45 
	gzmq
::
kqueue_t
::
	$kqueue_t
 () :

46 
	$¡İpšg
 (
çl£
)

49 
kqueue_fd
 = 
	`kqueue
 ();

50 
	`”ºo_as£¹
 (
kqueue_fd
 != -1);

51 #ifdeà
HAVE_FORK


52 
pid
 = 
	`g‘pid
();

54 
	}
}

56 
	gzmq
::
kqueue_t
::~
	$kqueue_t
 ()

58 
wÜk”
.
	`¡İ
 ();

59 
	`şo£
 (
kqueue_fd
);

60 
	}
}

62 
	gzmq
::
kqueue_t
::
	$kev’t_add
 (
fd_t
 
fd_
, 
f‹r_
, *
ud©a_
)

64 
kev’t
 
ev
;

66 
	`EV_SET
 (&
ev
, 
fd_
, 
f‹r_
, 
EV_ADD
, 0, 0, (
kev’t_ud©a_t
)
ud©a_
);

67 
rc
 = 
	`kev’t
 (
kqueue_fd
, &
ev
, 1, 
NULL
, 0, NULL);

68 
	`”ºo_as£¹
 (
rc
 != -1);

69 
	}
}

71 
	gzmq
::
kqueue_t
::
	$kev’t_d–‘e
 (
fd_t
 
fd_
, 
f‹r_
)

73 
kev’t
 
ev
;

75 
	`EV_SET
 (&
ev
, 
fd_
, 
f‹r_
, 
EV_DELETE
, 0, 0, 0);

76 
rc
 = 
	`kev’t
 (
kqueue_fd
, &
ev
, 1, 
NULL
, 0, NULL);

77 
	`”ºo_as£¹
 (
rc
 != -1);

78 
	}
}

80 
	gzmq
::
kqueue_t
::
hªdË_t
 
zmq
::kqueue_t::
	$add_fd
 (
fd_t
 
fd_
,

81 
i_pŞl_ev’ts
 *
»aùÜ_
)

83 
pŞl_’Œy_t
 *
³
 = 
	`Ãw
 (
¡d
::
nÙhrow
)…oll_entry_t;

84 
	`®loc_as£¹
 (
³
);

86 
³
->
fd
 = 
fd_
;

87 
³
->
æag_pŞlš
 = 0;

88 
³
->
æag_pŞlout
 = 0;

89 
³
->
»aùÜ
 = 
»aùÜ_
;

91 
	`adju¡_lßd
 (1);

93  
³
;

94 
	}
}

96 
	gzmq
::
kqueue_t
::
	$rm_fd
 (
hªdË_t
 
hªdË_
)

98 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

99 ià(
³
->
æag_pŞlš
)

100 
	`kev’t_d–‘e
 (
³
->
fd
, 
EVFILT_READ
);

101 ià(
³
->
æag_pŞlout
)

102 
	`kev’t_d–‘e
 (
³
->
fd
, 
EVFILT_WRITE
);

103 
³
->
fd
 = 
»tœed_fd
;

104 
»tœed
.
	`push_back
 (
³
);

106 
	`adju¡_lßd
 (-1);

107 
	}
}

109 
	gzmq
::
kqueue_t
::
	$£t_pŞlš
 (
hªdË_t
 
hªdË_
)

111 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

112 ià(
	`lik–y
 (!
³
->
æag_pŞlš
)) {

113 
³
->
æag_pŞlš
 = 
Œue
;

114 
	`kev’t_add
 (
³
->
fd
, 
EVFILT_READ
,…e);

116 
	}
}

118 
	gzmq
::
kqueue_t
::
	$»£t_pŞlš
 (
hªdË_t
 
hªdË_
)

120 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

121 ià(
	`lik–y
 (
³
->
æag_pŞlš
)) {

122 
³
->
æag_pŞlš
 = 
çl£
;

123 
	`kev’t_d–‘e
 (
³
->
fd
, 
EVFILT_READ
);

125 
	}
}

127 
	gzmq
::
kqueue_t
::
	$£t_pŞlout
 (
hªdË_t
 
hªdË_
)

129 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

130 ià(
	`lik–y
 (!
³
->
æag_pŞlout
)) {

131 
³
->
æag_pŞlout
 = 
Œue
;

132 
	`kev’t_add
 (
³
->
fd
, 
EVFILT_WRITE
,…e);

134 
	}
}

136 
	gzmq
::
kqueue_t
::
	$»£t_pŞlout
 (
hªdË_t
 
hªdË_
)

138 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
hªdË_
;

139 ià(
	`lik–y
 (
³
->
æag_pŞlout
)) {

140 
³
->
æag_pŞlout
 = 
çl£
;

141 
	`kev’t_d–‘e
 (
³
->
fd
, 
EVFILT_WRITE
);

143 
	}
}

145 
	gzmq
::
kqueue_t
::
	$¡¬t
 ()

147 
wÜk”
.
	`¡¬t
 (
wÜk”_routše
, 
this
);

148 
	}
}

150 
	gzmq
::
kqueue_t
::
	$¡İ
 ()

152 
¡İpšg
 = 
Œue
;

153 
	}
}

155 
	gzmq
::
kqueue_t
::
	$max_fds
 ()

158 
	}
}

160 
	gzmq
::
kqueue_t
::
	$loİ
 ()

162 !
¡İpšg
) {

165 
timeout
 = (è
	`execu‹_tim”s
 ();

168 
kev’t
 
ev_buf
 [
max_io_ev’ts
];

169 
time¥ec
 
ts
 = {
timeout
 / 1000, (timeout % 1000) * 1000000};

170 
n
 = 
	`kev’t
 (
kqueue_fd
, 
NULL
, 0, &
ev_buf
 [0], 
max_io_ev’ts
,

171 
timeout
 ? &
ts
: 
NULL
);

172 #ifdeà
HAVE_FORK


173 ià(
	`uÆik–y
(
pid
 !ğ
	`g‘pid
())) {

179 ià(
n
 == -1) {

180 
	`”ºo_as£¹
 (
”ºo
 =ğ
EINTR
);

184 
i
 = 0; i < 
n
; i ++) {

185 
pŞl_’Œy_t
 *
³
 = (pŞl_’Œy_t*è
ev_buf
 [
i
].
ud©a
;

187 ià(
³
->
fd
 =ğ
»tœed_fd
)

189 ià(
ev_buf
 [
i
].
æags
 & 
EV_EOF
)

190 
³
->
»aùÜ
->
	`š_ev’t
 ();

191 ià(
³
->
fd
 =ğ
»tœed_fd
)

193 ià(
ev_buf
 [
i
].
f‹r
 =ğ
EVFILT_WRITE
)

194 
³
->
»aùÜ
->
	`out_ev’t
 ();

195 ià(
³
->
fd
 =ğ
»tœed_fd
)

197 ià(
ev_buf
 [
i
].
f‹r
 =ğ
EVFILT_READ
)

198 
³
->
»aùÜ
->
	`š_ev’t
 ();

202 
»tœed_t
::
™”©Ü
 
™
 = 
»tœed
.
	`begš
 (); iˆ!ğ»tœed.
	`’d
 ();

203 ++
™
)

204 
d–‘e
 *
™
;

205 
»tœed
.
	`ş—r
 ();

207 
	}
}

209 
	gzmq
::
kqueue_t
::
	$wÜk”_routše
 (*
¬g_
)

211 ((
kqueue_t
*è
¬g_
)->
	`loİ
 ();

212 
	}
}

	@kqueue.hpp

20 #iâdeà
__ZMQ_KQUEUE_HPP_INCLUDED__


21 
	#__ZMQ_KQUEUE_HPP_INCLUDED__


	)

24 
	~"pŞËr.hµ
"

25 #ià
defšed
 
ZMQ_USE_KQUEUE


27 
	~<veùÜ
>

28 
	~<uni¡d.h
>

30 
	~"fd.hµ
"

31 
	~"th»ad.hµ
"

32 
	~"pŞËr_ba£.hµ
"

34 
Çme¥aû
 
	gzmq


37 
	gi_pŞl_ev’ts
;

42 şas 
	ckqueue_t
 : 
public
 
pŞËr_ba£_t


44 
public
:

46 * 
	thªdË_t
;

48 
kqueue_t
 ();

49 ~
kqueue_t
 ();

52 
hªdË_t
 
add_fd
 (
fd_t
 
fd_
, 
zmq
::
i_pŞl_ev’ts
 *
ev’ts_
);

53 
rm_fd
 (
hªdË_t
 
hªdË_
);

54 
£t_pŞlš
 (
hªdË_t
 
hªdË_
);

55 
»£t_pŞlš
 (
hªdË_t
 
hªdË_
);

56 
£t_pŞlout
 (
hªdË_t
 
hªdË_
);

57 
»£t_pŞlout
 (
hªdË_t
 
hªdË_
);

58 
¡¬t
 ();

59 
¡İ
 ();

61 
max_fds
 ();

63 
	g´iv©e
:

66 
wÜk”_routše
 (*
¬g_
);

69 
loİ
 ();

72 
fd_t
 
	gkqueue_fd
;

75 
kev’t_add
 (
fd_t
 
fd_
, 
f‹r_
, *
ud©a_
);

78 
kev’t_d–‘e
 (
fd_t
 
fd_
, 
f‹r_
);

80 
	spŞl_’Œy_t


82 
fd_t
 
	gfd
;

83 
boŞ
 
	gæag_pŞlš
;

84 
boŞ
 
	gæag_pŞlout
;

85 
	gzmq
::
i_pŞl_ev’ts
 *
»aùÜ
;

89 
	g¡d
::
	tveùÜ
 <
	tpŞl_’Œy_t
*> 
	t»tœed_t
;

90 
»tœed_t
 
	g»tœed
;

93 
boŞ
 
	g¡İpšg
;

96 
th»ad_t
 
	gwÜk”
;

98 
kqueue_t
 (const kqueue_t&);

99 cÚ¡ 
	gkqueue_t
 &
	gİ”©Ü
 = (cÚ¡ 
kqueue_t
&);

101 #ifdeà
HAVE_FORK


103 
pid_t
 
	gpid
;

107 
kqueue_t
 
	tpŞËr_t
;

	@lb.cpp

20 
	~"lb.hµ
"

21 
	~"pe.hµ
"

22 
	~"”r.hµ
"

23 
	~"msg.hµ
"

25 
	gzmq
::
lb_t
::
	$lb_t
 () :

26 
	`aùive
 (0),

27 
	`cu¼’t
 (0),

28 
	`mÜe
 (
çl£
),

29 
	$drİpšg
 (
çl£
)

31 
	}
}

33 
	gzmq
::
lb_t
::~
	$lb_t
 ()

35 
	`zmq_as£¹
 (
pes
.
	`em±y
 ());

36 
	}
}

38 
	gzmq
::
lb_t
::
	$©ch
 (
pe_t
 *
pe_
)

40 
pes
.
	`push_back
 (
pe_
);

41 
	`aùiv©ed
 (
pe_
);

42 
	}
}

44 
	gzmq
::
lb_t
::
	$pe_‹rmš©ed
 (
pe_t
 *
pe_
)

46 
pes_t
::
size_ty³
 
šdex
 = 
pes
.
	`šdex
 (
pe_
);

50 ià(
šdex
 =ğ
cu¼’t
 && 
mÜe
)

51 
drİpšg
 = 
Œue
;

55 ià(
šdex
 < 
aùive
) {

56 
aùive
--;

57 
pes
.
	`sw­
 (
šdex
, 
aùive
);

58 ià(
cu¼’t
 =ğ
aùive
)

59 
cu¼’t
 = 0;

61 
pes
.
	`”a£
 (
pe_
);

62 
	}
}

64 
	gzmq
::
lb_t
::
	$aùiv©ed
 (
pe_t
 *
pe_
)

67 
pes
.
	`sw­
 (pes.
	`šdex
 (
pe_
), 
aùive
);

68 
aùive
++;

69 
	}
}

71 
	gzmq
::
lb_t
::
	$£nd
 (
msg_t
 *
msg_
)

73  
	`£ndpe
 (
msg_
, 
NULL
);

74 
	}
}

76 
	gzmq
::
lb_t
::
	$£ndpe
 (
msg_t
 *
msg_
, 
pe_t
 **
pe_
)

80 ià(
drİpšg
) {

82 
mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::mÜ? 
Œue
 : 
çl£
;

83 
drİpšg
 = 
mÜe
;

85 
rc
 = 
msg_
->
	`şo£
 ();

86 
	`”ºo_as£¹
 (
rc
 == 0);

87 
rc
 = 
msg_
->
	`š™
 ();

88 
	`”ºo_as£¹
 (
rc
 == 0);

92 
aùive
 > 0) {

93 ià(
pes
 [
cu¼’t
]->
	`wr™e
 (
msg_
))

95 ià(
pe_
)

96 *
pe_
 = 
pes
 [
cu¼’t
];

100 
	`zmq_as£¹
 (!
mÜe
);

101 
aùive
--;

102 ià(
cu¼’t
 < 
aùive
)

103 
pes
.
	`sw­
 (
cu¼’t
, 
aùive
);

105 
cu¼’t
 = 0;

109 ià(
aùive
 == 0) {

110 
”ºo
 = 
EAGAIN
;

116 
mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::mÜe? 
Œue
: 
çl£
;

117 ià(!
mÜe
) {

118 
pes
 [
cu¼’t
]->
	`æush
 ();

119 
cu¼’t
 = (cu¼’ˆ+ 1è% 
aùive
;

123 
rc
 = 
msg_
->
	`š™
 ();

124 
	`”ºo_as£¹
 (
rc
 == 0);

127 
	}
}

129 
boŞ
 
	gzmq
::
lb_t
::
	$has_out
 ()

133 ià(
mÜe
)

134  
Œue
;

136 
aùive
 > 0) {

139 ià(
pes
 [
cu¼’t
]->
	`check_wr™e
 ())

140  
Œue
;

143 
aùive
--;

144 
pes
.
	`sw­
 (
cu¼’t
, 
aùive
);

145 ià(
cu¼’t
 =ğ
aùive
)

146 
cu¼’t
 = 0;

149  
çl£
;

150 
	}
}

	@lb.hpp

20 #iâdeà
__ZMQ_LB_HPP_INCLUDED__


21 
	#__ZMQ_LB_HPP_INCLUDED__


	)

23 
	~"¬¿y.hµ
"

24 
	~"pe.hµ
"

26 
Çme¥aû
 
	gzmq


32 şas 
	clb_t


34 
	gpublic
:

36 
lb_t
 ();

37 ~
lb_t
 ();

39 
©ch
 (
pe_t
 *
pe_
);

40 
aùiv©ed
 (
pe_t
 *
pe_
);

41 
pe_‹rmš©ed
 (
pe_t
 *
pe_
);

43 
£nd
 (
msg_t
 *
msg_
);

49 
£ndpe
 (
msg_t
 *
msg_
, 
pe_t
 **
pe_
);

51 
boŞ
 
has_out
 ();

53 
	g´iv©e
:

56 
¬¿y_t
 <
	tpe_t
, 2> 
	tpes_t
;

57 
pes_t
 
	gpes
;

61 
	gpes_t
::
size_ty³
 
aùive
;

64 
	gpes_t
::
size_ty³
 
cu¼’t
;

67 
boŞ
 
	gmÜe
;

70 
boŞ
 
	gdrİpšg
;

72 
lb_t
 (const†b_t&);

73 cÚ¡ 
	glb_t
 &
	gİ”©Ü
 = (cÚ¡ 
lb_t
&);

	@likely.hpp

20 #iâdeà
__ZMQ_LIKELY_HPP_INCLUDED__


21 
	#__ZMQ_LIKELY_HPP_INCLUDED__


	)

23 #ià
defšed
 
__GNUC__


24 
	#lik–y
(
x
è
	`__butš_ex³ù
 ((x), 1)

	)

25 
	#uÆik–y
(
x
è
	`__butš_ex³ù
 ((x), 0)

	)

27 
	#lik–y
(
x
è(x)

	)

28 
	#uÆik–y
(
x
è(x)

	)

	@mailbox.cpp

20 
	~"mabox.hµ
"

21 
	~"”r.hµ
"

23 
	gzmq
::
mabox_t
::
	$mabox_t
 ()

28 
boŞ
 
ok
 = 
ıe
.
	`»ad
 (
NULL
);

29 
	`zmq_as£¹
 (!
ok
);

30 
aùive
 = 
çl£
;

31 
	}
}

33 
	gzmq
::
mabox_t
::~
	$mabox_t
 ()

39 
sync
.
	`lock
 ();

40 
sync
.
	`uÆock
 ();

41 
	}
}

43 
	gzmq
::
fd_t
 
zmq
::
mabox_t
::
	$g‘_fd
 ()

45  
sigÇËr
.
	`g‘_fd
 ();

46 
	}
}

48 
	gzmq
::
mabox_t
::
	$£nd
 (cÚ¡ 
commªd_t
 &
cmd_
)

50 
sync
.
	`lock
 ();

51 
ıe
.
	`wr™e
 (
cmd_
, 
çl£
);

52 
boŞ
 
ok
 = 
ıe
.
	`æush
 ();

53 
sync
.
	`uÆock
 ();

54 ià(!
ok
)

55 
sigÇËr
.
	`£nd
 ();

56 
	}
}

58 
	gzmq
::
mabox_t
::
	$»cv
 (
commªd_t
 *
cmd_
, 
timeout_
)

61 ià(
aùive
) {

62 
boŞ
 
ok
 = 
ıe
.
	`»ad
 (
cmd_
);

63 ià(
ok
)

67 
aùive
 = 
çl£
;

68 
sigÇËr
.
	`»cv
 ();

72 
rc
 = 
sigÇËr
.
	`wa™
 (
timeout_
);

73 ià(
rc
 !ğ0 && (
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
EINTR
))

77 
aùive
 = 
Œue
;

80 
	`”ºo_as£¹
 (
rc
 == 0);

81 
boŞ
 
ok
 = 
ıe
.
	`»ad
 (
cmd_
);

82 
	`zmq_as£¹
 (
ok
);

84 
	}
}

	@mailbox.hpp

20 #iâdeà
__ZMQ_MAILBOX_HPP_INCLUDED__


21 
	#__ZMQ_MAILBOX_HPP_INCLUDED__


	)

23 
	~<¡ddef.h
>

25 
	~"¶©fÜm.hµ
"

26 
	~"sigÇËr.hµ
"

27 
	~"fd.hµ
"

28 
	~"cÚfig.hµ
"

29 
	~"commªd.hµ
"

30 
	~"ype.hµ
"

31 
	~"mu‹x.hµ
"

33 
Çme¥aû
 
	gzmq


36 şas 
	cmabox_t


38 
	gpublic
:

40 
mabox_t
 ();

41 ~
mabox_t
 ();

43 
fd_t
 
g‘_fd
 ();

44 
£nd
 (cÚ¡ 
commªd_t
 &
cmd_
);

45 
»cv
 (
commªd_t
 *
cmd_
, 
timeout_
);

47 #ifdeà
HAVE_FORK


51 
fÜked
(è{ 
	gsigÇËr
.forked(); }

54 
	g´iv©e
:

57 
ype_t
 <
	tcommªd_t
, 
	tcommªd_pe_g¿nuÏr™y
> 
	tıe_t
;

58 
ıe_t
 
	gıe
;

61 
sigÇËr_t
 
	gsigÇËr
;

67 
mu‹x_t
 
	gsync
;

71 
boŞ
 
	gaùive
;

74 
mabox_t
 (const mailbox_t&);

75 cÚ¡ 
	gmabox_t
 &
	gİ”©Ü
 = (cÚ¡ 
mabox_t
&);

	@mechanism.cpp

20 
	~<¡ršg.h
>

22 
	~"mechªism.hµ
"

23 
	~"İtiÚs.hµ
"

24 
	~"msg.hµ
"

25 
	~"”r.hµ
"

26 
	~"wœe.hµ
"

28 
	gzmq
::
mechªism_t
::
	$mechªism_t
 (cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

29 
	$İtiÚs
 (
İtiÚs_
)

31 
	}
}

33 
zmq
::
mechªism_t
::~
	$mechªism_t
 ()

35 
	}
}

37 
zmq
::
mechªism_t
::
	$£t_³”_id’t™y
 (cÚ¡ *
id_±r
, 
size_t
 
id_size
)

39 
id’t™y
 = 
	`blob_t
 (
¡©ic_ÿ¡
 <cÚ¡ *> (
id_±r
), 
id_size
);

40 
	}
}

42 
	gzmq
::
mechªism_t
::
	$³”_id’t™y
 (
msg_t
 *
msg_
)

44 cÚ¡ 
rc
 = 
msg_
->
	`š™_size
 (
id’t™y
.
	`size
 ());

45 
	`”ºo_as£¹
 (
rc
 == 0);

46 
	`memıy
 (
msg_
->
	`d©a
 (), 
id’t™y
.d©¨(), id’t™y.
	`size
 ());

47 
msg_
->
	`£t_æags
 (
msg_t
::
id’t™y
);

48 
	}
}

50 cÚ¡ *
	gzmq
::
mechªism_t
::
	$sock‘_ty³_¡ršg
 (
sock‘_ty³
) const

52 cÚ¡ *
Çmes
 [] = {"PAIR", "PUB", "SUB", "REQ", "REP",

55 
	`zmq_as£¹
 (
sock‘_ty³
 >= 0 && socket_type <= 10);

56  
Çmes
 [
sock‘_ty³
];

57 
	}
}

59 
size_t
 
	gzmq
::
mechªism_t
::
	$add_´İ”ty
 (*
±r
, cÚ¡ *
Çme
,

60 cÚ¡ *
v®ue
, 
size_t
 
v®ue_Ën
) const

62 cÚ¡ 
size_t
 
Çme_Ën
 = 
	`¡¾’
 (
Çme
);

63 
	`zmq_as£¹
 (
Çme_Ën
 <= 255);

64 *
±r
++ = 
¡©ic_ÿ¡
 <> (
Çme_Ën
);

65 
	`memıy
 (
±r
, 
Çme
, 
Çme_Ën
);

66 
±r
 +ğ
Çme_Ën
;

67 
	`zmq_as£¹
 (
v®ue_Ën
 <= 0x7FFFFFFF);

68 
	`put_ušt32
 (
±r
, 
¡©ic_ÿ¡
 <
ušt32_t
> (
v®ue_Ën
));

69 
±r
 += 4;

70 
	`memıy
 (
±r
, 
v®ue
, 
v®ue_Ën
);

72  1 + 
Çme_Ën
 + 4 + 
v®ue_Ën
;

73 
	}
}

75 
	gzmq
::
mechªism_t
::
	$·r£_m‘ad©a
 (cÚ¡ *
±r_
,

76 
size_t
 
Ëngth_
)

78 
size_t
 
by‹s_Ëá
 = 
Ëngth_
;

80 
by‹s_Ëá
 > 1) {

81 cÚ¡ 
size_t
 
Çme_Ëngth
 = 
¡©ic_ÿ¡
 <size_t> (*
±r_
);

82 
±r_
 += 1;

83 
by‹s_Ëá
 -= 1;

84 ià(
by‹s_Ëá
 < 
Çme_Ëngth
)

87 cÚ¡ 
¡d
::
¡ršg
 
Çme
 = std::
	`¡ršg
 ((*è
±r_
, 
Çme_Ëngth
);

88 
±r_
 +ğ
Çme_Ëngth
;

89 
by‹s_Ëá
 -ğ
Çme_Ëngth
;

90 ià(
by‹s_Ëá
 < 4)

93 cÚ¡ 
size_t
 
v®ue_Ëngth
 = 
¡©ic_ÿ¡
 <size_t> (
	`g‘_ušt32
 (
±r_
));

94 
±r_
 += 4;

95 
by‹s_Ëá
 -= 4;

96 ià(
by‹s_Ëá
 < 
v®ue_Ëngth
)

99 cÚ¡ 
ušt8_t
 *
v®ue
 = 
±r_
;

100 
±r_
 +ğ
v®ue_Ëngth
;

101 
by‹s_Ëá
 -ğ
v®ue_Ëngth
;

103 ià(
Çme
 =ğ"Id’t™y" && 
İtiÚs
.
»cv_id’t™y
)

104 
	`£t_³”_id’t™y
 (
v®ue
, 
v®ue_Ëngth
);

106 ià(
Çme
 == "Socket-Type") {

107 cÚ¡ 
¡d
::
¡ršg
 
	`sock‘_ty³
 ((*è
v®ue
, 
v®ue_Ëngth
);

108 ià(!
	`check_sock‘_ty³
 (
sock‘_ty³
)) {

109 
”ºo
 = 
EINVAL
;

114 cÚ¡ 
rc
 = 
	`´İ”ty
 (
Çme
, 
v®ue
, 
v®ue_Ëngth
);

115 ià(
rc
 == -1)

119 ià(
by‹s_Ëá
 > 0) {

120 
”ºo
 = 
EPROTO
;

124 
	}
}

126 
	gzmq
::
mechªism_t
::
	$´İ”ty
 (cÚ¡ 
¡d
::
¡ršg
 
Çme_
,

127 cÚ¡ *
v®ue_
, 
size_t
 
Ëngth_
)

132 
	}
}

134 
boŞ
 
	gzmq
::
mechªism_t
::
	$check_sock‘_ty³
 (cÚ¡ 
¡d
::
¡ršg
 
ty³_
) const

136 
İtiÚs
.
ty³
) {

137 
ZMQ_REQ
:

138  
ty³_
 == "REP" ||ype_ == "ROUTER";

139 
ZMQ_REP
:

140  
ty³_
 == "REQ" ||ype_ == "DEALER";

141 
ZMQ_DEALER
:

142  
ty³_
 == "REP" ||ype_ == "DEALER" ||ype_ == "ROUTER";

143 
ZMQ_ROUTER
:

144  
ty³_
 == "REQ" ||ype_ == "DEALER" ||ype_ == "ROUTER";

145 
ZMQ_PUSH
:

146  
ty³_
 == "PULL";

147 
ZMQ_PULL
:

148  
ty³_
 == "PUSH";

149 
ZMQ_PUB
:

150  
ty³_
 == "SUB" ||ype_ == "XSUB";

151 
ZMQ_SUB
:

152  
ty³_
 == "PUB" ||ype_ == "XPUB";

153 
ZMQ_XPUB
:

154  
ty³_
 == "SUB" ||ype_ == "XSUB";

155 
ZMQ_XSUB
:

156  
ty³_
 == "PUB" ||ype_ == "XPUB";

157 
ZMQ_PAIR
:

158  
ty³_
 == "PAIR";

162  
çl£
;

163 
	}
}

	@mechanism.hpp

20 #iâdeà
__ZMQ_MECHANISM_HPP_INCLUDED__


21 
	#__ZMQ_MECHANISM_HPP_INCLUDED__


	)

23 
	~"¡dšt.hµ
"

24 
	~"İtiÚs.hµ
"

25 
	~"blob.hµ
"

27 
Çme¥aû
 
	gzmq


33 
şass
 
	gmsg_t
;

35 şas 
	cmechªism_t


37 
	gpublic
:

39 
mechªism_t
 (cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

41 
	gvœtu®
 ~
mechªism_t
 ();

44 
vœtu®
 
Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
) = 0;

47 
vœtu®
 
´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
) = 0;

49 
vœtu®
 
’code
 (
msg_t
 *
msg_
) {  0; }

51 
vœtu®
 
decode
 (
msg_t
 *
msg_
) {  0; }

54 
vœtu®
 
z­_msg_avaabË
 () {  0; }

57 
vœtu®
 
boŞ
 
is_hªdshake_com¶‘e
 () const = 0;

59 
£t_³”_id’t™y
 (cÚ¡ *
id_±r
, 
size_t
 
id_size
);

61 
³”_id’t™y
 (
msg_t
 *
msg_
);

63 
	g´Ùeùed
:

67 cÚ¡ *
sock‘_ty³_¡ršg
 (
sock‘_ty³
) const;

69 
size_t
 
add_´İ”ty
 (*
±r
, cÚ¡ *
Çme
,

70 cÚ¡ *
v®ue
, 
size_t
 
v®ue_Ën
) const;

76 
·r£_m‘ad©a
 (cÚ¡ *
±r_
, 
size_t
 
Ëngth
);

85 
vœtu®
 
´İ”ty
 (cÚ¡ 
¡d
::
¡ršg
 
Çme_
,

86 cÚ¡ *
v®ue_
, 
size_t
 
Ëngth_
);

88 
İtiÚs_t
 
	gİtiÚs
;

90 
	g´iv©e
:

92 
blob_t
 
id’t™y
;

96 
boŞ
 
check_sock‘_ty³
 (cÚ¡ 
¡d
::
¡ršg
 
ty³_
) const;

	@msg.cpp

20 
	~"msg.hµ
"

21 
	~"../šşude/zmq.h
"

23 
	~<¡ršg.h
>

24 
	~<¡dlib.h
>

25 
	~<Ãw
>

27 
	~"¡dšt.hµ
"

28 
	~"lik–y.hµ
"

29 
	~"”r.hµ
"

33 
	tzmq_msg_size_check


34 [2 * (( (
zmq
::
msg_t
è=ğ (
zmq_msg_t
)) != 0) - 1];

36 
boŞ
 
	gzmq
::
msg_t
::
	$check
 ()

38  
u
.
ba£
.
ty³
 >ğ
ty³_mš
 && u.ba£.ty³ <ğ
ty³_max
;

39 
	}
}

41 
	gzmq
::
msg_t
::
	$š™
 ()

43 
u
.
vsm
.
ty³
 = 
ty³_vsm
;

44 
u
.
vsm
.
æags
 = 0;

45 
u
.
vsm
.
size
 = 0;

47 
	}
}

49 
	gzmq
::
msg_t
::
	$š™_size
 (
size_t
 
size_
)

51 ià(
size_
 <ğ
max_vsm_size
) {

52 
u
.
vsm
.
ty³
 = 
ty³_vsm
;

53 
u
.
vsm
.
æags
 = 0;

54 
u
.
vsm
.
size
 = (è
size_
;

57 
u
.
lmsg
.
ty³
 = 
ty³_lmsg
;

58 
u
.
lmsg
.
æags
 = 0;

59 
u
.
lmsg
.
cÚ‹Á
 =

60 (
cÚ‹Á_t
*è
	`m®loc
 ( (cÚ‹Á_tè+ 
size_
);

61 ià(
	`uÆik–y
 (!
u
.
lmsg
.
cÚ‹Á
)) {

62 
”ºo
 = 
ENOMEM
;

66 
u
.
lmsg
.
cÚ‹Á
->
d©a
 = u.lmsg.content + 1;

67 
u
.
lmsg
.
cÚ‹Á
->
size
 = 
size_
;

68 
u
.
lmsg
.
cÚ‹Á
->
fâ
 = 
NULL
;

69 
u
.
lmsg
.
cÚ‹Á
->
hšt
 = 
NULL
;

70 
	`Ãw
 (&
u
.
lmsg
.
cÚ‹Á
->
»fút
è
zmq
::
	`©omic_couÁ”_t
 ();

73 
	}
}

75 
	gzmq
::
msg_t
::
	$š™_d©a
 (*
d©a_
, 
size_t
 
size_
, 
msg_ä“_â
 *
fâ_
,

76 *
hšt_
)

80 
	`as£¹
 (
d©a_
 !ğ
NULL
 || 
size_
 == 0);

83 if(
fâ_
 =ğ
NULL
) {

84 
u
.
cmsg
.
ty³
 = 
ty³_cmsg
;

85 
u
.
cmsg
.
æags
 = 0;

86 
u
.
cmsg
.
d©a
 = 
d©a_
;

87 
u
.
cmsg
.
size
 = 
size_
;

90 
u
.
lmsg
.
ty³
 = 
ty³_lmsg
;

91 
u
.
lmsg
.
æags
 = 0;

92 
u
.
lmsg
.
cÚ‹Á
 = (
cÚ‹Á_t
*è
	`m®loc
 ( (content_t));

93 ià(!
u
.
lmsg
.
cÚ‹Á
) {

94 
”ºo
 = 
ENOMEM
;

98 
u
.
lmsg
.
cÚ‹Á
->
d©a
 = 
d©a_
;

99 
u
.
lmsg
.
cÚ‹Á
->
size
 = 
size_
;

100 
u
.
lmsg
.
cÚ‹Á
->
fâ
 = 
fâ_
;

101 
u
.
lmsg
.
cÚ‹Á
->
hšt
 = 
hšt_
;

102 
	`Ãw
 (&
u
.
lmsg
.
cÚ‹Á
->
»fút
è
zmq
::
	`©omic_couÁ”_t
 ();

106 
	}
}

108 
	gzmq
::
msg_t
::
	$š™_d–im™”
 ()

110 
u
.
d–im™”
.
ty³
 = 
ty³_d–im™”
;

111 
u
.
d–im™”
.
æags
 = 0;

113 
	}
}

115 
	gzmq
::
msg_t
::
	$şo£
 ()

118 ià(
	`uÆik–y
 (!
	`check
 ())) {

119 
”ºo
 = 
EFAULT
;

123 ià(
u
.
ba£
.
ty³
 =ğ
ty³_lmsg
) {

127 ià(!(
u
.
lmsg
.
æags
 & 
msg_t
::
sh¬ed
) ||

128 !
u
.
lmsg
.
cÚ‹Á
->
»fút
.
	`sub
 (1)) {

132 
u
.
lmsg
.
cÚ‹Á
->
»fút
.~
	`©omic_couÁ”_t
 ();

134 ià(
u
.
lmsg
.
cÚ‹Á
->
fâ
)

135 
u
.
lmsg
.
cÚ‹Á
->
	`fâ
 (u.lmsg.cÚ‹Á->
d©a
,

136 
u
.
lmsg
.
cÚ‹Á
->
hšt
);

137 
	`ä“
 (
u
.
lmsg
.
cÚ‹Á
);

142 
u
.
ba£
.
ty³
 = 0;

146 
	}
}

148 
	gzmq
::
msg_t
::
	$move
 (
msg_t
 &
¤c_
)

151 ià(
	`uÆik–y
 (!
¤c_
.
	`check
 ())) {

152 
”ºo
 = 
EFAULT
;

156 
rc
 = 
	`şo£
 ();

157 ià(
	`uÆik–y
 (
rc
 < 0))

158  
rc
;

160 *
this
 = 
¤c_
;

162 
rc
 = 
¤c_
.
	`š™
 ();

163 ià(
	`uÆik–y
 (
rc
 < 0))

164  
rc
;

167 
	}
}

169 
	gzmq
::
msg_t
::
	$cİy
 (
msg_t
 &
¤c_
)

172 ià(
	`uÆik–y
 (!
¤c_
.
	`check
 ())) {

173 
”ºo
 = 
EFAULT
;

177 
rc
 = 
	`şo£
 ();

178 ià(
	`uÆik–y
 (
rc
 < 0))

179  
rc
;

181 ià(
¤c_
.
u
.
ba£
.
ty³
 =ğ
ty³_lmsg
) {

185 ià(
¤c_
.
u
.
lmsg
.
æags
 & 
msg_t
::
sh¬ed
)

186 
¤c_
.
u
.
lmsg
.
cÚ‹Á
->
»fút
.
	`add
 (1);

188 
¤c_
.
u
.
lmsg
.
æags
 |ğ
msg_t
::
sh¬ed
;

189 
¤c_
.
u
.
lmsg
.
cÚ‹Á
->
»fút
.
	`£t
 (2);

193 *
this
 = 
¤c_
;

197 
	}
}

199 *
	gzmq
::
msg_t
::
	$d©a
 ()

202 
	`zmq_as£¹
 (
	`check
 ());

204 
u
.
ba£
.
ty³
) {

205 
ty³_vsm
:

206  
u
.
vsm
.
d©a
;

207 
ty³_lmsg
:

208  
u
.
lmsg
.
cÚ‹Á
->
d©a
;

209 
ty³_cmsg
:

210  
u
.
cmsg
.
d©a
;

212 
	`zmq_as£¹
 (
çl£
);

213  
NULL
;

215 
	}
}

217 
size_t
 
	gzmq
::
msg_t
::
	$size
 ()

220 
	`zmq_as£¹
 (
	`check
 ());

222 
u
.
ba£
.
ty³
) {

223 
ty³_vsm
:

224  
u
.
vsm
.
size
;

225 
ty³_lmsg
:

226  
u
.
lmsg
.
cÚ‹Á
->
size
;

227 
ty³_cmsg
:

228  
u
.
cmsg
.
size
;

230 
	`zmq_as£¹
 (
çl£
);

233 
	}
}

235 
	gzmq
::
msg_t
::
	$æags
 ()

237  
u
.
ba£
.
æags
;

238 
	}
}

240 
	gzmq
::
msg_t
::
	$£t_æags
 (
æags_
)

242 
u
.
ba£
.
æags
 |ğ
æags_
;

243 
	}
}

245 
	gzmq
::
msg_t
::
	$»£t_æags
 (
æags_
)

247 
u
.
ba£
.
æags
 &ğ~
æags_
;

248 
	}
}

250 
boŞ
 
	gzmq
::
msg_t
::
	$is_id’t™y
 () const

252  (
u
.
ba£
.
æags
 & 
id’t™y
) == identity;

253 
	}
}

255 
boŞ
 
	gzmq
::
msg_t
::
	$is_d–im™”
 ()

257  
u
.
ba£
.
ty³
 =ğ
ty³_d–im™”
;

258 
	}
}

260 
boŞ
 
	gzmq
::
msg_t
::
	$is_vsm
 ()

262  
u
.
ba£
.
ty³
 =ğ
ty³_vsm
;

263 
	}
}

265 
boŞ
 
	gzmq
::
msg_t
::
	$is_cmsg
 ()

267  
u
.
ba£
.
ty³
 =ğ
ty³_cmsg
;

268 
	}
}

270 
	gzmq
::
msg_t
::
	$add_»fs
 (
»fs_
)

272 
	`zmq_as£¹
 (
»fs_
 >= 0);

275 ià(!
»fs_
)

280 ià(
u
.
ba£
.
ty³
 =ğ
ty³_lmsg
) {

281 ià(
u
.
lmsg
.
æags
 & 
msg_t
::
sh¬ed
)

282 
u
.
lmsg
.
cÚ‹Á
->
»fút
.
	`add
 (
»fs_
);

284 
u
.
lmsg
.
cÚ‹Á
->
»fút
.
	`£t
 (
»fs_
 + 1);

285 
u
.
lmsg
.
æags
 |ğ
msg_t
::
sh¬ed
;

288 
	}
}

290 
boŞ
 
	gzmq
::
msg_t
::
	$rm_»fs
 (
»fs_
)

292 
	`zmq_as£¹
 (
»fs_
 >= 0);

295 ià(!
»fs_
)

296  
Œue
;

299 ià(
u
.
ba£
.
ty³
 !ğ
ty³_lmsg
 || !(u.
lmsg
.
æags
 & 
msg_t
::
sh¬ed
)) {

300 
	`şo£
 ();

301  
çl£
;

305 ià(!
u
.
lmsg
.
cÚ‹Á
->
»fút
.
	`sub
 (
»fs_
)) {

308 
u
.
lmsg
.
cÚ‹Á
->
»fút
.~
	`©omic_couÁ”_t
 ();

310 ià(
u
.
lmsg
.
cÚ‹Á
->
fâ
)

311 
u
.
lmsg
.
cÚ‹Á
->
	`fâ
 (u.lmsg.cÚ‹Á->
d©a
, u.lmsg.cÚ‹Á->
hšt
);

312 
	`ä“
 (
u
.
lmsg
.
cÚ‹Á
);

314  
çl£
;

317  
Œue
;

318 
	}
}

	@msg.hpp

20 #iâdeà
__ZMQ_MSG_HPP_INCLUDE__


21 
	#__ZMQ_MSG_HPP_INCLUDE__


	)

23 
	~<¡ddef.h
>

24 
	~<¡dio.h
>

26 
	~"cÚfig.hµ
"

27 
	~"©omic_couÁ”.hµ
"

34 (
msg_ä“_â
è(*
	td©a
, *
	thšt
);

37 
Çme¥aû
 
zmq


43 şas 
	cmsg_t


45 
public
:

50 
mÜe
 = 1,

51 
commªd
 = 2,

52 
id’t™y
 = 64,

53 
sh¬ed
 = 128

56 
boŞ
 
check
 ();

57 
š™
 ();

58 
š™_size
 (
size_t
 
size_
);

59 
š™_d©a
 (*
d©a_
, 
size_t
 
size_
, 
msg_ä“_â
 *
fâ_
,

60 *
hšt_
);

61 
š™_d–im™”
 ();

62 
şo£
 ();

63 
move
 (
msg_t
 &
¤c_
);

64 
cİy
 (
msg_t
 &
¤c_
);

65 *
d©a
 ();

66 
size_t
 
size
 ();

67 
æags
 ();

68 
£t_æags
 (
æags_
);

69 
»£t_æags
 (
æags_
);

70 
boŞ
 
is_id’t™y
 () const;

71 
boŞ
 
is_d–im™”
 ();

72 
boŞ
 
is_vsm
 ();

73 
boŞ
 
is_cmsg
 ();

77 
add_»fs
 (
»fs_
);

81 
boŞ
 
rm_»fs
 (
»fs_
);

83 
´iv©e
:

87 ’um {
max_vsm_size
 = 29};

96 
	scÚ‹Á_t


98 *
d©a
;

99 
size_t
 
size
;

100 
msg_ä“_â
 *
fâ
;

101 *
hšt
;

102 
zmq
::
©omic_couÁ”_t
 
»fút
;

106 
	ety³_t


108 
ty³_mš
 = 101,

110 
ty³_vsm
 = 101,

112 
ty³_lmsg
 = 102,

114 
ty³_d–im™”
 = 103,

116 
ty³_cmsg
 = 104,

117 
ty³_max
 = 104

126 
unu£d
 [
max_vsm_size
 + 1];

127 
ty³
;

128 
æags
;

129 } 
ba£
;

131 
d©a
 [
max_vsm_size
];

132 
size
;

133 
ty³
;

134 
æags
;

135 } 
vsm
;

137 
cÚ‹Á_t
 *
cÚ‹Á
;

138 
unu£d
 [
max_vsm_size
 + 1 -  (
cÚ‹Á_t
*)];

139 
ty³
;

140 
æags
;

141 } 
lmsg
;

143 * 
d©a
;

144 
size_t
 
size
;

145 
unu£d


146 [
max_vsm_size
 + 1 -  (*è-  (
size_t
)];

147 
ty³
;

148 
æags
;

149 } 
cmsg
;

151 
unu£d
 [
max_vsm_size
 + 1];

152 
ty³
;

153 
æags
;

154 } 
d–im™”
;

155 } 
u
;

	@mtrie.cpp

20 
	~<¡dlib.h
>

22 
	~<Ãw
>

23 
	~<®gÜ™hm
>

25 
	~"¶©fÜm.hµ
"

26 #ià
defšed
 
ZMQ_HAVE_WINDOWS


27 
	~"wšdows.hµ
"

30 
	~"”r.hµ
"

31 
	~"pe.hµ
"

32 
	~"mŒ›.hµ
"

34 
	gzmq
::
mŒ›_t
::
	$mŒ›_t
 () :

35 
	`pes
 (0),

36 
	`mš
 (0),

37 
	`couÁ
 (0),

38 
	$live_nodes
 (0)

40 
	}
}

42 
	gzmq
::
mŒ›_t
::~
	$mŒ›_t
 ()

44 ià(
pes
) {

45 
d–‘e
 
pes
;

46 
pes
 = 0;

49 ià(
couÁ
 == 1) {

50 
	`zmq_as£¹
 (
Ãxt
.
node
);

51 
d–‘e
 
Ãxt
.
node
;

52 
Ãxt
.
node
 = 0;

55 ià(
couÁ
 > 1) {

56 
i
 = 0; i !ğ
couÁ
; ++i)

57 
d–‘e
 
Ãxt
.
bË
 [
i
];

58 
	`ä“
 (
Ãxt
.
bË
);

60 
	}
}

62 
boŞ
 
	gzmq
::
mŒ›_t
::
	$add
 (*
´efix_
, 
size_t
 
size_
, 
pe_t
 *
pe_
)

64  
	`add_h–³r
 (
´efix_
, 
size_
, 
pe_
);

65 
	}
}

67 
boŞ
 
	gzmq
::
mŒ›_t
::
	$add_h–³r
 (*
´efix_
, 
size_t
 
size_
,

68 
pe_t
 *
pe_
)

71 ià(!
size_
) {

72 
boŞ
 
»suÉ
 = !
pes
;

73 ià(!
pes
) {

74 
pes
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
pes_t
;

75 
	`®loc_as£¹
 (
pes
);

77 
pes
->
	`š£¹
 (
pe_
);

78  
»suÉ
;

81 
c
 = *
´efix_
;

82 ià(
c
 < 
mš
 || c >ğmš + 
couÁ
) {

86 ià(!
couÁ
) {

87 
mš
 = 
c
;

88 
couÁ
 = 1;

89 
Ãxt
.
node
 = 
NULL
;

92 ià(
couÁ
 == 1) {

93 
Şdc
 = 
mš
;

94 
mŒ›_t
 *
Şdp
 = 
Ãxt
.
node
;

95 
couÁ
 = (
mš
 < 
c
 ? c - min : min - c) + 1;

96 
Ãxt
.
bË
 = (
mŒ›_t
**)

97 
	`m®loc
 ( (
mŒ›_t
*è* 
couÁ
);

98 
	`®loc_as£¹
 (
Ãxt
.
bË
);

99 
i
 = 0; i !ğ
couÁ
; ++i)

100 
Ãxt
.
bË
 [
i
] = 0;

101 
mš
 = 
¡d
::
	`mš
 (mš, 
c
);

102 
Ãxt
.
bË
 [
Şdc
 - 
mš
] = 
Şdp
;

105 ià(
mš
 < 
c
) {

107 
Şd_couÁ
 = 
couÁ
;

108 
couÁ
 = 
c
 - 
mš
 + 1;

109 
Ãxt
.
bË
 = (
mŒ›_t
**è
	`»®loc
 (next.table,

110  (
mŒ›_t
*è* 
couÁ
);

111 
	`®loc_as£¹
 (
Ãxt
.
bË
);

112 
i
 = 
Şd_couÁ
; i !ğ
couÁ
; i++)

113 
Ãxt
.
bË
 [
i
] = 
NULL
;

117 
Şd_couÁ
 = 
couÁ
;

118 
couÁ
 = (
mš
 + 
Şd_couÁ
è- 
c
;

119 
Ãxt
.
bË
 = (
mŒ›_t
**è
	`»®loc
 (next.table,

120  (
mŒ›_t
*è* 
couÁ
);

121 
	`®loc_as£¹
 (
Ãxt
.
bË
);

122 
	`memmove
 (
Ãxt
.
bË
 + 
mš
 - 
c
,‚ext.table,

123 
Şd_couÁ
 *  (
mŒ›_t
*));

124 
i
 = 0; i !ğ
mš
 - 
c
; i++)

125 
Ãxt
.
bË
 [
i
] = 
NULL
;

126 
mš
 = 
c
;

131 ià(
couÁ
 == 1) {

132 ià(!
Ãxt
.
node
) {

133 
Ãxt
.
node
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
mŒ›_t
;

134 
	`®loc_as£¹
 (
Ãxt
.
node
);

135 ++
live_nodes
;

137  
Ãxt
.
node
->
	`add_h–³r
 (
´efix_
 + 1, 
size_
 - 1, 
pe_
);

140 ià(!
Ãxt
.
bË
 [
c
 - 
mš
]) {

141 
Ãxt
.
bË
 [
c
 - 
mš
] = 
	`Ãw
 (
¡d
::
nÙhrow
è
mŒ›_t
;

142 
	`®loc_as£¹
 (
Ãxt
.
bË
 [
c
 - 
mš
]);

143 ++
live_nodes
;

145  
Ãxt
.
bË
 [
c
 - 
mš
]->
	`add_h–³r
 (
´efix_
 + 1, 
size_
 - 1, 
pe_
);

147 
	}
}

150 
	gzmq
::
mŒ›_t
::
rm
 (
pe_t
 *
pe_
,

151 (*
func_
è(*
d©a_
, 
size_t
 
size_
, *
¬g_
),

152 *
¬g_
)

154 *
buff
 = 
NULL
;

155 
	`rm_h–³r
 (
pe_
, &
buff
, 0, 0, 
func_
, 
¬g_
);

156 
	`ä“
 (
buff
);

157 
	}
}

159 
	gzmq
::
mŒ›_t
::
rm_h–³r
 (
pe_t
 *
pe_
, **
buff_
,

160 
size_t
 
buffsize_
, size_ˆ
maxbuffsize_
,

161 (*
func_
è(*
d©a_
, 
size_t
 
size_
, *
¬g_
),

162 *
¬g_
)

165 ià(
pes
 &&…es->
	`”a£
 (
pe_
è&&…es->
	`em±y
 ()) {

166 
	`func_
 (*
buff_
, 
buffsize_
, 
¬g_
);

167 
d–‘e
 
pes
;

168 
pes
 = 0;

172 ià(
buffsize_
 >ğ
maxbuffsize_
) {

173 
maxbuffsize_
 = 
buffsize_
 + 256;

174 *
buff_
 = (*è
	`»®loc
 (*buff_, 
maxbuffsize_
);

175 
	`®loc_as£¹
 (*
buff_
);

179 ià(
couÁ
 == 0)

183 ià(
couÁ
 == 1) {

184 (*
buff_
è[
buffsize_
] = 
mš
;

185 
buffsize_
++;

186 
Ãxt
.
node
->
	`rm_h–³r
 (
pe_
, 
buff_
, 
buffsize_
, 
maxbuffsize_
,

187 
func_
, 
¬g_
);

190 ià(
Ãxt
.
node
->
	`is_»dundªt
 ()) {

191 
d–‘e
 
Ãxt
.
node
;

192 
Ãxt
.
node
 = 0;

193 
couÁ
 = 0;

194 --
live_nodes
;

195 
	`zmq_as£¹
 (
live_nodes
 == 0);

203 
Ãw_mš
 = 
mš
 + 
couÁ
 - 1;

205 
Ãw_max
 = 
mš
;

206 
c
 = 0; c !ğ
couÁ
; c++) {

207 (*
buff_
è[
buffsize_
] = 
mš
 + 
c
;

208 ià(
Ãxt
.
bË
 [
c
]) {

209 
Ãxt
.
bË
 [
c
]->
	`rm_h–³r
 (
pe_
, 
buff_
, 
buffsize_
 + 1,

210 
maxbuffsize_
, 
func_
, 
¬g_
);

213 ià(
Ãxt
.
bË
 [
c
]->
	`is_»dundªt
 ()) {

214 
d–‘e
 
Ãxt
.
bË
 [
c
];

215 
Ãxt
.
bË
 [
c
] = 0;

217 
	`zmq_as£¹
 (
live_nodes
 > 0);

218 --
live_nodes
;

228 ià(
c
 + 
mš
 < 
Ãw_mš
)

229 
Ãw_mš
 = 
c
 + 
mš
;

230 ià(
c
 + 
mš
 > 
Ãw_max
)

231 
Ãw_max
 = 
c
 + 
mš
;

236 
	`zmq_as£¹
 (
couÁ
 > 1);

239 ià(
live_nodes
 == 0) {

240 
	`ä“
 (
Ãxt
.
bË
);

241 
Ãxt
.
bË
 = 
NULL
;

242 
couÁ
 = 0;

246 ià(
live_nodes
 == 1) {

250 
	`zmq_as£¹
 (
Ãw_mš
 =ğ
Ãw_max
);

251 
	`zmq_as£¹
 (
Ãw_mš
 >ğ
mš
 &&‚ew_mš < mš + 
couÁ
);

252 
mŒ›_t
 *
node
 = 
Ãxt
.
bË
 [
Ãw_mš
 - 
mš
];

253 
	`zmq_as£¹
 (
node
);

254 
	`ä“
 (
Ãxt
.
bË
);

255 
Ãxt
.
node
 =‚ode;

256 
couÁ
 = 1;

257 
mš
 = 
Ãw_mš
;

260 ià(
Ãw_mš
 > 
mš
 || 
Ãw_max
 < mš + 
couÁ
 - 1) {

261 
	`zmq_as£¹
 (
Ãw_max
 - 
Ãw_mš
 + 1 > 1);

263 
mŒ›_t
 **
Şd_bË
 = 
Ãxt
.
bË
;

264 
	`zmq_as£¹
 (
Ãw_mš
 > 
mš
 || 
Ãw_max
 < mš + 
couÁ
 - 1);

265 
	`zmq_as£¹
 (
Ãw_mš
 >ğ
mš
);

266 
	`zmq_as£¹
 (
Ãw_max
 <ğ
mš
 + 
couÁ
 - 1);

267 
	`zmq_as£¹
 (
Ãw_max
 - 
Ãw_mš
 + 1 < 
couÁ
);

269 
couÁ
 = 
Ãw_max
 - 
Ãw_mš
 + 1;

270 
Ãxt
.
bË
 = (
mŒ›_t
**è
	`m®loc
 ( (mŒ›_t*è* 
couÁ
);

271 
	`®loc_as£¹
 (
Ãxt
.
bË
);

273 
	`memmove
 (
Ãxt
.
bË
, 
Şd_bË
 + (
Ãw_mš
 - 
mš
),

274  (
mŒ›_t
*è* 
couÁ
);

275 
	`ä“
 (
Şd_bË
);

277 
mš
 = 
Ãw_mš
;

279 
	}
}

281 
boŞ
 
	gzmq
::
mŒ›_t
::
	$rm
 (*
´efix_
, 
size_t
 
size_
, 
pe_t
 *
pe_
)

283  
	`rm_h–³r
 (
´efix_
, 
size_
, 
pe_
);

284 
	}
}

286 
boŞ
 
	gzmq
::
mŒ›_t
::
	$rm_h–³r
 (*
´efix_
, 
size_t
 
size_
,

287 
pe_t
 *
pe_
)

289 ià(!
size_
) {

290 ià(
pes
) {

291 
pes_t
::
size_ty³
 
”a£d
 = 
pes
->
	`”a£
 (
pe_
);

292 
	`zmq_as£¹
 (
”a£d
 == 1);

293 ià(
pes
->
	`em±y
 ()) {

294 
d–‘e
 
pes
;

295 
pes
 = 0;

298  !
pes
;

301 
c
 = *
´efix_
;

302 ià(!
couÁ
 || 
c
 < 
mš
 || c >= min + count)

303  
çl£
;

305 
mŒ›_t
 *
Ãxt_node
 =

306 
couÁ
 =ğ1 ? 
Ãxt
.
node
 :‚ext.
bË
 [
c
 - 
mš
];

308 ià(!
Ãxt_node
)

309  
çl£
;

311 
boŞ
 
»t
 = 
Ãxt_node
->
	`rm_h–³r
 (
´efix_
 + 1, 
size_
 - 1, 
pe_
);

313 ià(
Ãxt_node
->
	`is_»dundªt
 ()) {

314 
d–‘e
 
Ãxt_node
;

315 
	`zmq_as£¹
 (
couÁ
 > 0);

317 ià(
couÁ
 == 1) {

318 
Ãxt
.
node
 = 0;

319 
couÁ
 = 0;

320 --
live_nodes
;

321 
	`zmq_as£¹
 (
live_nodes
 == 0);

324 
Ãxt
.
bË
 [
c
 - 
mš
] = 0;

325 
	`zmq_as£¹
 (
live_nodes
 > 1);

326 --
live_nodes
;

329 ià(
live_nodes
 == 1) {

333 
i
;

334 
i
 = 0; i < 
couÁ
; ++i)

335 ià(
Ãxt
.
bË
 [
i
])

338 
	`zmq_as£¹
 (
i
 < 
couÁ
);

339 
mš
 +ğ
i
;

340 
couÁ
 = 1;

341 
mŒ›_t
 *
Şdp
 = 
Ãxt
.
bË
 [
i
];

342 
	`ä“
 (
Ãxt
.
bË
);

343 
Ãxt
.
node
 = 
Şdp
;

346 ià(
c
 =ğ
mš
) {

348 
i
;

349 
i
 = 1; i < 
couÁ
; ++i)

350 ià(
Ãxt
.
bË
 [
i
])

353 
	`zmq_as£¹
 (
i
 < 
couÁ
);

354 
mš
 +ğ
i
;

355 
couÁ
 -ğ
i
;

356 
mŒ›_t
 **
Şd_bË
 = 
Ãxt
.
bË
;

357 
Ãxt
.
bË
 = (
mŒ›_t
**è
	`m®loc
 ( (mŒ›_t*è* 
couÁ
);

358 
	`®loc_as£¹
 (
Ãxt
.
bË
);

359 
	`memmove
 (
Ãxt
.
bË
, 
Şd_bË
 + 
i
,  (
mŒ›_t
*è* 
couÁ
);

360 
	`ä“
 (
Şd_bË
);

363 ià(
c
 =ğ
mš
 + 
couÁ
 - 1) {

365 
i
;

366 
i
 = 1; i < 
couÁ
; ++i)

367 ià(
Ãxt
.
bË
 [
couÁ
 - 1 - 
i
])

370 
	`zmq_as£¹
 (
i
 < 
couÁ
);

371 
couÁ
 -ğ
i
;

372 
mŒ›_t
 **
Şd_bË
 = 
Ãxt
.
bË
;

373 
Ãxt
.
bË
 = (
mŒ›_t
**è
	`m®loc
 ( (mŒ›_t*è* 
couÁ
);

374 
	`®loc_as£¹
 (
Ãxt
.
bË
);

375 
	`memmove
 (
Ãxt
.
bË
, 
Şd_bË
,  (
mŒ›_t
*è* 
couÁ
);

376 
	`ä“
 (
Şd_bË
);

381  
»t
;

382 
	}
}

384 
	gzmq
::
mŒ›_t
::
m©ch
 (*
d©a_
, 
size_t
 
size_
,

385 (*
func_
è(
pe_t
 *
pe_
, *
¬g_
), *arg_)

387 
mŒ›_t
 *
cu¼’t
 = 
this
;

388 
Œue
) {

391 ià(
cu¼’t
->
pes
) {

392 
pes_t
::
™”©Ü
 
™
 = 
cu¼’t
->
pes
->
	`begš
 ();

393 
™
 !ğ
cu¼’t
->
pes
->
	`’d
 (); ++it)

394 
	`func_
 (*
™
, 
¬g_
);

398 ià(!
size_
)

402 ià(
cu¼’t
->
couÁ
 == 0)

406 ià(
cu¼’t
->
couÁ
 == 1) {

407 ià(
d©a_
 [0] !ğ
cu¼’t
->
mš
)

409 
cu¼’t
 = cu¼’t->
Ãxt
.
node
;

410 
d©a_
++;

411 
size_
--;

416 ià(
d©a_
 [0] < 
cu¼’t
->
mš
 || data_ [0] >=

417 
cu¼’t
->
mš
 + cu¼’t->
couÁ
)

419 ià(!
cu¼’t
->
Ãxt
.
bË
 [
d©a_
 [0] - cu¼’t->
mš
])

421 
cu¼’t
 = cu¼’t->
Ãxt
.
bË
 [
d©a_
 [0] - cu¼’t->
mš
];

422 
d©a_
++;

423 
size_
--;

425 
	}
}

427 
boŞ
 
	gzmq
::
mŒ›_t
::
	$is_»dundªt
 () const

429  !
pes
 && 
live_nodes
 == 0;

430 
	}
}

	@mtrie.hpp

20 #iâdeà
__ZMQ_MTRIE_HPP_INCLUDED__


21 
	#__ZMQ_MTRIE_HPP_INCLUDED__


	)

23 
	~<¡ddef.h
>

24 
	~<£t
>

26 
	~"¡dšt.hµ
"

28 
Çme¥aû
 
	gzmq


31 
şass
 
	gpe_t
;

35 şas 
	cmŒ›_t


37 
	gpublic
:

39 
mŒ›_t
 ();

40 ~
mŒ›_t
 ();

44 
boŞ
 
add
 (*
´efix_
, 
size_t
 
size_
, 
zmq
::
pe_t
 *
pe_
);

49 
rm
 (
zmq
::
pe_t
 *
pe_
,

50 (*
func_
è(*
d©a_
, 
size_t
 
size_
, *
¬g_
),

51 *
¬g_
);

55 
boŞ
 
rm
 (*
´efix_
, 
size_t
 
size_
, 
zmq
::
pe_t
 *
pe_
);

58 
m©ch
 (*
d©a_
, 
size_t
 
size_
,

59 (*
func_
è(
zmq
::
pe_t
 *
pe_
, *
¬g_
), *arg_);

61 
	g´iv©e
:

63 
boŞ
 
add_h–³r
 (*
´efix_
, 
size_t
 
size_
,

64 
zmq
::
pe_t
 *
pe_
);

65 
rm_h–³r
 (
zmq
::
pe_t
 *
pe_
, **
buff_
,

66 
size_t
 
buffsize_
, size_ˆ
maxbuffsize_
,

67 (*
func_
è(*
d©a_
, 
size_t
 
size_
, *
¬g_
),

68 *
¬g_
);

69 
boŞ
 
rm_h–³r
 (*
´efix_
, 
size_t
 
size_
,

70 
zmq
::
pe_t
 *
pe_
);

71 
boŞ
 
is_»dundªt
 () const;

73 
	g¡d
::
	t£t
 <
	tzmq
::
	tpe_t
*> 
	tpes_t
;

74 
pes_t
 *
	gpes
;

76 
	gmš
;

77 
	gcouÁ
;

78 
	glive_nodes
;

80 
şass
 
mŒ›_t
 *
	gnode
;

81 
şass
 
mŒ›_t
 **
	gbË
;

82 } 
	gÃxt
;

84 
mŒ›_t
 (const mtrie_t&);

85 cÚ¡ 
	gmŒ›_t
 &
	gİ”©Ü
 = (cÚ¡ 
mŒ›_t
&);

	@mutex.hpp

20 #iâdeà
__ZMQ_MUTEX_HPP_INCLUDED__


21 
	#__ZMQ_MUTEX_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

24 
	~"”r.hµ
"

28 #ifdeà
ZMQ_HAVE_WINDOWS


30 
	~"wšdows.hµ
"

32 
Çme¥aû
 
	gzmq


35 şas 
	cmu‹x_t


37 
	gpublic
:

38 
šlše
 
mu‹x_t
 ()

40 
In™ŸlizeCr™iÿlSeùiÚ
 (&
cs
);

43 
	gšlše
 ~
mu‹x_t
 ()

45 
D–‘eCr™iÿlSeùiÚ
 (&
cs
);

48 
šlše
 
lock
 ()

50 
EÁ”Cr™iÿlSeùiÚ
 (&
cs
);

53 
šlše
 
boŞ
 
Œy_lock
 ()

55  (
TryEÁ”Cr™iÿlSeùiÚ
 (&
cs
)è? 
	gŒue
 : 
çl£
;

58 
šlše
 
uÆock
 ()

60 
L—veCr™iÿlSeùiÚ
 (&
cs
);

63 
	g´iv©e
:

65 
CRITICAL_SECTION
 
cs
;

68 
mu‹x_t
 (const mutex_t&);

69 
	gİ”©Ü
 = (cÚ¡ 
mu‹x_t
&);

76 
	~<±h»ad.h
>

78 
Çme¥aû
 
	gzmq


81 şas 
	cmu‹x_t


83 
	gpublic
:

84 
šlše
 
mu‹x_t
 ()

86 
rc
 = 
±h»ad_mu‹x_š™
 (&
mu‹x
, 
NULL
);

87 
posix_as£¹
 (
rc
);

90 
	gšlše
 ~
mu‹x_t
 ()

92 
	grc
 = 
±h»ad_mu‹x_de¡roy
 (&
mu‹x
);

93 
posix_as£¹
 (
rc
);

96 
šlše
 
lock
 ()

98 
	grc
 = 
±h»ad_mu‹x_lock
 (&
mu‹x
);

99 
posix_as£¹
 (
rc
);

102 
šlše
 
boŞ
 
Œy_lock
 ()

104 
	grc
 = 
±h»ad_mu‹x_Œylock
 (&
mu‹x
);

105 ià(
	grc
 =ğ
EBUSY
)

106  
çl£
;

108 
posix_as£¹
 (
rc
);

109  
	gŒue
;

112 
šlše
 
uÆock
 ()

114 
	grc
 = 
±h»ad_mu‹x_uÆock
 (&
mu‹x
);

115 
posix_as£¹
 (
rc
);

118 
	g´iv©e
:

120 
±h»ad_mu‹x_t
 
mu‹x
;

123 
mu‹x_t
 (const mutex_t&);

124 cÚ¡ 
	gmu‹x_t
 &
	gİ”©Ü
 = (cÚ¡ 
mu‹x_t
&);

132 
Çme¥aû
 
	gzmq


134 
	sscİed_lock_t


136 
scİed_lock_t
 (
mu‹x_t
& 
mu‹x_
)

137 : 
mu‹x
 (
mu‹x_
)

139 
mu‹x
.
lock
 ();

142 ~
scİed_lock_t
 ()

144 
	gmu‹x
.
uÆock
 ();

147 
	g´iv©e
:

149 
mu‹x_t
& 
mu‹x
;

152 
scİed_lock_t
 (const scoped_lock_t&);

153 cÚ¡ 
	gscİed_lock_t
 &
	gİ”©Ü
 = (cÚ¡ 
scİed_lock_t
&);

	@null_mechanism.cpp

20 
	~"¶©fÜm.hµ
"

21 #ifdeà
ZMQ_HAVE_WINDOWS


22 
	~"wšdows.hµ
"

25 
	~<¡ddef.h
>

26 
	~<¡ršg.h
>

27 
	~<¡dlib.h
>

29 
	~"”r.hµ
"

30 
	~"msg.hµ
"

31 
	~"£ssiÚ_ba£.hµ
"

32 
	~"wœe.hµ
"

33 
	~"nuÎ_mechªism.hµ
"

35 
	gzmq
::
nuÎ_mechªism_t
::
	$nuÎ_mechªism_t
 (
£ssiÚ_ba£_t
 *
£ssiÚ_
,

36 cÚ¡ 
¡d
::
¡ršg
 &
³”_add»ss_
,

37 cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

38 
	`mechªism_t
 (
İtiÚs_
),

39 
	`£ssiÚ
 (
£ssiÚ_
),

40 
	`³”_add»ss
 (
³”_add»ss_
),

41 
	`»ady_commªd_£Á
 (
çl£
),

42 
	`»ady_commªd_»ûived
 (
çl£
),

43 
	`z­_cÚÃùed
 (
çl£
),

44 
	`z­_»que¡_£Á
 (
çl£
),

45 
	$z­_»¶y_»ûived
 (
çl£
)

49 ià(
İtiÚs
.
z­_domaš
.
	`size
 () > 0

50 && 
£ssiÚ
->
	`z­_cÚÃù
 () == 0)

51 
z­_cÚÃùed
 = 
Œue
;

52 
	}
}

54 
	gzmq
::
nuÎ_mechªism_t
::~
	$nuÎ_mechªism_t
 ()

56 
	}
}

58 
zmq
::
nuÎ_mechªism_t
::
	$Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
)

60 ià(
»ady_commªd_£Á
) {

61 
”ºo
 = 
EAGAIN
;

64 ià(
z­_cÚÃùed
 && !
z­_»¶y_»ûived
) {

65 ià(
z­_»que¡_£Á
) {

66 
”ºo
 = 
EAGAIN
;

69 
	`£nd_z­_»que¡
 ();

70 
z­_»que¡_£Á
 = 
Œue
;

71 cÚ¡ 
rc
 = 
	`»ûive_ªd_´oûss_z­_»¶y
 ();

72 ià(
rc
 != 0)

74 
z­_»¶y_»ûived
 = 
Œue
;

77 * cÚ¡ 
commªd_bufãr
 = (*è
	`m®loc
 (512);

78 
	`®loc_as£¹
 (
commªd_bufãr
);

80 *
±r
 = 
commªd_bufãr
;

83 
	`memıy
 (
±r
, "\5READY", 6);

84 
±r
 += 6;

87 cÚ¡ *
sock‘_ty³
 = 
	`sock‘_ty³_¡ršg
 (
İtiÚs
.
ty³
);

88 
±r
 +ğ
	`add_´İ”ty
 (±r, "Sock‘-Ty³", 
sock‘_ty³
, 
	`¡¾’
 (socket_type));

91 ià(
İtiÚs
.
ty³
 =ğ
ZMQ_REQ


92 || 
İtiÚs
.
ty³
 =ğ
ZMQ_DEALER


93 || 
İtiÚs
.
ty³
 =ğ
ZMQ_ROUTER
) {

94 
±r
 +ğ
	`add_´İ”ty
 (ptr, "Identity",

95 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

98 cÚ¡ 
size_t
 
commªd_size
 = 
±r
 - 
commªd_bufãr
;

99 cÚ¡ 
rc
 = 
msg_
->
	`š™_size
 (
commªd_size
);

100 
	`”ºo_as£¹
 (
rc
 == 0);

101 
	`memıy
 (
msg_
->
	`d©a
 (), 
commªd_bufãr
, 
commªd_size
);

102 
	`ä“
 (
commªd_bufãr
);

104 
»ady_commªd_£Á
 = 
Œue
;

107 
	}
}

109 
	gzmq
::
nuÎ_mechªism_t
::
	$´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
)

111 ià(
»ady_commªd_»ûived
) {

112 
”ºo
 = 
EPROTO
;

116 cÚ¡ *
±r
 =

117 
¡©ic_ÿ¡
 <*> (
msg_
->
	`d©a
 ());

118 
size_t
 
by‹s_Ëá
 = 
msg_
->
	`size
 ();

120 ià(
by‹s_Ëá
 < 6 || 
	`memcmp
 (
±r
, "\5READY", 6)) {

121 
”ºo
 = 
EPROTO
;

125 
±r
 += 6;

126 
by‹s_Ëá
 -= 6;

128 
rc
 = 
	`·r£_m‘ad©a
 (
±r
, 
by‹s_Ëá
);

129 ià(
rc
 == 0) {

130 
rc
 = 
msg_
->
	`şo£
 ();

131 
	`”ºo_as£¹
 (
rc
 == 0);

132 
rc
 = 
msg_
->
	`š™
 ();

133 
	`”ºo_as£¹
 (
rc
 == 0);

136 
»ady_commªd_»ûived
 = 
Œue
;

138  
rc
;

139 
	}
}

141 
	gzmq
::
nuÎ_mechªism_t
::
	$z­_msg_avaabË
 ()

143 ià(
z­_»¶y_»ûived
) {

144 
”ºo
 = 
EFSM
;

147 cÚ¡ 
rc
 = 
	`»ûive_ªd_´oûss_z­_»¶y
 ();

148 ià(
rc
 == 0)

149 
z­_»¶y_»ûived
 = 
Œue
;

150  
rc
;

151 
	}
}

153 
boŞ
 
	gzmq
::
nuÎ_mechªism_t
::
	$is_hªdshake_com¶‘e
 () const

155  
»ady_commªd_»ûived
 && 
»ady_commªd_£Á
;

156 
	}
}

158 
	gzmq
::
nuÎ_mechªism_t
::
	$£nd_z­_»que¡
 ()

160 
rc
;

161 
msg_t
 
msg
;

164 
rc
 = 
msg
.
	`š™
 ();

165 
	`”ºo_as£¹
 (
rc
 == 0);

166 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

167 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

168 
	`”ºo_as£¹
 (
rc
 == 0);

171 
rc
 = 
msg
.
	`š™_size
 (3);

172 
	`”ºo_as£¹
 (
rc
 == 0);

173 
	`memıy
 (
msg
.
	`d©a
 (), "1.0", 3);

174 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

175 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

176 
	`”ºo_as£¹
 (
rc
 == 0);

179 
rc
 = 
msg
.
	`š™_size
 (1);

180 
	`”ºo_as£¹
 (
rc
 == 0);

181 
	`memıy
 (
msg
.
	`d©a
 (), "1", 1);

182 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

183 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

184 
	`”ºo_as£¹
 (
rc
 == 0);

187 
rc
 = 
msg
.
	`š™_size
 (
İtiÚs
.
z­_domaš
.
	`Ëngth
 ());

188 
	`”ºo_as£¹
 (
rc
 == 0);

189 
	`memıy
 (
msg
.
	`d©a
 (), 
İtiÚs
.
z­_domaš
.
	`c_¡r
 (), o±iÚs.z­_domaš.
	`Ëngth
 ());

190 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

191 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

192 
	`”ºo_as£¹
 (
rc
 == 0);

195 
rc
 = 
msg
.
	`š™_size
 (
³”_add»ss
.
	`Ëngth
 ());

196 
	`”ºo_as£¹
 (
rc
 == 0);

197 
	`memıy
 (
msg
.
	`d©a
 (), 
³”_add»ss
.
	`c_¡r
 (),…“r_add»ss.
	`Ëngth
 ());

198 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

199 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

200 
	`”ºo_as£¹
 (
rc
 == 0);

203 
rc
 = 
msg
.
	`š™_size
 (
İtiÚs
.
id’t™y_size
);

204 
	`”ºo_as£¹
 (
rc
 == 0);

205 
	`memıy
 (
msg
.
	`d©a
 (), 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

206 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

207 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

208 
	`”ºo_as£¹
 (
rc
 == 0);

211 
rc
 = 
msg
.
	`š™_size
 (4);

212 
	`”ºo_as£¹
 (
rc
 == 0);

213 
	`memıy
 (
msg
.
	`d©a
 (), "NULL", 4);

214 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

215 
	`”ºo_as£¹
 (
rc
 == 0);

216 
	}
}

218 
	gzmq
::
nuÎ_mechªism_t
::
	$»ûive_ªd_´oûss_z­_»¶y
 ()

220 
rc
 = 0;

221 
msg_t
 
msg
 [7];

224 
i
 = 0; i < 7; i++) {

225 
rc
 = 
msg
 [
i
].
	`š™
 ();

226 
	`”ºo_as£¹
 (
rc
 == 0);

229 
i
 = 0; i < 7; i++) {

230 
rc
 = 
£ssiÚ
->
	`»ad_z­_msg
 (&
msg
 [
i
]);

231 ià(
rc
 == -1)

233 ià((
msg
 [
i
].
	`æags
 (è& 
msg_t
::
mÜe
) == (i < 6? 0: msg_t::more)) {

234 
”ºo
 = 
EPROTO
;

235 
rc
 = -1;

240 ià(
rc
 != 0)

241 
”rÜ
;

244 ià(
msg
 [0].
	`size
 () > 0) {

245 
rc
 = -1;

246 
”ºo
 = 
EPROTO
;

247 
”rÜ
;

251 ià(
msg
 [1].
	`size
 (è!ğ3 || 
	`memcmp
 (msg [1].
	`d©a
 (), "1.0", 3)) {

252 
rc
 = -1;

253 
”ºo
 = 
EPROTO
;

254 
”rÜ
;

258 ià(
msg
 [2].
	`size
 (è!ğ1 || 
	`memcmp
 (msg [2].
	`d©a
 (), "1", 1)) {

259 
rc
 = -1;

260 
”ºo
 = 
EPROTO
;

261 
”rÜ
;

265 ià(
msg
 [3].
	`size
 (è!ğ3 || 
	`memcmp
 (msg [3].
	`d©a
 (), "200", 3)) {

266 
rc
 = -1;

267 
”ºo
 = 
EACCES
;

268 
”rÜ
;

272 
rc
 = 
	`·r£_m‘ad©a
 (
¡©ic_ÿ¡
 <cÚ¡ *> (
msg
 [6].
	`d©a
 ()),

273 
msg
 [6].
	`size
 ());

275 
”rÜ
:

276 
i
 = 0; i < 7; i++) {

277 cÚ¡ 
rc2
 = 
msg
 [
i
].
	`şo£
 ();

278 
	`”ºo_as£¹
 (
rc2
 == 0);

281  
rc
;

282 
	}
}

	@null_mechanism.hpp

20 #iâdeà
__ZMQ_NULL_MECHANISM_HPP_INCLUDED__


21 
	#__ZMQ_NULL_MECHANISM_HPP_INCLUDED__


	)

23 
	~"mechªism.hµ
"

24 
	~"İtiÚs.hµ
"

26 
Çme¥aû
 
	gzmq


29 
şass
 
	gmsg_t
;

30 
şass
 
	g£ssiÚ_ba£_t
;

32 şas 
	cnuÎ_mechªism_t
 : 
public
 
mechªism_t


34 
public
:

36 
nuÎ_mechªism_t
 (
£ssiÚ_ba£_t
 *
£ssiÚ_
,

37 cÚ¡ 
¡d
::
¡ršg
 &
³”_add»ss
,

38 cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

39 
	gvœtu®
 ~
nuÎ_mechªism_t
 ();

42 
vœtu®
 
Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
);

43 
vœtu®
 
´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
);

44 
vœtu®
 
z­_msg_avaabË
 ();

45 
vœtu®
 
boŞ
 
is_hªdshake_com¶‘e
 () const;

47 
	g´iv©e
:

49 
£ssiÚ_ba£_t
 * cÚ¡ 
£ssiÚ
;

51 cÚ¡ 
	g¡d
::
¡ršg
 
³”_add»ss
;

53 
boŞ
 
	g»ady_commªd_£Á
;

54 
boŞ
 
	g»ady_commªd_»ûived
;

55 
boŞ
 
	gz­_cÚÃùed
;

56 
boŞ
 
	gz­_»que¡_£Á
;

57 
boŞ
 
	gz­_»¶y_»ûived
;

59 
£nd_z­_»que¡
 ();

60 
»ûive_ªd_´oûss_z­_»¶y
 ();

	@object.cpp

20 
	~<¡ršg.h
>

21 
	~<¡d¬g.h
>

23 
	~"objeù.hµ
"

24 
	~"ùx.hµ
"

25 
	~"”r.hµ
"

26 
	~"pe.hµ
"

27 
	~"io_th»ad.hµ
"

28 
	~"£ssiÚ_ba£.hµ
"

29 
	~"sock‘_ba£.hµ
"

31 
	gzmq
::
objeù_t
::
	$objeù_t
 (
ùx_t
 *
ùx_
, 
ušt32_t
 
tid_
) :

32 
	`ùx
 (
ùx_
),

33 
	$tid
 (
tid_
)

35 
	}
}

37 
	gzmq
::
objeù_t
::
	$objeù_t
 (
objeù_t
 *
·»Á_
) :

38 
	`ùx
 (
·»Á_
->
ùx
),

39 
	`tid
 (
·»Á_
->
tid
)

41 
	}
}

43 
	gzmq
::
objeù_t
::~
	$objeù_t
 ()

45 
	}
}

47 
ušt32_t
 
zmq
::
objeù_t
::
	$g‘_tid
 ()

49  
tid
;

50 
	}
}

52 
	gzmq
::
objeù_t
::
	$£t_tid
(
ušt32_t
 
id
)

54 
tid
 = 
id
;

55 
	}
}

57 
	gzmq
::
ùx_t
 *
zmq
::
objeù_t
::
	$g‘_ùx
 ()

59  
ùx
;

60 
	}
}

62 
	gzmq
::
objeù_t
::
	$´oûss_commªd
 (
commªd_t
 &
cmd_
)

64 
cmd_
.
ty³
) {

66 
commªd_t
::
aùiv©e_»ad
:

67 
	`´oûss_aùiv©e_»ad
 ();

70 
commªd_t
::
aùiv©e_wr™e
:

71 
	`´oûss_aùiv©e_wr™e
 (
cmd_
.
¬gs
.
aùiv©e_wr™e
.
msgs_»ad
);

74 
commªd_t
::
¡İ
:

75 
	`´oûss_¡İ
 ();

78 
commªd_t
::
¶ug
:

79 
	`´oûss_¶ug
 ();

80 
	`´oûss_£qnum
 ();

83 
commªd_t
::
own
:

84 
	`´oûss_own
 (
cmd_
.
¬gs
.
own
.
objeù
);

85 
	`´oûss_£qnum
 ();

88 
commªd_t
::
©ch
:

89 
	`´oûss_©ch
 (
cmd_
.
¬gs
.
©ch
.
’gše
);

90 
	`´oûss_£qnum
 ();

93 
commªd_t
::
bšd
:

94 
	`´oûss_bšd
 (
cmd_
.
¬gs
.
bšd
.
pe
);

95 
	`´oûss_£qnum
 ();

98 
commªd_t
::
hiccup
:

99 
	`´oûss_hiccup
 (
cmd_
.
¬gs
.
hiccup
.
pe
);

102 
commªd_t
::
pe_‹rm
:

103 
	`´oûss_pe_‹rm
 ();

106 
commªd_t
::
pe_‹rm_ack
:

107 
	`´oûss_pe_‹rm_ack
 ();

110 
commªd_t
::
‹rm_»q
:

111 
	`´oûss_‹rm_»q
 (
cmd_
.
¬gs
.
‹rm_»q
.
objeù
);

114 
commªd_t
::
‹rm
:

115 
	`´oûss_‹rm
 (
cmd_
.
¬gs
.
‹rm
.
lšg”
);

118 
commªd_t
::
‹rm_ack
:

119 
	`´oûss_‹rm_ack
 ();

122 
commªd_t
::
»­
:

123 
	`´oûss_»­
 (
cmd_
.
¬gs
.
»­
.
sock‘
);

126 
commªd_t
::
»­ed
:

127 
	`´oûss_»­ed
 ();

130 
commªd_t
::
š´oc_cÚÃùed
:

131 
	`´oûss_£qnum
 ();

134 
commªd_t
::
dÚe
:

136 
	`zmq_as£¹
 (
çl£
);

138 
	}
}

140 
	gzmq
::
objeù_t
::
	$»gi¡”_’dpošt
 (cÚ¡ *
addr_
, 
’dpošt_t
 &
’dpošt_
)

142  
ùx
->
	`»gi¡”_’dpošt
 (
addr_
, 
’dpošt_
);

143 
	}
}

145 
	gzmq
::
objeù_t
::
	$uÄegi¡”_’dpošts
 (
sock‘_ba£_t
 *
sock‘_
)

147  
ùx
->
	`uÄegi¡”_’dpošts
 (
sock‘_
);

148 
	}
}

150 
	gzmq
::
’dpošt_t
 
zmq
::
objeù_t
::
	$fšd_’dpošt
 (cÚ¡ *
addr_
)

152  
ùx
->
	`fšd_’dpošt
 (
addr_
);

153 
	}
}

155 
	gzmq
::
objeù_t
::
	$³nd_cÚÃùiÚ
 (cÚ¡ *
addr_
, 
³ndšg_cÚÃùiÚ_t
 &
³ndšg_cÚÃùiÚ_
)

157 
ùx
->
	`³nd_cÚÃùiÚ
 (
addr_
, 
³ndšg_cÚÃùiÚ_
);

158 
	}
}

160 
	gzmq
::
objeù_t
::
	$cÚÃù_³ndšg
 (cÚ¡ *
addr_
, 
zmq
::
sock‘_ba£_t
 *
bšd_sock‘_
)

162  
ùx
->
	`cÚÃù_³ndšg
(
addr_
, 
bšd_sock‘_
);

163 
	}
}

165 
	gzmq
::
objeù_t
::
	$de¡roy_sock‘
 (
sock‘_ba£_t
 *
sock‘_
)

167 
ùx
->
	`de¡roy_sock‘
 (
sock‘_
);

168 
	}
}

170 
	gzmq
::
io_th»ad_t
 *
zmq
::
objeù_t
::
	$choo£_io_th»ad
 (
ušt64_t
 
affš™y_
)

172  
ùx
->
	`choo£_io_th»ad
 (
affš™y_
);

173 
	}
}

175 
	gzmq
::
objeù_t
::
	$£nd_¡İ
 ()

179 
commªd_t
 
cmd
;

180 
cmd
.
de¡š©iÚ
 = 
this
;

181 
cmd
.
ty³
 = 
commªd_t
::
¡İ
;

182 
ùx
->
	`£nd_commªd
 (
tid
, 
cmd
);

183 
	}
}

185 
	gzmq
::
objeù_t
::
	$£nd_¶ug
 (
own_t
 *
de¡š©iÚ_
, 
boŞ
 
šc_£qnum_
)

187 ià(
šc_£qnum_
)

188 
de¡š©iÚ_
->
	`šc_£qnum
 ();

190 
commªd_t
 
cmd
;

191 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

192 
cmd
.
ty³
 = 
commªd_t
::
¶ug
;

193 
	`£nd_commªd
 (
cmd
);

194 
	}
}

196 
	gzmq
::
objeù_t
::
	$£nd_own
 (
own_t
 *
de¡š©iÚ_
, own_ˆ*
objeù_
)

198 
de¡š©iÚ_
->
	`šc_£qnum
 ();

199 
commªd_t
 
cmd
;

200 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

201 
cmd
.
ty³
 = 
commªd_t
::
own
;

202 
cmd
.
¬gs
.
own
.
objeù
 = 
objeù_
;

203 
	`£nd_commªd
 (
cmd
);

204 
	}
}

206 
	gzmq
::
objeù_t
::
	$£nd_©ch
 (
£ssiÚ_ba£_t
 *
de¡š©iÚ_
,

207 
i_’gše
 *
’gše_
, 
boŞ
 
šc_£qnum_
)

209 ià(
šc_£qnum_
)

210 
de¡š©iÚ_
->
	`šc_£qnum
 ();

212 
commªd_t
 
cmd
;

213 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

214 
cmd
.
ty³
 = 
commªd_t
::
©ch
;

215 
cmd
.
¬gs
.
©ch
.
’gše
 = 
’gše_
;

216 
	`£nd_commªd
 (
cmd
);

217 
	}
}

219 
	gzmq
::
objeù_t
::
	$£nd_bšd
 (
own_t
 *
de¡š©iÚ_
, 
pe_t
 *
pe_
,

220 
boŞ
 
šc_£qnum_
)

222 ià(
šc_£qnum_
)

223 
de¡š©iÚ_
->
	`šc_£qnum
 ();

225 
commªd_t
 
cmd
;

226 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

227 
cmd
.
ty³
 = 
commªd_t
::
bšd
;

228 
cmd
.
¬gs
.
bšd
.
pe
 = 
pe_
;

229 
	`£nd_commªd
 (
cmd
);

230 
	}
}

232 
	gzmq
::
objeù_t
::
	$£nd_aùiv©e_»ad
 (
pe_t
 *
de¡š©iÚ_
)

234 
commªd_t
 
cmd
;

235 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

236 
cmd
.
ty³
 = 
commªd_t
::
aùiv©e_»ad
;

237 
	`£nd_commªd
 (
cmd
);

238 
	}
}

240 
	gzmq
::
objeù_t
::
	$£nd_aùiv©e_wr™e
 (
pe_t
 *
de¡š©iÚ_
,

241 
ušt64_t
 
msgs_»ad_
)

243 
commªd_t
 
cmd
;

244 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

245 
cmd
.
ty³
 = 
commªd_t
::
aùiv©e_wr™e
;

246 
cmd
.
¬gs
.
aùiv©e_wr™e
.
msgs_»ad
 = 
msgs_»ad_
;

247 
	`£nd_commªd
 (
cmd
);

248 
	}
}

250 
	gzmq
::
objeù_t
::
	$£nd_hiccup
 (
pe_t
 *
de¡š©iÚ_
, *
pe_
)

252 
commªd_t
 
cmd
;

253 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

254 
cmd
.
ty³
 = 
commªd_t
::
hiccup
;

255 
cmd
.
¬gs
.
hiccup
.
pe
 = 
pe_
;

256 
	`£nd_commªd
 (
cmd
);

257 
	}
}

259 
	gzmq
::
objeù_t
::
	$£nd_pe_‹rm
 (
pe_t
 *
de¡š©iÚ_
)

261 
commªd_t
 
cmd
;

262 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

263 
cmd
.
ty³
 = 
commªd_t
::
pe_‹rm
;

264 
	`£nd_commªd
 (
cmd
);

265 
	}
}

267 
	gzmq
::
objeù_t
::
	$£nd_pe_‹rm_ack
 (
pe_t
 *
de¡š©iÚ_
)

269 
commªd_t
 
cmd
;

270 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

271 
cmd
.
ty³
 = 
commªd_t
::
pe_‹rm_ack
;

272 
	`£nd_commªd
 (
cmd
);

273 
	}
}

275 
	gzmq
::
objeù_t
::
	$£nd_‹rm_»q
 (
own_t
 *
de¡š©iÚ_
,

276 
own_t
 *
objeù_
)

278 
commªd_t
 
cmd
;

279 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

280 
cmd
.
ty³
 = 
commªd_t
::
‹rm_»q
;

281 
cmd
.
¬gs
.
‹rm_»q
.
objeù
 = 
objeù_
;

282 
	`£nd_commªd
 (
cmd
);

283 
	}
}

285 
	gzmq
::
objeù_t
::
	$£nd_‹rm
 (
own_t
 *
de¡š©iÚ_
, 
lšg”_
)

287 
commªd_t
 
cmd
;

288 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

289 
cmd
.
ty³
 = 
commªd_t
::
‹rm
;

290 
cmd
.
¬gs
.
‹rm
.
lšg”
 = 
lšg”_
;

291 
	`£nd_commªd
 (
cmd
);

292 
	}
}

294 
	gzmq
::
objeù_t
::
	$£nd_‹rm_ack
 (
own_t
 *
de¡š©iÚ_
)

296 
commªd_t
 
cmd
;

297 
cmd
.
de¡š©iÚ
 = 
de¡š©iÚ_
;

298 
cmd
.
ty³
 = 
commªd_t
::
‹rm_ack
;

299 
	`£nd_commªd
 (
cmd
);

300 
	}
}

302 
	gzmq
::
objeù_t
::
	$£nd_»­
 (
şass
 
sock‘_ba£_t
 *
sock‘_
)

304 
commªd_t
 
cmd
;

305 
cmd
.
de¡š©iÚ
 = 
ùx
->
	`g‘_»­”
 ();

306 
cmd
.
ty³
 = 
commªd_t
::
»­
;

307 
cmd
.
¬gs
.
»­
.
sock‘
 = 
sock‘_
;

308 
	`£nd_commªd
 (
cmd
);

309 
	}
}

311 
	gzmq
::
objeù_t
::
	$£nd_»­ed
 ()

313 
commªd_t
 
cmd
;

314 
cmd
.
de¡š©iÚ
 = 
ùx
->
	`g‘_»­”
 ();

315 
cmd
.
ty³
 = 
commªd_t
::
»­ed
;

316 
	`£nd_commªd
 (
cmd
);

317 
	}
}

319 
	gzmq
::
objeù_t
::
	$£nd_š´oc_cÚÃùed
 (
zmq
::
sock‘_ba£_t
 *
sock‘_
)

321 
commªd_t
 
cmd
;

322 
cmd
.
de¡š©iÚ
 = 
sock‘_
;

323 
cmd
.
ty³
 = 
commªd_t
::
š´oc_cÚÃùed
;

324 
	`£nd_commªd
 (
cmd
);

325 
	}
}

327 
	gzmq
::
objeù_t
::
	$£nd_dÚe
 ()

329 
commªd_t
 
cmd
;

330 
cmd
.
de¡š©iÚ
 = 
NULL
;

331 
cmd
.
ty³
 = 
commªd_t
::
dÚe
;

332 
ùx
->
	`£nd_commªd
 (
ùx_t
::
‹rm_tid
, 
cmd
);

333 
	}
}

335 
	gzmq
::
objeù_t
::
	$´oûss_¡İ
 ()

337 
	`zmq_as£¹
 (
çl£
);

338 
	}
}

340 
	gzmq
::
objeù_t
::
	$´oûss_¶ug
 ()

342 
	`zmq_as£¹
 (
çl£
);

343 
	}
}

345 
	gzmq
::
objeù_t
::
	$´oûss_own
 (
own_t
 *)

347 
	`zmq_as£¹
 (
çl£
);

348 
	}
}

350 
	gzmq
::
objeù_t
::
	$´oûss_©ch
 (
i_’gše
 *)

352 
	`zmq_as£¹
 (
çl£
);

353 
	}
}

355 
	gzmq
::
objeù_t
::
	$´oûss_bšd
 (
pe_t
 *)

357 
	`zmq_as£¹
 (
çl£
);

358 
	}
}

360 
	gzmq
::
objeù_t
::
	$´oûss_aùiv©e_»ad
 ()

362 
	`zmq_as£¹
 (
çl£
);

363 
	}
}

365 
	gzmq
::
objeù_t
::
	$´oûss_aùiv©e_wr™e
 (
ušt64_t
)

367 
	`zmq_as£¹
 (
çl£
);

368 
	}
}

370 
	gzmq
::
objeù_t
::
	$´oûss_hiccup
 (*)

372 
	`zmq_as£¹
 (
çl£
);

373 
	}
}

375 
	gzmq
::
objeù_t
::
	$´oûss_pe_‹rm
 ()

377 
	`zmq_as£¹
 (
çl£
);

378 
	}
}

380 
	gzmq
::
objeù_t
::
	$´oûss_pe_‹rm_ack
 ()

382 
	`zmq_as£¹
 (
çl£
);

383 
	}
}

385 
	gzmq
::
objeù_t
::
	$´oûss_‹rm_»q
 (
own_t
 *)

387 
	`zmq_as£¹
 (
çl£
);

388 
	}
}

390 
	gzmq
::
objeù_t
::
	$´oûss_‹rm
 ()

392 
	`zmq_as£¹
 (
çl£
);

393 
	}
}

395 
	gzmq
::
objeù_t
::
	$´oûss_‹rm_ack
 ()

397 
	`zmq_as£¹
 (
çl£
);

398 
	}
}

400 
	gzmq
::
objeù_t
::
	$´oûss_»­
 (
şass
 
sock‘_ba£_t
 *)

402 
	`zmq_as£¹
 (
çl£
);

403 
	}
}

405 
	gzmq
::
objeù_t
::
	$´oûss_»­ed
 ()

407 
	`zmq_as£¹
 (
çl£
);

408 
	}
}

410 
	gzmq
::
objeù_t
::
	$´oûss_£qnum
 ()

412 
	`zmq_as£¹
 (
çl£
);

413 
	}
}

415 
	gzmq
::
objeù_t
::
	$£nd_commªd
 (
commªd_t
 &
cmd_
)

417 
ùx
->
	`£nd_commªd
 (
cmd_
.
de¡š©iÚ
->
	`g‘_tid
 (), cmd_);

418 
	}
}

	@object.hpp

20 #iâdeà
__ZMQ_OBJECT_HPP_INCLUDED__


21 
	#__ZMQ_OBJECT_HPP_INCLUDED__


	)

23 
	~"¡dšt.hµ
"

25 
Çme¥aû
 
	gzmq


28 
	gi_’gše
;

29 
	g’dpošt_t
;

30 
	g³ndšg_cÚÃùiÚ_t
;

31 
	gcommªd_t
;

32 
şass
 
	gùx_t
;

33 
şass
 
	gpe_t
;

34 
şass
 
	gsock‘_ba£_t
;

35 
şass
 
	g£ssiÚ_ba£_t
;

36 
şass
 
	gio_th»ad_t
;

37 
şass
 
	gown_t
;

42 şas 
	cobjeù_t


44 
	gpublic
:

46 
objeù_t
 (
zmq
::
ùx_t
 *
ùx_
, 
ušt32_t
 
tid_
);

47 
objeù_t
 (objeù_ˆ*
·»Á_
);

48 
	gvœtu®
 ~
objeù_t
 ();

50 
ušt32_t
 
g‘_tid
 ();

51 
£t_tid
(
ušt32_t
 
id
);

52 
ùx_t
 *
g‘_ùx
 ();

53 
´oûss_commªd
 (
zmq
::
commªd_t
 &
cmd_
);

54 
£nd_š´oc_cÚÃùed
 (
zmq
::
sock‘_ba£_t
 *
sock‘_
);

55 
£nd_bšd
 (
zmq
::
own_t
 *
de¡š©iÚ_
, zmq::
pe_t
 *
pe_
, 
boŞ
 
šc_£qnum_
 = 
Œue
);

57 
	g´Ùeùed
:

61 
»gi¡”_’dpošt
 (cÚ¡ *
addr_
, 
zmq
::
’dpošt_t
 &
’dpošt_
);

62 
uÄegi¡”_’dpošts
 (
zmq
::
sock‘_ba£_t
 *
sock‘_
);

63 
	gzmq
::
’dpošt_t
 
fšd_’dpošt
 (cÚ¡ *
addr_
);

64 
³nd_cÚÃùiÚ
 (cÚ¡ *
addr_
, 
³ndšg_cÚÃùiÚ_t
 &
³ndšg_cÚÃùiÚ_
);

65 
cÚÃù_³ndšg
 (cÚ¡ *
addr_
, 
zmq
::
sock‘_ba£_t
 *
bšd_sock‘_
);

67 
de¡roy_sock‘
 (
zmq
::
sock‘_ba£_t
 *
sock‘_
);

70 
log
 (cÚ¡ *
fÜm©_
, ...);

73 
	gzmq
::
io_th»ad_t
 *
choo£_io_th»ad
 (
ušt64_t
 
affš™y_
);

77 
£nd_¡İ
 ();

78 
£nd_¶ug
 (
zmq
::
own_t
 *
de¡š©iÚ_
,

79 
boŞ
 
šc_£qnum_
 = 
Œue
);

80 
£nd_own
 (
zmq
::
own_t
 *
de¡š©iÚ_
,

81 
zmq
::
own_t
 *
objeù_
);

82 
£nd_©ch
 (
zmq
::
£ssiÚ_ba£_t
 *
de¡š©iÚ_
,

83 
zmq
::
i_’gše
 *
’gše_
, 
boŞ
 
šc_£qnum_
 = 
Œue
);

84 
£nd_aùiv©e_»ad
 (
zmq
::
pe_t
 *
de¡š©iÚ_
);

85 
£nd_aùiv©e_wr™e
 (
zmq
::
pe_t
 *
de¡š©iÚ_
,

86 
ušt64_t
 
msgs_»ad_
);

87 
£nd_hiccup
 (
zmq
::
pe_t
 *
de¡š©iÚ_
, *
pe_
);

88 
£nd_pe_‹rm
 (
zmq
::
pe_t
 *
de¡š©iÚ_
);

89 
£nd_pe_‹rm_ack
 (
zmq
::
pe_t
 *
de¡š©iÚ_
);

90 
£nd_‹rm_»q
 (
zmq
::
own_t
 *
de¡š©iÚ_
,

91 
zmq
::
own_t
 *
objeù_
);

92 
£nd_‹rm
 (
zmq
::
own_t
 *
de¡š©iÚ_
, 
lšg”_
);

93 
£nd_‹rm_ack
 (
zmq
::
own_t
 *
de¡š©iÚ_
);

94 
£nd_»­
 (
zmq
::
sock‘_ba£_t
 *
sock‘_
);

95 
£nd_»­ed
 ();

96 
£nd_dÚe
 ();

100 
vœtu®
 
´oûss_¡İ
 ();

101 
vœtu®
 
´oûss_¶ug
 ();

102 
vœtu®
 
´oûss_own
 (
zmq
::
own_t
 *
objeù_
);

103 
vœtu®
 
´oûss_©ch
 (
zmq
::
i_’gše
 *
’gše_
);

104 
vœtu®
 
´oûss_bšd
 (
zmq
::
pe_t
 *
pe_
);

105 
vœtu®
 
´oûss_aùiv©e_»ad
 ();

106 
vœtu®
 
´oûss_aùiv©e_wr™e
 (
ušt64_t
 
msgs_»ad_
);

107 
vœtu®
 
´oûss_hiccup
 (*
pe_
);

108 
vœtu®
 
´oûss_pe_‹rm
 ();

109 
vœtu®
 
´oûss_pe_‹rm_ack
 ();

110 
vœtu®
 
´oûss_‹rm_»q
 (
zmq
::
own_t
 *
objeù_
);

111 
vœtu®
 
´oûss_‹rm
 (
lšg”_
);

112 
vœtu®
 
´oûss_‹rm_ack
 ();

113 
vœtu®
 
´oûss_»­
 (
zmq
::
sock‘_ba£_t
 *
sock‘_
);

114 
vœtu®
 
´oûss_»­ed
 ();

119 
vœtu®
 
´oûss_£qnum
 ();

121 
	g´iv©e
:

124 
zmq
::
ùx_t
 *
ùx
;

127 
ušt32_t
 
	gtid
;

129 
£nd_commªd
 (
commªd_t
 &
cmd_
);

131 
objeù_t
 (const object_t&);

132 cÚ¡ 
	gobjeù_t
 &
	gİ”©Ü
 = (cÚ¡ 
objeù_t
&);

	@options.cpp

20 
	~<¡ršg.h
>

22 
	~"İtiÚs.hµ
"

23 
	~"”r.hµ
"

24 
	~"../šşude/zmq_uts.h
"

26 
	gzmq
::
İtiÚs_t
::
	$İtiÚs_t
 () :

27 
	`¢dhwm
 (1000),

28 
	`rcvhwm
 (1000),

29 
	`affš™y
 (0),

30 
	`id’t™y_size
 (0),

31 
	`¿‹
 (100),

32 
	`»cov”y_ivl
 (10000),

33 
	`muÉiÿ¡_hİs
 (1),

34 
	`¢dbuf
 (0),

35 
	`rcvbuf
 (0),

36 
	`ty³
 (-1),

37 
	`lšg”
 (-1),

38 
	`»cÚÃù_ivl
 (100),

39 
	`»cÚÃù_ivl_max
 (0),

40 
	`backlog
 (100),

41 
	`maxmsgsize
 (-1),

42 
	`rcvtimeo
 (-1),

43 
	`¢dtimeo
 (-1),

44 
	`v6
 (0),

45 
	`immedŸ‹
 (0),

46 
	`f‹r
 (
çl£
),

47 
	`»cv_id’t™y
 (
çl£
),

48 
	`¿w_sock
 (
çl£
),

49 
	`tı_k“·live
 (-1),

50 
	`tı_k“·live_út
 (-1),

51 
	`tı_k“·live_idË
 (-1),

52 
	`tı_k“·live_štvl
 (-1),

53 
	`mechªism
 (
ZMQ_NULL
),

54 
	`as_£rv”
 (0),

55 
	`sock‘_id
 (0),

56 
	$cÚæ©e
 (
çl£
)

58 
	}
}

60 
	gzmq
::
İtiÚs_t
::
	$£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
,

61 
size_t
 
İtv®Ën_
)

63 
boŞ
 
is_št
 = (
İtv®Ën_
 ==  ());

64 
v®ue
 = 
is_št
? *((*è
İtv®_
): 0;

66 
İtiÚ_
) {

67 
ZMQ_SNDHWM
:

68 ià(
is_št
 && 
v®ue
 >= 0) {

69 
¢dhwm
 = 
v®ue
;

74 
ZMQ_RCVHWM
:

75 ià(
is_št
 && 
v®ue
 >= 0) {

76 
rcvhwm
 = 
v®ue
;

81 
ZMQ_AFFINITY
:

82 ià(
İtv®Ën_
 =ğ (
ušt64_t
)) {

83 
affš™y
 = *((
ušt64_t
*è
İtv®_
);

88 
ZMQ_IDENTITY
:

92 ià(
İtv®Ën_
 > 0 && optvallen_ < 256

93 && *((cÚ¡ *è
İtv®_
) != 0) {

94 
id’t™y_size
 = 
İtv®Ën_
;

95 
	`memıy
 (
id’t™y
, 
İtv®_
, 
id’t™y_size
);

100 
ZMQ_RATE
:

101 ià(
is_št
 && 
v®ue
 > 0) {

102 
¿‹
 = 
v®ue
;

107 
ZMQ_RECOVERY_IVL
:

108 ià(
is_št
 && 
v®ue
 >= 0) {

109 
»cov”y_ivl
 = 
v®ue
;

114 
ZMQ_SNDBUF
:

115 ià(
is_št
 && 
v®ue
 >= 0) {

116 
¢dbuf
 = 
v®ue
;

121 
ZMQ_RCVBUF
:

122 ià(
is_št
 && 
v®ue
 >= 0) {

123 
rcvbuf
 = 
v®ue
;

128 
ZMQ_LINGER
:

129 ià(
is_št
 && 
v®ue
 >= -1) {

130 
lšg”
 = 
v®ue
;

135 
ZMQ_RECONNECT_IVL
:

136 ià(
is_št
 && 
v®ue
 >= -1) {

137 
»cÚÃù_ivl
 = 
v®ue
;

142 
ZMQ_RECONNECT_IVL_MAX
:

143 ià(
is_št
 && 
v®ue
 >= 0) {

144 
»cÚÃù_ivl_max
 = 
v®ue
;

149 
ZMQ_BACKLOG
:

150 ià(
is_št
 && 
v®ue
 >= 0) {

151 
backlog
 = 
v®ue
;

156 
ZMQ_MAXMSGSIZE
:

157 ià(
İtv®Ën_
 =ğ (
št64_t
)) {

158 
maxmsgsize
 = *((
št64_t
 *è
İtv®_
);

163 
ZMQ_MULTICAST_HOPS
:

164 ià(
is_št
 && 
v®ue
 > 0) {

165 
muÉiÿ¡_hİs
 = 
v®ue
;

170 
ZMQ_RCVTIMEO
:

171 ià(
is_št
 && 
v®ue
 >= -1) {

172 
rcvtimeo
 = 
v®ue
;

177 
ZMQ_SNDTIMEO
:

178 ià(
is_št
 && 
v®ue
 >= -1) {

179 
¢dtimeo
 = 
v®ue
;

185 
ZMQ_IPV4ONLY
:

186 ià(
is_št
 && (
v®ue
 == 0 || value == 1)) {

187 
v6
 = (
v®ue
 == 0);

193 
ZMQ_IPV6
:

194 ià(
is_št
 && (
v®ue
 == 0 || value == 1)) {

195 
v6
 = (
v®ue
 != 0);

200 
ZMQ_TCP_KEEPALIVE
:

201 ià(
is_št
 && (
v®ue
 >= -1 || value <= 1)) {

202 
tı_k“·live
 = 
v®ue
;

207 
ZMQ_TCP_KEEPALIVE_CNT
:

208 ià(
is_št
 && (
v®ue
 == -1 || value >= 0)) {

209 
tı_k“·live_út
 = 
v®ue
;

214 
ZMQ_TCP_KEEPALIVE_IDLE
:

215 ià(
is_št
 && (
v®ue
 == -1 || value >= 0)) {

216 
tı_k“·live_idË
 = 
v®ue
;

221 
ZMQ_TCP_KEEPALIVE_INTVL
:

222 ià(
is_št
 && (
v®ue
 == -1 || value >= 0)) {

223 
tı_k“·live_štvl
 = 
v®ue
;

228 
ZMQ_IMMEDIATE
:

229 ià(
is_št
 && (
v®ue
 == 0 || value == 1)) {

230 
immedŸ‹
 = 
v®ue
;

235 
ZMQ_TCP_ACCEPT_FILTER
:

236 ià(
İtv®Ën_
 =ğ0 && 
İtv®_
 =ğ
NULL
) {

237 
tı_acû±_f‹rs
.
	`ş—r
 ();

241 ià(
İtv®Ën_
 > 0 && o±v®Ën_ < 256 && 
İtv®_
 !ğ
NULL
 && *((const *) optval_) != 0) {

242 
¡d
::
¡ršg
 
	`f‹r_¡r
 ((cÚ¡ *è
İtv®_
, 
İtv®Ën_
);

243 
tı_add»ss_mask_t
 
mask
;

244 
rc
 = 
mask
.
	`»sŞve
 (
f‹r_¡r
.
	`c_¡r
 (), 
v6
);

245 ià(
rc
 == 0) {

246 
tı_acû±_f‹rs
.
	`push_back
 (
mask
);

252 
ZMQ_PLAIN_SERVER
:

253 ià(
is_št
 && (
v®ue
 == 0 || value == 1)) {

254 
as_£rv”
 = 
v®ue
;

255 
mechªism
 = 
v®ue
? 
ZMQ_PLAIN
: 
ZMQ_NULL
;

260 
ZMQ_PLAIN_USERNAME
:

261 ià(
İtv®Ën_
 =ğ0 && 
İtv®_
 =ğ
NULL
) {

262 
mechªism
 = 
ZMQ_NULL
;

266 ià(
İtv®Ën_
 > 0 && o±v®Ën_ < 256 && 
İtv®_
 !ğ
NULL
) {

267 
¶aš_u£ºame
.
	`assign
 ((cÚ¡ *è
İtv®_
, 
İtv®Ën_
);

268 
as_£rv”
 = 0;

269 
mechªism
 = 
ZMQ_PLAIN
;

274 
ZMQ_PLAIN_PASSWORD
:

275 ià(
İtv®Ën_
 =ğ0 && 
İtv®_
 =ğ
NULL
) {

276 
mechªism
 = 
ZMQ_NULL
;

280 ià(
İtv®Ën_
 > 0 && o±v®Ën_ < 256 && 
İtv®_
 !ğ
NULL
) {

281 
¶aš_·sswÜd
.
	`assign
 ((cÚ¡ *è
İtv®_
, 
İtv®Ën_
);

282 
as_£rv”
 = 0;

283 
mechªism
 = 
ZMQ_PLAIN
;

288 
ZMQ_ZAP_DOMAIN
:

289 ià(
İtv®Ën_
 < 256) {

290 
z­_domaš
.
	`assign
 ((cÚ¡ *è
İtv®_
, 
İtv®Ën_
);

296 #ifdeà
HAVE_LIBSODIUM


297 
ZMQ_CURVE_SERVER
:

298 ià(
is_št
 && (
v®ue
 == 0 || value == 1)) {

299 
as_£rv”
 = 
v®ue
;

300 
mechªism
 = 
v®ue
? 
ZMQ_CURVE
: 
ZMQ_NULL
;

305 
ZMQ_CURVE_PUBLICKEY
:

306 ià(
İtv®Ën_
 =ğ
CURVE_KEYSIZE
) {

307 
	`memıy
 (
curve_public_key
, 
İtv®_
, 
CURVE_KEYSIZE
);

308 
mechªism
 = 
ZMQ_CURVE
;

312 ià(
İtv®Ën_
 =ğ
CURVE_KEYSIZE_Z85
) {

313 
	`zmq_z85_decode
 (
curve_public_key
, (*è
İtv®_
);

314 
mechªism
 = 
ZMQ_CURVE
;

319 
ZMQ_CURVE_SECRETKEY
:

320 ià(
İtv®Ën_
 =ğ
CURVE_KEYSIZE
) {

321 
	`memıy
 (
curve_£ü‘_key
, 
İtv®_
, 
CURVE_KEYSIZE
);

322 
mechªism
 = 
ZMQ_CURVE
;

326 ià(
İtv®Ën_
 =ğ
CURVE_KEYSIZE_Z85
) {

327 
	`zmq_z85_decode
 (
curve_£ü‘_key
, (*è
İtv®_
);

328 
mechªism
 = 
ZMQ_CURVE
;

333 
ZMQ_CURVE_SERVERKEY
:

334 ià(
İtv®Ën_
 =ğ
CURVE_KEYSIZE
) {

335 
	`memıy
 (
curve_£rv”_key
, 
İtv®_
, 
CURVE_KEYSIZE
);

336 
as_£rv”
 = 0;

337 
mechªism
 = 
ZMQ_CURVE
;

341 ià(
İtv®Ën_
 =ğ
CURVE_KEYSIZE_Z85
) {

342 
	`zmq_z85_decode
 (
curve_£rv”_key
, (*è
İtv®_
);

343 
as_£rv”
 = 0;

344 
mechªism
 = 
ZMQ_CURVE
;

350 
ZMQ_CONFLATE
:

351 ià(
is_št
 && (
v®ue
 == 0 || value == 1)) {

352 
cÚæ©e
 = (
v®ue
 != 0);

360 
”ºo
 = 
EINVAL
;

362 
	}
}

364 
	gzmq
::
İtiÚs_t
::
	$g‘sockİt
 (
İtiÚ_
, *
İtv®_
, 
size_t
 *
İtv®Ën_
)

366 
boŞ
 
is_št
 = (*
İtv®Ën_
 ==  ());

367 *
v®ue
 = (*è
İtv®_
;

369 
İtiÚ_
) {

370 
ZMQ_SNDHWM
:

371 ià(
is_št
) {

372 *
v®ue
 = 
¢dhwm
;

377 
ZMQ_RCVHWM
:

378 ià(
is_št
) {

379 *
v®ue
 = 
rcvhwm
;

384 
ZMQ_AFFINITY
:

385 ià(*
İtv®Ën_
 =ğ (
ušt64_t
)) {

386 *((
ušt64_t
 *è
İtv®_
èğ
affš™y
;

391 
ZMQ_IDENTITY
:

392 ià(*
İtv®Ën_
 >ğ
id’t™y_size
) {

393 
	`memıy
 (
İtv®_
, 
id’t™y
, 
id’t™y_size
);

394 *
İtv®Ën_
 = 
id’t™y_size
;

399 
ZMQ_RATE
:

400 ià(
is_št
) {

401 *
v®ue
 = 
¿‹
;

406 
ZMQ_RECOVERY_IVL
:

407 ià(
is_št
) {

408 *
v®ue
 = 
»cov”y_ivl
;

413 
ZMQ_SNDBUF
:

414 ià(
is_št
) {

415 *
v®ue
 = 
¢dbuf
;

420 
ZMQ_RCVBUF
:

421 ià(
is_št
) {

422 *
v®ue
 = 
rcvbuf
;

427 
ZMQ_TYPE
:

428 ià(
is_št
) {

429 *
v®ue
 = 
ty³
;

434 
ZMQ_LINGER
:

435 ià(
is_št
) {

436 *
v®ue
 = 
lšg”
;

441 
ZMQ_RECONNECT_IVL
:

442 ià(
is_št
) {

443 *
v®ue
 = 
»cÚÃù_ivl
;

448 
ZMQ_RECONNECT_IVL_MAX
:

449 ià(
is_št
) {

450 *
v®ue
 = 
»cÚÃù_ivl_max
;

455 
ZMQ_BACKLOG
:

456 ià(
is_št
) {

457 *
v®ue
 = 
backlog
;

462 
ZMQ_MAXMSGSIZE
:

463 ià(*
İtv®Ën_
 =ğ (
št64_t
)) {

464 *((
št64_t
 *è
İtv®_
èğ
maxmsgsize
;

465 *
İtv®Ën_
 =  (
št64_t
);

470 
ZMQ_MULTICAST_HOPS
:

471 ià(
is_št
) {

472 *
v®ue
 = 
muÉiÿ¡_hİs
;

477 
ZMQ_RCVTIMEO
:

478 ià(
is_št
) {

479 *
v®ue
 = 
rcvtimeo
;

484 
ZMQ_SNDTIMEO
:

485 ià(
is_št
) {

486 *
v®ue
 = 
¢dtimeo
;

491 
ZMQ_IPV4ONLY
:

492 ià(
is_št
) {

493 *
v®ue
 = 1 - 
v6
;

498 
ZMQ_IPV6
:

499 ià(
is_št
) {

500 *
v®ue
 = 
v6
;

505 
ZMQ_IMMEDIATE
:

506 ià(
is_št
) {

507 *
v®ue
 = 
immedŸ‹
;

512 
ZMQ_TCP_KEEPALIVE
:

513 ià(
is_št
) {

514 *
v®ue
 = 
tı_k“·live
;

519 
ZMQ_TCP_KEEPALIVE_CNT
:

520 ià(
is_št
) {

521 *
v®ue
 = 
tı_k“·live_út
;

526 
ZMQ_TCP_KEEPALIVE_IDLE
:

527 ià(
is_št
) {

528 *
v®ue
 = 
tı_k“·live_idË
;

533 
ZMQ_TCP_KEEPALIVE_INTVL
:

534 ià(
is_št
) {

535 *
v®ue
 = 
tı_k“·live_štvl
;

540 
ZMQ_MECHANISM
:

541 ià(
is_št
) {

542 *
v®ue
 = 
mechªism
;

547 
ZMQ_PLAIN_SERVER
:

548 ià(
is_št
) {

549 *
v®ue
 = 
as_£rv”
 && 
mechªism
 =ğ
ZMQ_PLAIN
;

554 
ZMQ_PLAIN_USERNAME
:

555 ià(*
İtv®Ën_
 >ğ
¶aš_u£ºame
.
	`size
 () + 1) {

556 
	`memıy
 (
İtv®_
, 
¶aš_u£ºame
.
	`c_¡r
 (),…Ïš_u£ºame.
	`size
 () + 1);

557 *
İtv®Ën_
 = 
¶aš_u£ºame
.
	`size
 () + 1;

562 
ZMQ_PLAIN_PASSWORD
:

563 ià(*
İtv®Ën_
 >ğ
¶aš_·sswÜd
.
	`size
 () + 1) {

564 
	`memıy
 (
İtv®_
, 
¶aš_·sswÜd
.
	`c_¡r
 (),…Ïš_·sswÜd.
	`size
 () + 1);

565 *
İtv®Ën_
 = 
¶aš_·sswÜd
.
	`size
 () + 1;

570 
ZMQ_ZAP_DOMAIN
:

571 ià(*
İtv®Ën_
 >ğ
z­_domaš
.
	`size
 () + 1) {

572 
	`memıy
 (
İtv®_
, 
z­_domaš
.
	`c_¡r
 (), z­_domaš.
	`size
 () + 1);

573 *
İtv®Ën_
 = 
z­_domaš
.
	`size
 () + 1;

579 #ifdeà
HAVE_LIBSODIUM


580 
ZMQ_CURVE_SERVER
:

581 ià(
is_št
) {

582 *
v®ue
 = 
as_£rv”
 && 
mechªism
 =ğ
ZMQ_CURVE
;

587 
ZMQ_CURVE_PUBLICKEY
:

588 ià(*
İtv®Ën_
 =ğ
CURVE_KEYSIZE
) {

589 
	`memıy
 (
İtv®_
, 
curve_public_key
, 
CURVE_KEYSIZE
);

593 ià(*
İtv®Ën_
 =ğ
CURVE_KEYSIZE_Z85
 + 1) {

594 
	`zmq_z85_’code
 ((*è
İtv®_
, 
curve_public_key
, 
CURVE_KEYSIZE
);

599 
ZMQ_CURVE_SECRETKEY
:

600 ià(*
İtv®Ën_
 =ğ
CURVE_KEYSIZE
) {

601 
	`memıy
 (
İtv®_
, 
curve_£ü‘_key
, 
CURVE_KEYSIZE
);

605 ià(*
İtv®Ën_
 =ğ
CURVE_KEYSIZE_Z85
 + 1) {

606 
	`zmq_z85_’code
 ((*è
İtv®_
, 
curve_£ü‘_key
, 
CURVE_KEYSIZE
);

611 
ZMQ_CURVE_SERVERKEY
:

612 ià(*
İtv®Ën_
 =ğ
CURVE_KEYSIZE
) {

613 
	`memıy
 (
İtv®_
, 
curve_£rv”_key
, 
CURVE_KEYSIZE
);

617 ià(*
İtv®Ën_
 =ğ
CURVE_KEYSIZE_Z85
 + 1) {

618 
	`zmq_z85_’code
 ((*è
İtv®_
, 
curve_£rv”_key
, 
CURVE_KEYSIZE
);

624 
ZMQ_CONFLATE
:

625 ià(
is_št
) {

626 *
v®ue
 = 
cÚæ©e
;

632 
”ºo
 = 
EINVAL
;

634 
	}
}

	@options.hpp

20 #iâdeà
__ZMQ_OPTIONS_HPP_INCLUDED__


21 
	#__ZMQ_OPTIONS_HPP_INCLUDED__


	)

23 
	~<¡ršg
>

24 
	~<veùÜ
>

26 
	~"¡ddef.h
"

27 
	~"¡dšt.hµ
"

28 
	~"tı_add»ss.hµ
"

29 
	~"../šşude/zmq.h
"

32 
	#CURVE_KEYSIZE
 32

	)

34 
	#CURVE_KEYSIZE_Z85
 40

	)

36 
Çme¥aû
 
	gzmq


38 
	sİtiÚs_t


40 
İtiÚs_t
 ();

42 
£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
, 
size_t
 
İtv®Ën_
);

43 
g‘sockİt
 (
İtiÚ_
, *
İtv®_
, 
size_t
 *
İtv®Ën_
);

46 
	g¢dhwm
;

47 
	grcvhwm
;

50 
ušt64_t
 
	gaffš™y
;

53 
	gid’t™y_size
;

54 
	gid’t™y
 [256];

57 
	g¿‹
;

60 
	g»cov”y_ivl
;

63 
	gmuÉiÿ¡_hİs
;

66 
	g¢dbuf
;

67 
	grcvbuf
;

70 
	gty³
;

73 
	glšg”
;

77 
	g»cÚÃù_ivl
;

81 
	g»cÚÃù_ivl_max
;

84 
	gbacklog
;

87 
št64_t
 
	gmaxmsgsize
;

90 
	grcvtimeo
;

91 
	g¢dtimeo
;

94 
boŞ
 
	gv6
;

98 
	gimmedŸ‹
;

101 
boŞ
 
	gf‹r
;

104 
boŞ
 
	g»cv_id’t™y
;

107 
boŞ
 
	g¿w_sock
;

111 
	gtı_k“·live
;

112 
	gtı_k“·live_út
;

113 
	gtı_k“·live_idË
;

114 
	gtı_k“·live_štvl
;

117 
	g¡d
::
	tveùÜ
 <
	ttı_add»ss_mask_t
> 
	ttı_acû±_f‹rs_t
;

118 
tı_acû±_f‹rs_t
 
	gtı_acû±_f‹rs
;

121 
	gmechªism
;

124 
	gas_£rv”
;

127 
	g¡d
::
¡ršg
 
z­_domaš
;

130 
	g¡d
::
¡ršg
 
¶aš_u£ºame
;

131 
	g¡d
::
¡ršg
 
¶aš_·sswÜd
;

134 
ušt8_t
 
	gcurve_public_key
 [
CURVE_KEYSIZE
];

135 
ušt8_t
 
	gcurve_£ü‘_key
 [
CURVE_KEYSIZE
];

136 
ušt8_t
 
	gcurve_£rv”_key
 [
CURVE_KEYSIZE
];

139 
	gsock‘_id
;

145 
boŞ
 
	gcÚæ©e
;

	@own.cpp

20 
	~"own.hµ
"

21 
	~"”r.hµ
"

22 
	~"io_th»ad.hµ
"

24 
	gzmq
::
own_t
::
	$own_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
) :

25 
	`objeù_t
 (
·»Á_
, 
tid_
),

26 
	`‹rmš©šg
 (
çl£
),

27 
	`£Á_£qnum
 (0),

28 
	`´oûs£d_£qnum
 (0),

29 
	`owÃr
 (
NULL
),

30 
	$‹rm_acks
 (0)

32 
	}
}

34 
	gzmq
::
own_t
::
	$own_t
 (
io_th»ad_t
 *
io_th»ad_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

35 
	`objeù_t
 (
io_th»ad_
),

36 
	`İtiÚs
 (
İtiÚs_
),

37 
	`‹rmš©šg
 (
çl£
),

38 
	`£Á_£qnum
 (0),

39 
	`´oûs£d_£qnum
 (0),

40 
	`owÃr
 (
NULL
),

41 
	$‹rm_acks
 (0)

43 
	}
}

45 
	gzmq
::
own_t
::~
	$own_t
 ()

47 
	}
}

49 
zmq
::
own_t
::
	$£t_owÃr
 (
own_t
 *
owÃr_
)

51 
	`zmq_as£¹
 (!
owÃr
);

52 
owÃr
 = 
owÃr_
;

53 
	}
}

55 
	gzmq
::
own_t
::
	$šc_£qnum
 ()

58 
£Á_£qnum
.
	`add
 (1);

59 
	}
}

61 
	gzmq
::
own_t
::
	$´oûss_£qnum
 ()

64 
´oûs£d_£qnum
++;

67 
	`check_‹rm_acks
 ();

68 
	}
}

70 
	gzmq
::
own_t
::
	$Ïunch_chd
 (
own_t
 *
objeù_
)

73 
objeù_
->
	`£t_owÃr
 (
this
);

76 
	`£nd_¶ug
 (
objeù_
);

79 
	`£nd_own
 (
this
, 
objeù_
);

80 
	}
}

82 
	gzmq
::
own_t
::
	$‹rm_chd
 (
own_t
 *
objeù_
)

84 
	`´oûss_‹rm_»q
 (
objeù_
);

85 
	}
}

87 
	gzmq
::
own_t
::
	$´oûss_‹rm_»q
 (
own_t
 *
objeù_
)

91 ià(
‹rmš©šg
)

95 
owÃd_t
::
™”©Ü
 
™
 = 
¡d
::
	`fšd
 (
owÃd
.
	`begš
 (), owÃd.
	`’d
 (), 
objeù_
);

99 ià(
™
 =ğ
owÃd
.
	`’d
 ())

102 
owÃd
.
	`”a£
 (
™
);

103 
	`»gi¡”_‹rm_acks
 (1);

107 
	`£nd_‹rm
 (
objeù_
, 
İtiÚs
.
lšg”
);

108 
	}
}

110 
	gzmq
::
own_t
::
	$´oûss_own
 (
own_t
 *
objeù_
)

114 ià(
‹rmš©šg
) {

115 
	`»gi¡”_‹rm_acks
 (1);

116 
	`£nd_‹rm
 (
objeù_
, 0);

121 
owÃd
.
	`š£¹
 (
objeù_
);

122 
	}
}

124 
	gzmq
::
own_t
::
	$‹rmš©e
 ()

128 ià(
‹rmš©šg
)

133 ià(!
owÃr
) {

134 
	`´oûss_‹rm
 (
İtiÚs
.
lšg”
);

139 
	`£nd_‹rm_»q
 (
owÃr
, 
this
);

140 
	}
}

142 
boŞ
 
	gzmq
::
own_t
::
	$is_‹rmš©šg
 ()

144  
‹rmš©šg
;

145 
	}
}

147 
	gzmq
::
own_t
::
	$´oûss_‹rm
 (
lšg”_
)

150 
	`zmq_as£¹
 (!
‹rmš©šg
);

153 
owÃd_t
::
™”©Ü
 
™
 = 
owÃd
.
	`begš
 (); iˆ!ğowÃd.
	`’d
 (); ++it)

154 
	`£nd_‹rm
 (*
™
, 
lšg”_
);

155 
	`»gi¡”_‹rm_acks
 ((è
owÃd
.
	`size
 ());

156 
owÃd
.
	`ş—r
 ();

160 
‹rmš©šg
 = 
Œue
;

161 
	`check_‹rm_acks
 ();

162 
	}
}

164 
	gzmq
::
own_t
::
	$»gi¡”_‹rm_acks
 (
couÁ_
)

166 
‹rm_acks
 +ğ
couÁ_
;

167 
	}
}

169 
	gzmq
::
own_t
::
	$uÄegi¡”_‹rm_ack
 ()

171 
	`zmq_as£¹
 (
‹rm_acks
 > 0);

172 
‹rm_acks
--;

175 
	`check_‹rm_acks
 ();

176 
	}
}

178 
	gzmq
::
own_t
::
	$´oûss_‹rm_ack
 ()

180 
	`uÄegi¡”_‹rm_ack
 ();

181 
	}
}

183 
	gzmq
::
own_t
::
	$check_‹rm_acks
 ()

185 ià(
‹rmš©šg
 && 
´oûs£d_£qnum
 =ğ
£Á_£qnum
.
	`g‘
 () &&

186 
‹rm_acks
 == 0) {

189 
	`zmq_as£¹
 (
owÃd
.
	`em±y
 ());

193 ià(
owÃr
)

194 
	`£nd_‹rm_ack
 (
owÃr
);

197 
	`´oûss_de¡roy
 ();

199 
	}
}

201 
	gzmq
::
own_t
::
	$´oûss_de¡roy
 ()

203 
d–‘e
 
this
;

204 
	}
}

	@own.hpp

20 #iâdeà
__ZMQ_OWN_HPP_INCLUDED__


21 
	#__ZMQ_OWN_HPP_INCLUDED__


	)

23 
	~<£t
>

24 
	~<®gÜ™hm
>

26 
	~"objeù.hµ
"

27 
	~"İtiÚs.hµ
"

28 
	~"©omic_couÁ”.hµ
"

29 
	~"¡dšt.hµ
"

31 
Çme¥aû
 
	gzmq


34 
şass
 
	gùx_t
;

35 
şass
 
	gio_th»ad_t
;

40 şas 
	cown_t
 : 
public
 
objeù_t


42 
public
:

49 
own_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
);

52 
own_t
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

57 
šc_£qnum
 ();

64 
»gi¡”_‹rm_acks
 (
couÁ_
);

65 
uÄegi¡”_‹rm_ack
 ();

67 
	g´Ùeùed
:

70 
Ïunch_chd
 (
own_t
 *
objeù_
);

73 
‹rm_chd
 (
own_t
 *
objeù_
);

78 
‹rmš©e
 ();

81 
boŞ
 
is_‹rmš©šg
 ();

87 
	gvœtu®
 ~
own_t
 ();

92 
´oûss_‹rm
 (
lšg”_
);

96 
vœtu®
 
´oûss_de¡roy
 ();

99 
İtiÚs_t
 
	gİtiÚs
;

101 
	g´iv©e
:

104 
£t_owÃr
 (
own_t
 *
owÃr_
);

107 
´oûss_own
 (
own_t
 *
objeù_
);

108 
´oûss_‹rm_»q
 (
own_t
 *
objeù_
);

109 
´oûss_‹rm_ack
 ();

110 
´oûss_£qnum
 ();

114 
check_‹rm_acks
 ();

118 
boŞ
 
	g‹rmš©šg
;

121 
©omic_couÁ”_t
 
	g£Á_£qnum
;

124 
ušt64_t
 
	g´oûs£d_£qnum
;

128 
own_t
 *
	gowÃr
;

132 
	g¡d
::
	t£t
 <
	town_t
*> 
	towÃd_t
;

133 
owÃd_t
 
	gowÃd
;

136 
	g‹rm_acks
;

138 
own_t
 (const own_t&);

139 cÚ¡ 
	gown_t
 &
	gİ”©Ü
 = (cÚ¡ 
own_t
&);

	@pair.cpp

20 
	~"·œ.hµ
"

21 
	~"”r.hµ
"

22 
	~"pe.hµ
"

23 
	~"msg.hµ
"

25 
	gzmq
::
·œ_t
::
	$·œ_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

26 
	`sock‘_ba£_t
 (
·»Á_
, 
tid_
, 
sid_
),

27 
	$pe
 (
NULL
)

29 
İtiÚs
.
ty³
 = 
ZMQ_PAIR
;

30 
	}
}

32 
	gzmq
::
·œ_t
::~
	$·œ_t
 ()

34 
	`zmq_as£¹
 (!
pe
);

35 
	}
}

37 
	gzmq
::
·œ_t
::
	$x©ch_pe
 (
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
)

40 ()
subsüibe_to_®l_
;

42 
	`zmq_as£¹
 (
pe_
 !ğ
NULL
);

46 ià(
pe
 =ğ
NULL
)

47 
pe
 = 
pe_
;

49 
pe_
->
	`‹rmš©e
 (
çl£
);

50 
	}
}

52 
	gzmq
::
·œ_t
::
	$xpe_‹rmš©ed
 (
pe_t
 *
pe_
)

54 ià(
pe_
 =ğ
pe
)

55 
pe
 = 
NULL
;

56 
	}
}

58 
	gzmq
::
·œ_t
::
	$x»ad_aùiv©ed
 (
pe_t
 *)

62 
	}
}

64 
zmq
::
·œ_t
::
	$xwr™e_aùiv©ed
 (
pe_t
 *)

68 
	}
}

70 
zmq
::
·œ_t
::
	$x£nd
 (
msg_t
 *
msg_
)

72 ià(!
pe
 || !pe->
	`wr™e
 (
msg_
)) {

73 
”ºo
 = 
EAGAIN
;

77 ià(!(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
))

78 
pe
->
	`æush
 ();

81 
rc
 = 
msg_
->
	`š™
 ();

82 
	`”ºo_as£¹
 (
rc
 == 0);

85 
	}
}

87 
	gzmq
::
·œ_t
::
	$x»cv
 (
msg_t
 *
msg_
)

90 
rc
 = 
msg_
->
	`şo£
 ();

91 
	`”ºo_as£¹
 (
rc
 == 0);

93 ià(!
pe
 || !pe->
	`»ad
 (
msg_
)) {

96 
rc
 = 
msg_
->
	`š™
 ();

97 
	`”ºo_as£¹
 (
rc
 == 0);

99 
”ºo
 = 
EAGAIN
;

103 
	}
}

105 
boŞ
 
	gzmq
::
·œ_t
::
	$xhas_š
 ()

107 ià(!
pe
)

108  
çl£
;

110  
pe
->
	`check_»ad
 ();

111 
	}
}

113 
boŞ
 
	gzmq
::
·œ_t
::
	$xhas_out
 ()

115 ià(!
pe
)

116  
çl£
;

118  
pe
->
	`check_wr™e
 ();

119 
	}
}

	@pair.hpp

20 #iâdeà
__ZMQ_PAIR_HPP_INCLUDED__


21 
	#__ZMQ_PAIR_HPP_INCLUDED__


	)

23 
	~"sock‘_ba£.hµ
"

24 
	~"£ssiÚ_ba£.hµ
"

26 
Çme¥aû
 
	gzmq


29 
şass
 
	gùx_t
;

30 
şass
 
	gmsg_t
;

31 
şass
 
	gpe_t
;

32 
şass
 
	gio_th»ad_t
;

34 şas 
	c·œ_t
 :

35 
public
 
sock‘_ba£_t


37 
public
:

39 
·œ_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid
);

40 ~
·œ_t
 ();

43 
x©ch_pe
 (
zmq
::
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
);

44 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

45 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

46 
boŞ
 
xhas_š
 ();

47 
boŞ
 
xhas_out
 ();

48 
x»ad_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

49 
xwr™e_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

50 
xpe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

52 
	g´iv©e
:

54 
zmq
::
pe_t
 *
pe
;

56 
·œ_t
 (const…air_t&);

57 cÚ¡ 
	g·œ_t
 &
	gİ”©Ü
 = (cÚ¡ 
·œ_t
&);

	@pgm_receiver.cpp

20 
	~"¶©fÜm.hµ
"

22 #ià
defšed
 
ZMQ_HAVE_OPENPGM


24 
	~<Ãw
>

26 #ifdeà
ZMQ_HAVE_WINDOWS


27 
	~"wšdows.hµ
"

30 
	~"pgm_»ûiv”.hµ
"

31 
	~"£ssiÚ_ba£.hµ
"

32 
	~"v1_decod”.hµ
"

33 
	~"¡dšt.hµ
"

34 
	~"wœe.hµ
"

35 
	~"”r.hµ
"

37 
	gzmq
::
pgm_»ûiv”_t
::
	$pgm_»ûiv”_t
 (
şass
 
io_th»ad_t
 *
·»Á_
,

38 cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

39 
	`io_objeù_t
 (
·»Á_
),

40 
	`has_rx_tim”
 (
çl£
),

41 
	`pgm_sock‘
 (
Œue
, 
İtiÚs_
),

42 
	`İtiÚs
 (
İtiÚs_
),

43 
	`£ssiÚ
 (
NULL
),

44 
	`aùive_tsi
 (
NULL
),

45 
	$šsize
 (0)

47 
	}
}

49 
	gzmq
::
pgm_»ûiv”_t
::~
	$pgm_»ûiv”_t
 ()

52 
	`zmq_as£¹
 (
³”s
.
	`em±y
 ());

53 
	}
}

55 
	gzmq
::
pgm_»ûiv”_t
::
	$š™
 (
boŞ
 
udp_’ÿpsuÏtiÚ_
, cÚ¡ *
ÃtwÜk_
)

57  
pgm_sock‘
.
	`š™
 (
udp_’ÿpsuÏtiÚ_
, 
ÃtwÜk_
);

58 
	}
}

60 
	gzmq
::
pgm_»ûiv”_t
::
	$¶ug
 (
io_th»ad_t
 *
io_th»ad_
,

61 
£ssiÚ_ba£_t
 *
£ssiÚ_
)

64 
fd_t
 
sock‘_fd
 = 
»tœed_fd
;

65 
fd_t
 
wa™šg_pe_fd
 = 
»tœed_fd
;

66 
pgm_sock‘
.
	`g‘_»ûiv”_fds
 (&
sock‘_fd
, &
wa™šg_pe_fd
);

67 
sock‘_hªdË
 = 
	`add_fd
 (
sock‘_fd
);

68 
pe_hªdË
 = 
	`add_fd
 (
wa™šg_pe_fd
);

69 
	`£t_pŞlš
 (
pe_hªdË
);

70 
	`£t_pŞlš
 (
sock‘_hªdË
);

72 
£ssiÚ
 = 
£ssiÚ_
;

75 
	`drİ_subsütiÚs
 ();

76 
	}
}

78 
	gzmq
::
pgm_»ûiv”_t
::
	$uÅlug
 ()

81 
³”s_t
::
™”©Ü
 
™
 = 
³”s
.
	`begš
 (); iˆ!ğ³”s.
	`’d
 (); ++it) {

82 ià(
™
->
£cÚd
.
decod”
 !ğ
NULL
)

83 
d–‘e
 
™
->
£cÚd
.
decod”
;

85 
³”s
.
	`ş—r
 ();

86 
aùive_tsi
 = 
NULL
;

88 ià(
has_rx_tim”
) {

89 
	`ÿnûl_tim”
 (
rx_tim”_id
);

90 
has_rx_tim”
 = 
çl£
;

93 
	`rm_fd
 (
sock‘_hªdË
);

94 
	`rm_fd
 (
pe_hªdË
);

96 
£ssiÚ
 = 
NULL
;

97 
	}
}

99 
	gzmq
::
pgm_»ûiv”_t
::
	$‹rmš©e
 ()

101 
	`uÅlug
 ();

102 
d–‘e
 
this
;

103 
	}
}

105 
	gzmq
::
pgm_»ûiv”_t
::
	$»¡¬t_ouut
 ()

107 
	`drİ_subsütiÚs
 ();

108 
	}
}

110 
	gzmq
::
pgm_»ûiv”_t
::
	$»¡¬t_šput
 ()

112 
	`zmq_as£¹
 (
£ssiÚ
 !ğ
NULL
);

113 
	`zmq_as£¹
 (
aùive_tsi
 !ğ
NULL
);

115 cÚ¡ 
³”s_t
::
™”©Ü
 
™
 = 
³”s
.
	`fšd
 (*
aùive_tsi
);

116 
	`zmq_as£¹
 (
™
 !ğ
³”s
.
	`’d
 ());

117 
	`zmq_as£¹
 (
™
->
£cÚd
.
jošed
);

120 
rc
 = 
£ssiÚ
->
	`push_msg
 (
™
->
£cÚd
.
decod”
->
	`msg
 ());

121 
	`”ºo_as£¹
 (
rc
 == 0);

123 ià(
šsize
 > 0) {

124 
rc
 = 
	`´oûss_šput
 (
™
->
£cÚd
.
decod”
);

125 ià(
rc
 == -1) {

127 ià(
”ºo
 =ğ
EAGAIN
) {

128 
£ssiÚ
->
	`æush
 ();

133 
™
->
£cÚd
.
jošed
 = 
çl£
;

134 
d–‘e
 
™
->
£cÚd
.
decod”
;

135 
™
->
£cÚd
.
decod”
 = 
NULL
;

136 
šsize
 = 0;

141 
	`£t_pŞlš
 (
pe_hªdË
);

142 
	`£t_pŞlš
 (
sock‘_hªdË
);

144 
aùive_tsi
 = 
NULL
;

145 
	`š_ev’t
 ();

146 
	}
}

148 
	gzmq
::
pgm_»ûiv”_t
::
	$š_ev’t
 ()

151 cÚ¡ 
pgm_tsi_t
 *
tsi
 = 
NULL
;

153 ià(
has_rx_tim”
) {

154 
	`ÿnûl_tim”
 (
rx_tim”_id
);

155 
has_rx_tim”
 = 
çl£
;

160 
Œue
) {

164 *
tmp
 = 
NULL
;

165 
ssize_t
 
»ûived
 = 
pgm_sock‘
.
	`»ûive
 (&
tmp
, &
tsi
);

166 
špos
 = (*è
tmp
;

170 ià(
»ûived
 == 0) {

171 ià(
”ºo
 =ğ
ENOMEM
 ||ƒ¼nØ=ğ
EBUSY
) {

172 cÚ¡ 
timeout
 = 
pgm_sock‘
.
	`g‘_rx_timeout
 ();

173 
	`add_tim”
 (
timeout
, 
rx_tim”_id
);

174 
has_rx_tim”
 = 
Œue
;

180 
³”s_t
::
™”©Ü
 
™
 = 
³”s
.
	`fšd
 (*
tsi
);

183 ià(
»ûived
 == -1) {

184 ià(
™
 !ğ
³”s
.
	`’d
 ()) {

185 
™
->
£cÚd
.
jošed
 = 
çl£
;

186 ià(
™
->
£cÚd
.
decod”
 !ğ
NULL
) {

187 
d–‘e
 
™
->
£cÚd
.
decod”
;

188 
™
->
£cÚd
.
decod”
 = 
NULL
;

195 ià(
™
 =ğ
³”s
.
	`’d
 ()) {

196 
³”_šfo_t
 
³”_šfo
 = {
çl£
, 
NULL
};

197 
™
 = 
³”s
.
	`š£¹
 (
³”s_t
::
	`v®ue_ty³
 (*
tsi
, 
³”_šfo
)).
fœ¡
;

200 
šsize
 = 
¡©ic_ÿ¡
 <
size_t
> (
»ûived
);

203 
	`zmq_as£¹
 (
šsize
 >ğ (
ušt16_t
));

204 
ušt16_t
 
off£t
 = 
	`g‘_ušt16
 (
špos
);

205 
špos
 +ğ (
ušt16_t
);

206 
šsize
 -ğ (
ušt16_t
);

209 ià(!
™
->
£cÚd
.
jošed
) {

213 ià(
off£t
 == 0xffff)

216 
	`zmq_as£¹
 (
off£t
 <ğ
šsize
);

217 
	`zmq_as£¹
 (
™
->
£cÚd
.
decod”
 =ğ
NULL
);

220 
špos
 +ğ
off£t
;

221 
šsize
 -ğ
off£t
;

224 
™
->
£cÚd
.
jošed
 = 
Œue
;

227 
™
->
£cÚd
.
decod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

228 
	`v1_decod”_t
 (0, 
İtiÚs
.
maxmsgsize
);

229 
	`®loc_as£¹
 (
™
->
£cÚd
.
decod”
);

232 
rc
 = 
	`´oûss_šput
 (
™
->
£cÚd
.
decod”
);

233 ià(
rc
 == -1) {

234 ià(
”ºo
 =ğ
EAGAIN
) {

235 
aùive_tsi
 = 
tsi
;

238 
	`»£t_pŞlš
 (
pe_hªdË
);

239 
	`»£t_pŞlš
 (
sock‘_hªdË
);

244 
™
->
£cÚd
.
jošed
 = 
çl£
;

245 
d–‘e
 
™
->
£cÚd
.
decod”
;

246 
™
->
£cÚd
.
decod”
 = 
NULL
;

247 
šsize
 = 0;

252 
£ssiÚ
->
	`æush
 ();

253 
	}
}

255 
	gzmq
::
pgm_»ûiv”_t
::
	$´oûss_šput
 (
v1_decod”_t
 *
decod”
)

257 
	`zmq_as£¹
 (
£ssiÚ
 !ğ
NULL
);

259 
šsize
 > 0) {

260 
size_t
 
n
 = 0;

261 
rc
 = 
decod”
->
	`decode
 (
špos
, 
šsize
, 
n
);

262 ià(
rc
 == -1)

264 
špos
 +ğ
n
;

265 
šsize
 -ğ
n
;

266 ià(
rc
 == 0)

268 
rc
 = 
£ssiÚ
->
	`push_msg
 (
decod”
->
	`msg
 ());

269 ià(
rc
 == -1) {

270 
	`”ºo_as£¹
 (
”ºo
 =ğ
EAGAIN
);

275 
	}
}

278 
	gzmq
::
pgm_»ûiv”_t
::
	$tim”_ev’t
 (
tok’
)

280 
	`zmq_as£¹
 (
tok’
 =ğ
rx_tim”_id
);

283 
has_rx_tim”
 = 
çl£
;

284 
	`š_ev’t
 ();

285 
	}
}

287 
	gzmq
::
pgm_»ûiv”_t
::
	$drİ_subsütiÚs
 ()

289 
msg_t
 
msg
;

290 
msg
.
	`š™
 ();

291 
£ssiÚ
->
	`puÎ_msg
 (&
msg
))

292 
msg
.
	`şo£
 ();

293 
	}
}

	@pgm_receiver.hpp

20 #iâdeà
__ZMQ_PGM_RECEIVER_HPP_INCLUDED__


21 
	#__ZMQ_PGM_RECEIVER_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ià
defšed
 
ZMQ_HAVE_OPENPGM


27 #ifdeà
ZMQ_HAVE_WINDOWS


28 
	~"wšdows.hµ
"

31 
	~<m­
>

32 
	~<®gÜ™hm
>

34 
	~"io_objeù.hµ
"

35 
	~"i_’gše.hµ
"

36 
	~"İtiÚs.hµ
"

37 
	~"v1_decod”.hµ
"

38 
	~"pgm_sock‘.hµ
"

40 
Çme¥aû
 
	gzmq


43 
şass
 
	gio_th»ad_t
;

44 
şass
 
	g£ssiÚ_ba£_t
;

46 
şass
 
	gpgm_»ûiv”_t
 : 
public
 
io_objeù_t
,…ubliø
	gi_’gše


49 
	gpublic
:

51 
pgm_»ûiv”_t
 (
zmq
::
io_th»ad_t
 *
·»Á_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

52 ~
pgm_»ûiv”_t
 ();

54 
š™
 (
boŞ
 
udp_’ÿpsuÏtiÚ_
, cÚ¡ *
ÃtwÜk_
);

57 
¶ug
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
,

58 
zmq
::
£ssiÚ_ba£_t
 *
£ssiÚ_
);

59 
‹rmš©e
 ();

60 
»¡¬t_šput
 ();

61 
»¡¬t_ouut
 ();

62 
z­_msg_avaabË
 () {}

65 
š_ev’t
 ();

66 
tim”_ev’t
 (
tok’
);

68 
	g´iv©e
:

71 
uÅlug
 ();

75 
´oûss_šput
 (
v1_decod”_t
 *
decod”
);

79 
drİ_subsütiÚs
 ();

82 ’um {
	grx_tim”_id
 = 0xa1};

85 
boŞ
 
	ghas_rx_tim”
;

90 
	s³”_šfo_t


92 
boŞ
 
	gjošed
;

93 
v1_decod”_t
 *
	gdecod”
;

96 
	stsi_comp


98 
boŞ
 
İ”©Ü
 (è(cÚ¡ 
	gpgm_tsi_t
 &
	gÉsi
,

99 cÚ¡ 
	gpgm_tsi_t
 &
	g¹si
) const

101 
ušt32_t
 
	gÎ
[2], 
	g¾
[2];

102 
memıy
 (
Î
, &
Ési
,  (ll));

103 
memıy
 (
¾
, &
¹si
,  (rl));

104  (
	gÎ
[0] < 
	g¾
[0]è|| (Î[0] =ğ
¾
[0] && 
Î
[1] <„l[1]);

108 
	g¡d
::
	tm­
 <
	tpgm_tsi_t
, 
	t³”_šfo_t
, 
	ttsi_comp
> 
	t³”s_t
;

109 
³”s_t
 
	g³”s
;

112 
pgm_sock‘_t
 
	gpgm_sock‘
;

115 
İtiÚs_t
 
	gİtiÚs
;

118 
	gzmq
::
£ssiÚ_ba£_t
 *
£ssiÚ
;

120 cÚ¡ 
pgm_tsi_t
 *
	gaùive_tsi
;

123 
size_t
 
	gšsize
;

126 cÚ¡ *
	gšpos
;

129 
hªdË_t
 
	gsock‘_hªdË
;

132 
hªdË_t
 
	gpe_hªdË
;

134 
pgm_»ûiv”_t
 (const…gm_receiver_t&);

135 cÚ¡ 
	gpgm_»ûiv”_t
 &
	gİ”©Ü
 = (cÚ¡ 
pgm_»ûiv”_t
&);

	@pgm_sender.cpp

20 
	~"¶©fÜm.hµ
"

22 #ià
defšed
 
ZMQ_HAVE_OPENPGM


24 #ifdeà
ZMQ_HAVE_WINDOWS


25 
	~"wšdows.hµ
"

28 
	~<¡dlib.h
>

30 
	~"io_th»ad.hµ
"

31 
	~"pgm_£nd”.hµ
"

32 
	~"£ssiÚ_ba£.hµ
"

33 
	~"”r.hµ
"

34 
	~"wœe.hµ
"

35 
	~"¡dšt.hµ
"

37 
	gzmq
::
pgm_£nd”_t
::
	$pgm_£nd”_t
 (
io_th»ad_t
 *
·»Á_
,

38 cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

39 
	`io_objeù_t
 (
·»Á_
),

40 
	`has_tx_tim”
 (
çl£
),

41 
	`has_rx_tim”
 (
çl£
),

42 
	`£ssiÚ
 (
NULL
),

43 
	`’cod”
 (0),

44 
	`mÜe_æag
 (
çl£
),

45 
	`pgm_sock‘
 (
çl£
, 
İtiÚs_
),

46 
	`İtiÚs
 (
İtiÚs_
),

47 
	`out_bufãr
 (
NULL
),

48 
	`out_bufãr_size
 (0),

49 
	$wr™e_size
 (0)

51 
rc
 = 
msg
.
	`š™
 ();

52 
	`”ºo_as£¹
 (
rc
 == 0);

53 
	}
}

55 
	gzmq
::
pgm_£nd”_t
::
	$š™
 (
boŞ
 
udp_’ÿpsuÏtiÚ_
, cÚ¡ *
ÃtwÜk_
)

57 
rc
 = 
pgm_sock‘
.
	`š™
 (
udp_’ÿpsuÏtiÚ_
, 
ÃtwÜk_
);

58 ià(
rc
 != 0)

59  
rc
;

61 
out_bufãr_size
 = 
pgm_sock‘
.
	`g‘_max_tsdu_size
 ();

62 
out_bufãr
 = (*è
	`m®loc
 (
out_bufãr_size
);

63 
	`®loc_as£¹
 (
out_bufãr
);

65  
rc
;

66 
	}
}

68 
	gzmq
::
pgm_£nd”_t
::
	$¶ug
 (
io_th»ad_t
 *
io_th»ad_
, 
£ssiÚ_ba£_t
 *
£ssiÚ_
)

71 
fd_t
 
dowÆšk_sock‘_fd
 = 
»tœed_fd
;

72 
fd_t
 
u¶šk_sock‘_fd
 = 
»tœed_fd
;

73 
fd_t
 
rd©a_nÙify_fd
 = 
»tœed_fd
;

74 
fd_t
 
³ndšg_nÙify_fd
 = 
»tœed_fd
;

76 
£ssiÚ
 = 
£ssiÚ_
;

79 
pgm_sock‘
.
	`g‘_£nd”_fds
 (&
dowÆšk_sock‘_fd
, &
u¶šk_sock‘_fd
,

80 &
rd©a_nÙify_fd
, &
³ndšg_nÙify_fd
);

82 
hªdË
 = 
	`add_fd
 (
dowÆšk_sock‘_fd
);

83 
u¶šk_hªdË
 = 
	`add_fd
 (
u¶šk_sock‘_fd
);

84 
rd©a_nÙify_hªdË
 = 
	`add_fd
 (
rd©a_nÙify_fd
);

85 
³ndšg_nÙify_hªdË
 = 
	`add_fd
 (
³ndšg_nÙify_fd
);

89 
	`£t_pŞlš
 (
u¶šk_hªdË
);

90 
	`£t_pŞlš
 (
rd©a_nÙify_hªdË
);

91 
	`£t_pŞlš
 (
³ndšg_nÙify_hªdË
);

94 
	`£t_pŞlout
 (
hªdË
);

95 
	}
}

97 
	gzmq
::
pgm_£nd”_t
::
	$uÅlug
 ()

99 ià(
has_rx_tim”
) {

100 
	`ÿnûl_tim”
 (
rx_tim”_id
);

101 
has_rx_tim”
 = 
çl£
;

104 ià(
has_tx_tim”
) {

105 
	`ÿnûl_tim”
 (
tx_tim”_id
);

106 
has_tx_tim”
 = 
çl£
;

109 
	`rm_fd
 (
hªdË
);

110 
	`rm_fd
 (
u¶šk_hªdË
);

111 
	`rm_fd
 (
rd©a_nÙify_hªdË
);

112 
	`rm_fd
 (
³ndšg_nÙify_hªdË
);

113 
£ssiÚ
 = 
NULL
;

114 
	}
}

116 
	gzmq
::
pgm_£nd”_t
::
	$‹rmš©e
 ()

118 
	`uÅlug
 ();

119 
d–‘e
 
this
;

120 
	}
}

122 
	gzmq
::
pgm_£nd”_t
::
	$»¡¬t_ouut
 ()

124 
	`£t_pŞlout
 (
hªdË
);

125 
	`out_ev’t
 ();

126 
	}
}

128 
	gzmq
::
pgm_£nd”_t
::
	$»¡¬t_šput
 ()

130 
	`zmq_as£¹
 (
çl£
);

131 
	}
}

133 
	gzmq
::
pgm_£nd”_t
::~
	$pgm_£nd”_t
 ()

135 
rc
 = 
msg
.
	`şo£
 ();

136 
	`”ºo_as£¹
 (
rc
 == 0);

138 ià(
out_bufãr
) {

139 
	`ä“
 (
out_bufãr
);

140 
out_bufãr
 = 
NULL
;

142 
	}
}

144 
	gzmq
::
pgm_£nd”_t
::
	$š_ev’t
 ()

146 ià(
has_rx_tim”
) {

147 
	`ÿnûl_tim”
 (
rx_tim”_id
);

148 
has_rx_tim”
 = 
çl£
;

152 
pgm_sock‘
.
	`´oûss_up¡»am
 ();

153 ià(
”ºo
 =ğ
ENOMEM
 ||ƒ¼nØ=ğ
EBUSY
) {

154 cÚ¡ 
timeout
 = 
pgm_sock‘
.
	`g‘_rx_timeout
 ();

155 
	`add_tim”
 (
timeout
, 
rx_tim”_id
);

156 
has_rx_tim”
 = 
Œue
;

158 
	}
}

160 
	gzmq
::
pgm_£nd”_t
::
	$out_ev’t
 ()

164 ià(
wr™e_size
 == 0) {

169 *
bf
 = 
out_bufãr
 +  (
ušt16_t
);

170 
size_t
 
bfsz
 = 
out_bufãr_size
 -  (
ušt16_t
);

171 
ušt16_t
 
off£t
 = 0xffff;

173 
size_t
 
by‹s
 = 
’cod”
.
	`’code
 (&
bf
, 
bfsz
);

174 
by‹s
 < 
bfsz
) {

175 ià(!
mÜe_æag
 && 
off£t
 == 0xffff)

176 
off£t
 = 
¡©ic_ÿ¡
 <
ušt16_t
> (
by‹s
);

177 
rc
 = 
£ssiÚ
->
	`puÎ_msg
 (&
msg
);

178 ià(
rc
 == -1)

180 
mÜe_æag
 = 
msg
.
	`æags
 (è& 
msg_t
::
mÜe
;

181 
’cod”
.
	`lßd_msg
 (&
msg
);

182 
bf
 = 
out_bufãr
 +  (
ušt16_t
è+ 
by‹s
;

183 
by‹s
 +ğ
’cod”
.
	`’code
 (&
bf
, 
bfsz
 - bytes);

187 ià(
by‹s
 == 0) {

188 
	`»£t_pŞlout
 (
hªdË
);

192 
wr™e_size
 =  (
ušt16_t
è+ 
by‹s
;

195 
	`put_ušt16
 (
out_bufãr
, 
off£t
);

198 ià(
has_tx_tim”
) {

199 
	`ÿnûl_tim”
 (
tx_tim”_id
);

200 
has_tx_tim”
 = 
çl£
;

204 
size_t
 
nby‹s
 = 
pgm_sock‘
.
	`£nd
 (
out_bufãr
, 
wr™e_size
);

207 ià(
nby‹s
 =ğ
wr™e_size
)

208 
wr™e_size
 = 0;

210 
	`zmq_as£¹
 (
nby‹s
 == 0);

212 ià(
”ºo
 =ğ
ENOMEM
) {

213 cÚ¡ 
timeout
 = 
pgm_sock‘
.
	`g‘_tx_timeout
 ();

214 
	`add_tim”
 (
timeout
, 
tx_tim”_id
);

215 
has_tx_tim”
 = 
Œue
;

218 
	`”ºo_as£¹
 (
”ºo
 =ğ
EBUSY
);

220 
	}
}

222 
	gzmq
::
pgm_£nd”_t
::
	$tim”_ev’t
 (
tok’
)

225 ià(
tok’
 =ğ
rx_tim”_id
) {

226 
has_rx_tim”
 = 
çl£
;

227 
	`š_ev’t
 ();

230 ià(
tok’
 =ğ
tx_tim”_id
) {

231 
has_tx_tim”
 = 
çl£
;

232 
	`out_ev’t
 ();

235 
	`zmq_as£¹
 (
çl£
);

236 
	}
}

	@pgm_sender.hpp

20 #iâdeà
__ZMQ_PGM_SENDER_HPP_INCLUDED__


21 
	#__ZMQ_PGM_SENDER_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ià
defšed
 
ZMQ_HAVE_OPENPGM


27 #ifdeà
ZMQ_HAVE_WINDOWS


28 
	~"wšdows.hµ
"

31 
	~"¡dšt.hµ
"

32 
	~"io_objeù.hµ
"

33 
	~"i_’gše.hµ
"

34 
	~"İtiÚs.hµ
"

35 
	~"pgm_sock‘.hµ
"

36 
	~"v1_’cod”.hµ
"

37 
	~"msg.hµ
"

39 
Çme¥aû
 
	gzmq


42 
şass
 
	gio_th»ad_t
;

43 
şass
 
	g£ssiÚ_ba£_t
;

45 
şass
 
	gpgm_£nd”_t
 : 
public
 
io_objeù_t
,…ubliø
	gi_’gše


48 
	gpublic
:

50 
pgm_£nd”_t
 (
zmq
::
io_th»ad_t
 *
·»Á_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

51 ~
pgm_£nd”_t
 ();

53 
š™
 (
boŞ
 
udp_’ÿpsuÏtiÚ_
, cÚ¡ *
ÃtwÜk_
);

56 
¶ug
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
,

57 
zmq
::
£ssiÚ_ba£_t
 *
£ssiÚ_
);

58 
‹rmš©e
 ();

59 
»¡¬t_šput
 ();

60 
»¡¬t_ouut
 ();

61 
z­_msg_avaabË
 () {}

64 
š_ev’t
 ();

65 
out_ev’t
 ();

66 
tim”_ev’t
 (
tok’
);

68 
	g´iv©e
:

71 
uÅlug
 ();

74 ’um {
	gtx_tim”_id
 = 0xa0, 
	grx_tim”_id
 = 0xa1};

77 
boŞ
 
	ghas_tx_tim”
;

78 
boŞ
 
	ghas_rx_tim”
;

80 
£ssiÚ_ba£_t
 *
	g£ssiÚ
;

83 
v1_’cod”_t
 
	g’cod”
;

85 
msg_t
 
	gmsg
;

88 
boŞ
 
	gmÜe_æag
;

91 
pgm_sock‘_t
 
	gpgm_sock‘
;

94 
İtiÚs_t
 
	gİtiÚs
;

97 
hªdË_t
 
	ghªdË
;

98 
hªdË_t
 
	gu¶šk_hªdË
;

99 
hªdË_t
 
	grd©a_nÙify_hªdË
;

100 
hªdË_t
 
	g³ndšg_nÙify_hªdË
;

103 *
	gout_bufãr
;

106 
size_t
 
	gout_bufãr_size
;

110 
size_t
 
	gwr™e_size
;

112 
pgm_£nd”_t
 (const…gm_sender_t&);

113 cÚ¡ 
	gpgm_£nd”_t
 &
	gİ”©Ü
 = (cÚ¡ 
pgm_£nd”_t
&);

	@pgm_socket.cpp

20 
	~"¶©fÜm.hµ
"

22 #ifdeà
ZMQ_HAVE_OPENPGM


24 #ifdeà
ZMQ_HAVE_WINDOWS


25 
	~"wšdows.hµ
"

28 #ifdeà
ZMQ_HAVE_LINUX


29 
	~<pŞl.h
>

32 
	~<¡dlib.h
>

33 
	~<¡ršg.h
>

34 
	~<¡ršg
>

36 
	~"İtiÚs.hµ
"

37 
	~"pgm_sock‘.hµ
"

38 
	~"cÚfig.hµ
"

39 
	~"”r.hµ
"

40 
	~"¿ndom.hµ
"

41 
	~"¡dšt.hµ
"

43 #iâdeà
MSG_ERRQUEUE


44 
	#MSG_ERRQUEUE
 0x2000

	)

47 
	gzmq
::
pgm_sock‘_t
::
	$pgm_sock‘_t
 (
boŞ
 
»ûiv”_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

48 
	`sock
 (
NULL
),

49 
	`İtiÚs
 (
İtiÚs_
),

50 
	`»ûiv”
 (
»ûiv”_
),

51 
	`pgm_msgv
 (
NULL
),

52 
	`pgm_msgv_Ën
 (0),

53 
	`nby‹s_»c
 (0),

54 
	`nby‹s_´oûs£d
 (0),

55 
	$pgm_msgv_´oûs£d
 (0)

57 
	}
}

64 
	gzmq
::
pgm_sock‘_t
::
	$š™_add»ss
 (cÚ¡ *
ÃtwÜk_
,

65 
pgm_addršfo_t
 **
»s
, 
ušt16_t
 *
pÜt_numb”
)

68 cÚ¡ *
pÜt_d–im
 = 
	`¡¼chr
 (
ÃtwÜk_
, ':');

69 ià(!
pÜt_d–im
) {

70 
”ºo
 = 
EINVAL
;

74 *
pÜt_numb”
 = 
	`©oi
 (
pÜt_d–im
 + 1);

76 
ÃtwÜk
 [256];

77 ià(
pÜt_d–im
 - 
ÃtwÜk_
 >ğ(è (
ÃtwÜk
) - 1) {

78 
”ºo
 = 
EINVAL
;

81 
	`mem£t
 (
ÃtwÜk
, '\0',  (network));

82 
	`memıy
 (
ÃtwÜk
, 
ÃtwÜk_
, 
pÜt_d–im
 -‚etwork_);

84 
pgm_”rÜ_t
 *
pgm_”rÜ
 = 
NULL
;

85 
pgm_addršfo_t
 
hšts
;

87 
	`mem£t
 (&
hšts
, 0,  (hints));

88 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

89 ià(!
	`pgm_g‘addršfo
 (
ÃtwÜk
, 
NULL
, 
»s
, &
pgm_”rÜ
)) {

92 
	`zmq_as£¹
 (
pgm_”rÜ
 !ğ
NULL
);

93 ià(
pgm_”rÜ
->
domaš
 =ğ
PGM_ERROR_DOMAIN_IF
 &&

96 Ğ
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_SERVICE
 &&

97 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_SOCKTNOSUPPORT
)) {

100 
	`pgm_”rÜ_ä“
 (
pgm_”rÜ
);

101 
”ºo
 = 
EINVAL
;

106 
	`zmq_as£¹
 (
çl£
);

109 
	}
}

112 
	gzmq
::
pgm_sock‘_t
::
	$š™
 (
boŞ
 
udp_’ÿpsuÏtiÚ_
, cÚ¡ *
ÃtwÜk_
)

115 
	`zmq_as£¹
 (
sock
 =ğ
NULL
);

116 
	`zmq_as£¹
 (
İtiÚs
.
¿‹
 > 0);

119 
nby‹s_»c
 = 0;

120 
nby‹s_´oûs£d
 = 0;

121 
pgm_msgv_´oûs£d
 = 0;

123 
ušt16_t
 
pÜt_numb”
;

124 
pgm_addršfo_t
 *
»s
 = 
NULL
;

125 
§_çmy_t
 
§_çmy
;

127 
pgm_”rÜ_t
 *
pgm_”rÜ
 = 
NULL
;

129 ià(
	`š™_add»ss
(
ÃtwÜk_
, &
»s
, &
pÜt_numb”
) < 0) {

130 
”r_abÜt
;

133 
	`zmq_as£¹
 (
»s
 !ğ
NULL
);

136 
§_çmy
 = 
»s
->
ai_£nd_addrs
[0].
g¤_group
.
ss_çmy
;

139 ià(
udp_’ÿpsuÏtiÚ_
) {

140 ià(!
	`pgm_sock‘
 (&
sock
, 
§_çmy
, 
SOCK_SEQPACKET
, 
IPPROTO_UDP
,

141 &
pgm_”rÜ
)) {

144 
	`zmq_as£¹
 (
pgm_”rÜ
 !ğ
NULL
);

145 ià(
pgm_”rÜ
->
domaš
 =ğ
PGM_ERROR_DOMAIN_SOCKET
 && (

146 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_BADF
 &&

147 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_FAULT
 &&

148 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_NOPROTOOPT
 &&

149 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_FAILED
))

152 
”r_abÜt
;

155 
	`zmq_as£¹
 (
çl£
);

159 cÚ¡ 
’ÿpsuÏtiÚ_pÜt
 = 
pÜt_numb”
;

160 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_UDP_ENCAP_UCAST_PORT
,

161 &
’ÿpsuÏtiÚ_pÜt
,  (encapsulation_port)))

162 
”r_abÜt
;

163 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_UDP_ENCAP_MCAST_PORT
,

164 &
’ÿpsuÏtiÚ_pÜt
,  (encapsulation_port)))

165 
”r_abÜt
;

168 ià(!
	`pgm_sock‘
 (&
sock
, 
§_çmy
, 
SOCK_SEQPACKET
, 
IPPROTO_PGM
,

169 &
pgm_”rÜ
)) {

172 
	`zmq_as£¹
 (
pgm_”rÜ
 !ğ
NULL
);

173 ià(
pgm_”rÜ
->
domaš
 =ğ
PGM_ERROR_DOMAIN_SOCKET
 && (

174 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_BADF
 &&

175 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_FAULT
 &&

176 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_NOPROTOOPT
 &&

177 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_FAILED
))

180 
”r_abÜt
;

183 
	`zmq_as£¹
 (
çl£
);

188 cÚ¡ 
rcvbuf
 = (è
İtiÚs
.rcvbuf;

189 ià(
rcvbuf
) {

190 ià(!
	`pgm_£tsockİt
 (
sock
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
rcvbuf
,

191  (
rcvbuf
)))

192 
”r_abÜt
;

195 cÚ¡ 
¢dbuf
 = (è
İtiÚs
.sndbuf;

196 ià(
¢dbuf
) {

197 ià(!
	`pgm_£tsockİt
 (
sock
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
¢dbuf
,

198  (
¢dbuf
)))

199 
”r_abÜt
;

202 cÚ¡ 
max_du
 = (è
pgm_max_du
;

203 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_MTU
, &
max_du
,

204  (
max_du
)))

205 
”r_abÜt
;

208 ià(
»ûiv”
) {

209 cÚ¡ 
»cv_Úly
 = 1,

210 
rxw_max_du
 = (è
pgm_max_du
,

211 
rxw_sqns
 = 
	`compu‹_sqns
 (
rxw_max_du
),

212 
³”_expœy
 = 
	`pgm_£cs
 (300),

213 
¥mr_expœy
 = 
	`pgm_m£cs
 (25),

214 
Çk_bo_ivl
 = 
	`pgm_m£cs
 (50),

215 
Çk_½t_ivl
 = 
	`pgm_m£cs
 (200),

216 
Çk_rd©a_ivl
 = 
	`pgm_m£cs
 (200),

217 
Çk_d©a_»Œ›s
 = 50,

218 
Çk_ncf_»Œ›s
 = 50;

220 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_RECV_ONLY
, &
»cv_Úly
,

221  (
»cv_Úly
)) ||

222 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_RXW_SQNS
, &
rxw_sqns
,

223  (
rxw_sqns
)) ||

224 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_PEER_EXPIRY
, &
³”_expœy
,

225  (
³”_expœy
)) ||

226 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_SPMR_EXPIRY
, &
¥mr_expœy
,

227  (
¥mr_expœy
)) ||

228 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_NAK_BO_IVL
, &
Çk_bo_ivl
,

229  (
Çk_bo_ivl
)) ||

230 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_NAK_RPT_IVL
, &
Çk_½t_ivl
,

231  (
Çk_½t_ivl
)) ||

232 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_NAK_RDATA_IVL
,

233 &
Çk_rd©a_ivl
,  (nak_rdata_ivl)) ||

234 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_NAK_DATA_RETRIES
,

235 &
Çk_d©a_»Œ›s
,  (nak_data_retries)) ||

236 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_NAK_NCF_RETRIES
,

237 &
Çk_ncf_»Œ›s
,  (nak_ncf_retries)))

238 
”r_abÜt
;

241 cÚ¡ 
£nd_Úly
 = 1,

242 
max_¹e
 = (è((
İtiÚs
.
¿‹
 * 1000) / 8),

243 
txw_max_du
 = (è
pgm_max_du
,

244 
txw_sqns
 = 
	`compu‹_sqns
 (
txw_max_du
),

245 
amb›Á_¥m
 = 
	`pgm_£cs
 (30),

246 
h—¹b—t_¥m
[] = { 
	`pgm_m£cs
 (100),

247 
	`pgm_m£cs
 (100),

248 
	`pgm_m£cs
 (100),

249 
	`pgm_m£cs
 (100),

250 
	`pgm_m£cs
 (1300),

251 
	`pgm_£cs
 (7),

252 
	`pgm_£cs
 (16),

253 
	`pgm_£cs
 (25),

254 
	`pgm_£cs
 (30) };

256 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_SEND_ONLY
,

257 &
£nd_Úly
,  (send_only)) ||

258 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_ODATA_MAX_RTE
,

259 &
max_¹e
,  (max_rte)) ||

260 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_TXW_SQNS
,

261 &
txw_sqns
,  (txw_sqns)) ||

262 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_AMBIENT_SPM
,

263 &
amb›Á_¥m
,  (ambient_spm)) ||

264 !
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_HEARTBEAT_SPM
,

265 &
h—¹b—t_¥m
,  (heartbeat_spm)))

266 
”r_abÜt
;

270 
pgm_sockaddr_t
 
addr
;

272 
	`mem£t
 (&
addr
, 0, (addr));

273 
addr
.
§_pÜt
 = 
pÜt_numb”
;

274 
addr
.
§_addr
.
¥Üt
 = 
DEFAULT_DATA_SOURCE_PORT
;

277 
ušt32_t
 
buf
 [2];

278 
buf
 [0] = 
	`g’”©e_¿ndom
 ();

279 
buf
 [1] = 
	`g’”©e_¿ndom
 ();

280 ià(!
	`pgm_gsi_ü—‹_äom_d©a
 (&
addr
.
§_addr
.
gsi
, (
ušt8_t
*è
buf
, 8))

281 
”r_abÜt
;

285 
pgm_š‹rçû_»q_t
 
if_»q
;

286 
	`mem£t
 (&
if_»q
, 0, (if_req));

287 
if_»q
.
œ_š‹rçû
 = 
»s
->
ai_»cv_addrs
[0].
g¤_š‹rçû
;

288 
if_»q
.
œ_scİe_id
 = 0;

289 ià(
AF_INET6
 =ğ
§_çmy
) {

290 
sockaddr_š6
 
§6
;

291 
	`memıy
 (&
§6
, &
»s
->
ai_»cv_addrs
[0].
g¤_group
,  (sa6));

292 
if_»q
.
œ_scİe_id
 = 
§6
.
sš6_scİe_id
;

294 ià(!
	`pgm_bšd3
 (
sock
, &
addr
,  (addr), &
if_»q
,  (if_req),

295 &
if_»q
,  (if_»q), &
pgm_”rÜ
)) {

298 
	`zmq_as£¹
 (
pgm_”rÜ
 !ğ
NULL
);

299 ià((
pgm_”rÜ
->
domaš
 =ğ
PGM_ERROR_DOMAIN_SOCKET
 ||

300 
pgm_”rÜ
->
domaš
 =ğ
PGM_ERROR_DOMAIN_IF
) && (

301 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_INVAL
 &&

302 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_BADF
 &&

303 
pgm_”rÜ
->
code
 !ğ
PGM_ERROR_FAULT
))

306 
”r_abÜt
;

309 
	`zmq_as£¹
 (
çl£
);

313 
i
 = 0; i < 
»s
->
ai_»cv_addrs_Ën
; i++) {

314 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_JOIN_GROUP
,

315 &
»s
->
ai_»cv_addrs
 [
i
],  (
group_»q
)))

316 
”r_abÜt
;

318 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_SEND_GROUP
,

319 &
»s
->
ai_£nd_addrs
 [0],  (
group_»q
)))

320 
”r_abÜt
;

322 
	`pgm_ä“addršfo
 (
»s
);

323 
»s
 = 
NULL
;

328 cÚ¡ 
muÉiÿ¡_loİ
 = 0;

329 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_MULTICAST_LOOP
,

330 &
muÉiÿ¡_loİ
,  (multicast_loop)))

331 
”r_abÜt
;

333 cÚ¡ 
muÉiÿ¡_hİs
 = 
İtiÚs
.multicast_hops;

334 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_MULTICAST_HOPS
,

335 &
muÉiÿ¡_hİs
,  (multicast_hops)))

336 
”r_abÜt
;

340 cÚ¡ 
dsı
 = 0x2e << 2;

341 ià(
AF_INET6
 !ğ
§_çmy
)

342 
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_TOS
,

343 &
dsı
,  (dscp));

345 cÚ¡ 
nÚblockšg
 = 1;

346 ià(!
	`pgm_£tsockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_NOBLOCK
,

347 &
nÚblockšg
,  (nonblocking)))

348 
”r_abÜt
;

352 ià(!
	`pgm_cÚÃù
 (
sock
, &
pgm_”rÜ
)) {

355 
	`zmq_as£¹
 (
pgm_”rÜ
 !ğ
NULL
);

356 
”r_abÜt
;

360 ià(
»ûiv”
) {

361 
	`zmq_as£¹
 (
š_b©ch_size
 > 0);

362 
size_t
 
max_tsdu_size
 = 
	`g‘_max_tsdu_size
 ();

363 
pgm_msgv_Ën
 = (è
š_b©ch_size
 / 
max_tsdu_size
;

364 ià((è
š_b©ch_size
 % 
max_tsdu_size
)

365 
pgm_msgv_Ën
++;

366 
	`zmq_as£¹
 (
pgm_msgv_Ën
);

368 
pgm_msgv
 = (
pgm_msgv_t
*è
	`m®loc
 ( (pgm_msgv_tè* 
pgm_msgv_Ën
);

369 
	`®loc_as£¹
 (
pgm_msgv
);

374 
”r_abÜt
:

375 ià(
sock
 !ğ
NULL
) {

376 
	`pgm_şo£
 (
sock
, 
FALSE
);

377 
sock
 = 
NULL
;

379 ià(
»s
 !ğ
NULL
) {

380 
	`pgm_ä“addršfo
 (
»s
);

381 
»s
 = 
NULL
;

383 ià(
pgm_”rÜ
 !ğ
NULL
) {

384 
	`pgm_”rÜ_ä“
 (
pgm_”rÜ
);

385 
pgm_”rÜ
 = 
NULL
;

387 
”ºo
 = 
EINVAL
;

389 
	}
}

391 
	gzmq
::
pgm_sock‘_t
::~
	$pgm_sock‘_t
 ()

393 ià(
pgm_msgv
)

394 
	`ä“
 (
pgm_msgv
);

395 ià(
sock
)

396 
	`pgm_şo£
 (
sock
, 
TRUE
);

397 
	}
}

401 
	gzmq
::
pgm_sock‘_t
::
	$g‘_»ûiv”_fds
 (
fd_t
 *
»ûive_fd_
,

402 
fd_t
 *
wa™šg_pe_fd_
)

404 
sockËn_t
 
sockËn
;

405 
boŞ
 
rc
;

407 
	`zmq_as£¹
 (
»ûive_fd_
);

408 
	`zmq_as£¹
 (
wa™šg_pe_fd_
);

410 
sockËn
 =  (*
»ûive_fd_
);

411 
rc
 = 
	`pgm_g‘sockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_RECV_SOCK
, 
»ûive_fd_
,

412 &
sockËn
);

413 
	`zmq_as£¹
 (
rc
);

414 
	`zmq_as£¹
 (
sockËn
 =ğ (*
»ûive_fd_
));

416 
sockËn
 =  (*
wa™šg_pe_fd_
);

417 
rc
 = 
	`pgm_g‘sockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_PENDING_SOCK
, 
wa™šg_pe_fd_
,

418 &
sockËn
);

419 
	`zmq_as£¹
 (
rc
);

420 
	`zmq_as£¹
 (
sockËn
 =ğ (*
wa™šg_pe_fd_
));

421 
	}
}

428 
	gzmq
::
pgm_sock‘_t
::
	$g‘_£nd”_fds
 (
fd_t
 *
£nd_fd_
, fd_ˆ*
»ûive_fd_
,

429 
fd_t
 *
rd©a_nÙify_fd_
, fd_ˆ*
³ndšg_nÙify_fd_
)

431 
sockËn_t
 
sockËn
;

432 
boŞ
 
rc
;

434 
	`zmq_as£¹
 (
£nd_fd_
);

435 
	`zmq_as£¹
 (
»ûive_fd_
);

436 
	`zmq_as£¹
 (
rd©a_nÙify_fd_
);

437 
	`zmq_as£¹
 (
³ndšg_nÙify_fd_
);

439 
sockËn
 =  (*
£nd_fd_
);

440 
rc
 = 
	`pgm_g‘sockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_SEND_SOCK
, 
£nd_fd_
, &
sockËn
);

441 
	`zmq_as£¹
 (
rc
);

442 
	`zmq_as£¹
 (
sockËn
 =ğ (*
»ûive_fd_
));

444 
sockËn
 =  (*
»ûive_fd_
);

445 
rc
 = 
	`pgm_g‘sockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_RECV_SOCK
, 
»ûive_fd_
,

446 &
sockËn
);

447 
	`zmq_as£¹
 (
rc
);

448 
	`zmq_as£¹
 (
sockËn
 =ğ (*
»ûive_fd_
));

450 
sockËn
 =  (*
rd©a_nÙify_fd_
);

451 
rc
 = 
	`pgm_g‘sockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_REPAIR_SOCK
, 
rd©a_nÙify_fd_
,

452 &
sockËn
);

453 
	`zmq_as£¹
 (
rc
);

454 
	`zmq_as£¹
 (
sockËn
 =ğ (*
rd©a_nÙify_fd_
));

456 
sockËn
 =  (*
³ndšg_nÙify_fd_
);

457 
rc
 = 
	`pgm_g‘sockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_PENDING_SOCK
,

458 
³ndšg_nÙify_fd_
, &
sockËn
);

459 
	`zmq_as£¹
 (
rc
);

460 
	`zmq_as£¹
 (
sockËn
 =ğ (*
³ndšg_nÙify_fd_
));

461 
	}
}

465 
size_t
 
	gzmq
::
pgm_sock‘_t
::
	$£nd
 (*
d©a_
, 
size_t
 
d©a_Ën_
)

467 
size_t
 
nby‹s
 = 0;

469 cÚ¡ 
¡©us
 = 
	`pgm_£nd
 (
sock
, 
d©a_
, 
d©a_Ën_
, &
nby‹s
);

472 ià(
nby‹s
 > 0) {

473 
	`zmq_as£¹
 (
¡©us
 =ğ
PGM_IO_STATUS_NORMAL
);

474 
	`zmq_as£¹
 (
nby‹s
 =ğ
d©a_Ën_
);

477 
	`zmq_as£¹
 (
¡©us
 =ğ
PGM_IO_STATUS_RATE_LIMITED
 ||

478 
¡©us
 =ğ
PGM_IO_STATUS_WOULD_BLOCK
);

480 ià(
¡©us
 =ğ
PGM_IO_STATUS_RATE_LIMITED
)

481 
”ºo
 = 
ENOMEM
;

483 
”ºo
 = 
EBUSY
;

487 
Ï¡_tx_¡©us
 = 
¡©us
;

489  
nby‹s
;

490 
	}
}

492 
	gzmq
::
pgm_sock‘_t
::
	$g‘_rx_timeout
 ()

494 ià(
Ï¡_rx_¡©us
 !ğ
PGM_IO_STATUS_RATE_LIMITED
 &&

495 
Ï¡_rx_¡©us
 !ğ
PGM_IO_STATUS_TIMER_PENDING
)

498 
timev®
 
tv
;

499 
sockËn_t
 
İ’
 =  (
tv
);

500 cÚ¡ 
boŞ
 
rc
 = 
	`pgm_g‘sockİt
 (
sock
, 
IPPROTO_PGM
,

501 
Ï¡_rx_¡©us
 =ğ
PGM_IO_STATUS_RATE_LIMITED
 ? 
PGM_RATE_REMAIN
 :

502 
PGM_TIME_REMAIN
, &
tv
, &
İ’
);

503 
	`zmq_as£¹
 (
rc
);

505 cÚ¡ 
timeout
 = (
tv
.
tv_£c
 * 1000è+ (tv.
tv_u£c
 / 1000);

507  
timeout
;

508 
	}
}

510 
	gzmq
::
pgm_sock‘_t
::
	$g‘_tx_timeout
 ()

512 ià(
Ï¡_tx_¡©us
 !ğ
PGM_IO_STATUS_RATE_LIMITED
)

515 
timev®
 
tv
;

516 
sockËn_t
 
İ’
 =  (
tv
);

517 cÚ¡ 
boŞ
 
rc
 = 
	`pgm_g‘sockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_RATE_REMAIN
, &
tv
,

518 &
İ’
);

519 
	`zmq_as£¹
 (
rc
);

521 cÚ¡ 
timeout
 = (
tv
.
tv_£c
 * 1000è+ (tv.
tv_u£c
 / 1000);

523  
timeout
;

524 
	}
}

527 
size_t
 
	gzmq
::
pgm_sock‘_t
::
	$g‘_max_tsdu_size
 ()

529 
max_tsdu
 = 0;

530 
sockËn_t
 
İ’
 =  (
max_tsdu
);

532 
boŞ
 
rc
 = 
	`pgm_g‘sockİt
 (
sock
, 
IPPROTO_PGM
, 
PGM_MSS
, &
max_tsdu
, &
İ’
);

533 
	`zmq_as£¹
 (
rc
);

534 
	`zmq_as£¹
 (
İ’
 =ğ (
max_tsdu
));

535  (
size_t
è
max_tsdu
;

536 
	}
}

540 
ssize_t
 
	gzmq
::
pgm_sock‘_t
::
	$»ûive
 (**
¿w_d©a_
, cÚ¡ 
pgm_tsi_t
 **
tsi_
)

542 
size_t
 
¿w_d©a_Ën
 = 0;

546 ià(
nby‹s_»c
 =ğ
nby‹s_´oûs£d
 &&‚bytes_rec > 0) {

549 
nby‹s_»c
 = 0;

550 
nby‹s_´oûs£d
 = 0;

551 
pgm_msgv_´oûs£d
 = 0;

552 
”ºo
 = 
EAGAIN
;

558 ià(
nby‹s_»c
 =ğ
nby‹s_´oûs£d
) {

561 
	`zmq_as£¹
 (
pgm_msgv_´oûs£d
 == 0);

562 
	`zmq_as£¹
 (
nby‹s_´oûs£d
 == 0);

563 
	`zmq_as£¹
 (
nby‹s_»c
 == 0);

567 
pgm_”rÜ_t
 *
pgm_”rÜ
 = 
NULL
;

569 cÚ¡ 
¡©us
 = 
	`pgm_»cvmsgv
 (
sock
, 
pgm_msgv
,

570 
pgm_msgv_Ën
, 
MSG_ERRQUEUE
, &
nby‹s_»c
, &
pgm_”rÜ
);

573 
	`zmq_as£¹
 (
¡©us
 !ğ
PGM_IO_STATUS_ERROR
);

575 
Ï¡_rx_¡©us
 = 
¡©us
;

579 ià(
¡©us
 =ğ
PGM_IO_STATUS_TIMER_PENDING
) {

581 
	`zmq_as£¹
 (
nby‹s_»c
 == 0);

585 
nby‹s_»c
 = 0;

586 
”ºo
 = 
EBUSY
;

591 ià(
¡©us
 =ğ
PGM_IO_STATUS_RATE_LIMITED
) {

593 
	`zmq_as£¹
 (
nby‹s_»c
 == 0);

596 
nby‹s_»c
 = 0;

597 
”ºo
 = 
ENOMEM
;

602 ià(
¡©us
 =ğ
PGM_IO_STATUS_WOULD_BLOCK
) {

604 
	`zmq_as£¹
 (
nby‹s_»c
 == 0);

607 
nby‹s_»c
 = 0;

608 
”ºo
 = 
EAGAIN
;

613 ià(
¡©us
 =ğ
PGM_IO_STATUS_RESET
) {

615 
pgm_sk_buff_t
* 
skb
 = 
pgm_msgv
 [0].
msgv_skb
 [0];

618 *
tsi_
 = &
skb
->
tsi
;

619 
nby‹s_»c
 = 0;

622 
”ºo
 = 
EINVAL
;

623 
	`pgm_ä“_skb
 (
skb
);

627 
	`zmq_as£¹
 (
¡©us
 =ğ
PGM_IO_STATUS_NORMAL
);

631 
	`zmq_as£¹
 (
pgm_msgv_´oûs£d
 <ğ
pgm_msgv_Ën
);

635 
	`zmq_as£¹
 (
nby‹s_»c
 > 0);

638 
	`zmq_as£¹
 (
pgm_msgv
 [
pgm_msgv_´oûs£d
].
msgv_Ën
 == 1);

640 
pgm_sk_buff_t
* 
skb
 =

641 
pgm_msgv
 [
pgm_msgv_´oûs£d
].
msgv_skb
 [0];

644 *
¿w_d©a_
 = 
skb
->
d©a
;

645 
¿w_d©a_Ën
 = 
skb
->
Ën
;

648 *
tsi_
 = &
skb
->
tsi
;

651 
pgm_msgv_´oûs£d
++;

652 
	`zmq_as£¹
 (
pgm_msgv_´oûs£d
 <ğ
pgm_msgv_Ën
);

653 
nby‹s_´oûs£d
 +=
¿w_d©a_Ën
;

655  
¿w_d©a_Ën
;

656 
	}
}

658 
	gzmq
::
pgm_sock‘_t
::
	$´oûss_up¡»am
 ()

660 
pgm_msgv_t
 
dummy_msg
;

662 
size_t
 
dummy_by‹s
 = 0;

663 
pgm_”rÜ_t
 *
pgm_”rÜ
 = 
NULL
;

665 cÚ¡ 
¡©us
 = 
	`pgm_»cvmsgv
 (
sock
, &
dummy_msg
,

666 1, 
MSG_ERRQUEUE
, &
dummy_by‹s
, &
pgm_”rÜ
);

669 
	`zmq_as£¹
 (
¡©us
 !ğ
PGM_IO_STATUS_ERROR
);

672 
	`zmq_as£¹
 (
dummy_by‹s
 =ğ0 && (
¡©us
 =ğ
PGM_IO_STATUS_TIMER_PENDING
 ||

673 
¡©us
 =ğ
PGM_IO_STATUS_RATE_LIMITED
 ||

674 
¡©us
 =ğ
PGM_IO_STATUS_WOULD_BLOCK
));

676 
Ï¡_rx_¡©us
 = 
¡©us
;

678 ià(
¡©us
 =ğ
PGM_IO_STATUS_TIMER_PENDING
)

679 
”ºo
 = 
EBUSY
;

681 ià(
¡©us
 =ğ
PGM_IO_STATUS_RATE_LIMITED
)

682 
”ºo
 = 
ENOMEM
;

684 
”ºo
 = 
EAGAIN
;

685 
	}
}

687 
	gzmq
::
pgm_sock‘_t
::
	$compu‹_sqns
 (
du_
)

690 
ušt64_t
 
¿‹
 = 
	`ušt64_t
 (
İtiÚs
.rate) / 8;

693 
ušt64_t
 
size
 = 
	`ušt64_t
 (
İtiÚs
.
»cov”y_ivl
è* 
¿‹
;

696 
ušt64_t
 
sqns
 = 
size
 / 
du_
;

699 ià(
sqns
 == 0)

700 
sqns
 = 1;

702  (è
sqns
;

703 
	}
}

	@pgm_socket.hpp

20 #iâdeà
__PGM_SOCKET_HPP_INCLUDED__


21 
	#__PGM_SOCKET_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ià
defšed
 
ZMQ_HAVE_OPENPGM


27 #ifdeà
ZMQ_HAVE_WINDOWS


28 
	~"wšdows.hµ
"

29 
	#__PGM_WININT_H__


	)

32 
	~<pgm/pgm.h
>

34 #ifdeà
ZMQ_HAVE_OSX


35 
	~<pgm/š.h
>

38 
	~"fd.hµ
"

39 
	~"İtiÚs.hµ
"

41 
Çme¥aû
 
	gzmq


44 şas 
	cpgm_sock‘_t


47 
	gpublic
:

50 
pgm_sock‘_t
 (
boŞ
 
»ûiv”_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

53 ~
pgm_sock‘_t
 ();

56 
š™
 (
boŞ
 
udp_’ÿpsuÏtiÚ_
, cÚ¡ *
ÃtwÜk_
);

59 
š™_add»ss
(cÚ¡ *
ÃtwÜk_
, 
pgm_addršfo_t
 **
addr
, 
ušt16_t
 *
pÜt_numb”
);

62 
g‘_»ûiv”_fds
 (
fd_t
 *
»ûive_fd_
, fd_ˆ*
wa™šg_pe_fd_
);

66 
g‘_£nd”_fds
 (
fd_t
 *
£nd_fd_
, fd_ˆ*
»ûive_fd_
,

67 
fd_t
 *
rd©a_nÙify_fd_
, fd_ˆ*
³ndšg_nÙify_fd_
);

70 
size_t
 
£nd
 (*
d©a_
, size_ˆ
d©a_Ën_
);

73 
size_t
 
g‘_max_tsdu_size
 ();

76 
ssize_t
 
»ûive
 (**
d©a_
, cÚ¡ 
pgm_tsi_t
 **
tsi_
);

78 
g‘_rx_timeout
 ();

79 
g‘_tx_timeout
 ();

83 
´oûss_up¡»am
 ();

85 
	g´iv©e
:

88 
compu‹_sqns
 (
du_
);

91 
pgm_sock_t
* 
	gsock
;

93 
	gÏ¡_rx_¡©us
, 
	gÏ¡_tx_¡©us
;

96 
İtiÚs_t
 
	gİtiÚs
;

99 
boŞ
 
	g»ûiv”
;

103 
pgm_msgv_t
 *
	gpgm_msgv
;

106 
size_t
 
	gpgm_msgv_Ën
;

109 
size_t
 
	gnby‹s_»c
;

112 
size_t
 
	gnby‹s_´oûs£d
;

115 
size_t
 
	gpgm_msgv_´oûs£d
;

	@pipe.cpp

20 
	~<Ãw
>

21 
	~<¡ddef.h
>

23 
	~"pe.hµ
"

24 
	~"”r.hµ
"

26 
	~"ype.hµ
"

27 
	~"ype_cÚæ©e.hµ
"

29 
	gzmq
::
	$p•aœ
 (
şass
 
objeù_t
 *
·»Ás_
 [2], cÏs 
pe_t
* 
pes_
 [2],

30 
hwms_
 [2], 
boŞ
 
cÚæ©e_
 [2])

35 
ype_t
 <
	tmsg_t
, 
	tmes§ge_pe_g¿nuÏr™y
> 
	tupe_nÜm®_t
;

36 
ype_cÚæ©e_t
 <
	tmsg_t
, 
	tmes§ge_pe_g¿nuÏr™y
> 
	tupe_cÚæ©e_t
;

38 
pe_t
::
upe_t
 *
upe1
;

39 if(
cÚæ©e_
 [0])

40 
upe1
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`upe_cÚæ©e_t
 ();

42 
upe1
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`upe_nÜm®_t
 ();

43 
	`®loc_as£¹
 (
upe1
);

45 
pe_t
::
upe_t
 *
upe2
;

46 if(
cÚæ©e_
 [1])

47 
upe2
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`upe_cÚæ©e_t
 ();

49 
upe2
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`upe_nÜm®_t
 ();

50 
	`®loc_as£¹
 (
upe2
);

52 
pes_
 [0] = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`pe_t
 (
·»Ás_
 [0], 
upe1
, 
upe2
,

53 
hwms_
 [1], hwms_ [0], 
cÚæ©e_
 [0]);

54 
	`®loc_as£¹
 (
pes_
 [0]);

55 
pes_
 [1] = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`pe_t
 (
·»Ás_
 [1], 
upe2
, 
upe1
,

56 
hwms_
 [0], hwms_ [1], 
cÚæ©e_
 [1]);

57 
	`®loc_as£¹
 (
pes_
 [1]);

59 
pes_
 [0]->
	`£t_³”
 (pipes_ [1]);

60 
pes_
 [1]->
	`£t_³”
 (pipes_ [0]);

63 
	}
}

65 
	gzmq
::
pe_t
::
	$pe_t
 (
objeù_t
 *
·»Á_
, 
upe_t
 *
špe_
, upe_ˆ*
oue_
,

66 
šhwm_
, 
outhwm_
, 
boŞ
 
cÚæ©e_
) :

67 
	`objeù_t
 (
·»Á_
),

68 
	`špe
 (
špe_
),

69 
	`oue
 (
oue_
),

70 
	`š_aùive
 (
Œue
),

71 
	`out_aùive
 (
Œue
),

72 
	`hwm
 (
outhwm_
),

73 
	`lwm
 (
	`compu‹_lwm
 (
šhwm_
)),

74 
	`msgs_»ad
 (0),

75 
	`msgs_wr™‹n
 (0),

76 
	`³”s_msgs_»ad
 (0),

77 
	`³”
 (
NULL
),

78 
	`sšk
 (
NULL
),

79 
	`¡©e
 (
aùive
),

80 
	`d–ay
 (
Œue
),

81 
	$cÚæ©e
 (
cÚæ©e_
)

83 
	}
}

85 
	gzmq
::
pe_t
::~
	$pe_t
 ()

87 
	}
}

89 
zmq
::
pe_t
::
	$£t_³”
 (
pe_t
 *
³”_
)

92 
	`zmq_as£¹
 (!
³”
);

93 
³”
 = 
³”_
;

94 
	}
}

96 
	gzmq
::
pe_t
::
	$£t_ev’t_sšk
 (
i_pe_ev’ts
 *
sšk_
)

99 
	`zmq_as£¹
 (!
sšk
);

100 
sšk
 = 
sšk_
;

101 
	}
}

103 
	gzmq
::
pe_t
::
	$£t_id’t™y
 (cÚ¡ 
blob_t
 &
id’t™y_
)

105 
id’t™y
 = 
id’t™y_
;

106 
	}
}

108 
	gzmq
::
blob_t
 
zmq
::
pe_t
::
	$g‘_id’t™y
 ()

110  
id’t™y
;

111 
	}
}

113 
boŞ
 
	gzmq
::
pe_t
::
	$check_»ad
 ()

115 ià(
	`uÆik–y
 (!
š_aùive
))

116  
çl£
;

117 ià(
	`uÆik–y
 (
¡©e
 !ğ
aùive
 && s‹ !ğ
wa™šg_fÜ_d–im™”
))

118  
çl£
;

121 ià(!
špe
->
	`check_»ad
 ()) {

122 
š_aùive
 = 
çl£
;

123  
çl£
;

128 ià(
špe
->
	`´obe
 (
is_d–im™”
)) {

129 
msg_t
 
msg
;

130 
boŞ
 
ok
 = 
špe
->
	`»ad
 (&
msg
);

131 
	`zmq_as£¹
 (
ok
);

132 
	`´oûss_d–im™”
 ();

133  
çl£
;

136  
Œue
;

137 
	}
}

139 
boŞ
 
	gzmq
::
pe_t
::
	$»ad
 (
msg_t
 *
msg_
)

141 ià(
	`uÆik–y
 (!
š_aùive
))

142  
çl£
;

143 ià(
	`uÆik–y
 (
¡©e
 !ğ
aùive
 && s‹ !ğ
wa™šg_fÜ_d–im™”
))

144  
çl£
;

146 ià(!
špe
->
	`»ad
 (
msg_
)) {

147 
š_aùive
 = 
çl£
;

148  
çl£
;

152 ià(
msg_
->
	`is_d–im™”
 ()) {

153 
	`´oûss_d–im™”
 ();

154  
çl£
;

157 ià(!(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
è&& !msg_->
	`is_id’t™y
 ())

158 
msgs_»ad
++;

160 ià(
lwm
 > 0 && 
msgs_»ad
 %†wm == 0)

161 
	`£nd_aùiv©e_wr™e
 (
³”
, 
msgs_»ad
);

163  
Œue
;

164 
	}
}

166 
boŞ
 
	gzmq
::
pe_t
::
	$check_wr™e
 ()

168 ià(
	`uÆik–y
 (!
out_aùive
 || 
¡©e
 !ğ
aùive
))

169  
çl£
;

171 
boŞ
 
fuÎ
 = 
hwm
 > 0 && 
msgs_wr™‹n
 - 
³”s_msgs_»ad
 =ğ
	`ušt64_t
 (hwm);

173 ià(
	`uÆik–y
 (
fuÎ
)) {

174 
out_aùive
 = 
çl£
;

175  
çl£
;

178  
Œue
;

179 
	}
}

181 
boŞ
 
	gzmq
::
pe_t
::
	$wr™e
 (
msg_t
 *
msg_
)

183 ià(
	`uÆik–y
 (!
	`check_wr™e
 ()))

184  
çl£
;

186 
boŞ
 
mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::mÜ? 
Œue
 : 
çl£
;

187 cÚ¡ 
boŞ
 
is_id’t™y
 = 
msg_
->
	`is_id’t™y
 ();

188 
oue
->
	`wr™e
 (*
msg_
, 
mÜe
);

189 ià(!
mÜe
 && !
is_id’t™y
)

190 
msgs_wr™‹n
++;

192  
Œue
;

193 
	}
}

195 
	gzmq
::
pe_t
::
	$rŞlback
 ()

198 
msg_t
 
msg
;

199 ià(
oue
) {

200 
oue
->
	`unwr™e
 (&
msg
)) {

201 
	`zmq_as£¹
 (
msg
.
	`æags
 (è& 
msg_t
::
mÜe
);

202 
rc
 = 
msg
.
	`şo£
 ();

203 
	`”ºo_as£¹
 (
rc
 == 0);

206 
	}
}

208 
	gzmq
::
pe_t
::
	$æush
 ()

211 ià(
¡©e
 =ğ
‹rm_ack_£Á
)

214 ià(
oue
 && !oue->
	`æush
 ())

215 
	`£nd_aùiv©e_»ad
 (
³”
);

216 
	}
}

218 
	gzmq
::
pe_t
::
	$´oûss_aùiv©e_»ad
 ()

220 ià(!
š_aùive
 && (
¡©e
 =ğ
aùive
 || s‹ =ğ
wa™šg_fÜ_d–im™”
)) {

221 
š_aùive
 = 
Œue
;

222 
sšk
->
	`»ad_aùiv©ed
 (
this
);

224 
	}
}

226 
	gzmq
::
pe_t
::
	$´oûss_aùiv©e_wr™e
 (
ušt64_t
 
msgs_»ad_
)

229 
³”s_msgs_»ad
 = 
msgs_»ad_
;

231 ià(!
out_aùive
 && 
¡©e
 =ğ
aùive
) {

232 
out_aùive
 = 
Œue
;

233 
sšk
->
	`wr™e_aùiv©ed
 (
this
);

235 
	}
}

237 
	gzmq
::
pe_t
::
	$´oûss_hiccup
 (*
pe_
)

241 
	`zmq_as£¹
 (
oue
);

242 
oue
->
	`æush
 ();

243 
msg_t
 
msg
;

244 
oue
->
	`»ad
 (&
msg
)) {

245 
rc
 = 
msg
.
	`şo£
 ();

246 
	`”ºo_as£¹
 (
rc
 == 0);

248 
d–‘e
 
oue
;

251 
	`zmq_as£¹
 (
pe_
);

252 
oue
 = (
upe_t
*è
pe_
;

253 
out_aùive
 = 
Œue
;

256 ià(
¡©e
 =ğ
aùive
)

257 
sšk
->
	`hiccu³d
 (
this
);

258 
	}
}

260 
	gzmq
::
pe_t
::
	$´oûss_pe_‹rm
 ()

267 ià(
¡©e
 =ğ
aùive
) {

268 ià(!
d–ay
) {

269 
¡©e
 = 
‹rm_ack_£Á
;

270 
oue
 = 
NULL
;

271 
	`£nd_pe_‹rm_ack
 (
³”
);

274 
¡©e
 = 
wa™šg_fÜ_d–im™”
;

280 ià(
¡©e
 =ğ
d–im™”_»ûived
) {

281 
¡©e
 = 
‹rm_ack_£Á
;

282 
oue
 = 
NULL
;

283 
	`£nd_pe_‹rm_ack
 (
³”
);

290 ià(
¡©e
 =ğ
‹rm_»q_£Á1
) {

291 
¡©e
 = 
‹rm_»q_£Á2
;

292 
oue
 = 
NULL
;

293 
	`£nd_pe_‹rm_ack
 (
³”
);

298 
	`zmq_as£¹
 (
çl£
);

299 
	}
}

301 
	gzmq
::
pe_t
::
	$´oûss_pe_‹rm_ack
 ()

304 
	`zmq_as£¹
 (
sšk
);

305 
sšk
->
	`pe_‹rmš©ed
 (
this
);

311 ià(
¡©e
 =ğ
‹rm_»q_£Á1
) {

312 
oue
 = 
NULL
;

313 
	`£nd_pe_‹rm_ack
 (
³”
);

316 
	`zmq_as£¹
 (
¡©e
 =ğ
‹rm_ack_£Á
 || s‹ =ğ
‹rm_»q_£Á2
);

324 ià(!
cÚæ©e
) {

325 
msg_t
 
msg
;

326 
špe
->
	`»ad
 (&
msg
)) {

327 
rc
 = 
msg
.
	`şo£
 ();

328 
	`”ºo_as£¹
 (
rc
 == 0);

332 
d–‘e
 
špe
;

335 
d–‘e
 
this
;

336 
	}
}

338 
	gzmq
::
pe_t
::
	$£t_nod–ay
 ()

340 
this
->
d–ay
 = 
çl£
;

341 
	}
}

343 
	gzmq
::
pe_t
::
	$‹rmš©e
 (
boŞ
 
d–ay_
)

346 
d–ay
 = 
d–ay_
;

349 ià(
¡©e
 =ğ
‹rm_»q_£Á1
 || s‹ =ğ
‹rm_»q_£Á2
)

355 ià(
¡©e
 =ğ
‹rm_ack_£Á
)

361 ià(
¡©e
 =ğ
aùive
) {

362 
	`£nd_pe_‹rm
 (
³”
);

363 
¡©e
 = 
‹rm_»q_£Á1
;

369 ià(
¡©e
 =ğ
wa™šg_fÜ_d–im™”
 && !
d–ay
) {

370 
oue
 = 
NULL
;

371 
	`£nd_pe_‹rm_ack
 (
³”
);

372 
¡©e
 = 
‹rm_ack_£Á
;

377 ià(
¡©e
 =ğ
wa™šg_fÜ_d–im™”
) {

384 ià(
¡©e
 =ğ
d–im™”_»ûived
) {

385 
	`£nd_pe_‹rm
 (
³”
);

386 
¡©e
 = 
‹rm_»q_£Á1
;

391 
	`zmq_as£¹
 (
çl£
);

394 
out_aùive
 = 
çl£
;

396 ià(
oue
) {

399 
	`rŞlback
 ();

403 
msg_t
 
msg
;

404 
msg
.
	`š™_d–im™”
 ();

405 
oue
->
	`wr™e
 (
msg
, 
çl£
);

406 
	`æush
 ();

408 
	}
}

410 
boŞ
 
	gzmq
::
pe_t
::
	$is_d–im™”
 (
msg_t
 &
msg_
)

412  
msg_
.
	`is_d–im™”
 ();

413 
	}
}

415 
	gzmq
::
pe_t
::
	$compu‹_lwm
 (
hwm_
)

437 
»suÉ
 = (
hwm_
 > 
max_wm_d–
 * 2) ?

438 
hwm_
 - 
max_wm_d–
 : (hwm_ + 1) / 2;

440  
»suÉ
;

441 
	}
}

443 
	gzmq
::
pe_t
::
	$´oûss_d–im™”
 ()

445 
	`zmq_as£¹
 (
¡©e
 =ğ
aùive


446 || 
¡©e
 =ğ
wa™šg_fÜ_d–im™”
);

448 ià(
¡©e
 =ğ
aùive
)

449 
¡©e
 = 
d–im™”_»ûived
;

451 
oue
 = 
NULL
;

452 
	`£nd_pe_‹rm_ack
 (
³”
);

453 
¡©e
 = 
‹rm_ack_£Á
;

455 
	}
}

457 
	gzmq
::
pe_t
::
	$hiccup
 ()

460 ià(
¡©e
 !ğ
aùive
)

465 
špe
 = 
NULL
;

468 ià(
cÚæ©e
)

469 
špe
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

470 
ype_cÚæ©e_t
 <
msg_t
, 
mes§ge_pe_g¿nuÏr™y
> ();

472 
špe
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

473 
ype_t
 <
msg_t
, 
mes§ge_pe_g¿nuÏr™y
> ();

475 
	`®loc_as£¹
 (
špe
);

476 
š_aùive
 = 
Œue
;

479 
	`£nd_hiccup
 (
³”
, (*è
špe
);

480 
	}
}

482 
	gzmq
::
pe_t
::
	$£t_hwms
 (
šhwm_
, 
outhwm_
)

484 
lwm
 = 
	`compu‹_lwm
 (
šhwm_
);

485 
hwm
 = 
outhwm_
;

486 
	}
}

	@pipe.hpp

20 #iâdeà
__ZMQ_PIPE_HPP_INCLUDED__


21 
	#__ZMQ_PIPE_HPP_INCLUDED__


	)

23 
	~"msg.hµ
"

24 
	~"ype_ba£.hµ
"

25 
	~"cÚfig.hµ
"

26 
	~"objeù.hµ
"

27 
	~"¡dšt.hµ
"

28 
	~"¬¿y.hµ
"

29 
	~"blob.hµ
"

31 
Çme¥aû
 
	gzmq


34 
şass
 
	gobjeù_t
;

35 
şass
 
	gpe_t
;

45 
p•aœ
 (
zmq
::
objeù_t
 *
·»Ás_
 [2], zmq::
pe_t
* 
pes_
 [2],

46 
hwms_
 [2], 
boŞ
 
cÚæ©e_
 [2]);

48 
	si_pe_ev’ts


50 
	gvœtu®
 ~
i_pe_ev’ts
 () {}

52 
vœtu®
 
»ad_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
) = 0;

53 
vœtu®
 
wr™e_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
) = 0;

54 
vœtu®
 
hiccu³d
 (
zmq
::
pe_t
 *
pe_
) = 0;

55 
vœtu®
 
pe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
) = 0;

62 
şass
 
	gpe_t
 :

63 
public
 
objeù_t
,

64 
public
 
	g¬¿y_™em_t
 <1>,

65 
public
 
	g¬¿y_™em_t
 <2>,

66 
public
 
	g¬¿y_™em_t
 <3>

69 
ä›nd
 
p•aœ
 (
zmq
::
objeù_t
 *
·»Ás_
 [2], zmq::
pe_t
* 
pes_
 [2],

70 
hwms_
 [2], 
boŞ
 
cÚæ©e_
 [2]);

72 
	gpublic
:

75 
£t_ev’t_sšk
 (
i_pe_ev’ts
 *
sšk_
);

78 
£t_id’t™y
 (cÚ¡ 
blob_t
 &
id’t™y_
);

79 
blob_t
 
g‘_id’t™y
 ();

82 
boŞ
 
check_»ad
 ();

85 
boŞ
 
»ad
 (
msg_t
 *
msg_
);

89 
boŞ
 
check_wr™e
 ();

93 
boŞ
 
wr™e
 (
msg_t
 *
msg_
);

96 
rŞlback
 ();

99 
æush
 ();

104 
hiccup
 ();

107 
£t_nod–ay
 ();

113 
‹rmš©e
 (
boŞ
 
d–ay_
);

116 
£t_hwms
 (
šhwm_
, 
outhwm_
);

118 
	g´iv©e
:

121 
ype_ba£_t
 <
	tmsg_t
, 
	tmes§ge_pe_g¿nuÏr™y
> 
	tupe_t
;

124 
´oûss_aùiv©e_»ad
 ();

125 
´oûss_aùiv©e_wr™e
 (
ušt64_t
 
msgs_»ad_
);

126 
´oûss_hiccup
 (*
pe_
);

127 
´oûss_pe_‹rm
 ();

128 
´oûss_pe_‹rm_ack
 ();

131 
´oûss_d–im™”
 ();

135 
pe_t
 (
objeù_t
 *
·»Á_
, 
upe_t
 *
špe_
, upe_ˆ*
oue_
,

136 
šhwm_
, 
outhwm_
, 
boŞ
 
cÚæ©e_
);

140 
£t_³”
 (
pe_t
 *
pe_
);

143 ~
pe_t
 ();

146 
upe_t
 *
	gšpe
;

147 
upe_t
 *
	goue
;

150 
boŞ
 
	gš_aùive
;

151 
boŞ
 
	gout_aùive
;

154 
	ghwm
;

157 
	glwm
;

160 
ušt64_t
 
	gmsgs_»ad
;

161 
ušt64_t
 
	gmsgs_wr™‹n
;

165 
ušt64_t
 
	g³”s_msgs_»ad
;

168 
pe_t
 *
	g³”
;

171 
i_pe_ev’ts
 *
	gsšk
;

185 
	gaùive
,

186 
	gd–im™”_»ûived
,

187 
	gwa™šg_fÜ_d–im™”
,

188 
	g‹rm_ack_£Á
,

189 
	g‹rm_»q_£Á1
,

190 
	g‹rm_»q_£Á2


191 } 
	g¡©e
;

196 
boŞ
 
	gd–ay
;

199 
blob_t
 
	gid’t™y
;

202 
boŞ
 
is_d–im™”
 (
msg_t
 &
msg_
);

205 
compu‹_lwm
 (
hwm_
);

207 
boŞ
 
	gcÚæ©e
;

210 
pe_t
 (const…ipe_t&);

211 cÚ¡ 
	gpe_t
 &
	gİ”©Ü
 = (cÚ¡ 
pe_t
&);

	@plain_mechanism.cpp

20 
	~"¶©fÜm.hµ
"

21 #ifdeà
ZMQ_HAVE_WINDOWS


22 
	~"wšdows.hµ
"

25 
	~<¡ršg.h
>

26 
	~<¡ršg
>

28 
	~"msg.hµ
"

29 
	~"£ssiÚ_ba£.hµ
"

30 
	~"”r.hµ
"

31 
	~"¶aš_mechªism.hµ
"

32 
	~"wœe.hµ
"

34 
	gzmq
::
¶aš_mechªism_t
::
	$¶aš_mechªism_t
 (
£ssiÚ_ba£_t
 *
£ssiÚ_
,

35 cÚ¡ 
¡d
::
¡ršg
 &
³”_add»ss_
,

36 cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

37 
	`mechªism_t
 (
İtiÚs_
),

38 
	`£ssiÚ
 (
£ssiÚ_
),

39 
	`³”_add»ss
 (
³”_add»ss_
),

40 
	`ex³ùšg_z­_»¶y
 (
çl£
),

41 
	`¡©e
 (
İtiÚs
.
as_£rv”
? 
wa™šg_fÜ_h–lo
: 
£ndšg_h–lo
)

43 
	}
}

45 
zmq
::
¶aš_mechªism_t
::~
	$¶aš_mechªism_t
 ()

47 
	}
}

49 
zmq
::
¶aš_mechªism_t
::
	$Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
)

51 
rc
 = 0;

53 
¡©e
) {

54 
£ndšg_h–lo
:

55 
rc
 = 
	`´oduû_h–lo
 (
msg_
);

56 ià(
rc
 == 0)

57 
¡©e
 = 
wa™šg_fÜ_w–come
;

59 
£ndšg_w–come
:

60 
rc
 = 
	`´oduû_w–come
 (
msg_
);

61 ià(
rc
 == 0)

62 
¡©e
 = 
wa™šg_fÜ_š™Ÿ‹
;

64 
£ndšg_š™Ÿ‹
:

65 
rc
 = 
	`´oduû_š™Ÿ‹
 (
msg_
);

66 ià(
rc
 == 0)

67 
¡©e
 = 
wa™šg_fÜ_»ady
;

69 
£ndšg_»ady
:

70 
rc
 = 
	`´oduû_»ady
 (
msg_
);

71 ià(
rc
 == 0)

72 
¡©e
 = 
»ady
;

75 
”ºo
 = 
EAGAIN
;

76 
rc
 = -1;

78  
rc
;

79 
	}
}

81 
	gzmq
::
¶aš_mechªism_t
::
	$´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
)

83 
rc
 = 0;

85 
¡©e
) {

86 
wa™šg_fÜ_h–lo
:

87 
rc
 = 
	`´oûss_h–lo
 (
msg_
);

88 ià(
rc
 == 0)

89 
¡©e
 = 
ex³ùšg_z­_»¶y
? 
wa™šg_fÜ_z­_»¶y
: 
£ndšg_w–come
;

91 
wa™šg_fÜ_w–come
:

92 
rc
 = 
	`´oûss_w–come
 (
msg_
);

93 ià(
rc
 == 0)

94 
¡©e
 = 
£ndšg_š™Ÿ‹
;

96 
wa™šg_fÜ_š™Ÿ‹
:

97 
rc
 = 
	`´oûss_š™Ÿ‹
 (
msg_
);

98 ià(
rc
 == 0)

99 
¡©e
 = 
£ndšg_»ady
;

101 
wa™šg_fÜ_»ady
:

102 
rc
 = 
	`´oûss_»ady
 (
msg_
);

103 ià(
rc
 == 0)

104 
¡©e
 = 
»ady
;

107 
”ºo
 = 
EPROTO
;

108 
rc
 = -1;

111 ià(
rc
 == 0) {

112 
rc
 = 
msg_
->
	`şo£
 ();

113 
	`”ºo_as£¹
 (
rc
 == 0);

114 
rc
 = 
msg_
->
	`š™
 ();

115 
	`”ºo_as£¹
 (
rc
 == 0);

117  
rc
;

118 
	}
}

120 
boŞ
 
	gzmq
::
¶aš_mechªism_t
::
	$is_hªdshake_com¶‘e
 () const

122  
¡©e
 =ğ
»ady
;

123 
	}
}

125 
	gzmq
::
¶aš_mechªism_t
::
	$z­_msg_avaabË
 ()

127 ià(
¡©e
 !ğ
wa™šg_fÜ_z­_»¶y
) {

128 
”ºo
 = 
EFSM
;

131 cÚ¡ 
rc
 = 
	`»ûive_ªd_´oûss_z­_»¶y
 ();

132 ià(
rc
 == 0)

133 
¡©e
 = 
£ndšg_w–come
;

134  
rc
;

135 
	}
}

137 
	gzmq
::
¶aš_mechªism_t
::
	$´oduû_h–lo
 (
msg_t
 *
msg_
) const

139 cÚ¡ 
¡d
::
¡ršg
 
u£ºame
 = 
İtiÚs
.
¶aš_u£ºame
;

140 
	`zmq_as£¹
 (
u£ºame
.
	`Ëngth
 () < 256);

142 cÚ¡ 
¡d
::
¡ršg
 
·sswÜd
 = 
İtiÚs
.
¶aš_·sswÜd
;

143 
	`zmq_as£¹
 (
·sswÜd
.
	`Ëngth
 () < 256);

145 cÚ¡ 
size_t
 
commªd_size
 = 6 + 1 + 
u£ºame
.
	`Ëngth
 ()

146 + 1 + 
·sswÜd
.
	`Ëngth
 ();

148 cÚ¡ 
rc
 = 
msg_
->
	`š™_size
 (
commªd_size
);

149 
	`”ºo_as£¹
 (
rc
 == 0);

151 *
±r
 = 
¡©ic_ÿ¡
 <*> (
msg_
->
	`d©a
 ());

152 
	`memıy
 (
±r
, "\x05HELLO", 6);

153 
±r
 += 6;

155 *
±r
++ = 
¡©ic_ÿ¡
 <> (
u£ºame
.
	`Ëngth
 ());

156 
	`memıy
 (
±r
, 
u£ºame
.
	`c_¡r
 (), u£ºame.
	`Ëngth
 ());

157 
±r
 +ğ
u£ºame
.
	`Ëngth
 ();

159 *
±r
++ = 
¡©ic_ÿ¡
 <> (
·sswÜd
.
	`Ëngth
 ());

160 
	`memıy
 (
±r
, 
·sswÜd
.
	`c_¡r
 (),…asswÜd.
	`Ëngth
 ());

161 
±r
 +ğ
·sswÜd
.
	`Ëngth
 ();

164 
	}
}

167 
	gzmq
::
¶aš_mechªism_t
::
	$´oûss_h–lo
 (
msg_t
 *
msg_
)

169 cÚ¡ *
±r
 = 
¡©ic_ÿ¡
 <*> (
msg_
->
	`d©a
 ());

170 
size_t
 
by‹s_Ëá
 = 
msg_
->
	`size
 ();

172 ià(
by‹s_Ëá
 < 6 || 
	`memcmp
 (
±r
, "\x05HELLO", 6)) {

173 
”ºo
 = 
EPROTO
;

176 
±r
 += 6;

177 
by‹s_Ëá
 -= 6;

179 ià(
by‹s_Ëá
 < 1) {

180 
”ºo
 = 
EPROTO
;

183 cÚ¡ 
size_t
 
u£ºame_Ëngth
 = 
¡©ic_ÿ¡
 <size_t> (*
±r
++);

184 
by‹s_Ëá
 -= 1;

186 ià(
by‹s_Ëá
 < 
u£ºame_Ëngth
) {

187 
”ºo
 = 
EPROTO
;

190 cÚ¡ 
¡d
::
¡ršg
 
u£ºame
 = std::
	`¡ršg
 ((*è
±r
, 
u£ºame_Ëngth
);

191 
±r
 +ğ
u£ºame_Ëngth
;

192 
by‹s_Ëá
 -ğ
u£ºame_Ëngth
;

194 ià(
by‹s_Ëá
 < 1) {

195 
”ºo
 = 
EPROTO
;

198 cÚ¡ 
size_t
 
·sswÜd_Ëngth
 = 
¡©ic_ÿ¡
 <size_t> (*
±r
++);

199 
by‹s_Ëá
 -= 1;

201 ià(
by‹s_Ëá
 < 
·sswÜd_Ëngth
) {

202 
”ºo
 = 
EPROTO
;

205 cÚ¡ 
¡d
::
¡ršg
 
·sswÜd
 = std::
	`¡ršg
 ((*è
±r
, 
·sswÜd_Ëngth
);

206 
±r
 +ğ
·sswÜd_Ëngth
;

207 
by‹s_Ëá
 -ğ
·sswÜd_Ëngth
;

209 ià(
by‹s_Ëá
 > 0) {

210 
”ºo
 = 
EPROTO
;

215 
rc
 = 
£ssiÚ
->
	`z­_cÚÃù
 ();

216 ià(
rc
 == 0) {

217 
	`£nd_z­_»que¡
 (
u£ºame
, 
·sswÜd
);

218 
rc
 = 
	`»ûive_ªd_´oûss_z­_»¶y
 ();

219 ià(
rc
 != 0) {

220 ià(
”ºo
 !ğ
EAGAIN
)

222 
ex³ùšg_z­_»¶y
 = 
Œue
;

227 
	}
}

229 
	gzmq
::
¶aš_mechªism_t
::
	$´oduû_w–come
 (
msg_t
 *
msg_
) const

231 cÚ¡ 
rc
 = 
msg_
->
	`š™_size
 (8);

232 
	`”ºo_as£¹
 (
rc
 == 0);

233 
	`memıy
 (
msg_
->
	`d©a
 (), "\x07WELCOME", 8);

235 
	}
}

237 
	gzmq
::
¶aš_mechªism_t
::
	$´oûss_w–come
 (
msg_t
 *
msg_
)

239 cÚ¡ *
±r
 = 
¡©ic_ÿ¡
 <*> (
msg_
->
	`d©a
 ());

240 
size_t
 
by‹s_Ëá
 = 
msg_
->
	`size
 ();

242 ià(
by‹s_Ëá
 !ğ8 || 
	`memcmp
 (
±r
, "\x07WELCOME", 8)) {

243 
”ºo
 = 
EPROTO
;

247 
	}
}

249 
	gzmq
::
¶aš_mechªism_t
::
	$´oduû_š™Ÿ‹
 (
msg_t
 *
msg_
) const

251 * cÚ¡ 
commªd_bufãr
 = (*è
	`m®loc
 (512);

252 
	`®loc_as£¹
 (
commªd_bufãr
);

254 *
±r
 = 
commªd_bufãr
;

257 
	`memıy
 (
±r
, "\x08INITIATE", 9);

258 
±r
 += 9;

261 cÚ¡ *
sock‘_ty³
 = 
	`sock‘_ty³_¡ršg
 (
İtiÚs
.
ty³
);

262 
±r
 +ğ
	`add_´İ”ty
 (±r, "Sock‘-Ty³", 
sock‘_ty³
, 
	`¡¾’
 (socket_type));

265 ià(
İtiÚs
.
ty³
 =ğ
ZMQ_REQ


266 || 
İtiÚs
.
ty³
 =ğ
ZMQ_DEALER


267 || 
İtiÚs
.
ty³
 =ğ
ZMQ_ROUTER
) {

268 
±r
 +ğ
	`add_´İ”ty
 (ptr, "Identity",

269 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

272 cÚ¡ 
size_t
 
commªd_size
 = 
±r
 - 
commªd_bufãr
;

273 cÚ¡ 
rc
 = 
msg_
->
	`š™_size
 (
commªd_size
);

274 
	`”ºo_as£¹
 (
rc
 == 0);

275 
	`memıy
 (
msg_
->
	`d©a
 (), 
commªd_bufãr
, 
commªd_size
);

276 
	`ä“
 (
commªd_bufãr
);

279 
	}
}

281 
	gzmq
::
¶aš_mechªism_t
::
	$´oûss_š™Ÿ‹
 (
msg_t
 *
msg_
)

283 cÚ¡ *
±r
 = 
¡©ic_ÿ¡
 <*> (
msg_
->
	`d©a
 ());

284 
size_t
 
by‹s_Ëá
 = 
msg_
->
	`size
 ();

286 ià(
by‹s_Ëá
 < 9 || 
	`memcmp
 (
±r
, "\x08INITIATE", 9)) {

287 
”ºo
 = 
EPROTO
;

290 
±r
 += 9;

291 
by‹s_Ëá
 -= 9;

292  
	`·r£_m‘ad©a
 (
±r
, 
by‹s_Ëá
);

293 
	}
}

295 
	gzmq
::
¶aš_mechªism_t
::
	$´oduû_»ady
 (
msg_t
 *
msg_
) const

297 * cÚ¡ 
commªd_bufãr
 = (*è
	`m®loc
 (512);

298 
	`®loc_as£¹
 (
commªd_bufãr
);

300 *
±r
 = 
commªd_bufãr
;

303 
	`memıy
 (
±r
, "\x05READY", 6);

304 
±r
 += 6;

307 cÚ¡ *
sock‘_ty³
 = 
	`sock‘_ty³_¡ršg
 (
İtiÚs
.
ty³
);

308 
±r
 +ğ
	`add_´İ”ty
 (±r, "Sock‘-Ty³", 
sock‘_ty³
, 
	`¡¾’
 (socket_type));

311 ià(
İtiÚs
.
ty³
 =ğ
ZMQ_REQ


312 || 
İtiÚs
.
ty³
 =ğ
ZMQ_DEALER


313 || 
İtiÚs
.
ty³
 =ğ
ZMQ_ROUTER
) {

314 
±r
 +ğ
	`add_´İ”ty
 (ptr, "Identity",

315 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

318 cÚ¡ 
size_t
 
commªd_size
 = 
±r
 - 
commªd_bufãr
;

319 cÚ¡ 
rc
 = 
msg_
->
	`š™_size
 (
commªd_size
);

320 
	`”ºo_as£¹
 (
rc
 == 0);

321 
	`memıy
 (
msg_
->
	`d©a
 (), 
commªd_bufãr
, 
commªd_size
);

322 
	`ä“
 (
commªd_bufãr
);

325 
	}
}

327 
	gzmq
::
¶aš_mechªism_t
::
	$´oûss_»ady
 (
msg_t
 *
msg_
)

329 cÚ¡ *
±r
 = 
¡©ic_ÿ¡
 <*> (
msg_
->
	`d©a
 ());

330 
size_t
 
by‹s_Ëá
 = 
msg_
->
	`size
 ();

332 ià(
by‹s_Ëá
 < 6 || 
	`memcmp
 (
±r
, "\x05READY", 6)) {

333 
”ºo
 = 
EPROTO
;

336 
±r
 += 6;

337 
by‹s_Ëá
 -= 6;

338  
	`·r£_m‘ad©a
 (
±r
, 
by‹s_Ëá
);

339 
	}
}

341 
	gzmq
::
¶aš_mechªism_t
::
	$£nd_z­_»que¡
 (cÚ¡ 
¡d
::
¡ršg
 &
u£ºame
,

342 cÚ¡ 
¡d
::
¡ršg
 &
·sswÜd
)

344 
rc
;

345 
msg_t
 
msg
;

348 
rc
 = 
msg
.
	`š™
 ();

349 
	`”ºo_as£¹
 (
rc
 == 0);

350 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

351 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

352 
	`”ºo_as£¹
 (
rc
 == 0);

355 
rc
 = 
msg
.
	`š™_size
 (3);

356 
	`”ºo_as£¹
 (
rc
 == 0);

357 
	`memıy
 (
msg
.
	`d©a
 (), "1.0", 3);

358 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

359 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

360 
	`”ºo_as£¹
 (
rc
 == 0);

363 
rc
 = 
msg
.
	`š™_size
 (1);

364 
	`”ºo_as£¹
 (
rc
 == 0);

365 
	`memıy
 (
msg
.
	`d©a
 (), "1", 1);

366 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

367 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

368 
	`”ºo_as£¹
 (
rc
 == 0);

371 
rc
 = 
msg
.
	`š™_size
 (
İtiÚs
.
z­_domaš
.
	`Ëngth
 ());

372 
	`”ºo_as£¹
 (
rc
 == 0);

373 
	`memıy
 (
msg
.
	`d©a
 (), 
İtiÚs
.
z­_domaš
.
	`c_¡r
 (), o±iÚs.z­_domaš.
	`Ëngth
 ());

374 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

375 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

376 
	`”ºo_as£¹
 (
rc
 == 0);

379 
rc
 = 
msg
.
	`š™_size
 (
³”_add»ss
.
	`Ëngth
 ());

380 
	`”ºo_as£¹
 (
rc
 == 0);

381 
	`memıy
 (
msg
.
	`d©a
 (), 
³”_add»ss
.
	`c_¡r
 (),…“r_add»ss.
	`Ëngth
 ());

382 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

383 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

384 
	`”ºo_as£¹
 (
rc
 == 0);

387 
rc
 = 
msg
.
	`š™_size
 (
İtiÚs
.
id’t™y_size
);

388 
	`”ºo_as£¹
 (
rc
 == 0);

389 
	`memıy
 (
msg
.
	`d©a
 (), 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

390 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

391 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

392 
	`”ºo_as£¹
 (
rc
 == 0);

395 
rc
 = 
msg
.
	`š™_size
 (5);

396 
	`”ºo_as£¹
 (
rc
 == 0);

397 
	`memıy
 (
msg
.
	`d©a
 (), "PLAIN", 5);

398 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

399 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

400 
	`”ºo_as£¹
 (
rc
 == 0);

403 
rc
 = 
msg
.
	`š™_size
 (
u£ºame
.
	`Ëngth
 ());

404 
	`”ºo_as£¹
 (
rc
 == 0);

405 
	`memıy
 (
msg
.
	`d©a
 (), 
u£ºame
.
	`c_¡r
 (), u£ºame.
	`Ëngth
 ());

406 
msg
.
	`£t_æags
 (
msg_t
::
mÜe
);

407 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

408 
	`”ºo_as£¹
 (
rc
 == 0);

411 
rc
 = 
msg
.
	`š™_size
 (
·sswÜd
.
	`Ëngth
 ());

412 
	`”ºo_as£¹
 (
rc
 == 0);

413 
	`memıy
 (
msg
.
	`d©a
 (), 
·sswÜd
.
	`c_¡r
 (),…asswÜd.
	`Ëngth
 ());

414 
rc
 = 
£ssiÚ
->
	`wr™e_z­_msg
 (&
msg
);

415 
	`”ºo_as£¹
 (
rc
 == 0);

416 
	}
}

418 
	gzmq
::
¶aš_mechªism_t
::
	$»ûive_ªd_´oûss_z­_»¶y
 ()

420 
rc
 = 0;

421 
msg_t
 
msg
 [7];

424 
i
 = 0; i < 7; i++) {

425 
rc
 = 
msg
 [
i
].
	`š™
 ();

426 
	`”ºo_as£¹
 (
rc
 == 0);

429 
i
 = 0; i < 7; i++) {

430 
rc
 = 
£ssiÚ
->
	`»ad_z­_msg
 (&
msg
 [
i
]);

431 ià(
rc
 == -1)

433 ià((
msg
 [
i
].
	`æags
 (è& 
msg_t
::
mÜe
) == (i < 6? 0: msg_t::more)) {

434 
”ºo
 = 
EPROTO
;

435 
rc
 = -1;

440 ià(
rc
 != 0)

441 
”rÜ
;

444 ià(
msg
 [0].
	`size
 () > 0) {

445 
rc
 = -1;

446 
”ºo
 = 
EPROTO
;

447 
”rÜ
;

451 ià(
msg
 [1].
	`size
 (è!ğ3 || 
	`memcmp
 (msg [1].
	`d©a
 (), "1.0", 3)) {

452 
rc
 = -1;

453 
”ºo
 = 
EPROTO
;

454 
”rÜ
;

458 ià(
msg
 [2].
	`size
 (è!ğ1 || 
	`memcmp
 (msg [2].
	`d©a
 (), "1", 1)) {

459 
rc
 = -1;

460 
”ºo
 = 
EPROTO
;

461 
”rÜ
;

465 ià(
msg
 [3].
	`size
 (è!ğ3 || 
	`memcmp
 (msg [3].
	`d©a
 (), "200", 3)) {

466 
rc
 = -1;

467 
”ºo
 = 
EACCES
;

468 
”rÜ
;

472 
rc
 = 
	`·r£_m‘ad©a
 (
¡©ic_ÿ¡
 <cÚ¡ *> (
msg
 [6].
	`d©a
 ()),

473 
msg
 [6].
	`size
 ());

475 
”rÜ
:

476 
i
 = 0; i < 7; i++) {

477 cÚ¡ 
rc2
 = 
msg
 [
i
].
	`şo£
 ();

478 
	`”ºo_as£¹
 (
rc2
 == 0);

481  
rc
;

482 
	}
}

	@plain_mechanism.hpp

20 #iâdeà
__ZMQ_PLAIN_MECHANISM_HPP_INCLUDED__


21 
	#__ZMQ_PLAIN_MECHANISM_HPP_INCLUDED__


	)

23 
	~"mechªism.hµ
"

24 
	~"İtiÚs.hµ
"

26 
Çme¥aû
 
	gzmq


29 
şass
 
	gmsg_t
;

30 
şass
 
	g£ssiÚ_ba£_t
;

32 şas 
	c¶aš_mechªism_t
 : 
public
 
mechªism_t


34 
public
:

36 
¶aš_mechªism_t
 (
£ssiÚ_ba£_t
 *
£ssiÚ_
,

37 cÚ¡ 
¡d
::
¡ršg
 &
³”_add»ss_
,

38 cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

39 
	gvœtu®
 ~
¶aš_mechªism_t
 ();

42 
vœtu®
 
Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
);

43 
vœtu®
 
´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
);

44 
vœtu®
 
z­_msg_avaabË
 ();

45 
vœtu®
 
boŞ
 
is_hªdshake_com¶‘e
 () const;

47 
	g´iv©e
:

49 
	e¡©e_t
 {

50 
£ndšg_h–lo
,

51 
	gwa™šg_fÜ_h–lo
,

52 
	g£ndšg_w–come
,

53 
	gwa™šg_fÜ_w–come
,

54 
	g£ndšg_š™Ÿ‹
,

55 
	gwa™šg_fÜ_š™Ÿ‹
,

56 
	g£ndšg_»ady
,

57 
	gwa™šg_fÜ_»ady
,

58 
	gwa™šg_fÜ_z­_»¶y
,

59 
	g»ady


62 
£ssiÚ_ba£_t
 * cÚ¡ 
	g£ssiÚ
;

64 cÚ¡ 
	g¡d
::
¡ršg
 
³”_add»ss
;

67 
boŞ
 
	gex³ùšg_z­_»¶y
;

69 
¡©e_t
 
	g¡©e
;

71 
´oduû_h–lo
 (
msg_t
 *
msg_
) const;

72 
´oduû_w–come
 (
msg_t
 *
msg_
) const;

73 
´oduû_š™Ÿ‹
 (
msg_t
 *
msg_
) const;

74 
´oduû_»ady
 (
msg_t
 *
msg_
) const;

76 
´oûss_h–lo
 (
msg_t
 *
msg_
);

77 
´oûss_w–come
 (
msg_t
 *
msg
);

78 
´oûss_»ady
 (
msg_t
 *
msg_
);

79 
´oûss_š™Ÿ‹
 (
msg_t
 *
msg_
);

81 
£nd_z­_»que¡
 (cÚ¡ 
¡d
::
¡ršg
 &
u£ºame
,

82 cÚ¡ 
¡d
::
¡ršg
 &
·sswÜd
);

83 
»ûive_ªd_´oûss_z­_»¶y
 ();

	@poll.cpp

20 
	~"pŞl.hµ
"

21 #ià
defšed
 
ZMQ_USE_POLL


23 
	~<sys/ty³s.h
>

24 
	~<sys/time.h
>

25 
	~<pŞl.h
>

26 
	~<®gÜ™hm
>

28 
	~"pŞl.hµ
"

29 
	~"”r.hµ
"

30 
	~"cÚfig.hµ
"

31 
	~"i_pŞl_ev’ts.hµ
"

33 
	gzmq
::
pŞl_t
::
	$pŞl_t
 () :

34 
	`»tœed
 (
çl£
),

35 
	$¡İpšg
 (
çl£
)

37 
	}
}

39 
	gzmq
::
pŞl_t
::~
	$pŞl_t
 ()

41 
wÜk”
.
	`¡İ
 ();

42 
	}
}

44 
	gzmq
::
pŞl_t
::
hªdË_t
 
zmq
::pŞl_t::
	$add_fd
 (
fd_t
 
fd_
, 
i_pŞl_ev’ts
 *
ev’ts_
)

47 
fd_bË_t
::
size_ty³
 
sz
 = 
fd_bË
.
	`size
 ();

48 ià(
sz
 <ğ(
fd_bË_t
::
size_ty³
è
fd_
) {

49 
fd_bË
.
	`»size
 (
fd_
 + 1);

50 
sz
 !ğ(
fd_bË_t
::
size_ty³
è(
fd_
 + 1)) {

51 
fd_bË
 [
sz
].
šdex
 = 
»tœed_fd
;

52 ++
sz
;

56 
pŞlfd
 
pfd
 = {
fd_
, 0, 0};

57 
pŞl£t
.
	`push_back
 (
pfd
);

58 
	`zmq_as£¹
 (
fd_bË
 [
fd_
].
šdex
 =ğ
»tœed_fd
);

60 
fd_bË
 [
fd_
].
šdex
 = 
pŞl£t
.
	`size
() - 1;

61 
fd_bË
 [
fd_
].
ev’ts
 = 
ev’ts_
;

64 
	`adju¡_lßd
 (1);

66  
fd_
;

67 
	}
}

69 
	gzmq
::
pŞl_t
::
	$rm_fd
 (
hªdË_t
 
hªdË_
)

71 
fd_t
 
šdex
 = 
fd_bË
 [
hªdË_
].index;

72 
	`zmq_as£¹
 (
šdex
 !ğ
»tœed_fd
);

75 
pŞl£t
 [
šdex
].
fd
 = 
»tœed_fd
;

76 
fd_bË
 [
hªdË_
].
šdex
 = 
»tœed_fd
;

77 
»tœed
 = 
Œue
;

80 
	`adju¡_lßd
 (-1);

81 
	}
}

83 
	gzmq
::
pŞl_t
::
	$£t_pŞlš
 (
hªdË_t
 
hªdË_
)

85 
šdex
 = 
fd_bË
 [
hªdË_
].index;

86 
pŞl£t
 [
šdex
].
ev’ts
 |ğ
POLLIN
;

87 
	}
}

89 
	gzmq
::
pŞl_t
::
	$»£t_pŞlš
 (
hªdË_t
 
hªdË_
)

91 
šdex
 = 
fd_bË
 [
hªdË_
].index;

92 
pŞl£t
 [
šdex
].
ev’ts
 &ğ~((è
POLLIN
);

93 
	}
}

95 
	gzmq
::
pŞl_t
::
	$£t_pŞlout
 (
hªdË_t
 
hªdË_
)

97 
šdex
 = 
fd_bË
 [
hªdË_
].index;

98 
pŞl£t
 [
šdex
].
ev’ts
 |ğ
POLLOUT
;

99 
	}
}

101 
	gzmq
::
pŞl_t
::
	$»£t_pŞlout
 (
hªdË_t
 
hªdË_
)

103 
šdex
 = 
fd_bË
 [
hªdË_
].index;

104 
pŞl£t
 [
šdex
].
ev’ts
 &ğ~((è
POLLOUT
);

105 
	}
}

107 
	gzmq
::
pŞl_t
::
	$¡¬t
 ()

109 
wÜk”
.
	`¡¬t
 (
wÜk”_routše
, 
this
);

110 
	}
}

112 
	gzmq
::
pŞl_t
::
	$¡İ
 ()

114 
¡İpšg
 = 
Œue
;

115 
	}
}

117 
	gzmq
::
pŞl_t
::
	$max_fds
 ()

120 
	}
}

122 
	gzmq
::
pŞl_t
::
	$loİ
 ()

124 !
¡İpšg
) {

127 
timeout
 = (è
	`execu‹_tim”s
 ();

130 
rc
 = 
	`pŞl
 (&
pŞl£t
 [0],…Şl£t.
	`size
 (), 
timeout
 ?imeout : -1);

131 ià(
rc
 == -1) {

132 
	`”ºo_as£¹
 (
”ºo
 =ğ
EINTR
);

138 ià(
rc
 == 0)

141 
pŞl£t_t
::
size_ty³
 
i
 = 0; i !ğ
pŞl£t
.
	`size
 (); i++) {

143 
	`zmq_as£¹
 (!(
pŞl£t
 [
i
].
»v’ts
 & 
POLLNVAL
));

144 ià(
pŞl£t
 [
i
].
fd
 =ğ
»tœed_fd
)

146 ià(
pŞl£t
 [
i
].
»v’ts
 & (
POLLERR
 | 
POLLHUP
))

147 
fd_bË
 [
pŞl£t
 [
i
].
fd
].
ev’ts
->
	`š_ev’t
 ();

148 ià(
pŞl£t
 [
i
].
fd
 =ğ
»tœed_fd
)

150 ià(
pŞl£t
 [
i
].
»v’ts
 & 
POLLOUT
)

151 
fd_bË
 [
pŞl£t
 [
i
].
fd
].
ev’ts
->
	`out_ev’t
 ();

152 ià(
pŞl£t
 [
i
].
fd
 =ğ
»tœed_fd
)

154 ià(
pŞl£t
 [
i
].
»v’ts
 & 
POLLIN
)

155 
fd_bË
 [
pŞl£t
 [
i
].
fd
].
ev’ts
->
	`š_ev’t
 ();

159 ià(
»tœed
) {

160 
pŞl£t_t
::
size_ty³
 
i
 = 0;

161 
i
 < 
pŞl£t
.
	`size
 ()) {

162 ià(
pŞl£t
 [
i
].
fd
 =ğ
»tœed_fd
)

163 
pŞl£t
.
	`”a£
 (pŞl£t.
	`begš
 (è+ 
i
);

165 
fd_bË
 [
pŞl£t
 [
i
].
fd
].
šdex
 = i;

166 
i
 ++;

169 
»tœed
 = 
çl£
;

172 
	}
}

174 
	gzmq
::
pŞl_t
::
	$wÜk”_routše
 (*
¬g_
)

176 ((
pŞl_t
*è
¬g_
)->
	`loİ
 ();

177 
	}
}

	@poll.hpp

20 #iâdeà
__ZMQ_POLL_HPP_INCLUDED__


21 
	#__ZMQ_POLL_HPP_INCLUDED__


	)

24 
	~"pŞËr.hµ
"

25 #ià
defšed
 
ZMQ_USE_POLL


27 
	~<pŞl.h
>

28 
	~<¡ddef.h
>

29 
	~<veùÜ
>

31 
	~"fd.hµ
"

32 
	~"th»ad.hµ
"

33 
	~"pŞËr_ba£.hµ
"

35 
Çme¥aû
 
	gzmq


38 
	gi_pŞl_ev’ts
;

43 şas 
	cpŞl_t
 : 
public
 
pŞËr_ba£_t


45 
public
:

47 
fd_t
 
	thªdË_t
;

49 
pŞl_t
 ();

50 ~
pŞl_t
 ();

53 
hªdË_t
 
add_fd
 (
fd_t
 
fd_
, 
zmq
::
i_pŞl_ev’ts
 *
ev’ts_
);

54 
rm_fd
 (
hªdË_t
 
hªdË_
);

55 
£t_pŞlš
 (
hªdË_t
 
hªdË_
);

56 
»£t_pŞlš
 (
hªdË_t
 
hªdË_
);

57 
£t_pŞlout
 (
hªdË_t
 
hªdË_
);

58 
»£t_pŞlout
 (
hªdË_t
 
hªdË_
);

59 
¡¬t
 ();

60 
¡İ
 ();

62 
max_fds
 ();

64 
	g´iv©e
:

67 
wÜk”_routše
 (*
¬g_
);

70 
loİ
 ();

72 
	sfd_’Œy_t


74 
fd_t
 
	gšdex
;

75 
	gzmq
::
i_pŞl_ev’ts
 *
ev’ts
;

79 
	g¡d
::
	tveùÜ
 <
	tfd_’Œy_t
> 
	tfd_bË_t
;

80 
fd_bË_t
 
	gfd_bË
;

83 
	g¡d
::
	tveùÜ
 <
	tpŞlfd
> 
	tpŞl£t_t
;

84 
pŞl£t_t
 
	gpŞl£t
;

87 
boŞ
 
	g»tœed
;

90 
boŞ
 
	g¡İpšg
;

93 
th»ad_t
 
	gwÜk”
;

95 
pŞl_t
 (const…oll_t&);

96 cÚ¡ 
	gpŞl_t
 &
	gİ”©Ü
 = (cÚ¡ 
pŞl_t
&);

99 
pŞl_t
 
	tpŞËr_t
;

	@poller.hpp

20 #iâdeà
__ZMQ_POLLER_HPP_INCLUDED__


21 
	#__ZMQ_POLLER_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ià
defšed
 
ZMQ_FORCE_SELECT


26 
	#ZMQ_USE_SELECT


	)

27 
	~"£Ëù.hµ
"

28 #–ià
defšed
 
ZMQ_FORCE_POLL


29 
	#ZMQ_USE_POLL


	)

30 
	~"pŞl.hµ
"

31 #–ià
defšed
 
ZMQ_FORCE_EPOLL


32 
	#ZMQ_USE_EPOLL


	)

33 
	~"•Şl.hµ
"

34 #–ià
defšed
 
ZMQ_FORCE_DEVPOLL


35 
	#ZMQ_USE_DEVPOLL


	)

36 
	~"devpŞl.hµ
"

37 #–ià
defšed
 
ZMQ_FORCE_KQUEUE


38 
	#ZMQ_USE_KQUEUE


	)

39 
	~"kqueue.hµ
"

40 #–ià
defšed
 
ZMQ_HAVE_LINUX


41 
	#ZMQ_USE_EPOLL


	)

42 
	~"•Şl.hµ
"

43 #–ià
defšed
 
ZMQ_HAVE_WINDOWS


44 
	#ZMQ_USE_SELECT


	)

45 
	~"£Ëù.hµ
"

46 #–ià
defšed
 
ZMQ_HAVE_FREEBSD


47 
	#ZMQ_USE_KQUEUE


	)

48 
	~"kqueue.hµ
"

49 #–ià
defšed
 
ZMQ_HAVE_OPENBSD


50 
	#ZMQ_USE_KQUEUE


	)

51 
	~"kqueue.hµ
"

52 #–ià
defšed
 
ZMQ_HAVE_NETBSD


53 
	#ZMQ_USE_KQUEUE


	)

54 
	~"kqueue.hµ
"

55 #–ià
defšed
 
ZMQ_HAVE_SOLARIS


56 
	#ZMQ_USE_DEVPOLL


	)

57 
	~"devpŞl.hµ
"

58 #–ià
defšed
 
ZMQ_HAVE_OSX


59 
	#ZMQ_USE_KQUEUE


	)

60 
	~"kqueue.hµ
"

61 #–ià
defšed
 
ZMQ_HAVE_QNXNTO


62 
	#ZMQ_USE_POLL


	)

63 
	~"pŞl.hµ
"

64 #–ià
defšed
 
ZMQ_HAVE_AIX


65 
	#ZMQ_USE_POLL


	)

66 
	~"pŞl.hµ
"

67 #–ià
defšed
 
ZMQ_HAVE_HPUX


68 
	#ZMQ_USE_DEVPOLL


	)

69 
	~"devpŞl.hµ
"

70 #–ià
defšed
 
ZMQ_HAVE_OPENVMS


71 
	#ZMQ_USE_SELECT


	)

72 
	~"£Ëù.hµ
"

73 #–ià
defšed
 
ZMQ_HAVE_CYGWIN


74 
	#ZMQ_USE_SELECT


	)

75 
	~"£Ëù.hµ
"

77 #”rÜ 
UnsuµÜ‹d
 
¶©fÜm


	@poller_base.cpp

20 
	~"pŞËr_ba£.hµ
"

21 
	~"i_pŞl_ev’ts.hµ
"

22 
	~"”r.hµ
"

24 
	gzmq
::
pŞËr_ba£_t
::
	$pŞËr_ba£_t
 ()

26 
	}
}

28 
zmq
::
pŞËr_ba£_t
::~
	$pŞËr_ba£_t
 ()

31 
	`zmq_as£¹
 (
	`g‘_lßd
 () == 0);

32 
	}
}

34 
	gzmq
::
pŞËr_ba£_t
::
	$g‘_lßd
 ()

36  
lßd
.
	`g‘
 ();

37 
	}
}

39 
	gzmq
::
pŞËr_ba£_t
::
	$adju¡_lßd
 (
amouÁ_
)

41 ià(
amouÁ_
 > 0)

42 
lßd
.
	`add
 (
amouÁ_
);

44 ià(
amouÁ_
 < 0)

45 
lßd
.
	`sub
 (-
amouÁ_
);

46 
	}
}

48 
	gzmq
::
pŞËr_ba£_t
::
	$add_tim”
 (
timeout_
, 
i_pŞl_ev’ts
 *
sšk_
, 
id_
)

50 
ušt64_t
 
expœ©iÚ
 = 
şock
.
	`now_ms
 (è+ 
timeout_
;

51 
tim”_šfo_t
 
šfo
 = {
sšk_
, 
id_
};

52 
tim”s
.
	`š£¹
 (
tim”s_t
::
	`v®ue_ty³
 (
expœ©iÚ
, 
šfo
));

53 
	}
}

55 
	gzmq
::
pŞËr_ba£_t
::
	$ÿnûl_tim”
 (
i_pŞl_ev’ts
 *
sšk_
, 
id_
)

58 
tim”s_t
::
™”©Ü
 
™
 = 
tim”s
.
	`begš
 (); iˆ!ğtim”s.
	`’d
 (); ++it)

59 ià(
™
->
£cÚd
.
sšk
 =ğ
sšk_
 && it->£cÚd.
id
 =ğ
id_
) {

60 
tim”s
.
	`”a£
 (
™
);

65 
	`zmq_as£¹
 (
çl£
);

66 
	}
}

68 
ušt64_t
 
	gzmq
::
pŞËr_ba£_t
::
	$execu‹_tim”s
 ()

71 ià(
tim”s
.
	`em±y
 ())

75 
ušt64_t
 
cu¼’t
 = 
şock
.
	`now_ms
 ();

78 
tim”s_t
::
™”©Ü
 
™
 = 
tim”s
.
	`begš
 ();

79 
™
 !ğ
tim”s
.
	`’d
 ()) {

85 ià(
™
->
fœ¡
 > 
cu¼’t
)

86  
™
->
fœ¡
 - 
cu¼’t
;

89 
™
->
£cÚd
.
sšk
->
	`tim”_ev’t
 (™->£cÚd.
id
);

92 
tim”s_t
::
™”©Ü
 
o
 = 
™
;

93 ++
™
;

94 
tim”s
.
	`”a£
 (
o
);

99 
	}
}

	@poller_base.hpp

20 #iâdeà
__ZMQ_POLLER_BASE_HPP_INCLUDED__


21 
	#__ZMQ_POLLER_BASE_HPP_INCLUDED__


	)

23 
	~<m­
>

25 
	~"şock.hµ
"

26 
	~"©omic_couÁ”.hµ
"

28 
Çme¥aû
 
	gzmq


31 
	gi_pŞl_ev’ts
;

33 şas 
	cpŞËr_ba£_t


35 
	gpublic
:

37 
pŞËr_ba£_t
 ();

38 
	gvœtu®
 ~
pŞËr_ba£_t
 ();

42 
g‘_lßd
 ();

47 
add_tim”
 (
timeout_
, 
zmq
::
i_pŞl_ev’ts
 *
sšk_
, 
id_
);

50 
ÿnûl_tim”
 (
zmq
::
i_pŞl_ev’ts
 *
sšk_
, 
id_
);

52 
	g´Ùeùed
:

55 
adju¡_lßd
 (
amouÁ_
);

59 
ušt64_t
 
execu‹_tim”s
 ();

61 
	g´iv©e
:

64 
şock_t
 
şock
;

67 
	stim”_šfo_t


69 
	gzmq
::
i_pŞl_ev’ts
 *
sšk
;

70 
	gid
;

72 
	g¡d
::
	tmuÉim­
 <
	tušt64_t
, 
	ttim”_šfo_t
> 
	ttim”s_t
;

73 
tim”s_t
 
	gtim”s
;

77 
©omic_couÁ”_t
 
	glßd
;

79 
pŞËr_ba£_t
 (const…oller_base_t&);

80 cÚ¡ 
	gpŞËr_ba£_t
 &
	gİ”©Ü
 = (cÚ¡ 
pŞËr_ba£_t
&);

	@precompiled.cpp

20 
	~"´ecomped.hµ
"

	@precompiled.hpp

20 #iâdeà
__ZMQ_PRECOMPILED_HPP_INCLUDED__


21 
	#__ZMQ_PRECOMPILED_HPP_INCLUDED__


	)

23 #ifdeà
_MSC_VER


26 
	~"¶©fÜm.hµ
"

27 
	~"wšdows.hµ
"

28 
	~<fú.h
>

29 
	~<šŒš.h
>

30 
	~<io.h
>

31 
	~<½c.h
>

32 
	~<sys/¡©.h
>

35 
	~<®gÜ™hm
>

36 
	~<m­
>

37 
	~<£t
>

38 
	~<¡ršg
>

39 
	~<veùÜ
>

42 
	~"../šşude/zmq.h
"

	@proxy.cpp

20 
	~<¡ddef.h
>

21 
	~"¶©fÜm.hµ
"

22 
	~"´oxy.hµ
"

23 
	~"lik–y.hµ
"

25 #ià
defšed
 
ZMQ_FORCE_SELECT


26 
	#ZMQ_POLL_BASED_ON_SELECT


	)

27 #–ià
defšed
 
ZMQ_FORCE_POLL


28 
	#ZMQ_POLL_BASED_ON_POLL


	)

29 #–ià
defšed
 
ZMQ_HAVE_LINUX
 || defšed 
ZMQ_HAVE_FREEBSD
 ||\

30 
defšed
 
	gZMQ_HAVE_OPENBSD
 || defšed 
	gZMQ_HAVE_SOLARIS
 ||\

31 
defšed
 
	gZMQ_HAVE_OSX
 || defšed 
	gZMQ_HAVE_QNXNTO
 ||\

32 
defšed
 
	gZMQ_HAVE_HPUX
 || defšed 
	gZMQ_HAVE_AIX
 ||\

33 
defšed
 
	gZMQ_HAVE_NETBSD


34 
	#ZMQ_POLL_BASED_ON_POLL


	)

35 #–ià
defšed
 
ZMQ_HAVE_WINDOWS
 || defšed 
ZMQ_HAVE_OPENVMS
 ||\

36 
defšed
 
	gZMQ_HAVE_CYGWIN


37 
	#ZMQ_POLL_BASED_ON_SELECT


	)

44 #ià
defšed
 
ZMQ_POLL_BASED_ON_POLL


45 
	~<pŞl.h
>

50 
	~"sock‘_ba£.hµ
"

51 
	~"”r.hµ
"

54 
	~"../šşude/zmq.h
"

57 
	gzmq
::
	$´oxy
 (

58 
şass
 
sock‘_ba£_t
 *
äÚ‹nd_
,

59 
şass
 
sock‘_ba£_t
 *
back’d_
,

60 
şass
 
sock‘_ba£_t
 *
ÿ±u»_
,

61 
şass
 
sock‘_ba£_t
 *
cÚŒŞ_
)

63 
msg_t
 
msg
;

64 
rc
 = 
msg
.
	`š™
 ();

65 ià(
rc
 != 0)

71 
mÜe
;

72 
size_t
 
mÜesz
;

73 
zmq_pŞl™em_t
 
™ems
 [] = {

74 { 
äÚ‹nd_
, 0, 
ZMQ_POLLIN
, 0 },

75 { 
back’d_
, 0, 
ZMQ_POLLIN
, 0 },

76 { 
cÚŒŞ_
, 0, 
ZMQ_POLLIN
, 0 }

78 
qt_pŞl_™ems
 = (
cÚŒŞ_
 ? 3 : 2);

82 
aùive
,

83 
·u£d
,

84 
‹rmš©ed


85 } 
¡©e
 = 
aùive
;

87 
¡©e
 !ğ
‹rmš©ed
) {

89 
rc
 = 
	`zmq_pŞl
 (&
™ems
 [0], 
qt_pŞl_™ems
, -1);

90 ià(
	`uÆik–y
 (
rc
 < 0))

94 ià(
cÚŒŞ_
 && 
™ems
 [2].
»v’ts
 & 
ZMQ_POLLIN
) {

95 
rc
 = 
cÚŒŞ_
->
	`»cv
 (&
msg
, 0);

96 ià(
	`uÆik–y
 (
rc
 < 0))

99 
mÜesz
 =  
mÜe
;

100 
rc
 = 
cÚŒŞ_
->
	`g‘sockİt
 (
ZMQ_RCVMORE
, &
mÜe
, &
mÜesz
);

101 ià(
	`uÆik–y
 (
rc
 < 0è|| 
mÜe
)

105 ià(
ÿ±u»_
) {

106 
msg_t
 
ù¾
;

107 
rc
 = 
ù¾
.
	`š™
 ();

108 ià(
	`uÆik–y
 (
rc
 < 0))

110 
rc
 = 
ù¾
.
	`cİy
 (
msg
);

111 ià(
	`uÆik–y
 (
rc
 < 0))

113 
rc
 = 
ÿ±u»_
->
	`£nd
 (&
ù¾
, 
mÜe
? 
ZMQ_SNDMORE
: 0);

114 ià(
	`uÆik–y
 (
rc
 < 0))

118 ià(
msg
.
	`size
 (è=ğ5 && 
	`memcmp
 (msg.
	`d©a
 (), "PAUSE", 5) == 0)

119 
¡©e
 = 
·u£d
;

121 ià(
msg
.
	`size
 (è=ğ6 && 
	`memcmp
 (msg.
	`d©a
 (), "RESUME", 6) == 0)

122 
¡©e
 = 
aùive
;

124 ià(
msg
.
	`size
 (è=ğ9 && 
	`memcmp
 (msg.
	`d©a
 (), "TERMINATE", 9) == 0)

125 
¡©e
 = 
‹rmš©ed
;

128 
	`puts
 ("E: invalid command sento…roxy");

129 
	`zmq_as£¹
 (
çl£
);

133 ià(
™ems
 [0].
»v’ts
 & 
ZMQ_POLLIN
) {

134 
Œue
) {

135 
rc
 = 
äÚ‹nd_
->
	`»cv
 (&
msg
, 0);

136 ià(
	`uÆik–y
 (
rc
 < 0))

139 
mÜesz
 =  
mÜe
;

140 
rc
 = 
äÚ‹nd_
->
	`g‘sockİt
 (
ZMQ_RCVMORE
, &
mÜe
, &
mÜesz
);

141 ià(
	`uÆik–y
 (
rc
 < 0))

145 ià(
ÿ±u»_
) {

146 
msg_t
 
ù¾
;

147 
rc
 = 
ù¾
.
	`š™
 ();

148 ià(
	`uÆik–y
 (
rc
 < 0))

150 
rc
 = 
ù¾
.
	`cİy
 (
msg
);

151 ià(
	`uÆik–y
 (
rc
 < 0))

153 
rc
 = 
ÿ±u»_
->
	`£nd
 (&
ù¾
, 
mÜe
? 
ZMQ_SNDMORE
: 0);

154 ià(
	`uÆik–y
 (
rc
 < 0))

157 
rc
 = 
back’d_
->
	`£nd
 (&
msg
, 
mÜe
? 
ZMQ_SNDMORE
: 0);

158 ià(
	`uÆik–y
 (
rc
 < 0))

160 ià(
mÜe
 == 0)

165 ià(
™ems
 [1].
»v’ts
 & 
ZMQ_POLLIN
) {

166 
Œue
) {

167 
rc
 = 
back’d_
->
	`»cv
 (&
msg
, 0);

168 ià(
	`uÆik–y
 (
rc
 < 0))

171 
mÜesz
 =  
mÜe
;

172 
rc
 = 
back’d_
->
	`g‘sockİt
 (
ZMQ_RCVMORE
, &
mÜe
, &
mÜesz
);

173 ià(
	`uÆik–y
 (
rc
 < 0))

177 ià(
ÿ±u»_
) {

178 
msg_t
 
ù¾
;

179 
rc
 = 
ù¾
.
	`š™
 ();

180 ià(
	`uÆik–y
 (
rc
 < 0))

182 
rc
 = 
ù¾
.
	`cİy
 (
msg
);

183 ià(
	`uÆik–y
 (
rc
 < 0))

185 
rc
 = 
ÿ±u»_
->
	`£nd
 (&
ù¾
, 
mÜe
? 
ZMQ_SNDMORE
: 0);

186 ià(
	`uÆik–y
 (
rc
 < 0))

189 
rc
 = 
äÚ‹nd_
->
	`£nd
 (&
msg
, 
mÜe
? 
ZMQ_SNDMORE
: 0);

190 ià(
	`uÆik–y
 (
rc
 < 0))

192 ià(
mÜe
 == 0)

199 
	}
}

	@proxy.hpp

20 #iâdeà
__ZMQ_PROXY_HPP_INCLUDED__


21 
	#__ZMQ_PROXY_HPP_INCLUDED__


	)

23 
Çme¥aû
 
	gzmq


25 
´oxy
 (

26 
şass
 
sock‘_ba£_t
 *
äÚ‹nd_
,

27 
şass
 
sock‘_ba£_t
 *
back’d_
,

28 
şass
 
sock‘_ba£_t
 *
ÿ±u»_
,

29 
şass
 
sock‘_ba£_t
 *
cÚŒŞ_
 = 
NULL
);

	@pub.cpp

20 
	~"pub.hµ
"

21 
	~"msg.hµ
"

23 
	gzmq
::
pub_t
::
	$pub_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

24 
	$xpub_t
 (
·»Á_
, 
tid_
, 
sid_
)

26 
İtiÚs
.
ty³
 = 
ZMQ_PUB
;

27 
	}
}

29 
	gzmq
::
pub_t
::~
	$pub_t
 ()

31 
	}
}

33 
zmq
::
pub_t
::
	$x»cv
 (
şass
 
msg_t
 *)

36 
”ºo
 = 
ENOTSUP
;

38 
	}
}

40 
boŞ
 
	gzmq
::
pub_t
::
	$xhas_š
 ()

42  
çl£
;

43 
	}
}

	@pub.hpp

20 #iâdeà
__ZMQ_PUB_HPP_INCLUDED__


21 
	#__ZMQ_PUB_HPP_INCLUDED__


	)

23 
	~"xpub.hµ
"

25 
Çme¥aû
 
	gzmq


28 
şass
 
	gùx_t
;

29 
şass
 
	gio_th»ad_t
;

30 
şass
 
	gsock‘_ba£_t
;

31 
şass
 
	gmsg_t
;

33 şas 
	cpub_t
 : 
public
 
xpub_t


35 
public
:

37 
pub_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
);

38 ~
pub_t
 ();

41 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

42 
boŞ
 
xhas_š
 ();

44 
	g´iv©e
:

46 
pub_t
 (const…ub_t&);

47 cÚ¡ 
	gpub_t
 &
	gİ”©Ü
 = (cÚ¡ 
pub_t
&);

	@pull.cpp

20 
	~"puÎ.hµ
"

21 
	~"”r.hµ
"

22 
	~"msg.hµ
"

23 
	~"pe.hµ
"

25 
	gzmq
::
puÎ_t
::
	$puÎ_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

26 
	$sock‘_ba£_t
 (
·»Á_
, 
tid_
, 
sid_
)

28 
İtiÚs
.
ty³
 = 
ZMQ_PULL
;

29 
	}
}

31 
	gzmq
::
puÎ_t
::~
	$puÎ_t
 ()

33 
	}
}

35 
zmq
::
puÎ_t
::
	$x©ch_pe
 (
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
)

38 ()
subsüibe_to_®l_
;

40 
	`zmq_as£¹
 (
pe_
);

41 
fq
.
	`©ch
 (
pe_
);

42 
	}
}

44 
	gzmq
::
puÎ_t
::
	$x»ad_aùiv©ed
 (
pe_t
 *
pe_
)

46 
fq
.
	`aùiv©ed
 (
pe_
);

47 
	}
}

49 
	gzmq
::
puÎ_t
::
	$xpe_‹rmš©ed
 (
pe_t
 *
pe_
)

51 
fq
.
	`pe_‹rmš©ed
 (
pe_
);

52 
	}
}

54 
	gzmq
::
puÎ_t
::
	$x»cv
 (
msg_t
 *
msg_
)

56  
fq
.
	`»cv
 (
msg_
);

57 
	}
}

59 
boŞ
 
	gzmq
::
puÎ_t
::
	$xhas_š
 ()

61  
fq
.
	`has_š
 ();

62 
	}
}

	@pull.hpp

20 #iâdeà
__ZMQ_PULL_HPP_INCLUDED__


21 
	#__ZMQ_PULL_HPP_INCLUDED__


	)

23 
	~"sock‘_ba£.hµ
"

24 
	~"£ssiÚ_ba£.hµ
"

25 
	~"fq.hµ
"

27 
Çme¥aû
 
	gzmq


30 
şass
 
	gùx_t
;

31 
şass
 
	gpe_t
;

32 
şass
 
	gmsg_t
;

33 
şass
 
	gio_th»ad_t
;

35 şas 
	cpuÎ_t
 :

36 
public
 
sock‘_ba£_t


38 
public
:

40 
puÎ_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
);

41 ~
puÎ_t
 ();

43 
	g´Ùeùed
:

46 
x©ch_pe
 (
zmq
::
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
);

47 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

48 
boŞ
 
xhas_š
 ();

49 
x»ad_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

50 
xpe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

52 
	g´iv©e
:

55 
fq_t
 
fq
;

57 
puÎ_t
 (const…ull_t&);

58 cÚ¡ 
	gpuÎ_t
 &
	gİ”©Ü
 = (cÚ¡ 
puÎ_t
&);

	@push.cpp

20 
	~"push.hµ
"

21 
	~"pe.hµ
"

22 
	~"”r.hµ
"

23 
	~"msg.hµ
"

25 
	gzmq
::
push_t
::
	$push_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

26 
	$sock‘_ba£_t
 (
·»Á_
, 
tid_
, 
sid_
)

28 
İtiÚs
.
ty³
 = 
ZMQ_PUSH
;

29 
	}
}

31 
	gzmq
::
push_t
::~
	$push_t
 ()

33 
	}
}

35 
zmq
::
push_t
::
	$x©ch_pe
 (
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
)

38 ()
subsüibe_to_®l_
;

40 
	`zmq_as£¹
 (
pe_
);

41 
lb
.
	`©ch
 (
pe_
);

42 
	}
}

44 
	gzmq
::
push_t
::
	$xwr™e_aùiv©ed
 (
pe_t
 *
pe_
)

46 
lb
.
	`aùiv©ed
 (
pe_
);

47 
	}
}

49 
	gzmq
::
push_t
::
	$xpe_‹rmš©ed
 (
pe_t
 *
pe_
)

51 
lb
.
	`pe_‹rmš©ed
 (
pe_
);

52 
	}
}

54 
	gzmq
::
push_t
::
	$x£nd
 (
msg_t
 *
msg_
)

56  
lb
.
	`£nd
 (
msg_
);

57 
	}
}

59 
boŞ
 
	gzmq
::
push_t
::
	$xhas_out
 ()

61  
lb
.
	`has_out
 ();

62 
	}
}

	@push.hpp

20 #iâdeà
__ZMQ_PUSH_HPP_INCLUDED__


21 
	#__ZMQ_PUSH_HPP_INCLUDED__


	)

23 
	~"sock‘_ba£.hµ
"

24 
	~"£ssiÚ_ba£.hµ
"

25 
	~"lb.hµ
"

27 
Çme¥aû
 
	gzmq


30 
şass
 
	gùx_t
;

31 
şass
 
	gpe_t
;

32 
şass
 
	gmsg_t
;

33 
şass
 
	gio_th»ad_t
;

35 şas 
	cpush_t
 :

36 
public
 
sock‘_ba£_t


38 
public
:

40 
push_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
);

41 ~
push_t
 ();

43 
	g´Ùeùed
:

46 
x©ch_pe
 (
zmq
::
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
);

47 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

48 
boŞ
 
xhas_out
 ();

49 
xwr™e_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

50 
xpe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

52 
	g´iv©e
:

55 
lb_t
 
lb
;

57 
push_t
 (const…ush_t&);

58 cÚ¡ 
	gpush_t
 &
	gİ”©Ü
 = (cÚ¡ 
push_t
&);

	@random.cpp

20 
	~<¡dlib.h
>

22 
	~"¶©fÜm.hµ
"

23 #ià
defšed
 
ZMQ_HAVE_WINDOWS


24 
	~"wšdows.hµ
"

26 
	~<uni¡d.h
>

29 
	~"¿ndom.hµ
"

30 
	~"¡dšt.hµ
"

31 
	~"şock.hµ
"

33 
	gzmq
::
	$£ed_¿ndom
 ()

35 #ià
defšed
 
ZMQ_HAVE_WINDOWS


36 
pid
 = (è
	`G‘Cu¼’tProûssId
 ();

38 
pid
 = (è
	`g‘pid
 ();

40 
	`¤ªd
 ((è(
şock_t
::
	`now_us
 (è+ 
pid
));

41 
	}
}

43 
ušt32_t
 
	gzmq
::
	$g’”©e_¿ndom
 ()

46 
ušt32_t
 
low
 = (ušt32_tè
	`¿nd
 ();

47 
ušt32_t
 
high
 = (ušt32_tè
	`¿nd
 ();

48 
high
 <<= ( () * 8 - 1);

49  
high
 | 
low
;

50 
	}
}

	@random.hpp

20 #iâdeà
__ZMQ_RANDOM_HPP_INCLUDED__


21 
	#__ZMQ_RANDOM_HPP_INCLUDED__


	)

23 
	~"¡dšt.hµ
"

25 
Çme¥aû
 
	gzmq


29 
£ed_¿ndom
 ();

32 
ušt32_t
 
g’”©e_¿ndom
 ();

	@raw_decoder.cpp

20 
	~<¡dlib.h
>

21 
	~<¡ršg.h
>

23 
	~"¶©fÜm.hµ
"

24 #ifdeà
ZMQ_HAVE_WINDOWS


25 
	~"wšdows.hµ
"

28 
	~"¿w_decod”.hµ
"

29 
	~"”r.hµ
"

31 
	gzmq
::
¿w_decod”_t
::
	$¿w_decod”_t
 (
size_t
 
bufsize_
) :

32 
	$bufsize
 (
bufsize_
)

34 
rc
 = 
š_´og»ss
.
	`š™
 ();

35 
	`”ºo_as£¹
 (
rc
 == 0);

37 
bufãr
 = (*è
	`m®loc
 (
bufsize
);

38 
	`®loc_as£¹
 (
bufãr
);

39 
	}
}

41 
	gzmq
::
¿w_decod”_t
::~
	$¿w_decod”_t
 ()

43 
rc
 = 
š_´og»ss
.
	`şo£
 ();

44 
	`”ºo_as£¹
 (
rc
 == 0);

46 
	`ä“
 (
bufãr
);

47 
	}
}

49 
	gzmq
::
¿w_decod”_t
::
	$g‘_bufãr
 (**
d©a_
, 
size_t
 *
size_
)

51 *
d©a_
 = 
bufãr
;

52 *
size_
 = 
bufsize
;

53 
	}
}

55 
	gzmq
::
¿w_decod”_t
::
	$decode
 (cÚ¡ 
ušt8_t
 *
d©a_
, 
size_t
 
size_
,

56 
size_t
 &
by‹s_u£d_
)

58 
rc
 = 
š_´og»ss
.
	`š™_size
 (
size_
);

59 
	`”ºo_as£¹
 (
rc
 != -1);

60 
	`memıy
 (
š_´og»ss
.
	`d©a
 (), 
d©a_
, 
size_
);

61 
by‹s_u£d_
 = 
size_
;

63 
	}
}

	@raw_decoder.hpp

20 #iâdeà
__ZMQ_RAW_DECODER_HPP_INCLUDED__


21 
	#__ZMQ_RAW_DECODER_HPP_INCLUDED__


	)

23 
	~"”r.hµ
"

24 
	~"msg.hµ
"

25 
	~"i_decod”.hµ
"

26 
	~"¡dšt.hµ
"

28 
Çme¥aû
 
	gzmq


33 şas 
	c¿w_decod”_t
 : 
public
 
i_decod”


35 
public
:

37 
¿w_decod”_t
 (
size_t
 
bufsize_
);

38 
	gvœtu®
 ~
¿w_decod”_t
 ();

42 
vœtu®
 
g‘_bufãr
 (**
d©a_
, 
size_t
 *
size_
);

44 
vœtu®
 
decode
 (cÚ¡ *
d©a_
, 
size_t
 
size_
,

45 
size_t
 &
´oûs£d
);

47 
vœtu®
 
msg_t
 *
msg
 (è{  &
	gš_´og»ss
; }

50 
	g´iv©e
:

53 
msg_t
 
š_´og»ss
;

55 cÚ¡ 
št64_t
 
	gbufsize
;

57 *
	gbufãr
;

59 
¿w_decod”_t
 (const„aw_decoder_t&);

60 
	gİ”©Ü
 = (cÚ¡ 
¿w_decod”_t
&);

	@raw_encoder.cpp

20 
	~"’cod”.hµ
"

21 
	~"¿w_’cod”.hµ
"

22 
	~"lik–y.hµ
"

23 
	~"wœe.hµ
"

25 
	gzmq
::
¿w_’cod”_t
::
	$¿w_’cod”_t
 (
size_t
 
bufsize_
) :

26 
’cod”_ba£_t
 <
¿w_’cod”_t
> (
bufsize_
)

29 
	`Ãxt_¡•
 (
NULL
, 0, &
¿w_’cod”_t
::
¿w_mes§ge_»ady
, 
Œue
);

30 
	}
}

32 
	gzmq
::
¿w_’cod”_t
::~
	$¿w_’cod”_t
 ()

34 
	}
}

36 
zmq
::
¿w_’cod”_t
::
	$¿w_mes§ge_»ady
 ()

38 
	`Ãxt_¡•
 (
š_´og»ss
->
	`d©a
 (), in_´og»ss->
	`size
 (),

39 &
¿w_’cod”_t
::
¿w_mes§ge_»ady
, 
Œue
);

40 
	}
}

	@raw_encoder.hpp

20 #iâdeà
__ZMQ_RAW_ENCODER_HPP_INCLUDED__


21 
	#__ZMQ_RAW_ENCODER_HPP_INCLUDED__


	)

23 #ià
defšed
(
_MSC_VER
)

24 #iâdeà
NOMINMAX


25 
	#NOMINMAX


	)

29 
	~<¡ddef.h
>

30 
	~<¡ršg.h
>

31 
	~<¡dlib.h
>

32 
	~<®gÜ™hm
>

34 
	~"”r.hµ
"

35 
	~"msg.hµ
"

36 
	~"i_’cod”.hµ
"

38 
Çme¥aû
 
	gzmq


43 
şass
 
	g¿w_’cod”_t
 : 
public
 
’cod”_ba£_t
 <
¿w_’cod”_t
>

45 
public
:

47 
¿w_’cod”_t
 (
size_t
 
bufsize_
);

48 ~
¿w_’cod”_t
 ();

50 
	g´iv©e
:

52 
¿w_mes§ge_»ady
 ();

54 
¿w_’cod”_t
 (const„aw_encoder_t&);

55 cÚ¡ 
	g¿w_’cod”_t
 &
	gİ”©Ü
 = (cÚ¡ 
¿w_’cod”_t
&);

	@reaper.cpp

20 
	~"»­”.hµ
"

21 
	~"sock‘_ba£.hµ
"

22 
	~"”r.hµ
"

24 
	gzmq
::
»­”_t
::
	$»­”_t
 (
şass
 
ùx_t
 *
ùx_
, 
ušt32_t
 
tid_
) :

25 
	`objeù_t
 (
ùx_
, 
tid_
),

26 
	`sock‘s
 (0),

27 
	$‹rmš©šg
 (
çl£
)

29 
pŞËr
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
pŞËr_t
;

30 
	`®loc_as£¹
 (
pŞËr
);

32 
mabox_hªdË
 = 
pŞËr
->
	`add_fd
 (
mabox
.
	`g‘_fd
 (), 
this
);

33 
pŞËr
->
	`£t_pŞlš
 (
mabox_hªdË
);

35 #ifdeà
HAVE_FORK


36 
pid
 = 
	`g‘pid
();

38 
	}
}

40 
	gzmq
::
»­”_t
::~
	$»­”_t
 ()

42 
d–‘e
 
pŞËr
;

43 
	}
}

45 
	gzmq
::
mabox_t
 *
zmq
::
»­”_t
::
	$g‘_mabox
 ()

47  &
mabox
;

48 
	}
}

50 
	gzmq
::
»­”_t
::
	$¡¬t
 ()

53 
pŞËr
->
	`¡¬t
 ();

54 
	}
}

56 
	gzmq
::
»­”_t
::
	$¡İ
 ()

58 
	`£nd_¡İ
 ();

59 
	}
}

61 
	gzmq
::
»­”_t
::
	$š_ev’t
 ()

63 
Œue
) {

64 #ifdeà
HAVE_FORK


65 ià(
	`uÆik–y
(
pid
 !ğ
	`g‘pid
()))

73 
commªd_t
 
cmd
;

74 
rc
 = 
mabox
.
	`»cv
 (&
cmd
, 0);

75 ià(
rc
 !ğ0 && 
”ºo
 =ğ
EINTR
)

77 ià(
rc
 !ğ0 && 
”ºo
 =ğ
EAGAIN
)

79 
	`”ºo_as£¹
 (
rc
 == 0);

82 
cmd
.
de¡š©iÚ
->
	`´oûss_commªd
 (cmd);

84 
	}
}

86 
	gzmq
::
»­”_t
::
	$out_ev’t
 ()

88 
	`zmq_as£¹
 (
çl£
);

89 
	}
}

91 
	gzmq
::
»­”_t
::
	$tim”_ev’t
 ()

93 
	`zmq_as£¹
 (
çl£
);

94 
	}
}

96 
	gzmq
::
»­”_t
::
	$´oûss_¡İ
 ()

98 
‹rmš©šg
 = 
Œue
;

101 ià(!
sock‘s
) {

102 
	`£nd_dÚe
 ();

103 
pŞËr
->
	`rm_fd
 (
mabox_hªdË
);

104 
pŞËr
->
	`¡İ
 ();

106 
	}
}

108 
	gzmq
::
»­”_t
::
	$´oûss_»­
 (
sock‘_ba£_t
 *
sock‘_
)

111 
sock‘_
->
	`¡¬t_»­šg
 (
pŞËr
);

113 ++
sock‘s
;

114 
	}
}

116 
	gzmq
::
»­”_t
::
	$´oûss_»­ed
 ()

118 --
sock‘s
;

122 ià(!
sock‘s
 && 
‹rmš©šg
) {

123 
	`£nd_dÚe
 ();

124 
pŞËr
->
	`rm_fd
 (
mabox_hªdË
);

125 
pŞËr
->
	`¡İ
 ();

127 
	}
}

	@reaper.hpp

20 #iâdeà
__ZMQ_REAPER_HPP_INCLUDED__


21 
	#__ZMQ_REAPER_HPP_INCLUDED__


	)

23 
	~"objeù.hµ
"

24 
	~"mabox.hµ
"

25 
	~"pŞËr.hµ
"

26 
	~"i_pŞl_ev’ts.hµ
"

28 
Çme¥aû
 
	gzmq


31 
şass
 
	gùx_t
;

32 
şass
 
	gsock‘_ba£_t
;

34 
şass
 
	g»­”_t
 : 
public
 
objeù_t
,…ubliø
	gi_pŞl_ev’ts


36 
	gpublic
:

38 
»­”_t
 (
zmq
::
ùx_t
 *
ùx_
, 
ušt32_t
 
tid_
);

39 ~
»­”_t
 ();

41 
mabox_t
 *
g‘_mabox
 ();

43 
¡¬t
 ();

44 
¡İ
 ();

47 
š_ev’t
 ();

48 
out_ev’t
 ();

49 
tim”_ev’t
 (
id_
);

51 
	g´iv©e
:

54 
´oûss_¡İ
 ();

55 
´oûss_»­
 (
zmq
::
sock‘_ba£_t
 *
sock‘_
);

56 
´oûss_»­ed
 ();

59 
mabox_t
 
	gmabox
;

62 
	gpŞËr_t
::
hªdË_t
 
mabox_hªdË
;

65 
pŞËr_t
 *
	gpŞËr
;

68 
	gsock‘s
;

71 
boŞ
 
	g‹rmš©šg
;

73 
»­”_t
 (const„eaper_t&);

74 cÚ¡ 
	g»­”_t
 &
	gİ”©Ü
 = (cÚ¡ 
»­”_t
&);

76 #ifdeà
HAVE_FORK


78 
pid_t
 
	gpid
;

	@rep.cpp

20 
	~"»p.hµ
"

21 
	~"”r.hµ
"

22 
	~"msg.hµ
"

24 
	gzmq
::
»p_t
::
	$»p_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

25 
	`rou‹r_t
 (
·»Á_
, 
tid_
, 
sid_
),

26 
	`£ndšg_»¶y
 (
çl£
),

27 
	$»que¡_begšs
 (
Œue
)

29 
İtiÚs
.
ty³
 = 
ZMQ_REP
;

30 
	}
}

32 
	gzmq
::
»p_t
::~
	$»p_t
 ()

34 
	}
}

36 
zmq
::
»p_t
::
	$x£nd
 (
msg_t
 *
msg_
)

39 ià(!
£ndšg_»¶y
) {

40 
”ºo
 = 
EFSM
;

44 
boŞ
 
mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::mÜ? 
Œue
 : 
çl£
;

47 
rc
 = 
rou‹r_t
::
	`x£nd
 (
msg_
);

48 ià(
rc
 != 0)

49  
rc
;

52 ià(!
mÜe
)

53 
£ndšg_»¶y
 = 
çl£
;

56 
	}
}

58 
	gzmq
::
»p_t
::
	$x»cv
 (
msg_t
 *
msg_
)

61 ià(
£ndšg_»¶y
) {

62 
”ºo
 = 
EFSM
;

68 ià(
»que¡_begšs
) {

69 
Œue
) {

70 
rc
 = 
rou‹r_t
::
	`x»cv
 (
msg_
);

71 ià(
rc
 != 0)

72  
rc
;

74 ià((
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
)) {

76 
boŞ
 
bÙtom
 = (
msg_
->
	`size
 () == 0);

79 
rc
 = 
rou‹r_t
::
	`x£nd
 (
msg_
);

80 
	`”ºo_as£¹
 (
rc
 == 0);

82 ià(
bÙtom
)

88 
rc
 = 
rou‹r_t
::
	`rŞlback
 ();

89 
	`”ºo_as£¹
 (
rc
 == 0);

92 
»que¡_begšs
 = 
çl£
;

96 
rc
 = 
rou‹r_t
::
	`x»cv
 (
msg_
);

97 ià(
rc
 != 0)

98  
rc
;

101 ià(!(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
)) {

102 
£ndšg_»¶y
 = 
Œue
;

103 
»que¡_begšs
 = 
Œue
;

107 
	}
}

109 
boŞ
 
	gzmq
::
»p_t
::
	$xhas_š
 ()

111 ià(
£ndšg_»¶y
)

112  
çl£
;

114  
rou‹r_t
::
	`xhas_š
 ();

115 
	}
}

117 
boŞ
 
	gzmq
::
»p_t
::
	$xhas_out
 ()

119 ià(!
£ndšg_»¶y
)

120  
çl£
;

122  
rou‹r_t
::
	`xhas_out
 ();

123 
	}
}

	@rep.hpp

20 #iâdeà
__ZMQ_REP_HPP_INCLUDED__


21 
	#__ZMQ_REP_HPP_INCLUDED__


	)

23 
	~"rou‹r.hµ
"

25 
Çme¥aû
 
	gzmq


28 
şass
 
	gùx_t
;

29 
şass
 
	gmsg_t
;

30 
şass
 
	gio_th»ad_t
;

31 
şass
 
	gsock‘_ba£_t
;

33 şas 
	c»p_t
 : 
public
 
rou‹r_t


35 
public
:

37 
»p_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid
);

38 ~
»p_t
 ();

41 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

42 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

43 
boŞ
 
xhas_š
 ();

44 
boŞ
 
xhas_out
 ();

46 
	g´iv©e
:

50 
boŞ
 
£ndšg_»¶y
;

54 
boŞ
 
	g»que¡_begšs
;

56 
»p_t
 (const„ep_t&);

57 cÚ¡ 
	g»p_t
 &
	gİ”©Ü
 = (cÚ¡ 
»p_t
&);

	@req.cpp

20 
	~"»q.hµ
"

21 
	~"”r.hµ
"

22 
	~"msg.hµ
"

23 
	~"wœe.hµ
"

24 
	~"¿ndom.hµ
"

25 
	~"lik–y.hµ
"

27 
	gzmq
::
»q_t
::
	$»q_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

28 
	`d—Ër_t
 (
·»Á_
, 
tid_
, 
sid_
),

29 
	`»ûivšg_»¶y
 (
çl£
),

30 
	`mes§ge_begšs
 (
Œue
),

31 
	`»¶y_pe
 (
NULL
),

32 
	`»que¡_id_äames_’abËd
 (
çl£
),

33 
	`»que¡_id
 (
	`g’”©e_¿ndom
()),

34 
	$¡riù
 (
Œue
)

36 
İtiÚs
.
ty³
 = 
ZMQ_REQ
;

37 
	}
}

39 
	gzmq
::
»q_t
::~
	$»q_t
 ()

41 
	}
}

43 
zmq
::
»q_t
::
	$x£nd
 (
msg_t
 *
msg_
)

47 ià(
»ûivšg_»¶y
) {

48 ià(
¡riù
) {

49 
”ºo
 = 
EFSM
;

53 ià(
»¶y_pe
)

54 
»¶y_pe
->
	`‹rmš©e
 (
çl£
);

55 
»ûivšg_»¶y
 = 
çl£
;

56 
mes§ge_begšs
 = 
Œue
;

60 ià(
mes§ge_begšs
) {

61 
»¶y_pe
 = 
NULL
;

63 ià(
»que¡_id_äames_’abËd
) {

64 
»que¡_id
++;

66 
msg_t
 
id
;

67 
rc
 = 
id
.
	`š™_d©a
 (&
»que¡_id
,  (»que¡_id), 
NULL
, NULL);

68 
	`”ºo_as£¹
 (
rc
 == 0);

69 
id
.
	`£t_æags
 (
msg_t
::
mÜe
);

71 
rc
 = 
d—Ër_t
::
	`£ndpe
 (&
id
, &
»¶y_pe
);

72 ià(
rc
 != 0)

76 
msg_t
 
bÙtom
;

77 
rc
 = 
bÙtom
.
	`š™
 ();

78 
	`”ºo_as£¹
 (
rc
 == 0);

79 
bÙtom
.
	`£t_æags
 (
msg_t
::
mÜe
);

81 
rc
 = 
d—Ër_t
::
	`£ndpe
 (&
bÙtom
, &
»¶y_pe
);

82 ià(
rc
 != 0)

84 
	`as£¹
 (
»¶y_pe
);

86 
mes§ge_begšs
 = 
çl£
;

93 
msg_t
 
drİ
;

94 
Œue
) {

95 
rc
 = 
drİ
.
	`š™
 ();

96 
	`”ºo_as£¹
 (
rc
 == 0);

97 
rc
 = 
d—Ër_t
::
	`x»cv
 (&
drİ
);

98 ià(
rc
 != 0)

100 
drİ
.
	`şo£
 ();

104 
boŞ
 
mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::mÜ? 
Œue
 : 
çl£
;

106 
rc
 = 
d—Ër_t
::
	`x£nd
 (
msg_
);

107 ià(
rc
 != 0)

108  
rc
;

111 ià(!
mÜe
) {

112 
»ûivšg_»¶y
 = 
Œue
;

113 
mes§ge_begšs
 = 
Œue
;

117 
	}
}

119 
	gzmq
::
»q_t
::
	$x»cv
 (
msg_t
 *
msg_
)

122 ià(!
»ûivšg_»¶y
) {

123 
”ºo
 = 
EFSM
;

128 
mes§ge_begšs
) {

130 ià(
»que¡_id_äames_’abËd
) {

131 
rc
 = 
	`»cv_»¶y_pe
 (
msg_
);

132 ià(
rc
 != 0)

133  
rc
;

135 ià(
	`uÆik–y
 (!(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
) ||

136 
msg_
->
	`size
 (è!ğ (
»que¡_id
) ||

137 *
¡©ic_ÿ¡
<
ušt32_t
 *> (
msg_
->
	`d©a
 ()è!ğ
»que¡_id
)) {

139 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
) {

140 
rc
 = 
	`»cv_»¶y_pe
 (
msg_
);

141 
	`”ºo_as£¹
 (
rc
 == 0);

149 
rc
 = 
	`»cv_»¶y_pe
 (
msg_
);

150 ià(
rc
 != 0)

151  
rc
;

153 ià(
	`uÆik–y
 (!(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
è|| msg_->
	`size
 () != 0)) {

155 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
) {

156 
rc
 = 
	`»cv_»¶y_pe
 (
msg_
);

157 
	`”ºo_as£¹
 (
rc
 == 0);

162 
mes§ge_begšs
 = 
çl£
;

165 
rc
 = 
	`»cv_»¶y_pe
 (
msg_
);

166 ià(
rc
 != 0)

167  
rc
;

170 ià(!(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
)) {

171 
»ûivšg_»¶y
 = 
çl£
;

172 
mes§ge_begšs
 = 
Œue
;

176 
	}
}

178 
boŞ
 
	gzmq
::
»q_t
::
	$xhas_š
 ()

182 ià(!
»ûivšg_»¶y
)

183  
çl£
;

185  
d—Ër_t
::
	`xhas_š
 ();

186 
	}
}

188 
boŞ
 
	gzmq
::
»q_t
::
	$xhas_out
 ()

190 ià(
»ûivšg_»¶y
)

191  
çl£
;

193  
d—Ër_t
::
	`xhas_out
 ();

194 
	}
}

196 
	gzmq
::
»q_t
::
	$x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
, 
size_t
 
İtv®Ën_
)

198 
boŞ
 
is_št
 = (
İtv®Ën_
 ==  ());

199 
v®ue
 = 
is_št
? *((*è
İtv®_
): 0;

200 
İtiÚ_
) {

201 
ZMQ_REQ_CORRELATE
:

202 ià(
is_št
 && 
v®ue
 >= 0) {

203 
»que¡_id_äames_’abËd
 = (
v®ue
 != 0);

208 
ZMQ_REQ_RELAXED
:

209 ià(
is_št
 && 
v®ue
 >= 0) {

210 
¡riù
 = (
v®ue
 == 0);

219  
d—Ër_t
::
	`x£tsockİt
 (
İtiÚ_
, 
İtv®_
, 
İtv®Ën_
);

220 
	}
}

222 
	gzmq
::
»q_t
::
	$xpe_‹rmš©ed
 (
pe_t
 *
pe_
)

224 ià(
»¶y_pe
 =ğ
pe_
)

225 
»¶y_pe
 = 
NULL
;

226 
d—Ër_t
::
	`xpe_‹rmš©ed
 (
pe_
);

227 
	}
}

229 
	gzmq
::
»q_t
::
	$»cv_»¶y_pe
 (
msg_t
 *
msg_
)

231 
Œue
) {

232 
pe_t
 *
pe
 = 
NULL
;

233 
rc
 = 
d—Ër_t
::
	`»cvpe
 (
msg_
, &
pe
);

234 ià(
rc
 != 0)

235  
rc
;

236 ià(!
»¶y_pe
 || 
pe
 ==„eply_pipe)

239 
	}
}

241 
	gzmq
::
»q_£ssiÚ_t
::
	$»q_£ssiÚ_t
 (
io_th»ad_t
 *
io_th»ad_
, 
boŞ
 
cÚÃù_
,

242 
sock‘_ba£_t
 *
sock‘_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

243 cÚ¡ 
add»ss_t
 *
addr_
) :

244 
	`£ssiÚ_ba£_t
 (
io_th»ad_
, 
cÚÃù_
, 
sock‘_
, 
İtiÚs_
, 
addr_
),

245 
	$¡©e
 (
bÙtom
)

247 
	}
}

249 
	gzmq
::
»q_£ssiÚ_t
::~
	$»q_£ssiÚ_t
 ()

251 
	}
}

253 
zmq
::
»q_£ssiÚ_t
::
	$push_msg
 (
msg_t
 *
msg_
)

255 
¡©e
) {

256 
bÙtom
:

257 ià(
msg_
->
	`æags
 (è=ğ
msg_t
::
mÜe
 && msg_->
	`size
 () == 0) {

258 
¡©e
 = 
body
;

259  
£ssiÚ_ba£_t
::
	`push_msg
 (
msg_
);

262 
body
:

263 ià(
msg_
->
	`æags
 (è=ğ
msg_t
::
mÜe
)

264  
£ssiÚ_ba£_t
::
	`push_msg
 (
msg_
);

265 ià(
msg_
->
	`æags
 () == 0) {

266 
¡©e
 = 
bÙtom
;

267  
£ssiÚ_ba£_t
::
	`push_msg
 (
msg_
);

271 
”ºo
 = 
EFAULT
;

273 
	}
}

275 
	gzmq
::
»q_£ssiÚ_t
::
	$»£t
 ()

277 
£ssiÚ_ba£_t
::
	`»£t
 ();

278 
¡©e
 = 
bÙtom
;

279 
	}
}

	@req.hpp

20 #iâdeà
__ZMQ_REQ_HPP_INCLUDED__


21 
	#__ZMQ_REQ_HPP_INCLUDED__


	)

23 
	~"d—Ër.hµ
"

24 
	~"¡dšt.hµ
"

26 
Çme¥aû
 
	gzmq


29 
şass
 
	gùx_t
;

30 
şass
 
	gmsg_t
;

31 
şass
 
	gio_th»ad_t
;

32 
şass
 
	gsock‘_ba£_t
;

34 şas 
	c»q_t
 : 
public
 
d—Ër_t


36 
public
:

38 
»q_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
);

39 ~
»q_t
 ();

42 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

43 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

44 
boŞ
 
xhas_š
 ();

45 
boŞ
 
xhas_out
 ();

46 
x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
, 
size_t
 
İtv®Ën_
);

47 
xpe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

49 
	g´Ùeùed
:

53 
»cv_»¶y_pe
 (
zmq
::
msg_t
 *
msg_
);

55 
	g´iv©e
:

59 
boŞ
 
»ûivšg_»¶y
;

63 
boŞ
 
	gmes§ge_begšs
;

66 
	gzmq
::
pe_t
 *
»¶y_pe
;

69 
boŞ
 
	g»que¡_id_äames_’abËd
;

73 
ušt32_t
 
	g»que¡_id
;

78 
boŞ
 
	g¡riù
;

80 
»q_t
 (const„eq_t&);

81 cÚ¡ 
	g»q_t
 &
	gİ”©Ü
 = (cÚ¡ 
»q_t
&);

84 şas 
	c»q_£ssiÚ_t
 : 
public
 
£ssiÚ_ba£_t


86 
public
:

88 
»q_£ssiÚ_t
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
, 
boŞ
 
cÚÃù_
,

89 
zmq
::
sock‘_ba£_t
 *
sock‘_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

90 cÚ¡ 
add»ss_t
 *
addr_
);

91 ~
»q_£ssiÚ_t
 ();

94 
push_msg
 (
msg_t
 *
msg_
);

95 
»£t
 ();

97 
	g´iv©e
:

100 
bÙtom
,

101 
	gbody


102 } 
	g¡©e
;

104 
»q_£ssiÚ_t
 (const„eq_session_t&);

105 cÚ¡ 
	g»q_£ssiÚ_t
 &
	gİ”©Ü
 = (cÚ¡ 
»q_£ssiÚ_t
&);

	@router.cpp

20 
	~"rou‹r.hµ
"

21 
	~"pe.hµ
"

22 
	~"wœe.hµ
"

23 
	~"¿ndom.hµ
"

24 
	~"lik–y.hµ
"

25 
	~"”r.hµ
"

27 
	gzmq
::
rou‹r_t
::
	$rou‹r_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

28 
	`sock‘_ba£_t
 (
·»Á_
, 
tid_
, 
sid_
),

29 
	`´eãtched
 (
çl£
),

30 
	`id’t™y_£Á
 (
çl£
),

31 
	`mÜe_š
 (
çl£
),

32 
	`cu¼’t_out
 (
NULL
),

33 
	`mÜe_out
 (
çl£
),

34 
	`Ãxt_³”_id
 (
	`g’”©e_¿ndom
 ()),

35 
	`mªd©Üy
 (
çl£
),

37 
	`¿w_sock
 (
çl£
),

38 
	$´obe_rou‹r
 (
çl£
)

40 
İtiÚs
.
ty³
 = 
ZMQ_ROUTER
;

41 
İtiÚs
.
»cv_id’t™y
 = 
Œue
;

42 
İtiÚs
.
¿w_sock
 = 
çl£
;

44 
´eãtched_id
.
	`š™
 ();

45 
´eãtched_msg
.
	`š™
 ();

46 
	}
}

48 
	gzmq
::
rou‹r_t
::~
	$rou‹r_t
 ()

50 
	`zmq_as£¹
 (
ªÚymous_pes
.
	`em±y
 ());;

51 
	`zmq_as£¹
 (
oues
.
	`em±y
 ());

52 
´eãtched_id
.
	`şo£
 ();

53 
´eãtched_msg
.
	`şo£
 ();

54 
	}
}

56 
	gzmq
::
rou‹r_t
::
	$x©ch_pe
 (
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
)

59 ()
subsüibe_to_®l_
;

61 
	`zmq_as£¹
 (
pe_
);

63 ià(
´obe_rou‹r
) {

64 
msg_t
 
´obe_msg_
;

65 
rc
 = 
´obe_msg_
.
	`š™
 ();

66 
	`”ºo_as£¹
 (
rc
 == 0);

68 
rc
 = 
pe_
->
	`wr™e
 (&
´obe_msg_
);

70 
pe_
->
	`æush
 ();

72 
rc
 = 
´obe_msg_
.
	`şo£
 ();

73 
	`”ºo_as£¹
 (
rc
 == 0);

76 
boŞ
 
id’t™y_ok
 = 
	`id’tify_³”
 (
pe_
);

77 ià(
id’t™y_ok
)

78 
fq
.
	`©ch
 (
pe_
);

80 
ªÚymous_pes
.
	`š£¹
 (
pe_
);

81 
	}
}

83 
	gzmq
::
rou‹r_t
::
	$x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
,

84 
size_t
 
İtv®Ën_
)

86 
boŞ
 
is_št
 = (
İtv®Ën_
 ==  ());

87 
v®ue
 = 
is_št
? *((*è
İtv®_
): 0;

89 
İtiÚ_
) {

90 
ZMQ_ROUTER_RAW
:

91 ià(
is_št
 && 
v®ue
 >= 0) {

92 
¿w_sock
 = (
v®ue
 != 0);

93 ià(
¿w_sock
) {

94 
İtiÚs
.
»cv_id’t™y
 = 
çl£
;

95 
İtiÚs
.
¿w_sock
 = 
Œue
;

101 
ZMQ_ROUTER_MANDATORY
:

102 ià(
is_št
 && 
v®ue
 >= 0) {

103 
mªd©Üy
 = (
v®ue
 != 0);

108 
ZMQ_PROBE_ROUTER
:

109 ià(
is_št
 && 
v®ue
 >= 0) {

110 
´obe_rou‹r
 = (
v®ue
 != 0);

118 
”ºo
 = 
EINVAL
;

120 
	}
}

123 
	gzmq
::
rou‹r_t
::
	$xpe_‹rmš©ed
 (
pe_t
 *
pe_
)

125 
¡d
::
£t
 <
pe_t
*>::
™”©Ü
 
™
 = 
ªÚymous_pes
.
	`fšd
 (
pe_
);

126 ià(
™
 !ğ
ªÚymous_pes
.
	`’d
 ())

127 
ªÚymous_pes
.
	`”a£
 (
™
);

129 
oues_t
::
™”©Ü
 
™
 = 
oues
.
	`fšd
 (
pe_
->
	`g‘_id’t™y
 ());

130 
	`zmq_as£¹
 (
™
 !ğ
oues
.
	`’d
 ());

131 
oues
.
	`”a£
 (
™
);

132 
fq
.
	`pe_‹rmš©ed
 (
pe_
);

133 ià(
pe_
 =ğ
cu¼’t_out
)

134 
cu¼’t_out
 = 
NULL
;

136 
	}
}

138 
	gzmq
::
rou‹r_t
::
	$x»ad_aùiv©ed
 (
pe_t
 *
pe_
)

140 
¡d
::
£t
 <
pe_t
*>::
™”©Ü
 
™
 = 
ªÚymous_pes
.
	`fšd
 (
pe_
);

141 ià(
™
 =ğ
ªÚymous_pes
.
	`’d
 ())

142 
fq
.
	`aùiv©ed
 (
pe_
);

144 
boŞ
 
id’t™y_ok
 = 
	`id’tify_³”
 (
pe_
);

145 ià(
id’t™y_ok
) {

146 
ªÚymous_pes
.
	`”a£
 (
™
);

147 
fq
.
	`©ch
 (
pe_
);

150 
	}
}

152 
	gzmq
::
rou‹r_t
::
	$xwr™e_aùiv©ed
 (
pe_t
 *
pe_
)

154 
oues_t
::
™”©Ü
 
™
;

155 
™
 = 
oues
.
	`begš
 (); iˆ!ğoues.
	`’d
 (); ++it)

156 ià(
™
->
£cÚd
.
pe
 =ğ
pe_
)

159 
	`zmq_as£¹
 (
™
 !ğ
oues
.
	`’d
 ());

160 
	`zmq_as£¹
 (!
™
->
£cÚd
.
aùive
);

161 
™
->
£cÚd
.
aùive
 = 
Œue
;

162 
	}
}

164 
	gzmq
::
rou‹r_t
::
	$x£nd
 (
msg_t
 *
msg_
)

168 ià(!
mÜe_out
) {

169 
	`zmq_as£¹
 (!
cu¼’t_out
);

174 ià(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
) {

176 
mÜe_out
 = 
Œue
;

181 
blob_t
 
	`id’t™y
 ((*è
msg_
->
	`d©a
 (), msg_->
	`size
 ());

182 
oues_t
::
™”©Ü
 
™
 = 
oues
.
	`fšd
 (
id’t™y
);

184 ià(
™
 !ğ
oues
.
	`’d
 ()) {

185 
cu¼’t_out
 = 
™
->
£cÚd
.
pe
;

186 ià(!
cu¼’t_out
->
	`check_wr™e
 ()) {

187 
™
->
£cÚd
.
aùive
 = 
çl£
;

188 
cu¼’t_out
 = 
NULL
;

189 ià(
mªd©Üy
) {

190 
mÜe_out
 = 
çl£
;

191 
”ºo
 = 
EAGAIN
;

197 ià(
mªd©Üy
) {

198 
mÜe_out
 = 
çl£
;

199 
”ºo
 = 
EHOSTUNREACH
;

204 
rc
 = 
msg_
->
	`şo£
 ();

205 
	`”ºo_as£¹
 (
rc
 == 0);

206 
rc
 = 
msg_
->
	`š™
 ();

207 
	`”ºo_as£¹
 (
rc
 == 0);

212 ià(
İtiÚs
.
¿w_sock
)

213 
msg_
->
	`»£t_æags
 (
msg_t
::
mÜe
);

216 
mÜe_out
 = 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
 ? 
Œue
 : 
çl£
;

219 ià(
cu¼’t_out
) {

224 ià(
¿w_sock
 && 
msg_
->
	`size
() == 0) {

225 
cu¼’t_out
->
	`‹rmš©e
 (
çl£
);

226 
rc
 = 
msg_
->
	`şo£
 ();

227 
	`”ºo_as£¹
 (
rc
 == 0);

228 
rc
 = 
msg_
->
	`š™
 ();

229 
	`”ºo_as£¹
 (
rc
 == 0);

230 
cu¼’t_out
 = 
NULL
;

234 
boŞ
 
ok
 = 
cu¼’t_out
->
	`wr™e
 (
msg_
);

235 ià(
	`uÆik–y
 (!
ok
))

236 
cu¼’t_out
 = 
NULL
;

238 ià(!
mÜe_out
) {

239 
cu¼’t_out
->
	`æush
 ();

240 
cu¼’t_out
 = 
NULL
;

244 
rc
 = 
msg_
->
	`şo£
 ();

245 
	`”ºo_as£¹
 (
rc
 == 0);

249 
rc
 = 
msg_
->
	`š™
 ();

250 
	`”ºo_as£¹
 (
rc
 == 0);

253 
	}
}

255 
	gzmq
::
rou‹r_t
::
	$x»cv
 (
msg_t
 *
msg_
)

257 ià(
´eãtched
) {

258 ià(!
id’t™y_£Á
) {

259 
rc
 = 
msg_
->
	`move
 (
´eãtched_id
);

260 
	`”ºo_as£¹
 (
rc
 == 0);

261 
id’t™y_£Á
 = 
Œue
;

264 
rc
 = 
msg_
->
	`move
 (
´eãtched_msg
);

265 
	`”ºo_as£¹
 (
rc
 == 0);

266 
´eãtched
 = 
çl£
;

268 
mÜe_š
 = 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
 ? 
Œue
 : 
çl£
;

272 
pe_t
 *
pe
 = 
NULL
;

273 
rc
 = 
fq
.
	`»cvpe
 (
msg_
, &
pe
);

278 
rc
 =ğ0 && 
msg_
->
	`is_id’t™y
 ())

279 
rc
 = 
fq
.
	`»cvpe
 (
msg_
, &
pe
);

281 ià(
rc
 != 0)

284 
	`zmq_as£¹
 (
pe
 !ğ
NULL
);

287 ià(
mÜe_š
)

288 
mÜe_š
 = 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
 ? 
Œue
 : 
çl£
;

293 
rc
 = 
´eãtched_msg
.
	`move
 (*
msg_
);

294 
	`”ºo_as£¹
 (
rc
 == 0);

295 
´eãtched
 = 
Œue
;

297 
blob_t
 
id’t™y
 = 
pe
->
	`g‘_id’t™y
 ();

298 
rc
 = 
msg_
->
	`š™_size
 (
id’t™y
.
	`size
 ());

299 
	`”ºo_as£¹
 (
rc
 == 0);

300 
	`memıy
 (
msg_
->
	`d©a
 (), 
id’t™y
.d©¨(), id’t™y.
	`size
 ());

301 
msg_
->
	`£t_æags
 (
msg_t
::
mÜe
);

302 
id’t™y_£Á
 = 
Œue
;

306 
	}
}

308 
	gzmq
::
rou‹r_t
::
	$rŞlback
 ()

310 ià(
cu¼’t_out
) {

311 
cu¼’t_out
->
	`rŞlback
 ();

312 
cu¼’t_out
 = 
NULL
;

313 
mÜe_out
 = 
çl£
;

316 
	}
}

318 
boŞ
 
	gzmq
::
rou‹r_t
::
	$xhas_š
 ()

322 ià(
mÜe_š
)

323  
Œue
;

326 ià(
´eãtched
)

327  
Œue
;

331 
pe_t
 *
pe
 = 
NULL
;

332 
rc
 = 
fq
.
	`»cvpe
 (&
´eãtched_msg
, &
pe
);

338 
rc
 =ğ0 && 
´eãtched_msg
.
	`is_id’t™y
 ())

339 
rc
 = 
fq
.
	`»cvpe
 (&
´eãtched_msg
, &
pe
);

341 ià(
rc
 != 0)

342  
çl£
;

344 
	`zmq_as£¹
 (
pe
 !ğ
NULL
);

346 
blob_t
 
id’t™y
 = 
pe
->
	`g‘_id’t™y
 ();

347 
rc
 = 
´eãtched_id
.
	`š™_size
 (
id’t™y
.
	`size
 ());

348 
	`”ºo_as£¹
 (
rc
 == 0);

349 
	`memıy
 (
´eãtched_id
.
	`d©a
 (), 
id’t™y
.d©¨(), id’t™y.
	`size
 ());

350 
´eãtched_id
.
	`£t_æags
 (
msg_t
::
mÜe
);

352 
´eãtched
 = 
Œue
;

353 
id’t™y_£Á
 = 
çl£
;

355  
Œue
;

356 
	}
}

358 
boŞ
 
	gzmq
::
rou‹r_t
::
	$xhas_out
 ()

363  
Œue
;

364 
	}
}

366 
boŞ
 
	gzmq
::
rou‹r_t
::
	$id’tify_³”
 (
pe_t
 *
pe_
)

368 
msg_t
 
msg
;

369 
blob_t
 
id’t™y
;

370 
boŞ
 
ok
;

372 ià(
İtiÚs
.
¿w_sock
) {

373 
buf
 [5];

374 
buf
 [0] = 0;

375 
	`put_ušt32
 (
buf
 + 1, 
Ãxt_³”_id
++);

376 
id’t™y
 = 
	`blob_t
 (
buf
,  buf);

379 
msg
.
	`š™
 ();

380 
ok
 = 
pe_
->
	`»ad
 (&
msg
);

381 ià(!
ok
)

382  
çl£
;

384 ià(
msg
.
	`size
 () == 0) {

386 
buf
 [5];

387 
buf
 [0] = 0;

388 
	`put_ušt32
 (
buf
 + 1, 
Ãxt_³”_id
++);

389 
id’t™y
 = 
	`blob_t
 (
buf
,  buf);

390 
msg
.
	`şo£
 ();

393 
id’t™y
 = 
	`blob_t
 ((*è
msg
.
	`d©a
 (), msg.
	`size
 ());

394 
oues_t
::
™”©Ü
 
™
 = 
oues
.
	`fšd
 (
id’t™y
);

395 
msg
.
	`şo£
 ();

398 ià(
™
 !ğ
oues
.
	`’d
 ())

399  
çl£
;

403 
pe_
->
	`£t_id’t™y
 (
id’t™y
);

405 
oue_t
 
oue
 = {
pe_
, 
Œue
};

406 
ok
 = 
oues
.
	`š£¹
 (
oues_t
::
	`v®ue_ty³
 (
id’t™y
, 
oue
)).
£cÚd
;

407 
	`zmq_as£¹
 (
ok
);

409  
Œue
;

410 
	}
}

	@router.hpp

20 #iâdeà
__ZMQ_ROUTER_HPP_INCLUDED__


21 
	#__ZMQ_ROUTER_HPP_INCLUDED__


	)

23 
	~<m­
>

25 
	~"sock‘_ba£.hµ
"

26 
	~"£ssiÚ_ba£.hµ
"

27 
	~"¡dšt.hµ
"

28 
	~"blob.hµ
"

29 
	~"msg.hµ
"

30 
	~"fq.hµ
"

32 
Çme¥aû
 
	gzmq


35 
şass
 
	gùx_t
;

36 
şass
 
	gpe_t
;

39 şas 
	crou‹r_t
 :

40 
public
 
sock‘_ba£_t


42 
public
:

44 
rou‹r_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid
);

45 ~
rou‹r_t
 ();

48 
x©ch_pe
 (
zmq
::
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
);

49 
x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
, 
size_t
 
İtv®Ën_
);

50 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

51 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

52 
boŞ
 
xhas_š
 ();

53 
boŞ
 
xhas_out
 ();

54 
x»ad_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

55 
xwr™e_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

56 
xpe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

58 
	g´Ùeùed
:

61 
rŞlback
 ();

63 
	g´iv©e
:

66 
boŞ
 
id’tify_³”
 (
pe_t
 *
pe_
);

69 
fq_t
 
	gfq
;

72 
boŞ
 
	g´eãtched
;

76 
boŞ
 
	gid’t™y_£Á
;

79 
msg_t
 
	g´eãtched_id
;

82 
msg_t
 
	g´eãtched_msg
;

85 
boŞ
 
	gmÜe_š
;

87 
	soue_t


89 
	gzmq
::
pe_t
 *
pe
;

90 
boŞ
 
	gaùive
;

94 
	g¡d
::
£t
 <
pe_t
*> 
ªÚymous_pes
;

97 
	g¡d
::
	tm­
 <
	tblob_t
, 
	toue_t
> 
	toues_t
;

98 
oues_t
 
	goues
;

101 
	gzmq
::
pe_t
 *
cu¼’t_out
;

104 
boŞ
 
	gmÜe_out
;

108 
ušt32_t
 
	gÃxt_³”_id
;

112 
boŞ
 
	gmªd©Üy
;

113 
boŞ
 
	g¿w_sock
;

116 
boŞ
 
	g´obe_rou‹r
;

118 
rou‹r_t
 (const„outer_t&);

119 cÚ¡ 
	grou‹r_t
 &
	gİ”©Ü
 = (cÚ¡ 
rou‹r_t
&);

	@select.cpp

20 
	~"£Ëù.hµ
"

21 #ià
defšed
 
ZMQ_USE_SELECT


23 
	~"¶©fÜm.hµ
"

24 #ià
defšed
 
ZMQ_HAVE_WINDOWS


25 
	~"wšdows.hµ
"

26 #–ià
defšed
 
ZMQ_HAVE_HPUX


27 
	~<sys/·¿m.h
>

28 
	~<sys/ty³s.h
>

29 
	~<sys/time.h
>

30 #–ià
defšed
 
ZMQ_HAVE_OPENVMS


31 
	~<sys/ty³s.h
>

32 
	~<sys/time.h
>

34 
	~<sys/£Ëù.h
>

37 
	~<¡ršg.h
>

38 
	~<®gÜ™hm
>

40 
	~"”r.hµ
"

41 
	~"cÚfig.hµ
"

42 
	~"i_pŞl_ev’ts.hµ
"

44 
	gzmq
::
£Ëù_t
::
	$£Ëù_t
 () :

45 
	`maxfd
 (
»tœed_fd
),

46 
	`»tœed
 (
çl£
),

47 
	$¡İpšg
 (
çl£
)

50 
	`FD_ZERO
 (&
sourû_£t_š
);

51 
	`FD_ZERO
 (&
sourû_£t_out
);

52 
	`FD_ZERO
 (&
sourû_£t_”r
);

53 
	}
}

55 
	gzmq
::
£Ëù_t
::~
	$£Ëù_t
 ()

57 
wÜk”
.
	`¡İ
 ();

58 
	}
}

60 
	gzmq
::
£Ëù_t
::
hªdË_t
 
zmq
::£Ëù_t::
	$add_fd
 (
fd_t
 
fd_
, 
i_pŞl_ev’ts
 *
ev’ts_
)

63 
fd_’Œy_t
 
’Œy
 = {
fd_
, 
ev’ts_
};

64 
fds
.
	`push_back
 (
’Œy
);

68 
	`zmq_as£¹
 (
fds
.
	`size
 (è<ğ
FD_SETSIZE
);

71 
	`FD_SET
 (
fd_
, &
sourû_£t_”r
);

74 ià(
fd_
 > 
maxfd
)

75 
maxfd
 = 
fd_
;

78 
	`adju¡_lßd
 (1);

80  
fd_
;

81 
	}
}

83 
	gzmq
::
£Ëù_t
::
	$rm_fd
 (
hªdË_t
 
hªdË_
)

86 
fd_£t_t
::
™”©Ü
 
™
;

87 
™
 = 
fds
.
	`begš
 (); iˆ!ğfds.
	`’d
 (); ++it)

88 ià(
™
->
fd
 =ğ
hªdË_
)

90 
	`zmq_as£¹
 (
™
 !ğ
fds
.
	`’d
 ());

91 
™
->
fd
 = 
»tœed_fd
;

92 
»tœed
 = 
Œue
;

95 
	`FD_CLR
 (
hªdË_
, &
sourû_£t_š
);

96 
	`FD_CLR
 (
hªdË_
, &
sourû_£t_out
);

97 
	`FD_CLR
 (
hªdË_
, &
sourû_£t_”r
);

100 
	`FD_CLR
 (
hªdË_
, &
»adfds
);

101 
	`FD_CLR
 (
hªdË_
, &
wr™efds
);

102 
	`FD_CLR
 (
hªdË_
, &
exû±fds
);

106 ià(
hªdË_
 =ğ
maxfd
) {

107 
maxfd
 = 
»tœed_fd
;

108 
fd_£t_t
::
™”©Ü
 
™
 = 
fds
.
	`begš
 (); iˆ!ğfds.
	`’d
 (); ++it)

109 ià(
™
->
fd
 > 
maxfd
)

110 
maxfd
 = 
™
->
fd
;

114 
	`adju¡_lßd
 (-1);

115 
	}
}

117 
	gzmq
::
£Ëù_t
::
	$£t_pŞlš
 (
hªdË_t
 
hªdË_
)

119 
	`FD_SET
 (
hªdË_
, &
sourû_£t_š
);

120 
	}
}

122 
	gzmq
::
£Ëù_t
::
	$»£t_pŞlš
 (
hªdË_t
 
hªdË_
)

124 
	`FD_CLR
 (
hªdË_
, &
sourû_£t_š
);

125 
	}
}

127 
	gzmq
::
£Ëù_t
::
	$£t_pŞlout
 (
hªdË_t
 
hªdË_
)

129 
	`FD_SET
 (
hªdË_
, &
sourû_£t_out
);

130 
	}
}

132 
	gzmq
::
£Ëù_t
::
	$»£t_pŞlout
 (
hªdË_t
 
hªdË_
)

134 
	`FD_CLR
 (
hªdË_
, &
sourû_£t_out
);

135 
	}
}

137 
	gzmq
::
£Ëù_t
::
	$¡¬t
 ()

139 
wÜk”
.
	`¡¬t
 (
wÜk”_routše
, 
this
);

140 
	}
}

142 
	gzmq
::
£Ëù_t
::
	$¡İ
 ()

144 
¡İpšg
 = 
Œue
;

145 
	}
}

147 
	gzmq
::
£Ëù_t
::
	$max_fds
 ()

149  
FD_SETSIZE
;

150 
	}
}

152 
	gzmq
::
£Ëù_t
::
	$loİ
 ()

154 !
¡İpšg
) {

157 
timeout
 = (è
	`execu‹_tim”s
 ();

160 
	`memıy
 (&
»adfds
, &
sourû_£t_š
,  source_set_in);

161 
	`memıy
 (&
wr™efds
, &
sourû_£t_out
,  source_set_out);

162 
	`memıy
 (&
exû±fds
, &
sourû_£t_”r
,  source_set_err);

165 
timev®
 
tv
 = {(è(
timeout
 / 1000),

166 (è(
timeout
 % 1000 * 1000)};

167 #ifdeà
ZMQ_HAVE_WINDOWS


168 
rc
 = 
	`£Ëù
 (0, &
»adfds
, &
wr™efds
, &
exû±fds
,

169 
timeout
 ? &
tv
 : 
NULL
);

170 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

172 
rc
 = 
	`£Ëù
 (
maxfd
 + 1, &
»adfds
, &
wr™efds
, &
exû±fds
,

173 
timeout
 ? &
tv
 : 
NULL
);

174 ià(
rc
 == -1) {

175 
	`”ºo_as£¹
 (
”ºo
 =ğ
EINTR
);

182 ià(
rc
 == 0)

185 
fd_£t_t
::
size_ty³
 
i
 = 0; i < 
fds
.
	`size
 (); i ++) {

186 ià(
fds
 [
i
].
fd
 =ğ
»tœed_fd
)

188 ià(
	`FD_ISSET
 (
fds
 [
i
].
fd
, &
exû±fds
))

189 
fds
 [
i
].
ev’ts
->
	`š_ev’t
 ();

190 ià(
fds
 [
i
].
fd
 =ğ
»tœed_fd
)

192 ià(
	`FD_ISSET
 (
fds
 [
i
].
fd
, &
wr™efds
))

193 
fds
 [
i
].
ev’ts
->
	`out_ev’t
 ();

194 ià(
fds
 [
i
].
fd
 =ğ
»tœed_fd
)

196 ià(
	`FD_ISSET
 (
fds
 [
i
].
fd
, &
»adfds
))

197 
fds
 [
i
].
ev’ts
->
	`š_ev’t
 ();

201 ià(
»tœed
) {

202 
fds
.
	`”a£
 (
¡d
::
	`»move_if
 (fds.
	`begš
 (), fds.
	`’d
 (),

203 
zmq
::
£Ëù_t
::
is_»tœed_fd
), 
fds
.
	`’d
 ());

204 
»tœed
 = 
çl£
;

207 
	}
}

209 
	gzmq
::
£Ëù_t
::
	$wÜk”_routše
 (*
¬g_
)

211 ((
£Ëù_t
*è
¬g_
)->
	`loİ
 ();

212 
	}
}

214 
boŞ
 
	gzmq
::
£Ëù_t
::
	$is_»tœed_fd
 (cÚ¡ 
fd_’Œy_t
 &
’Œy
)

216  (
’Œy
.
fd
 =ğ
»tœed_fd
);

217 
	}
}

	@select.hpp

20 #iâdeà
__ZMQ_SELECT_HPP_INCLUDED__


21 
	#__ZMQ_SELECT_HPP_INCLUDED__


	)

24 
	~"pŞËr.hµ
"

25 #ià
defšed
 
ZMQ_USE_SELECT


27 
	~"¶©fÜm.hµ
"

29 
	~<¡ddef.h
>

30 
	~<veùÜ
>

32 #ifdeà
ZMQ_HAVE_WINDOWS


33 
	~"wšsock2.h
"

34 #–ià
defšed
 
ZMQ_HAVE_OPENVMS


35 
	~<sys/ty³s.h
>

36 
	~<sys/time.h
>

38 
	~<sys/£Ëù.h
>

41 
	~"fd.hµ
"

42 
	~"th»ad.hµ
"

43 
	~"pŞËr_ba£.hµ
"

45 
Çme¥aû
 
	gzmq


48 
	gi_pŞl_ev’ts
;

53 şas 
	c£Ëù_t
 : 
public
 
pŞËr_ba£_t


55 
public
:

57 
fd_t
 
	thªdË_t
;

59 
£Ëù_t
 ();

60 ~
£Ëù_t
 ();

63 
hªdË_t
 
add_fd
 (
fd_t
 
fd_
, 
zmq
::
i_pŞl_ev’ts
 *
ev’ts_
);

64 
rm_fd
 (
hªdË_t
 
hªdË_
);

65 
£t_pŞlš
 (
hªdË_t
 
hªdË_
);

66 
»£t_pŞlš
 (
hªdË_t
 
hªdË_
);

67 
£t_pŞlout
 (
hªdË_t
 
hªdË_
);

68 
»£t_pŞlout
 (
hªdË_t
 
hªdË_
);

69 
¡¬t
 ();

70 
¡İ
 ();

72 
max_fds
 ();

74 
	g´iv©e
:

77 
wÜk”_routše
 (*
¬g_
);

80 
loİ
 ();

82 
	sfd_’Œy_t


84 
fd_t
 
	gfd
;

85 
	gzmq
::
i_pŞl_ev’ts
 *
ev’ts
;

89 
boŞ
 
is_»tœed_fd
 (cÚ¡ 
fd_’Œy_t
 &
’Œy
);

93 
	g¡d
::
	tveùÜ
 <
	tfd_’Œy_t
> 
	tfd_£t_t
;

94 
fd_£t_t
 
	gfds
;

96 
fd_£t
 
	gsourû_£t_š
;

97 
fd_£t
 
	gsourû_£t_out
;

98 
fd_£t
 
	gsourû_£t_”r
;

100 
fd_£t
 
	g»adfds
;

101 
fd_£t
 
	gwr™efds
;

102 
fd_£t
 
	gexû±fds
;

105 
fd_t
 
	gmaxfd
;

108 
boŞ
 
	g»tœed
;

111 
boŞ
 
	g¡İpšg
;

114 
th»ad_t
 
	gwÜk”
;

116 
£Ëù_t
 (const select_t&);

117 cÚ¡ 
	g£Ëù_t
 &
	gİ”©Ü
 = (cÚ¡ 
£Ëù_t
&);

120 
£Ëù_t
 
	tpŞËr_t
;

	@session_base.cpp

20 
	~"£ssiÚ_ba£.hµ
"

21 
	~"i_’gše.hµ
"

22 
	~"”r.hµ
"

23 
	~"pe.hµ
"

24 
	~"lik–y.hµ
"

25 
	~"tı_cÚÃù”.hµ
"

26 
	~"c_cÚÃù”.hµ
"

27 
	~"pgm_£nd”.hµ
"

28 
	~"pgm_»ûiv”.hµ
"

29 
	~"add»ss.hµ
"

31 
	~"ùx.hµ
"

32 
	~"»q.hµ
"

34 
	gzmq
::
£ssiÚ_ba£_t
 *
zmq
::£ssiÚ_ba£_t::
	$ü—‹
 (
şass
 
io_th»ad_t
 *
io_th»ad_
,

35 
boŞ
 
cÚÃù_
, 
şass
 
sock‘_ba£_t
 *
sock‘_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

36 cÚ¡ 
add»ss_t
 *
addr_
)

38 
£ssiÚ_ba£_t
 *
s
 = 
NULL
;

39 
İtiÚs_
.
ty³
) {

40 
ZMQ_REQ
:

41 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`»q_£ssiÚ_t
 (
io_th»ad_
, 
cÚÃù_
,

42 
sock‘_
, 
İtiÚs_
, 
addr_
);

44 
ZMQ_DEALER
:

45 
ZMQ_REP
:

46 
ZMQ_ROUTER
:

47 
ZMQ_PUB
:

48 
ZMQ_XPUB
:

49 
ZMQ_SUB
:

50 
ZMQ_XSUB
:

51 
ZMQ_PUSH
:

52 
ZMQ_PULL
:

53 
ZMQ_PAIR
:

54 
ZMQ_STREAM
:

55 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`£ssiÚ_ba£_t
 (
io_th»ad_
, 
cÚÃù_
,

56 
sock‘_
, 
İtiÚs_
, 
addr_
);

59 
”ºo
 = 
EINVAL
;

60  
NULL
;

62 
	`®loc_as£¹
 (
s
);

63  
s
;

64 
	}
}

66 
	gzmq
::
£ssiÚ_ba£_t
::
	$£ssiÚ_ba£_t
 (
şass
 
io_th»ad_t
 *
io_th»ad_
,

67 
boŞ
 
cÚÃù_
, 
şass
 
sock‘_ba£_t
 *
sock‘_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

68 cÚ¡ 
add»ss_t
 *
addr_
) :

69 
	`own_t
 (
io_th»ad_
, 
İtiÚs_
),

70 
	`io_objeù_t
 (
io_th»ad_
),

71 
	`cÚÃù
 (
cÚÃù_
),

72 
	`pe
 (
NULL
),

73 
	`z­_pe
 (
NULL
),

74 
	`šcom¶‘e_š
 (
çl£
),

75 
	`³ndšg
 (
çl£
),

76 
	`’gše
 (
NULL
),

77 
	`sock‘
 (
sock‘_
),

78 
	`io_th»ad
 (
io_th»ad_
),

79 
	`has_lšg”_tim”
 (
çl£
),

80 
	$addr
 (
addr_
)

82 
	}
}

84 
	gzmq
::
£ssiÚ_ba£_t
::~
	$£ssiÚ_ba£_t
 ()

86 
	`zmq_as£¹
 (!
pe
);

87 
	`zmq_as£¹
 (!
z­_pe
);

90 ià(
has_lšg”_tim”
) {

91 
	`ÿnûl_tim”
 (
lšg”_tim”_id
);

92 
has_lšg”_tim”
 = 
çl£
;

96 ià(
’gše
)

97 
’gše
->
	`‹rmš©e
 ();

99 
d–‘e
 
addr
;

100 
	}
}

102 
	gzmq
::
£ssiÚ_ba£_t
::
	$©ch_pe
 (
pe_t
 *
pe_
)

104 
	`zmq_as£¹
 (!
	`is_‹rmš©šg
 ());

105 
	`zmq_as£¹
 (!
pe
);

106 
	`zmq_as£¹
 (
pe_
);

107 
pe
 = 
pe_
;

108 
pe
->
	`£t_ev’t_sšk
 (
this
);

109 
	}
}

111 
	gzmq
::
£ssiÚ_ba£_t
::
	$puÎ_msg
 (
msg_t
 *
msg_
)

113 ià(!
pe
 || !pe->
	`»ad
 (
msg_
)) {

114 
”ºo
 = 
EAGAIN
;

117 
šcom¶‘e_š
 = 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
 ? 
Œue
 : 
çl£
;

120 
	}
}

122 
	gzmq
::
£ssiÚ_ba£_t
::
	$push_msg
 (
msg_t
 *
msg_
)

124 ià(
pe
 &&…e->
	`wr™e
 (
msg_
)) {

125 
rc
 = 
msg_
->
	`š™
 ();

126 
	`”ºo_as£¹
 (
rc
 == 0);

130 
”ºo
 = 
EAGAIN
;

132 
	}
}

134 
	gzmq
::
£ssiÚ_ba£_t
::
	$»ad_z­_msg
 (
msg_t
 *
msg_
)

136 ià(
z­_pe
 =ğ
NULL
) {

137 
”ºo
 = 
ENOTCONN
;

141 ià(!
z­_pe
->
	`»ad
 (
msg_
)) {

142 
”ºo
 = 
EAGAIN
;

147 
	}
}

149 
	gzmq
::
£ssiÚ_ba£_t
::
	$wr™e_z­_msg
 (
msg_t
 *
msg_
)

151 ià(
z­_pe
 =ğ
NULL
) {

152 
”ºo
 = 
ENOTCONN
;

156 cÚ¡ 
boŞ
 
ok
 = 
z­_pe
->
	`wr™e
 (
msg_
);

157 
	`zmq_as£¹
 (
ok
);

159 ià((
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
) == 0)

160 
z­_pe
->
	`æush
 ();

162 cÚ¡ 
rc
 = 
msg_
->
	`š™
 ();

163 
	`”ºo_as£¹
 (
rc
 == 0);

165 
	}
}

167 
	gzmq
::
£ssiÚ_ba£_t
::
	$»£t
 ()

169 
	}
}

171 
zmq
::
£ssiÚ_ba£_t
::
	$æush
 ()

173 ià(
pe
)

174 
pe
->
	`æush
 ();

175 
	}
}

177 
	gzmq
::
£ssiÚ_ba£_t
::
	$ş—n_pes
 ()

179 ià(
pe
) {

183 
pe
->
	`rŞlback
 ();

184 
pe
->
	`æush
 ();

187 
šcom¶‘e_š
) {

188 
msg_t
 
msg
;

189 
rc
 = 
msg
.
	`š™
 ();

190 
	`”ºo_as£¹
 (
rc
 == 0);

191 
rc
 = 
	`puÎ_msg
 (&
msg
);

192 
	`”ºo_as£¹
 (
rc
 == 0);

193 
rc
 = 
msg
.
	`şo£
 ();

194 
	`”ºo_as£¹
 (
rc
 == 0);

197 
	}
}

199 
	gzmq
::
£ssiÚ_ba£_t
::
	$pe_‹rmš©ed
 (
pe_t
 *
pe_
)

202 
	`zmq_as£¹
 (
pe_
 =ğ
pe


203 || 
pe_
 =ğ
z­_pe


204 || 
‹rmš©šg_pes
.
	`couÁ
 (
pe_
) == 1);

206 ià(
pe_
 =ğ
pe
)

208 
pe
 = 
NULL
;

210 ià(
pe_
 =ğ
z­_pe
) {

211 
z­_pe
 = 
NULL
;

215 
‹rmš©šg_pes
.
	`”a£
 (
pe_
);

217 ià(!
	`is_‹rmš©šg
 (è&& 
İtiÚs
.
¿w_sock
) {

218 ià(
’gše
) {

219 
’gše
->
	`‹rmš©e
 ();

220 
’gše
 = 
NULL
;

222 
	`‹rmš©e
 ();

228 ià(
³ndšg
 && !
pe
 && !
z­_pe
 && 
‹rmš©šg_pes
.
	`em±y
 ())

229 
	`´oûed_w™h_‹rm
 ();

230 
	}
}

232 
	gzmq
::
£ssiÚ_ba£_t
::
	$»ad_aùiv©ed
 (
pe_t
 *
pe_
)

235 ià(
	`uÆik–y
(
pe_
 !ğ
pe
 &&…e_ !ğ
z­_pe
)) {

236 
	`zmq_as£¹
 (
‹rmš©šg_pes
.
	`couÁ
 (
pe_
) == 1);

240 ià(
	`uÆik–y
 (
’gše
 =ğ
NULL
)) {

241 
pe
->
	`check_»ad
 ();

245 ià(
	`lik–y
 (
pe_
 =ğ
pe
))

246 
’gše
->
	`»¡¬t_ouut
 ();

248 
’gše
->
	`z­_msg_avaabË
 ();

249 
	}
}

251 
	gzmq
::
£ssiÚ_ba£_t
::
	$wr™e_aùiv©ed
 (
pe_t
 *
pe_
)

254 ià(
pe
 !ğ
pe_
) {

255 
	`zmq_as£¹
 (
‹rmš©šg_pes
.
	`couÁ
 (
pe_
) == 1);

259 ià(
’gše
)

260 
’gše
->
	`»¡¬t_šput
 ();

261 
	}
}

263 
	gzmq
::
£ssiÚ_ba£_t
::
	$hiccu³d
 (
pe_t
 *)

267 
	`zmq_as£¹
 (
çl£
);

268 
	}
}

270 
	gzmq
::
sock‘_ba£_t
 *
zmq
::
£ssiÚ_ba£_t
::
	$g‘_sock‘
 ()

272  
sock‘
;

273 
	}
}

275 
	gzmq
::
£ssiÚ_ba£_t
::
	$´oûss_¶ug
 ()

277 ià(
cÚÃù
)

278 
	`¡¬t_cÚÃùšg
 (
çl£
);

279 
	}
}

281 
	gzmq
::
£ssiÚ_ba£_t
::
	$z­_cÚÃù
 ()

283 
	`zmq_as£¹
 (
z­_pe
 =ğ
NULL
);

285 
’dpošt_t
 
³”
 = 
	`fšd_’dpošt
 ("inproc://zeromq.zap.01");

286 ià(
³”
.
sock‘
 =ğ
NULL
) {

287 
”ºo
 = 
ECONNREFUSED
;

290 ià(
³”
.
İtiÚs
.
ty³
 !ğ
ZMQ_REP


291 && 
³”
.
İtiÚs
.
ty³
 !ğ
ZMQ_ROUTER
) {

292 
”ºo
 = 
ECONNREFUSED
;

298 
objeù_t
 *
·»Ás
 [2] = {
this
, 
³”
.
sock‘
};

299 
pe_t
 *
Ãw_pes
 [2] = {
NULL
, NULL};

300 
hwms
 [2] = {0, 0};

301 
boŞ
 
cÚæ©es
 [2] = {
çl£
, false};

302 
rc
 = 
	`p•aœ
 (
·»Ás
, 
Ãw_pes
, 
hwms
, 
cÚæ©es
);

303 
	`”ºo_as£¹
 (
rc
 == 0);

306 
z­_pe
 = 
Ãw_pes
 [0];

307 
z­_pe
->
	`£t_nod–ay
 ();

308 
z­_pe
->
	`£t_ev’t_sšk
 (
this
);

310 
	`£nd_bšd
 (
³”
.
sock‘
, 
Ãw_pes
 [1], 
çl£
);

313 ià(
³”
.
İtiÚs
.
»cv_id’t™y
) {

314 
msg_t
 
id
;

315 
rc
 = 
id
.
	`š™
 ();

316 
	`”ºo_as£¹
 (
rc
 == 0);

317 
id
.
	`£t_æags
 (
msg_t
::
id’t™y
);

318 
boŞ
 
ok
 = 
z­_pe
->
	`wr™e
 (&
id
);

319 
	`zmq_as£¹
 (
ok
);

320 
z­_pe
->
	`æush
 ();

324 
	}
}

326 
	gzmq
::
£ssiÚ_ba£_t
::
	$´oûss_©ch
 (
i_’gše
 *
’gše_
)

328 
	`zmq_as£¹
 (
’gše_
 !ğ
NULL
);

331 ià(!
pe
 && !
	`is_‹rmš©šg
 ()) {

332 
objeù_t
 *
·»Ás
 [2] = {
this
, 
sock‘
};

333 
pe_t
 *
pes
 [2] = {
NULL
, NULL};

335 
boŞ
 
cÚæ©e
 = 
İtiÚs
.conflate &&

336 (
İtiÚs
.
ty³
 =ğ
ZMQ_DEALER
 ||

337 
İtiÚs
.
ty³
 =ğ
ZMQ_PULL
 ||

338 
İtiÚs
.
ty³
 =ğ
ZMQ_PUSH
 ||

339 
İtiÚs
.
ty³
 =ğ
ZMQ_PUB
 ||

340 
İtiÚs
.
ty³
 =ğ
ZMQ_SUB
);

342 
hwms
 [2] = {
cÚæ©e
? -1 : 
İtiÚs
.
rcvhwm
,

343 
cÚæ©e
? -1 : 
İtiÚs
.
¢dhwm
};

344 
boŞ
 
cÚæ©es
 [2] = {
cÚæ©e
, conflate};

345 
rc
 = 
	`p•aœ
 (
·»Ás
, 
pes
, 
hwms
, 
cÚæ©es
);

346 
	`”ºo_as£¹
 (
rc
 == 0);

349 
pes
 [0]->
	`£t_ev’t_sšk
 (
this
);

352 
	`zmq_as£¹
 (!
pe
);

353 
pe
 = 
pes
 [0];

356 
	`£nd_bšd
 (
sock‘
, 
pes
 [1]);

360 
	`zmq_as£¹
 (!
’gše
);

361 
’gše
 = 
’gše_
;

362 
’gše
->
	`¶ug
 (
io_th»ad
, 
this
);

363 
	}
}

365 
	gzmq
::
£ssiÚ_ba£_t
::
	$d‘ach
 ()

368 
’gše
 = 
NULL
;

371 
	`ş—n_pes
 ();

374 
	`d‘ached
 ();

377 ià(
pe
)

378 
pe
->
	`check_»ad
 ();

380 ià(
z­_pe
)

381 
z­_pe
->
	`check_»ad
 ();

382 
	}
}

384 
	gzmq
::
£ssiÚ_ba£_t
::
	$´oûss_‹rm
 (
lšg”_
)

386 
	`zmq_as£¹
 (!
³ndšg
);

391 ià(!
pe
 && !
z­_pe
) {

392 
	`´oûed_w™h_‹rm
 ();

396 
³ndšg
 = 
Œue
;

398 ià(
pe
 !ğ
NULL
) {

402 ià(
lšg”_
 > 0) {

403 
	`zmq_as£¹
 (!
has_lšg”_tim”
);

404 
	`add_tim”
 (
lšg”_
, 
lšg”_tim”_id
);

405 
has_lšg”_tim”
 = 
Œue
;

410 
pe
->
	`‹rmš©e
 (
lšg”_
 != 0);

415 
pe
->
	`check_»ad
 ();

418 ià(
z­_pe
 !ğ
NULL
)

419 
z­_pe
->
	`‹rmš©e
 (
çl£
);

420 
	}
}

422 
	gzmq
::
£ssiÚ_ba£_t
::
	$´oûed_w™h_‹rm
 ()

425 
³ndšg
 = 
çl£
;

428 
own_t
::
	`´oûss_‹rm
 (0);

429 
	}
}

431 
	gzmq
::
£ssiÚ_ba£_t
::
	$tim”_ev’t
 (
id_
)

436 
	`zmq_as£¹
 (
id_
 =ğ
lšg”_tim”_id
);

437 
has_lšg”_tim”
 = 
çl£
;

440 
	`zmq_as£¹
 (
pe
);

441 
pe
->
	`‹rmš©e
 (
çl£
);

442 
	}
}

444 
	gzmq
::
£ssiÚ_ba£_t
::
	$d‘ached
 ()

447 ià(!
cÚÃù
) {

448 
	`‹rmš©e
 ();

454 ià(
pe
 && 
İtiÚs
.
immedŸ‹
 == 1

455 && 
addr
->
´ÙocŞ
 != "pgm" &&‡ddr->protocol != "epgm") {

456 
pe
->
	`hiccup
 ();

457 
pe
->
	`‹rmš©e
 (
çl£
);

458 
‹rmš©šg_pes
.
	`š£¹
 (
pe
);

459 
pe
 = 
NULL
;

462 
	`»£t
 ();

465 ià(
İtiÚs
.
»cÚÃù_ivl
 != -1)

466 
	`¡¬t_cÚÃùšg
 (
Œue
);

470 ià(
pe
 && (
İtiÚs
.
ty³
 =ğ
ZMQ_SUB
 || o±iÚs.ty³ =ğ
ZMQ_XSUB
))

471 
pe
->
	`hiccup
 ();

472 
	}
}

474 
	gzmq
::
£ssiÚ_ba£_t
::
	$¡¬t_cÚÃùšg
 (
boŞ
 
wa™_
)

476 
	`zmq_as£¹
 (
cÚÃù
);

480 
io_th»ad_t
 *
io_th»ad
 = 
	`choo£_io_th»ad
 (
İtiÚs
.
affš™y
);

481 
	`zmq_as£¹
 (
io_th»ad
);

485 ià(
addr
->
´ÙocŞ
 == "tcp") {

486 
tı_cÚÃù”_t
 *
cÚÃù”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`tı_cÚÃù”_t
 (

487 
io_th»ad
, 
this
, 
İtiÚs
, 
addr
, 
wa™_
);

488 
	`®loc_as£¹
 (
cÚÃù”
);

489 
	`Ïunch_chd
 (
cÚÃù”
);

493 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


494 ià(
addr
->
´ÙocŞ
 == "ipc") {

495 
c_cÚÃù”_t
 *
cÚÃù”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`c_cÚÃù”_t
 (

496 
io_th»ad
, 
this
, 
İtiÚs
, 
addr
, 
wa™_
);

497 
	`®loc_as£¹
 (
cÚÃù”
);

498 
	`Ïunch_chd
 (
cÚÃù”
);

503 #ifdeà
ZMQ_HAVE_OPENPGM


506 ià(
addr
->
´ÙocŞ
 == "pgm" ||‡ddr->protocol == "epgm") {

508 
	`zmq_as£¹
 (
İtiÚs
.
ty³
 =ğ
ZMQ_PUB
 || o±iÚs.ty³ =ğ
ZMQ_XPUB


509 || 
İtiÚs
.
ty³
 =ğ
ZMQ_SUB
 || o±iÚs.ty³ =ğ
ZMQ_XSUB
);

512 
boŞ
 cÚ¡ 
udp_’ÿpsuÏtiÚ
 = 
addr
->
´ÙocŞ
 == "epgm";

517 ià(
İtiÚs
.
ty³
 =ğ
ZMQ_PUB
 || o±iÚs.ty³ =ğ
ZMQ_XPUB
) {

520 
pgm_£nd”_t
 *
pgm_£nd”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`pgm_£nd”_t
 (

521 
io_th»ad
, 
İtiÚs
);

522 
	`®loc_as£¹
 (
pgm_£nd”
);

524 
rc
 = 
pgm_£nd”
->
	`š™
 (
udp_’ÿpsuÏtiÚ
, 
addr
->
add»ss
.
	`c_¡r
 ());

525 
	`”ºo_as£¹
 (
rc
 == 0);

527 
	`£nd_©ch
 (
this
, 
pgm_£nd”
);

532 
pgm_»ûiv”_t
 *
pgm_»ûiv”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`pgm_»ûiv”_t
 (

533 
io_th»ad
, 
İtiÚs
);

534 
	`®loc_as£¹
 (
pgm_»ûiv”
);

536 
rc
 = 
pgm_»ûiv”
->
	`š™
 (
udp_’ÿpsuÏtiÚ
, 
addr
->
add»ss
.
	`c_¡r
 ());

537 
	`”ºo_as£¹
 (
rc
 == 0);

539 
	`£nd_©ch
 (
this
, 
pgm_»ûiv”
);

546 
	`zmq_as£¹
 (
çl£
);

547 
	}
}

	@session_base.hpp

20 #iâdeà
__ZMQ_SESSION_BASE_HPP_INCLUDED__


21 
	#__ZMQ_SESSION_BASE_HPP_INCLUDED__


	)

23 
	~<¡ršg
>

24 
	~<¡d¬g.h
>

26 
	~"own.hµ
"

27 
	~"io_objeù.hµ
"

28 
	~"pe.hµ
"

29 
	~"sock‘_ba£.hµ
"

31 
Çme¥aû
 
	gzmq


34 
şass
 
	gpe_t
;

35 
şass
 
	gio_th»ad_t
;

36 
şass
 
	gsock‘_ba£_t
;

37 
	gi_’gše
;

38 
	gadd»ss_t
;

40 
şass
 
	g£ssiÚ_ba£_t
 :

41 
public
 
own_t
,

42 
public
 
	gio_objeù_t
,

43 
public
 
	gi_pe_ev’ts


45 
	gpublic
:

48 
£ssiÚ_ba£_t
 *
ü—‹
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
,

49 
boŞ
 
cÚÃù_
, 
zmq
::
sock‘_ba£_t
 *
sock‘_
,

50 cÚ¡ 
İtiÚs_t
 &
İtiÚs_
, cÚ¡ 
add»ss_t
 *
addr_
);

53 
©ch_pe
 (
zmq
::
pe_t
 *
pe_
);

56 
vœtu®
 
»£t
 ();

57 
æush
 ();

58 
d‘ach
 ();

61 
»ad_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

62 
wr™e_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

63 
hiccu³d
 (
zmq
::
pe_t
 *
pe_
);

64 
pe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

68 
push_msg
 (
msg_t
 *
msg_
);

70 
z­_cÚÃù
 ();

75 
puÎ_msg
 (
msg_t
 *
msg_
);

80 
»ad_z­_msg
 (
msg_t
 *
msg_
);

85 
wr™e_z­_msg
 (
msg_t
 *
msg_
);

87 
sock‘_ba£_t
 *
g‘_sock‘
 ();

89 
	g´Ùeùed
:

91 
£ssiÚ_ba£_t
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
, 
boŞ
 
cÚÃù_
,

92 
zmq
::
sock‘_ba£_t
 *
sock‘_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

93 cÚ¡ 
add»ss_t
 *
addr_
);

94 
	gvœtu®
 ~
£ssiÚ_ba£_t
 ();

96 
	g´iv©e
:

98 
¡¬t_cÚÃùšg
 (
boŞ
 
wa™_
);

100 
d‘ached
 ();

103 
´oûss_¶ug
 ();

104 
´oûss_©ch
 (
zmq
::
i_’gše
 *
’gše_
);

105 
´oûss_‹rm
 (
lšg”_
);

108 
tim”_ev’t
 (
id_
);

112 
ş—n_pes
 ();

115 
´oûed_w™h_‹rm
 ();

119 
boŞ
 
	gcÚÃù
;

122 
	gzmq
::
pe_t
 *
pe
;

125 
	gzmq
::
pe_t
 *
z­_pe
;

128 
	g¡d
::
£t
 <
pe_t
 *> 
‹rmš©šg_pes
;

132 
boŞ
 
	gšcom¶‘e_š
;

136 
boŞ
 
	g³ndšg
;

139 
	gzmq
::
i_’gše
 *
’gše
;

142 
	gzmq
::
sock‘_ba£_t
 *
sock‘
;

146 
	gzmq
::
io_th»ad_t
 *
io_th»ad
;

149 ’um {
	glšg”_tim”_id
 = 0x20};

152 
boŞ
 
	ghas_lšg”_tim”
;

155 cÚ¡ 
add»ss_t
 *
	gaddr
;

157 
£ssiÚ_ba£_t
 (const session_base_t&);

158 cÚ¡ 
	g£ssiÚ_ba£_t
 &
	gİ”©Ü
 = (cÚ¡ 
£ssiÚ_ba£_t
&);

	@signaler.cpp

20 
	~"¶©fÜm.hµ
"

22 #ià
defšed
 
ZMQ_FORCE_SELECT


23 
	#ZMQ_SIGNALER_WAIT_BASED_ON_SELECT


	)

24 #–ià
defšed
 
ZMQ_FORCE_POLL


25 
	#ZMQ_SIGNALER_WAIT_BASED_ON_POLL


	)

26 #–ià
defšed
 
ZMQ_HAVE_LINUX
 || defšed 
ZMQ_HAVE_FREEBSD
 ||\

27 
defšed
 
	gZMQ_HAVE_OPENBSD
 || defšed 
	gZMQ_HAVE_SOLARIS
 ||\

28 
defšed
 
	gZMQ_HAVE_OSX
 || defšed 
	gZMQ_HAVE_QNXNTO
 ||\

29 
defšed
 
	gZMQ_HAVE_HPUX
 || defšed 
	gZMQ_HAVE_AIX
 ||\

30 
defšed
 
	gZMQ_HAVE_NETBSD


31 
	#ZMQ_SIGNALER_WAIT_BASED_ON_POLL


	)

32 #–ià
defšed
 
ZMQ_HAVE_WINDOWS
 || defšed 
ZMQ_HAVE_OPENVMS
 ||\

33 
defšed
 
	gZMQ_HAVE_CYGWIN


34 
	#ZMQ_SIGNALER_WAIT_BASED_ON_SELECT


	)

41 #ià
defšed
 
ZMQ_SIGNALER_WAIT_BASED_ON_POLL


42 
	~<pŞl.h
>

43 #–ià
defšed
 
ZMQ_SIGNALER_WAIT_BASED_ON_SELECT


44 #ià
defšed
 
ZMQ_HAVE_WINDOWS


45 
	~"wšdows.hµ
"

46 #–ià
defšed
 
ZMQ_HAVE_HPUX


47 
	~<sys/·¿m.h
>

48 
	~<sys/ty³s.h
>

49 
	~<sys/time.h
>

50 #–ià
defšed
 
ZMQ_HAVE_OPENVMS


51 
	~<sys/ty³s.h
>

52 
	~<sys/time.h
>

54 
	~<sys/£Ëù.h
>

58 
	~"sigÇËr.hµ
"

59 
	~"lik–y.hµ
"

60 
	~"¡dšt.hµ
"

61 
	~"cÚfig.hµ
"

62 
	~"”r.hµ
"

63 
	~"fd.hµ
"

64 
	~".hµ
"

66 #ià
defšed
 
ZMQ_HAVE_EVENTFD


67 
	~<sys/ev’tfd.h
>

70 #ià
defšed
 
ZMQ_HAVE_WINDOWS


71 
	~"wšdows.hµ
"

73 
	~<uni¡d.h
>

74 
	~<Ãtš‘/tı.h
>

75 
	~<uni¡d.h
>

76 
	~<sys/ty³s.h
>

77 
	~<sys/sock‘.h
>

80 #ià!
defšed
 (
ZMQ_HAVE_WINDOWS
)

83 
	$¦“p_ms
 (
ms_
)

85 ià(
ms_
 == 0)

87 #ià
defšed
 
ZMQ_HAVE_WINDOWS


88 
	`SË•
 (
ms_
 > 0 ? ms_ : 
INFINITE
);

90 #–ià
defšed
 
ZMQ_HAVE_ANDROID


91 
	`u¦“p
 (
ms_
 * 1000);

94  
	`u¦“p
 (
ms_
 * 1000);

96 
	}
}

102 
	$şo£_wa™_ms
 (
fd_
, 
max_ms_
 = 2000)

104 
ms_so_çr
 = 0;

105 
¡•_ms
 = 
max_ms_
 / 10;

106 ià(
¡•_ms
 < 1)

107 
¡•_ms
 = 1;

109 ià(
¡•_ms
 > 100)

110 
¡•_ms
 = 100;

112 
rc
 = 0;

116 ià(
rc
 =ğ-1 && 
”ºo
 =ğ
EAGAIN
)

118 
	`¦“p_ms
 (
¡•_ms
);

119 
ms_so_çr
 +ğ
¡•_ms
;

122 
rc
 = 
	`şo£
 (
fd_
);

123 } 
ms_so_çr
 < 
max_ms_
 && 
rc
 =ğ-1 && 
”ºo
 =ğ
EAGAIN
);

125  
rc
;

126 
	}
}

129 
	gzmq
::
sigÇËr_t
::
	$sigÇËr_t
 ()

132 ià(
	`make_fd·œ
 (&
r
, &
w
) == 0) {

133 
	`unblock_sock‘
 (
w
);

134 
	`unblock_sock‘
 (
r
);

136 #ifdeà
HAVE_FORK


137 
pid
 = 
	`g‘pid
();

139 
	}
}

141 
	gzmq
::
sigÇËr_t
::~
	$sigÇËr_t
 ()

143 #ià
defšed
 
ZMQ_HAVE_EVENTFD


144 
rc
 = 
	`şo£_wa™_ms
 (
r
);

145 
	`”ºo_as£¹
 (
rc
 == 0);

146 #–ià
defšed
 
ZMQ_HAVE_WINDOWS


147 
lšg”
 
so_lšg”
 = { 1, 0 };

148 
rc
 = 
	`£tsockİt
 (
w
, 
SOL_SOCKET
, 
SO_LINGER
,

149 (*)&
so_lšg”
,  (so_linger));

150 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

151 
rc
 = 
	`şo£sock‘
 (
w
);

152 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

153 
rc
 = 
	`şo£sock‘
 (
r
);

154 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

156 
rc
 = 
	`şo£_wa™_ms
 (
w
);

157 
	`”ºo_as£¹
 (
rc
 == 0);

158 
rc
 = 
	`şo£_wa™_ms
 (
r
);

159 
	`”ºo_as£¹
 (
rc
 == 0);

161 
	}
}

163 
	gzmq
::
fd_t
 
zmq
::
sigÇËr_t
::
	$g‘_fd
 ()

165  
r
;

166 
	}
}

168 
	gzmq
::
sigÇËr_t
::
	$£nd
 ()

170 #ià
HAVE_FORK


171 ià(
	`uÆik–y
(
pid
 !ğ
	`g‘pid
())) {

176 #ià
defšed
 
ZMQ_HAVE_EVENTFD


177 cÚ¡ 
ušt64_t
 
šc
 = 1;

178 
ssize_t
 
sz
 = 
	`wr™e
 (
w
, &
šc
,  (inc));

179 
	`”ºo_as£¹
 (
sz
 =ğ (
šc
));

180 #–ià
defšed
 
ZMQ_HAVE_WINDOWS


181 
dummy
 = 0;

182 
nby‹s
 = ::
	`£nd
 (
w
, (*è&
dummy
,  (dummy), 0);

183 
	`w§_as£¹
 (
nby‹s
 !ğ
SOCKET_ERROR
);

184 
	`zmq_as£¹
 (
nby‹s
 =ğ (
dummy
));

186 
dummy
 = 0;

187 
Œue
) {

188 
ssize_t
 
nby‹s
 = ::
	`£nd
 (
w
, &
dummy
,  (dummy), 0);

189 ià(
	`uÆik–y
 (
nby‹s
 =ğ-1 && 
”ºo
 =ğ
EINTR
))

191 #ià
HAVE_FORK


192 ià(
	`uÆik–y
(
pid
 !ğ
	`g‘pid
())) {

194 
”ºo
 = 
EINTR
;

198 
	`zmq_as£¹
 (
nby‹s
 =ğ (
dummy
));

202 
	}
}

204 
	gzmq
::
sigÇËr_t
::
	$wa™
 (
timeout_
)

206 #ifdeà
HAVE_FORK


207 ià(
	`uÆik–y
(
pid
 !ğ
	`g‘pid
()))

212 
”ºo
 = 
EINTR
;

217 #ifdeà
ZMQ_SIGNALER_WAIT_BASED_ON_POLL


219 
pŞlfd
 
pfd
;

220 
pfd
.
fd
 = 
r
;

221 
pfd
.
ev’ts
 = 
POLLIN
;

222 
rc
 = 
	`pŞl
 (&
pfd
, 1, 
timeout_
);

223 ià(
	`uÆik–y
 (
rc
 < 0)) {

224 
	`”ºo_as£¹
 (
”ºo
 =ğ
EINTR
);

228 ià(
	`uÆik–y
 (
rc
 == 0)) {

229 
”ºo
 = 
EAGAIN
;

232 #ifdeà
HAVE_FORK


233 ià(
	`uÆik–y
(
pid
 !ğ
	`g‘pid
())) {

237 
”ºo
 = 
EINTR
;

241 
	`zmq_as£¹
 (
rc
 == 1);

242 
	`zmq_as£¹
 (
pfd
.
»v’ts
 & 
POLLIN
);

245 #–ià
defšed
 
ZMQ_SIGNALER_WAIT_BASED_ON_SELECT


247 
fd_£t
 
fds
;

248 
	`FD_ZERO
 (&
fds
);

249 
	`FD_SET
 (
r
, &
fds
);

250 
timev®
 
timeout
;

251 ià(
timeout_
 >= 0) {

252 
timeout
.
tv_£c
 = 
timeout_
 / 1000;

253 
timeout
.
tv_u£c
 = 
timeout_
 % 1000 * 1000;

255 #ifdeà
ZMQ_HAVE_WINDOWS


256 
rc
 = 
	`£Ëù
 (0, &
fds
, 
NULL
, NULL,

257 
timeout_
 >ğ0 ? &
timeout
 : 
NULL
);

258 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

260 
rc
 = 
	`£Ëù
 (
r
 + 1, &
fds
, 
NULL
, NULL,

261 
timeout_
 >ğ0 ? &
timeout
 : 
NULL
);

262 ià(
	`uÆik–y
 (
rc
 < 0)) {

263 
	`”ºo_as£¹
 (
”ºo
 =ğ
EINTR
);

267 ià(
	`uÆik–y
 (
rc
 == 0)) {

268 
”ºo
 = 
EAGAIN
;

271 
	`zmq_as£¹
 (
rc
 == 1);

277 
	}
}

279 
	gzmq
::
sigÇËr_t
::
	$»cv
 ()

282 #ià
defšed
 
ZMQ_HAVE_EVENTFD


283 
ušt64_t
 
dummy
;

284 
ssize_t
 
sz
 = 
	`»ad
 (
r
, &
dummy
,  (dummy));

285 
	`”ºo_as£¹
 (
sz
 =ğ (
dummy
));

289 ià(
	`uÆik–y
 (
dummy
 == 2)) {

290 cÚ¡ 
ušt64_t
 
šc
 = 1;

291 
ssize_t
 
sz2
 = 
	`wr™e
 (
w
, &
šc
,  (inc));

292 
	`”ºo_as£¹
 (
sz2
 =ğ (
šc
));

296 
	`zmq_as£¹
 (
dummy
 == 1);

298 
dummy
;

299 #ià
defšed
 
ZMQ_HAVE_WINDOWS


300 
nby‹s
 = ::
	`»cv
 (
r
, (*è&
dummy
,  (dummy), 0);

301 
	`w§_as£¹
 (
nby‹s
 !ğ
SOCKET_ERROR
);

303 
ssize_t
 
nby‹s
 = ::
	`»cv
 (
r
, &
dummy
,  (dummy), 0);

304 
	`”ºo_as£¹
 (
nby‹s
 >= 0);

306 
	`zmq_as£¹
 (
nby‹s
 =ğ (
dummy
));

307 
	`zmq_as£¹
 (
dummy
 == 0);

309 
	}
}

311 #ifdeà
HAVE_FORK


312 
	gzmq
::
sigÇËr_t
::
	$fÜked
()

315 
	`şo£
 (
r
);

316 
	`şo£
 (
w
);

317 
	`make_fd·œ
 (&
r
, &
w
);

318 
	}
}

322 
	gzmq
::
sigÇËr_t
::
	$make_fd·œ
 (
fd_t
 *
r_
, fd_ˆ*
w_
)

324 #ià
defšed
 
ZMQ_HAVE_EVENTFD


325 
fd_t
 
fd
 = 
	`ev’tfd
 (0, 0);

326 ià(
fd
 == -1) {

327 
	`”ºo_as£¹
 (
”ºo
 =ğ
ENFILE
 ||ƒ¼nØ=ğ
EMFILE
);

328 *
w_
 = *
r_
 = -1;

332 *
w_
 = *
r_
 = 
fd
;

336 #–ià
defšed
 
ZMQ_HAVE_WINDOWS


337 #ià!
defšed
 
_WIN32_WCE


339 
SECURITY_DESCRIPTOR
 
sd
;

340 
SECURITY_ATTRIBUTES
 
§
;

341 
	`mem£t
 (&
sd
, 0,  (sd));

342 
	`mem£t
 (&
§
, 0,  (sa));

344 
	`In™ŸlizeSecur™yDesütÜ
(&
sd
, 
SECURITY_DESCRIPTOR_REVISION
);

345 
	`S‘Secur™yDesütÜDaş
(&
sd
, 
TRUE
, 0, 
FALSE
);

347 
§
.
nL’gth
 = (
SECURITY_ATTRIBUTES
);

348 
§
.
ÍSecur™yDesütÜ
 = &
sd
;

358 #ià!
defšed
 
_WIN32_WCE


359 
HANDLE
 
sync
 = 
	`C»©eEv’t
 (&
§
, 
FALSE
, 
TRUE
, 
	`TEXT
 ("Global\\zmq-signaler-port-sync"));

361 
HANDLE
 
sync
 = 
	`C»©eEv’t
 (
NULL
, 
FALSE
, 
TRUE
, 
	`TEXT
 ("Global\\zmq-signaler-port-sync"));

363 ià(
sync
 =ğ
NULL
 && 
	`G‘La¡E¼Ü
 (è=ğ
ERROR_ACCESS_DENIED
)

364 
sync
 = 
	`O³nEv’t
 (
SYNCHRONIZE
 | 
EVENT_MODIFY_STATE
,

365 
FALSE
, 
	`TEXT
 ("Global\\zmq-signaler-port-sync"));

367 
	`wš_as£¹
 (
sync
 !ğ
NULL
);

371 *
w_
 = 
INVALID_SOCKET
;

372 *
r_
 = 
INVALID_SOCKET
;

375 
SOCKET
 
li¡’”
;

376 
li¡’”
 = 
	`İ’_sock‘
 (
AF_INET
, 
SOCK_STREAM
, 0);

377 
	`w§_as£¹
 (
li¡’”
 !ğ
INVALID_SOCKET
);

380 
BOOL
 
so_»u£addr
 = 1;

381 
rc
 = 
	`£tsockİt
 (
li¡’”
, 
SOL_SOCKET
, 
SO_REUSEADDR
,

382 (*)&
so_»u£addr
,  (so_reuseaddr));

383 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

384 
BOOL
 
tı_nod–ay
 = 1;

385 
rc
 = 
	`£tsockİt
 (
li¡’”
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

386 (*)&
tı_nod–ay
,  (tcp_nodelay));

387 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

390 
sockaddr_š
 
addr
;

391 
	`mem£t
 (&
addr
, 0,  (addr));

392 
addr
.
sš_çmy
 = 
AF_INET
;

393 
addr
.
sš_addr
.
s_addr
 = 
	`htÚl
 (
INADDR_LOOPBACK
);

394 
addr
.
sš_pÜt
 = 
	`htÚs
 (
sigÇËr_pÜt
);

397 *
w_
 = 
	`İ’_sock‘
 (
AF_INET
, 
SOCK_STREAM
, 0);

398 
	`w§_as£¹
 (*
w_
 !ğ
INVALID_SOCKET
);

401 
rc
 = 
	`£tsockİt
 (*
w_
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

402 (*)&
tı_nod–ay
,  (tcp_nodelay));

403 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

406 
DWORD
 
dwrc
 = 
	`Wa™FÜSšgËObjeù
 (
sync
, 
INFINITE
);

407 
	`zmq_as£¹
 (
dwrc
 =ğ
WAIT_OBJECT_0
);

410 
rc
 = 
	`bšd
 (
li¡’”
, (cÚ¡ 
sockaddr
*è&
addr
,  (addr));

413 ià(
rc
 !ğ
SOCKET_ERROR
)

414 
rc
 = 
	`li¡’
 (
li¡’”
, 1);

417 ià(
rc
 !ğ
SOCKET_ERROR
)

418 
rc
 = 
	`cÚÃù
 (*
w_
, (
sockaddr
*è&
addr
,  (addr));

421 ià(
rc
 !ğ
SOCKET_ERROR
)

422 *
r_
 = 
	`acû±
 (
li¡’”
, 
NULL
, NULL);

425 
§ved_”ºo
 = 0;

426 ià(*
r_
 =ğ
INVALID_SOCKET
)

427 
§ved_”ºo
 = 
	`WSAG‘La¡E¼Ü
 ();

430 
	`şo£sock‘
 (
li¡’”
);

433 
BOOL
 
brc
 = 
	`S‘Ev’t
 (
sync
);

434 
	`wš_as£¹
 (
brc
 != 0);

437 
brc
 = 
	`Clo£HªdË
 (
sync
);

438 
	`wš_as£¹
 (
brc
 != 0);

440 ià(*
r_
 !ğ
INVALID_SOCKET
) {

441 #ià!
defšed
 
_WIN32_WCE


443 
brc
 = 
	`S‘HªdËInfÜm©iÚ
 ((
HANDLE
è*
r_
, 
HANDLE_FLAG_INHERIT
, 0);

444 
	`wš_as£¹
 (
brc
);

450 ià(*
w_
 !ğ
INVALID_SOCKET
) {

451 
rc
 = 
	`şo£sock‘
 (*
w_
);

452 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

453 *
w_
 = 
INVALID_SOCKET
;

456 
”ºo
 = 
	`w§_”rÜ_to_”ºo
 (
§ved_”ºo
);

460 #–ià
defšed
 
ZMQ_HAVE_OPENVMS


468 
sockaddr_š
 
lşaddr
;

469 
	`mem£t
 (&
lşaddr
, 0,  (lcladdr));

470 
lşaddr
.
sš_çmy
 = 
AF_INET
;

471 
lşaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
 (
INADDR_LOOPBACK
);

472 
lşaddr
.
sš_pÜt
 = 0;

474 
li¡’”
 = 
	`İ’_sock‘
 (
AF_INET
, 
SOCK_STREAM
, 0);

475 
	`”ºo_as£¹
 (
li¡’”
 != -1);

477 
Ú
 = 1;

478 
rc
 = 
	`£tsockİt
 (
li¡’”
, 
IPPROTO_TCP
, 
TCP_NODELAY
, &
Ú
,  (on));

479 
	`”ºo_as£¹
 (
rc
 != -1);

481 
rc
 = 
	`£tsockİt
 (
li¡’”
, 
IPPROTO_TCP
, 
TCP_NODELACK
, &
Ú
,  (on));

482 
	`”ºo_as£¹
 (
rc
 != -1);

484 
rc
 = 
	`bšd
 (
li¡’”
, (
sockaddr
*è&
lşaddr
,  (lcladdr));

485 
	`”ºo_as£¹
 (
rc
 != -1);

487 
sockËn_t
 
lşaddr_Ën
 =  (
lşaddr
);

489 
rc
 = 
	`g‘sockÇme
 (
li¡’”
, (
sockaddr
*è&
lşaddr
, &
lşaddr_Ën
);

490 
	`”ºo_as£¹
 (
rc
 != -1);

492 
rc
 = 
	`li¡’
 (
li¡’”
, 1);

493 
	`”ºo_as£¹
 (
rc
 != -1);

495 *
w_
 = 
	`İ’_sock‘
 (
AF_INET
, 
SOCK_STREAM
, 0);

496 
	`”ºo_as£¹
 (*
w_
 != -1);

498 
rc
 = 
	`£tsockİt
 (*
w_
, 
IPPROTO_TCP
, 
TCP_NODELAY
, &
Ú
,  (on));

499 
	`”ºo_as£¹
 (
rc
 != -1);

501 
rc
 = 
	`£tsockİt
 (*
w_
, 
IPPROTO_TCP
, 
TCP_NODELACK
, &
Ú
,  (on));

502 
	`”ºo_as£¹
 (
rc
 != -1);

504 
rc
 = 
	`cÚÃù
 (*
w_
, (
sockaddr
*è&
lşaddr
,  (lcladdr));

505 
	`”ºo_as£¹
 (
rc
 != -1);

507 *
r_
 = 
	`acû±
 (
li¡’”
, 
NULL
, NULL);

508 
	`”ºo_as£¹
 (*
r_
 != -1);

510 
	`şo£
 (
li¡’”
);

516 
sv
 [2];

517 
rc
 = 
	`sock‘·œ
 (
AF_UNIX
, 
SOCK_STREAM
, 0, 
sv
);

518 ià(
rc
 == -1) {

519 
	`”ºo_as£¹
 (
”ºo
 =ğ
ENFILE
 ||ƒ¼nØ=ğ
EMFILE
);

520 *
w_
 = *
r_
 = -1;

524 *
w_
 = 
sv
 [0];

525 *
r_
 = 
sv
 [1];

529 
	}
}

531 #ià
defšed
 
ZMQ_SIGNALER_WAIT_BASED_ON_SELECT


532 #undeà
ZMQ_SIGNALER_WAIT_BASED_ON_SELECT


534 #ià
defšed
 
ZMQ_SIGNALER_WAIT_BASED_ON_POLL


535 #undeà
ZMQ_SIGNALER_WAIT_BASED_ON_POLL


	@signaler.hpp

20 #iâdeà
__ZMQ_SIGNALER_HPP_INCLUDED__


21 
	#__ZMQ_SIGNALER_HPP_INCLUDED__


	)

23 #ifdeà
HAVE_FORK


24 
	~<uni¡d.h
>

27 
	~"fd.hµ
"

29 
Çme¥aû
 
	gzmq


37 şas 
	csigÇËr_t


39 
	gpublic
:

41 
sigÇËr_t
 ();

42 ~
sigÇËr_t
 ();

44 
fd_t
 
g‘_fd
 ();

45 
£nd
 ();

46 
wa™
 (
timeout_
);

47 
»cv
 ();

49 #ifdeà
HAVE_FORK


52 
fÜked
();

55 
	g´iv©e
:

59 
make_fd·œ
 (
fd_t
 *
r_
, fd_ˆ*
w_
);

63 
fd_t
 
	gw
;

64 
fd_t
 
	gr
;

67 
sigÇËr_t
 (const signaler_t&);

68 cÚ¡ 
	gsigÇËr_t
 &
	gİ”©Ü
 = (cÚ¡ 
sigÇËr_t
&);

70 #ifdeà
HAVE_FORK


72 
pid_t
 
	gpid
;

75 
şo£_š‹º®
();

	@socket_base.cpp

20 
	~<Ãw
>

21 
	~<¡ršg
>

22 
	~<®gÜ™hm
>

24 
	~"¶©fÜm.hµ
"

26 #ià
defšed
 
ZMQ_HAVE_WINDOWS


27 
	~"wšdows.hµ
"

28 #ià
defšed
 
_MSC_VER


29 #ià
defšed
 
_WIN32_WCE


30 
	~<cmnšŒš.h
>

32 
	~<šŒš.h
>

36 
	~<uni¡d.h
>

39 
	~"sock‘_ba£.hµ
"

40 
	~"tı_li¡’”.hµ
"

41 
	~"c_li¡’”.hµ
"

42 
	~"tı_cÚÃù”.hµ
"

43 
	~"io_th»ad.hµ
"

44 
	~"£ssiÚ_ba£.hµ
"

45 
	~"cÚfig.hµ
"

46 
	~"pe.hµ
"

47 
	~"”r.hµ
"

48 
	~"ùx.hµ
"

49 
	~"¶©fÜm.hµ
"

50 
	~"lik–y.hµ
"

51 
	~"msg.hµ
"

52 
	~"add»ss.hµ
"

53 
	~"c_add»ss.hµ
"

54 
	~"tı_add»ss.hµ
"

55 #ifdeà
ZMQ_HAVE_OPENPGM


56 
	~"pgm_sock‘.hµ
"

59 
	~"·œ.hµ
"

60 
	~"pub.hµ
"

61 
	~"sub.hµ
"

62 
	~"»q.hµ
"

63 
	~"»p.hµ
"

64 
	~"puÎ.hµ
"

65 
	~"push.hµ
"

66 
	~"d—Ër.hµ
"

67 
	~"rou‹r.hµ
"

68 
	~"xpub.hµ
"

69 
	~"xsub.hµ
"

70 
	~"¡»am.hµ
"

72 
boŞ
 
	gzmq
::
sock‘_ba£_t
::
	$check_g
 ()

74  
g
 == 0xbaddecaf;

75 
	}
}

77 
	gzmq
::
sock‘_ba£_t
 *
zmq
::sock‘_ba£_t::
	$ü—‹
 (
ty³_
, 
şass
 
ùx_t
 *
·»Á_
,

78 
ušt32_t
 
tid_
, 
sid_
)

80 
sock‘_ba£_t
 *
s
 = 
NULL
;

81 
ty³_
) {

82 
ZMQ_PAIR
:

83 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`·œ_t
 (
·»Á_
, 
tid_
, 
sid_
);

85 
ZMQ_PUB
:

86 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`pub_t
 (
·»Á_
, 
tid_
, 
sid_
);

88 
ZMQ_SUB
:

89 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`sub_t
 (
·»Á_
, 
tid_
, 
sid_
);

91 
ZMQ_REQ
:

92 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`»q_t
 (
·»Á_
, 
tid_
, 
sid_
);

94 
ZMQ_REP
:

95 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`»p_t
 (
·»Á_
, 
tid_
, 
sid_
);

97 
ZMQ_DEALER
:

98 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`d—Ër_t
 (
·»Á_
, 
tid_
, 
sid_
);

100 
ZMQ_ROUTER
:

101 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`rou‹r_t
 (
·»Á_
, 
tid_
, 
sid_
);

103 
ZMQ_PULL
:

104 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`puÎ_t
 (
·»Á_
, 
tid_
, 
sid_
);

106 
ZMQ_PUSH
:

107 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`push_t
 (
·»Á_
, 
tid_
, 
sid_
);

109 
ZMQ_XPUB
:

110 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`xpub_t
 (
·»Á_
, 
tid_
, 
sid_
);

112 
ZMQ_XSUB
:

113 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`xsub_t
 (
·»Á_
, 
tid_
, 
sid_
);

115 
ZMQ_STREAM
:

116 
s
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`¡»am_t
 (
·»Á_
, 
tid_
, 
sid_
);

119 
”ºo
 = 
EINVAL
;

120  
NULL
;

122 ià(
s
->
mabox
.
	`g‘_fd
 (è=ğ
»tœed_fd
)

123  
NULL
;

125 
	`®loc_as£¹
 (
s
);

126  
s
;

127 
	}
}

129 
	gzmq
::
sock‘_ba£_t
::
	$sock‘_ba£_t
 (
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

130 
	`own_t
 (
·»Á_
, 
tid_
),

131 
	`g
 (0xbaddecaf),

132 
	`ùx_‹rmš©ed
 (
çl£
),

133 
	`de¡royed
 (
çl£
),

134 
	`Ï¡_tsc
 (0),

135 
	`ticks
 (0),

136 
	`rcvmÜe
 (
çl£
),

137 
	`mÚ™Ü_sock‘
 (
NULL
),

138 
	$mÚ™Ü_ev’ts
 (0)

140 
İtiÚs
.
sock‘_id
 = 
sid_
;

141 
İtiÚs
.
v6
 = (
·»Á_
->
	`g‘
 (
ZMQ_IPV6
) != 0);

142 
	}
}

144 
	gzmq
::
sock‘_ba£_t
::~
	$sock‘_ba£_t
 ()

146 
	`¡İ_mÚ™Ü
 ();

147 
	`zmq_as£¹
 (
de¡royed
);

148 
	}
}

150 
	gzmq
::
mabox_t
 *
zmq
::
sock‘_ba£_t
::
	$g‘_mabox
 ()

152  &
mabox
;

153 
	}
}

155 
	gzmq
::
sock‘_ba£_t
::
	$¡İ
 ()

161 
	`£nd_¡İ
 ();

162 
	}
}

164 
	gzmq
::
sock‘_ba£_t
::
	$·r£_uri
 (cÚ¡ *
uri_
,

165 
¡d
::
¡ršg
 &
´ÙocŞ_
, std::¡ršg &
add»ss_
)

167 
	`zmq_as£¹
 (
uri_
 !ğ
NULL
);

169 
¡d
::
¡ršg
 
	`uri
 (
uri_
);

170 
¡d
::
¡ršg
::
size_ty³
 
pos
 = 
uri
.
	`fšd
 ("://");

171 ià(
pos
 =ğ
¡d
::
¡ršg
::
Åos
) {

172 
”ºo
 = 
EINVAL
;

175 
´ÙocŞ_
 = 
uri
.
	`sub¡r
 (0, 
pos
);

176 
add»ss_
 = 
uri
.
	`sub¡r
 (
pos
 + 3);

178 ià(
´ÙocŞ_
.
	`em±y
 (è|| 
add»ss_
.empty ()) {

179 
”ºo
 = 
EINVAL
;

183 
	}
}

185 
	gzmq
::
sock‘_ba£_t
::
	$check_´ÙocŞ
 (cÚ¡ 
¡d
::
¡ršg
 &
´ÙocŞ_
)

188 ià(
´ÙocŞ_
 != "inproc" &&…rotocol_ != "ipc" &&…rotocol_ != "tcp" &&

189 
´ÙocŞ_
 != "pgm" &&…rotocol_ != "epgm") {

190 
”ºo
 = 
EPROTONOSUPPORT
;

196 #ià!
defšed
 
ZMQ_HAVE_OPENPGM


197 ià(
´ÙocŞ_
 == "pgm" ||…rotocol_ == "epgm") {

198 
”ºo
 = 
EPROTONOSUPPORT
;

204 #ià
defšed
 
ZMQ_HAVE_WINDOWS
 || defšed 
ZMQ_HAVE_OPENVMS


205 ià(
´ÙocŞ_
 == "ipc") {

207 
”ºo
 = 
EPROTONOSUPPORT
;

215 ià((
´ÙocŞ_
 == "pgm" ||…rotocol_ == "epgm") &&

216 
İtiÚs
.
ty³
 !ğ
ZMQ_PUB
 && o±iÚs.ty³ !ğ
ZMQ_SUB
 &&

217 
İtiÚs
.
ty³
 !ğ
ZMQ_XPUB
 && o±iÚs.ty³ !ğ
ZMQ_XSUB
) {

218 
”ºo
 = 
ENOCOMPATPROTO
;

224 
	}
}

226 
	gzmq
::
sock‘_ba£_t
::
	$©ch_pe
 (
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
)

229 
pe_
->
	`£t_ev’t_sšk
 (
this
);

230 
pes
.
	`push_back
 (
pe_
);

233 
	`x©ch_pe
 (
pe_
, 
subsüibe_to_®l_
);

237 ià(
	`is_‹rmš©šg
 ()) {

238 
	`»gi¡”_‹rm_acks
 (1);

239 
pe_
->
	`‹rmš©e
 (
çl£
);

241 
	}
}

243 
	gzmq
::
sock‘_ba£_t
::
	$£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
,

244 
size_t
 
İtv®Ën_
)

246 ià(
	`uÆik–y
 (
ùx_‹rmš©ed
)) {

247 
”ºo
 = 
ETERM
;

252 
rc
 = 
	`x£tsockİt
 (
İtiÚ_
, 
İtv®_
, 
İtv®Ën_
);

253 ià(
rc
 =ğ0 || 
”ºo
 !ğ
EINVAL
)

254  
rc
;

258  
İtiÚs
.
	`£tsockİt
 (
İtiÚ_
, 
İtv®_
, 
İtv®Ën_
);

259 
	}
}

261 
	gzmq
::
sock‘_ba£_t
::
	$g‘sockİt
 (
İtiÚ_
, *
İtv®_
,

262 
size_t
 *
İtv®Ën_
)

264 ià(
	`uÆik–y
 (
ùx_‹rmš©ed
)) {

265 
”ºo
 = 
ETERM
;

269 ià(
İtiÚ_
 =ğ
ZMQ_RCVMORE
) {

270 ià(*
İtv®Ën_
 <  ()) {

271 
”ºo
 = 
EINVAL
;

274 *((*è
İtv®_
èğ
rcvmÜe
 ? 1 : 0;

275 *
İtv®Ën_
 =  ();

279 ià(
İtiÚ_
 =ğ
ZMQ_FD
) {

280 ià(*
İtv®Ën_
 <  (
fd_t
)) {

281 
”ºo
 = 
EINVAL
;

284 *((
fd_t
*è
İtv®_
èğ
mabox
.
	`g‘_fd
 ();

285 *
İtv®Ën_
 =  (
fd_t
);

289 ià(
İtiÚ_
 =ğ
ZMQ_EVENTS
) {

290 ià(*
İtv®Ën_
 <  ()) {

291 
”ºo
 = 
EINVAL
;

294 
rc
 = 
	`´oûss_commªds
 (0, 
çl£
);

295 ià(
rc
 !ğ0 && (
”ºo
 =ğ
EINTR
 ||ƒ¼nØ=ğ
ETERM
))

297 
	`”ºo_as£¹
 (
rc
 == 0);

298 *((*è
İtv®_
) = 0;

299 ià(
	`has_out
 ())

300 *((*è
İtv®_
è|ğ
ZMQ_POLLOUT
;

301 ià(
	`has_š
 ())

302 *((*è
İtv®_
è|ğ
ZMQ_POLLIN
;

303 *
İtv®Ën_
 =  ();

307 ià(
İtiÚ_
 =ğ
ZMQ_LAST_ENDPOINT
) {

308 ià(*
İtv®Ën_
 < 
Ï¡_’dpošt
.
	`size
 () + 1) {

309 
”ºo
 = 
EINVAL
;

312 
	`¡rıy
 (
¡©ic_ÿ¡
 <*> (
İtv®_
), 
Ï¡_’dpošt
.
	`c_¡r
 ());

313 *
İtv®Ën_
 = 
Ï¡_’dpošt
.
	`size
 () + 1;

317  
İtiÚs
.
	`g‘sockİt
 (
İtiÚ_
, 
İtv®_
, 
İtv®Ën_
);

318 
	}
}

320 
	gzmq
::
sock‘_ba£_t
::
	$bšd
 (cÚ¡ *
addr_
)

322 ià(
	`uÆik–y
 (
ùx_‹rmš©ed
)) {

323 
”ºo
 = 
ETERM
;

328 
rc
 = 
	`´oûss_commªds
 (0, 
çl£
);

329 ià(
	`uÆik–y
 (
rc
 != 0))

333 
¡d
::
¡ršg
 
´ÙocŞ
;

334 
¡d
::
¡ršg
 
add»ss
;

335 
rc
 = 
	`·r£_uri
 (
addr_
, 
´ÙocŞ
, 
add»ss
);

336 ià(
rc
 != 0)

339 
rc
 = 
	`check_´ÙocŞ
 (
´ÙocŞ
);

340 ià(
rc
 != 0)

343 ià(
´ÙocŞ
 == "inproc") {

344 
’dpošt_t
 
’dpošt
 = {
this
, 
İtiÚs
};

345 
rc
 = 
	`»gi¡”_’dpošt
 (
addr_
, 
’dpošt
);

346 ià(
rc
 == 0) {

347 
	`cÚÃù_³ndšg
(
addr_
, 
this
);

348 
Ï¡_’dpošt
.
	`assign
 (
addr_
);

350  
rc
;

353 ià(
´ÙocŞ
 == "pgm" ||…rotocol == "epgm") {

356  
	`cÚÃù
 (
addr_
);

361 
io_th»ad_t
 *
io_th»ad
 = 
	`choo£_io_th»ad
 (
İtiÚs
.
affš™y
);

362 ià(!
io_th»ad
) {

363 
”ºo
 = 
EMTHREAD
;

367 ià(
´ÙocŞ
 == "tcp") {

368 
tı_li¡’”_t
 *
li¡’”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`tı_li¡’”_t
 (

369 
io_th»ad
, 
this
, 
İtiÚs
);

370 
	`®loc_as£¹
 (
li¡’”
);

371 
rc
 = 
li¡’”
->
	`£t_add»ss
 (
add»ss
.
	`c_¡r
 ());

372 ià(
rc
 != 0) {

373 
d–‘e
 
li¡’”
;

374 
	`ev’t_bšd_çed
 (
add»ss
, 
	`zmq_”ºo
());

379 
li¡’”
->
	`g‘_add»ss
 (
Ï¡_’dpošt
);

381 
	`add_’dpošt
 (
addr_
, (
own_t
 *è
li¡’”
, 
NULL
);

385 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


386 ià(
´ÙocŞ
 == "ipc") {

387 
c_li¡’”_t
 *
li¡’”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`c_li¡’”_t
 (

388 
io_th»ad
, 
this
, 
İtiÚs
);

389 
	`®loc_as£¹
 (
li¡’”
);

390 
rc
 = 
li¡’”
->
	`£t_add»ss
 (
add»ss
.
	`c_¡r
 ());

391 ià(
rc
 != 0) {

392 
d–‘e
 
li¡’”
;

393 
	`ev’t_bšd_çed
 (
add»ss
, 
	`zmq_”ºo
());

398 
li¡’”
->
	`g‘_add»ss
 (
Ï¡_’dpošt
);

400 
	`add_’dpošt
 (
addr_
, (
own_t
 *è
li¡’”
, 
NULL
);

405 
	`zmq_as£¹
 (
çl£
);

407 
	}
}

409 
	gzmq
::
sock‘_ba£_t
::
	$cÚÃù
 (cÚ¡ *
addr_
)

411 ià(
	`uÆik–y
 (
ùx_‹rmš©ed
)) {

412 
”ºo
 = 
ETERM
;

417 
rc
 = 
	`´oûss_commªds
 (0, 
çl£
);

418 ià(
	`uÆik–y
 (
rc
 != 0))

422 
¡d
::
¡ršg
 
´ÙocŞ
;

423 
¡d
::
¡ršg
 
add»ss
;

424 
rc
 = 
	`·r£_uri
 (
addr_
, 
´ÙocŞ
, 
add»ss
);

425 ià(
rc
 != 0)

428 
rc
 = 
	`check_´ÙocŞ
 (
´ÙocŞ
);

429 ià(
rc
 != 0)

432 ià(
´ÙocŞ
 == "inproc") {

439 
’dpošt_t
 
³”
 = 
	`fšd_’dpošt
 (
addr_
);

443 
¢dhwm
 = 0;

444 ià(
³”
.
sock‘
 =ğ
NULL
)

445 
¢dhwm
 = 
İtiÚs
.sndhwm;

446 ià(
İtiÚs
.
¢dhwm
 !ğ0 && 
³”
.İtiÚs.
rcvhwm
 != 0)

447 
¢dhwm
 = 
İtiÚs
.¢dhwm + 
³”
.İtiÚs.
rcvhwm
;

448 
rcvhwm
 = 0;

449 ià(
³”
.
sock‘
 =ğ
NULL
)

450 
rcvhwm
 = 
İtiÚs
.rcvhwm;

451 ià(
İtiÚs
.
rcvhwm
 !ğ0 && 
³”
.İtiÚs.
¢dhwm
 != 0)

452 
rcvhwm
 = 
İtiÚs
.rcvhwm + 
³”
.İtiÚs.
¢dhwm
;

455 
objeù_t
 *
·»Ás
 [2] = {
this
, 
³”
.
sock‘
 =ğ
NULL
 ?his :…eer.socket};

456 
pe_t
 *
Ãw_pes
 [2] = {
NULL
, NULL};

458 
boŞ
 
cÚæ©e
 = 
İtiÚs
.conflate &&

459 (
İtiÚs
.
ty³
 =ğ
ZMQ_DEALER
 ||

460 
İtiÚs
.
ty³
 =ğ
ZMQ_PULL
 ||

461 
İtiÚs
.
ty³
 =ğ
ZMQ_PUSH
 ||

462 
İtiÚs
.
ty³
 =ğ
ZMQ_PUB
 ||

463 
İtiÚs
.
ty³
 =ğ
ZMQ_SUB
);

465 
hwms
 [2] = {
cÚæ©e
? -1 : 
¢dhwm
, cÚæ©e? -1 : 
rcvhwm
};

466 
boŞ
 
cÚæ©es
 [2] = {
cÚæ©e
, conflate};

467 
rc
 = 
	`p•aœ
 (
·»Ás
, 
Ãw_pes
, 
hwms
, 
cÚæ©es
);

468 
	`”ºo_as£¹
 (
rc
 == 0);

471 
	`©ch_pe
 (
Ãw_pes
 [0]);

473 ià(!
³”
.
sock‘
) {

478 
msg_t
 
id
;

479 
rc
 = 
id
.
	`š™_size
 (
İtiÚs
.
id’t™y_size
);

480 
	`”ºo_as£¹
 (
rc
 == 0);

481 
	`memıy
 (
id
.
	`d©a
 (), 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

482 
id
.
	`£t_æags
 (
msg_t
::
id’t™y
);

483 
boŞ
 
wr™‹n
 = 
Ãw_pes
 [0]->
	`wr™e
 (&
id
);

484 
	`zmq_as£¹
 (
wr™‹n
);

485 
Ãw_pes
 [0]->
	`æush
 ();

487 
’dpošt_t
 
’dpošt
 = {
this
, 
İtiÚs
};

488 
³ndšg_cÚÃùiÚ_t
 
³ndšg_cÚÃùiÚ
 = {
’dpošt
, 
Ãw_pes
 [0],‚ew_pipes [1]};

489 
	`³nd_cÚÃùiÚ
 (
addr_
, 
³ndšg_cÚÃùiÚ
);

494 ià(
³”
.
İtiÚs
.
»cv_id’t™y
) {

496 
msg_t
 
id
;

497 
rc
 = 
id
.
	`š™_size
 (
İtiÚs
.
id’t™y_size
);

498 
	`”ºo_as£¹
 (
rc
 == 0);

499 
	`memıy
 (
id
.
	`d©a
 (), 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

500 
id
.
	`£t_æags
 (
msg_t
::
id’t™y
);

501 
boŞ
 
wr™‹n
 = 
Ãw_pes
 [0]->
	`wr™e
 (&
id
);

502 
	`zmq_as£¹
 (
wr™‹n
);

503 
Ãw_pes
 [0]->
	`æush
 ();

507 ià(
İtiÚs
.
»cv_id’t™y
) {

508 
msg_t
 
id
;

509 
rc
 = 
id
.
	`š™_size
 (
³”
.
İtiÚs
.
id’t™y_size
);

510 
	`”ºo_as£¹
 (
rc
 == 0);

511 
	`memıy
 (
id
.
	`d©a
 (), 
³”
.
İtiÚs
.
id’t™y
,…“r.İtiÚs.
id’t™y_size
);

512 
id
.
	`£t_æags
 (
msg_t
::
id’t™y
);

513 
boŞ
 
wr™‹n
 = 
Ãw_pes
 [1]->
	`wr™e
 (&
id
);

514 
	`zmq_as£¹
 (
wr™‹n
);

515 
Ãw_pes
 [1]->
	`æush
 ();

521 
	`£nd_bšd
 (
³”
.
sock‘
, 
Ãw_pes
 [1], 
çl£
);

525 
Ï¡_’dpošt
.
	`assign
 (
addr_
);

528 
š´ocs
.
	`š£¹
 (
š´ocs_t
::
	`v®ue_ty³
 (
¡d
::
	`¡ršg
 (
addr_
), 
Ãw_pes
[0]));

534 
io_th»ad_t
 *
io_th»ad
 = 
	`choo£_io_th»ad
 (
İtiÚs
.
affš™y
);

535 ià(!
io_th»ad
) {

536 
”ºo
 = 
EMTHREAD
;

540 
add»ss_t
 *
·ddr
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`add»ss_t
 (
´ÙocŞ
, 
add»ss
);

541 
	`®loc_as£¹
 (
·ddr
);

544 ià(
´ÙocŞ
 == "tcp") {

545 
·ddr
->
»sŞved
.
tı_addr
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`tı_add»ss_t
 ();

546 
	`®loc_as£¹
 (
·ddr
->
»sŞved
.
tı_addr
);

547 
rc
 = 
·ddr
->
»sŞved
.
tı_addr
->
	`»sŞve
 (

548 
add»ss
.
	`c_¡r
 (), 
çl£
, 
İtiÚs
.
v6
);

549 ià(
rc
 != 0) {

550 
d–‘e
 
·ddr
;

554 #ià!
defšed
 
ZMQ_HAVE_WINDOWS
 && !defšed 
ZMQ_HAVE_OPENVMS


556 ià(
´ÙocŞ
 == "ipc") {

557 
·ddr
->
»sŞved
.
c_addr
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`c_add»ss_t
 ();

558 
	`®loc_as£¹
 (
·ddr
->
»sŞved
.
c_addr
);

559 
rc
 = 
·ddr
->
»sŞved
.
c_addr
->
	`»sŞve
 (
add»ss
.
	`c_¡r
 ());

560 ià(
rc
 != 0) {

561 
d–‘e
 
·ddr
;

566 #ifdeà
ZMQ_HAVE_OPENPGM


567 ià(
´ÙocŞ
 == "pgm" ||…rotocol == "epgm") {

568 
pgm_addršfo_t
 *
»s
 = 
NULL
;

569 
ušt16_t
 
pÜt_numb”
 = 0;

570 
rc
 = 
pgm_sock‘_t
::
	`š™_add»ss
(
add»ss
.
	`c_¡r
(), &
»s
, &
pÜt_numb”
);

571 ià(
»s
 !ğ
NULL
)

572 
	`pgm_ä“addršfo
 (
»s
);

573 ià(
rc
 !ğ0 || 
pÜt_numb”
 == 0)

578 
£ssiÚ_ba£_t
 *
£ssiÚ
 = sessiÚ_ba£_t::
	`ü—‹
 (
io_th»ad
, 
Œue
, 
this
,

579 
İtiÚs
, 
·ddr
);

580 
	`”ºo_as£¹
 (
£ssiÚ
);

584 
boŞ
 
subsüibe_to_®l
 = 
´ÙocŞ
 == "pgm" ||…rotocol == "epgm";

585 
pe_t
 *
Ãwpe
 = 
NULL
;

587 ià(
İtiÚs
.
immedŸ‹
 !ğ1 || 
subsüibe_to_®l
) {

589 
objeù_t
 *
·»Ás
 [2] = {
this
, 
£ssiÚ
};

590 
pe_t
 *
Ãw_pes
 [2] = {
NULL
, NULL};

592 
boŞ
 
cÚæ©e
 = 
İtiÚs
.conflate &&

593 (
İtiÚs
.
ty³
 =ğ
ZMQ_DEALER
 ||

594 
İtiÚs
.
ty³
 =ğ
ZMQ_PULL
 ||

595 
İtiÚs
.
ty³
 =ğ
ZMQ_PUSH
 ||

596 
İtiÚs
.
ty³
 =ğ
ZMQ_PUB
 ||

597 
İtiÚs
.
ty³
 =ğ
ZMQ_SUB
);

599 
hwms
 [2] = {
cÚæ©e
? -1 : 
İtiÚs
.
¢dhwm
,

600 
cÚæ©e
? -1 : 
İtiÚs
.
rcvhwm
};

601 
boŞ
 
cÚæ©es
 [2] = {
cÚæ©e
, conflate};

602 
rc
 = 
	`p•aœ
 (
·»Ás
, 
Ãw_pes
, 
hwms
, 
cÚæ©es
);

603 
	`”ºo_as£¹
 (
rc
 == 0);

606 
	`©ch_pe
 (
Ãw_pes
 [0], 
subsüibe_to_®l
);

607 
Ãwpe
 = 
Ãw_pes
 [0];

610 
£ssiÚ
->
	`©ch_pe
 (
Ãw_pes
 [1]);

614 
·ddr
->
	`to_¡ršg
 (
Ï¡_’dpošt
);

616 
	`add_’dpošt
 (
addr_
, (
own_t
 *è
£ssiÚ
, 
Ãwpe
);

618 
	}
}

620 
	gzmq
::
sock‘_ba£_t
::
	$add_’dpošt
 (cÚ¡ *
addr_
, 
own_t
 *
’dpošt_
, 
pe_t
 *
pe
)

623 
	`Ïunch_chd
 (
’dpošt_
);

624 
’dpošts
.
	`š£¹
 (
’dpošts_t
::
	`v®ue_ty³
 (
¡d
::
	`¡ršg
 (
addr_
), 
	`’dpošt_pe_t
(
’dpošt_
, 
pe
)));

625 
	}
}

627 
	gzmq
::
sock‘_ba£_t
::
	$‹rm_’dpošt
 (cÚ¡ *
addr_
)

630 ià(
	`uÆik–y
 (
ùx_‹rmš©ed
)) {

631 
”ºo
 = 
ETERM
;

636 ià(
	`uÆik–y
 (!
addr_
)) {

637 
”ºo
 = 
EINVAL
;

643 
rc
 = 
	`´oûss_commªds
 (0, 
çl£
);

644 ià(
	`uÆik–y
 (
rc
 != 0))

648 
¡d
::
¡ršg
 
´ÙocŞ
;

649 
¡d
::
¡ršg
 
add»ss
;

650 
rc
 = 
	`·r£_uri
 (
addr_
, 
´ÙocŞ
, 
add»ss
);

651 ià(
rc
 != 0)

654 
rc
 = 
	`check_´ÙocŞ
 (
´ÙocŞ
);

655 ià(
rc
 != 0)

659 ià(
´ÙocŞ
 == "inproc") {

660 
¡d
::
·œ
 <
š´ocs_t
::
™”©Ü
, iÅrocs_t::™”©Ü> 
¿nge
 = 
š´ocs
.
	`equ®_¿nge
 (¡d::
	`¡ršg
 (
addr_
));

661 ià(
¿nge
.
fœ¡
 =ğ¿nge.
£cÚd
) {

662 
”ºo
 = 
ENOENT
;

666 
š´ocs_t
::
™”©Ü
 
™
 = 
¿nge
.
fœ¡
; iˆ!ğ¿nge.
£cÚd
; ++it)

667 
™
->
£cÚd
->
	`‹rmš©e
(
Œue
);

668 
š´ocs
.
	`”a£
 (
¿nge
.
fœ¡
,„ªge.
£cÚd
);

673 
¡d
::
·œ
 <
’dpošts_t
::
™”©Ü
,ƒndpošts_t::™”©Ü> 
¿nge
 = 
’dpošts
.
	`equ®_¿nge
 (¡d::
	`¡ršg
 (
addr_
));

674 ià(
¿nge
.
fœ¡
 =ğ¿nge.
£cÚd
) {

675 
”ºo
 = 
ENOENT
;

679 
’dpošts_t
::
™”©Ü
 
™
 = 
¿nge
.
fœ¡
; iˆ!ğ¿nge.
£cÚd
; ++it) {

681 ià(
™
->
£cÚd
.£cÚd !ğ
NULL
)

682 
™
->
£cÚd
.£cÚd->
	`‹rmš©e
(
çl£
);

683 
	`‹rm_chd
 (
™
->
£cÚd
.
fœ¡
);

685 
’dpošts
.
	`”a£
 (
¿nge
.
fœ¡
,„ªge.
£cÚd
);

687 
	}
}

689 
	gzmq
::
sock‘_ba£_t
::
	$£nd
 (
msg_t
 *
msg_
, 
æags_
)

692 ià(
	`uÆik–y
 (
ùx_‹rmš©ed
)) {

693 
”ºo
 = 
ETERM
;

698 ià(
	`uÆik–y
 (!
msg_
 || !msg_->
	`check
 ())) {

699 
”ºo
 = 
EFAULT
;

704 
rc
 = 
	`´oûss_commªds
 (0, 
Œue
);

705 ià(
	`uÆik–y
 (
rc
 != 0))

709 
msg_
->
	`»£t_æags
 (
msg_t
::
mÜe
);

712 ià(
æags_
 & 
ZMQ_SNDMORE
)

713 
msg_
->
	`£t_æags
 (
msg_t
::
mÜe
);

716 
rc
 = 
	`x£nd
 (
msg_
);

717 ià(
rc
 == 0)

719 ià(
	`uÆik–y
 (
”ºo
 !ğ
EAGAIN
))

724 ià(
æags_
 & 
ZMQ_DONTWAIT
 || 
İtiÚs
.
¢dtimeo
 == 0)

729 
timeout
 = 
İtiÚs
.
¢dtimeo
;

730 
ušt64_t
 
’d
 = 
timeout
 < 0 ? 0 : (
şock
.
	`now_ms
 () +imeout);

735 
Œue
) {

736 ià(
	`uÆik–y
 (
	`´oûss_commªds
 (
timeout
, 
çl£
) != 0))

738 
rc
 = 
	`x£nd
 (
msg_
);

739 ià(
rc
 == 0)

741 ià(
	`uÆik–y
 (
”ºo
 !ğ
EAGAIN
))

743 ià(
timeout
 > 0) {

744 
timeout
 = (è(
’d
 - 
şock
.
	`now_ms
 ());

745 ià(
timeout
 <= 0) {

746 
”ºo
 = 
EAGAIN
;

752 
	}
}

754 
	gzmq
::
sock‘_ba£_t
::
	$»cv
 (
msg_t
 *
msg_
, 
æags_
)

757 ià(
	`uÆik–y
 (
ùx_‹rmš©ed
)) {

758 
”ºo
 = 
ETERM
;

763 ià(
	`uÆik–y
 (!
msg_
 || !msg_->
	`check
 ())) {

764 
”ºo
 = 
EFAULT
;

776 ià(++
ticks
 =ğ
šbound_pŞl_¿‹
) {

777 ià(
	`uÆik–y
 (
	`´oûss_commªds
 (0, 
çl£
) != 0))

779 
ticks
 = 0;

783 
rc
 = 
	`x»cv
 (
msg_
);

784 ià(
	`uÆik–y
 (
rc
 !ğ0 && 
”ºo
 !ğ
EAGAIN
))

788 ià(
rc
 == 0) {

789 
	`exŒaù_æags
 (
msg_
);

797 ià(
æags_
 & 
ZMQ_DONTWAIT
 || 
İtiÚs
.
rcvtimeo
 == 0) {

798 ià(
	`uÆik–y
 (
	`´oûss_commªds
 (0, 
çl£
) != 0))

800 
ticks
 = 0;

802 
rc
 = 
	`x»cv
 (
msg_
);

803 ià(
rc
 < 0)

804  
rc
;

805 
	`exŒaù_æags
 (
msg_
);

811 
timeout
 = 
İtiÚs
.
rcvtimeo
;

812 
ušt64_t
 
’d
 = 
timeout
 < 0 ? 0 : (
şock
.
	`now_ms
 () +imeout);

816 
boŞ
 
block
 = (
ticks
 != 0);

817 
Œue
) {

818 ià(
	`uÆik–y
 (
	`´oûss_commªds
 (
block
 ? 
timeout
 : 0, 
çl£
) != 0))

820 
rc
 = 
	`x»cv
 (
msg_
);

821 ià(
rc
 == 0) {

822 
ticks
 = 0;

825 ià(
	`uÆik–y
 (
”ºo
 !ğ
EAGAIN
))

827 
block
 = 
Œue
;

828 ià(
timeout
 > 0) {

829 
timeout
 = (è(
’d
 - 
şock
.
	`now_ms
 ());

830 ià(
timeout
 <= 0) {

831 
”ºo
 = 
EAGAIN
;

837 
	`exŒaù_æags
 (
msg_
);

839 
	}
}

841 
	gzmq
::
sock‘_ba£_t
::
	$şo£
 ()

844 
g
 = 0xdeadbeef;

849 
	`£nd_»­
 (
this
);

852 
	}
}

854 
boŞ
 
	gzmq
::
sock‘_ba£_t
::
	$has_š
 ()

856  
	`xhas_š
 ();

857 
	}
}

859 
boŞ
 
	gzmq
::
sock‘_ba£_t
::
	$has_out
 ()

861  
	`xhas_out
 ();

862 
	}
}

864 
	gzmq
::
sock‘_ba£_t
::
	$¡¬t_»­šg
 (
pŞËr_t
 *
pŞËr_
)

867 
pŞËr
 = 
pŞËr_
;

868 
hªdË
 = 
pŞËr
->
	`add_fd
 (
mabox
.
	`g‘_fd
 (), 
this
);

869 
pŞËr
->
	`£t_pŞlš
 (
hªdË
);

873 
	`‹rmš©e
 ();

874 
	`check_de¡roy
 ();

875 
	}
}

877 
	gzmq
::
sock‘_ba£_t
::
	$´oûss_commªds
 (
timeout_
, 
boŞ
 
thrÙe_
)

879 
rc
;

880 
commªd_t
 
cmd
;

881 ià(
timeout_
 != 0) {

884 
rc
 = 
mabox
.
	`»cv
 (&
cmd
, 
timeout_
);

892 
ušt64_t
 
tsc
 = 
zmq
::
şock_t
::
	`rdtsc
 ();

900 ià(
tsc
 && 
thrÙe_
) {

905 ià(
tsc
 >ğ
Ï¡_tsc
 &&sø-†a¡_tsø<ğ
max_commªd_d–ay
)

907 
Ï¡_tsc
 = 
tsc
;

911 
rc
 = 
mabox
.
	`»cv
 (&
cmd
, 0);

915 
rc
 == 0) {

916 
cmd
.
de¡š©iÚ
->
	`´oûss_commªd
 (cmd);

917 
rc
 = 
mabox
.
	`»cv
 (&
cmd
, 0);

920 ià(
”ºo
 =ğ
EINTR
)

923 
	`zmq_as£¹
 (
”ºo
 =ğ
EAGAIN
);

925 ià(
ùx_‹rmš©ed
) {

926 
”ºo
 = 
ETERM
;

931 
	}
}

933 
	gzmq
::
sock‘_ba£_t
::
	$´oûss_¡İ
 ()

939 
	`¡İ_mÚ™Ü
 ();

940 
ùx_‹rmš©ed
 = 
Œue
;

941 
	}
}

943 
	gzmq
::
sock‘_ba£_t
::
	$´oûss_bšd
 (
pe_t
 *
pe_
)

945 
	`©ch_pe
 (
pe_
);

946 
	}
}

948 
	gzmq
::
sock‘_ba£_t
::
	$´oûss_‹rm
 (
lšg”_
)

953 
	`uÄegi¡”_’dpošts
 (
this
);

956 
pes_t
::
size_ty³
 
i
 = 0; i !ğ
pes
.
	`size
 (); ++i)

957 
pes
 [
i
]->
	`‹rmš©e
 (
çl£
);

958 
	`»gi¡”_‹rm_acks
 ((è
pes
.
	`size
 ());

961 
own_t
::
	`´oûss_‹rm
 (
lšg”_
);

962 
	}
}

964 
	gzmq
::
sock‘_ba£_t
::
	$´oûss_de¡roy
 ()

966 
de¡royed
 = 
Œue
;

967 
	}
}

969 
	gzmq
::
sock‘_ba£_t
::
	$x£tsockİt
 (, cÚ¡ *, 
size_t
)

971 
”ºo
 = 
EINVAL
;

973 
	}
}

975 
boŞ
 
	gzmq
::
sock‘_ba£_t
::
	$xhas_out
 ()

977  
çl£
;

978 
	}
}

980 
	gzmq
::
sock‘_ba£_t
::
	$x£nd
 (
msg_t
 *)

982 
”ºo
 = 
ENOTSUP
;

984 
	}
}

986 
boŞ
 
	gzmq
::
sock‘_ba£_t
::
	$xhas_š
 ()

988  
çl£
;

989 
	}
}

991 
	gzmq
::
sock‘_ba£_t
::
	$x»cv
 (
msg_t
 *)

993 
”ºo
 = 
ENOTSUP
;

995 
	}
}

997 
	gzmq
::
sock‘_ba£_t
::
	$x»ad_aùiv©ed
 (
pe_t
 *)

999 
	`zmq_as£¹
 (
çl£
);

1000 
	}
}

1001 
	gzmq
::
sock‘_ba£_t
::
	$xwr™e_aùiv©ed
 (
pe_t
 *)

1003 
	`zmq_as£¹
 (
çl£
);

1004 
	}
}

1006 
	gzmq
::
sock‘_ba£_t
::
	$xhiccu³d
 (
pe_t
 *)

1008 
	`zmq_as£¹
 (
çl£
);

1009 
	}
}

1011 
	gzmq
::
sock‘_ba£_t
::
	$š_ev’t
 ()

1017 
	`´oûss_commªds
 (0, 
çl£
);

1018 
	`check_de¡roy
 ();

1019 
	}
}

1021 
	gzmq
::
sock‘_ba£_t
::
	$out_ev’t
 ()

1023 
	`zmq_as£¹
 (
çl£
);

1024 
	}
}

1026 
	gzmq
::
sock‘_ba£_t
::
	$tim”_ev’t
 ()

1028 
	`zmq_as£¹
 (
çl£
);

1029 
	}
}

1031 
	gzmq
::
sock‘_ba£_t
::
	$check_de¡roy
 ()

1034 ià(
de¡royed
) {

1037 
pŞËr
->
	`rm_fd
 (
hªdË
);

1040 
	`de¡roy_sock‘
 (
this
);

1043 
	`£nd_»­ed
 ();

1046 
own_t
::
	`´oûss_de¡roy
 ();

1048 
	}
}

1050 
	gzmq
::
sock‘_ba£_t
::
	$»ad_aùiv©ed
 (
pe_t
 *
pe_
)

1052 
	`x»ad_aùiv©ed
 (
pe_
);

1053 
	}
}

1055 
	gzmq
::
sock‘_ba£_t
::
	$wr™e_aùiv©ed
 (
pe_t
 *
pe_
)

1057 
	`xwr™e_aùiv©ed
 (
pe_
);

1058 
	}
}

1060 
	gzmq
::
sock‘_ba£_t
::
	$hiccu³d
 (
pe_t
 *
pe_
)

1062 ià(
İtiÚs
.
immedŸ‹
 == 1)

1063 
pe_
->
	`‹rmš©e
 (
çl£
);

1066 
	`xhiccu³d
 (
pe_
);

1067 
	}
}

1069 
	gzmq
::
sock‘_ba£_t
::
	$pe_‹rmš©ed
 (
pe_t
 *
pe_
)

1072 
	`xpe_‹rmš©ed
 (
pe_
);

1075 
š´ocs_t
::
™”©Ü
 
™
 = 
š´ocs
.
	`begš
(); iˆ!ğš´ocs.
	`’d
(); ++it) {

1076 ià(
™
->
£cÚd
 =ğ
pe_
) {

1077 
š´ocs
.
	`”a£
(
™
);

1084 
pes
.
	`”a£
 (
pe_
);

1085 ià(
	`is_‹rmš©šg
 ())

1086 
	`uÄegi¡”_‹rm_ack
 ();

1087 
	}
}

1089 
	gzmq
::
sock‘_ba£_t
::
	$exŒaù_æags
 (
msg_t
 *
msg_
)

1092 ià(
	`uÆik–y
 (
msg_
->
	`æags
 (è& 
msg_t
::
id’t™y
))

1093 
	`zmq_as£¹
 (
İtiÚs
.
»cv_id’t™y
);

1096 
rcvmÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
 ? 
Œue
 : 
çl£
;

1097 
	}
}

1099 
	gzmq
::
sock‘_ba£_t
::
	$mÚ™Ü
 (cÚ¡ *
addr_
, 
ev’ts_
)

1101 
rc
;

1102 ià(
	`uÆik–y
 (
ùx_‹rmš©ed
)) {

1103 
”ºo
 = 
ETERM
;

1108 ià(
addr_
 =ğ
NULL
) {

1109 
	`¡İ_mÚ™Ü
 ();

1114 
¡d
::
¡ršg
 
´ÙocŞ
;

1115 
¡d
::
¡ršg
 
add»ss
;

1116 
rc
 = 
	`·r£_uri
 (
addr_
, 
´ÙocŞ
, 
add»ss
);

1117 ià(
rc
 != 0)

1120 
rc
 = 
	`check_´ÙocŞ
 (
´ÙocŞ
);

1121 ià(
rc
 != 0)

1125 ià(
´ÙocŞ
 != "inproc") {

1126 
”ºo
 = 
EPROTONOSUPPORT
;

1131 
mÚ™Ü_ev’ts
 = 
ev’ts_
;

1132 
mÚ™Ü_sock‘
 = 
	`zmq_sock‘
 (
	`g‘_ùx
 (), 
ZMQ_PAIR
);

1133 ià(
mÚ™Ü_sock‘
 =ğ
NULL
)

1137 
lšg”
 = 0;

1138 
rc
 = 
	`zmq_£tsockİt
 (
mÚ™Ü_sock‘
, 
ZMQ_LINGER
, &
lšg”
,  (linger));

1139 ià(
rc
 == -1)

1140 
	`¡İ_mÚ™Ü
 ();

1143 
rc
 = 
	`zmq_bšd
 (
mÚ™Ü_sock‘
, 
addr_
);

1144 ià(
rc
 == -1)

1145 
	`¡İ_mÚ™Ü
 ();

1146  
rc
;

1147 
	}
}

1149 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_cÚÃùed
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
)

1151 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_CONNECTED
) {

1152 
zmq_ev’t_t
 
ev’t
;

1153 
ev’t
.ev’ˆğ
ZMQ_EVENT_CONNECTED
;

1154 
ev’t
.
v®ue
 = 
fd_
;

1155 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1157 
	}
}

1159 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_cÚÃù_d–ayed
 (
¡d
::
¡ršg
 &
addr_
, 
”r_
)

1161 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_CONNECT_DELAYED
) {

1162 
zmq_ev’t_t
 
ev’t
;

1163 
ev’t
.ev’ˆğ
ZMQ_EVENT_CONNECT_DELAYED
;

1164 
ev’t
.
v®ue
 = 
”r_
;

1165 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1167 
	}
}

1169 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_cÚÃù_»Œ›d
 (
¡d
::
¡ršg
 &
addr_
, 
š‹rv®_
)

1171 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_CONNECT_RETRIED
) {

1172 
zmq_ev’t_t
 
ev’t
;

1173 
ev’t
.ev’ˆğ
ZMQ_EVENT_CONNECT_RETRIED
;

1174 
ev’t
.
v®ue
 = 
š‹rv®_
;

1175 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1177 
	}
}

1179 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_li¡’šg
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
)

1181 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_LISTENING
) {

1182 
zmq_ev’t_t
 
ev’t
;

1183 
ev’t
.ev’ˆğ
ZMQ_EVENT_LISTENING
;

1184 
ev’t
.
v®ue
 = 
fd_
;

1185 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1187 
	}
}

1189 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_bšd_çed
 (
¡d
::
¡ršg
 &
addr_
, 
”r_
)

1191 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_BIND_FAILED
) {

1192 
zmq_ev’t_t
 
ev’t
;

1193 
ev’t
.ev’ˆğ
ZMQ_EVENT_BIND_FAILED
;

1194 
ev’t
.
v®ue
 = 
”r_
;

1195 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1197 
	}
}

1199 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_acû±ed
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
)

1201 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_ACCEPTED
) {

1202 
zmq_ev’t_t
 
ev’t
;

1203 
ev’t
.ev’ˆğ
ZMQ_EVENT_ACCEPTED
;

1204 
ev’t
.
v®ue
 = 
fd_
;

1205 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1207 
	}
}

1209 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_acû±_çed
 (
¡d
::
¡ršg
 &
addr_
, 
”r_
)

1211 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_ACCEPT_FAILED
) {

1212 
zmq_ev’t_t
 
ev’t
;

1213 
ev’t
.ev’ˆğ
ZMQ_EVENT_ACCEPT_FAILED
;

1214 
ev’t
.
v®ue
ğ
”r_
;

1215 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1217 
	}
}

1219 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_şo£d
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
)

1221 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_CLOSED
) {

1222 
zmq_ev’t_t
 
ev’t
;

1223 
ev’t
.ev’ˆğ
ZMQ_EVENT_CLOSED
;

1224 
ev’t
.
v®ue
 = 
fd_
;

1225 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1227 
	}
}

1229 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_şo£_çed
 (
¡d
::
¡ršg
 &
addr_
, 
”r_
)

1231 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_CLOSE_FAILED
) {

1232 
zmq_ev’t_t
 
ev’t
;

1233 
ev’t
.ev’ˆğ
ZMQ_EVENT_CLOSE_FAILED
;

1234 
ev’t
.
v®ue
 = 
”r_
;

1235 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1237 
	}
}

1239 
	gzmq
::
sock‘_ba£_t
::
	$ev’t_discÚÃùed
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
)

1241 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_DISCONNECTED
) {

1242 
zmq_ev’t_t
 
ev’t
;

1243 
ev’t
.ev’ˆğ
ZMQ_EVENT_DISCONNECTED
;

1244 
ev’t
.
v®ue
 = 
fd_
;

1245 
	`mÚ™Ü_ev’t
 (
ev’t
, 
addr_
);

1247 
	}
}

1249 
	gzmq
::
sock‘_ba£_t
::
	$mÚ™Ü_ev’t
 (
zmq_ev’t_t
 
ev’t_
, cÚ¡ 
¡d
::
¡ršg
& 
addr_
)

1251 ià(
mÚ™Ü_sock‘
) {

1252 cÚ¡ 
ušt16_t
 
eid
 = (ušt16_t)
ev’t_
.
ev’t
;

1253 cÚ¡ 
ušt32_t
 
v®ue
 = (ušt32_t)
ev’t_
.value;

1256 
zmq_msg_t
 
msg
;

1257 
	`zmq_msg_š™_size
 (&
msg
, (
eid
è+ (
v®ue
));

1258 * 
d©a1
 = (*)
	`zmq_msg_d©a
(&
msg
);

1259 
	`memıy
 (
d©a1
, &
eid
, (eid));

1260 
	`memıy
 (
d©a1
+(
eid
), &
v®ue
, (value));

1261 
	`zmq_£ndmsg
 (
mÚ™Ü_sock‘
, &
msg
, 
ZMQ_SNDMORE
);

1264 
	`zmq_msg_š™_size
 (&
msg
, 
addr_
.
	`size
());

1265 
	`memıy
(
	`zmq_msg_d©a
(&
msg
), 
addr_
.
	`c_¡r
(),‡ddr_.
	`size
());

1266 
	`zmq_£ndmsg
 (
mÚ™Ü_sock‘
, &
msg
, 0);

1268 
	}
}

1270 
	gzmq
::
sock‘_ba£_t
::
	$¡İ_mÚ™Ü
()

1272 ià(
mÚ™Ü_sock‘
) {

1273 ià(
mÚ™Ü_ev’ts
 & 
ZMQ_EVENT_MONITOR_STOPPED
) {

1274 
zmq_ev’t_t
 
ev’t
;

1275 
ev’t
.ev’ˆğ
ZMQ_EVENT_MONITOR_STOPPED
;

1276 
ev’t
.
v®ue
 = 0;

1277 
	`mÚ™Ü_ev’t
 (
ev’t
, "");

1279 
	`zmq_şo£
 (
mÚ™Ü_sock‘
);

1280 
mÚ™Ü_sock‘
 = 
NULL
;

1281 
mÚ™Ü_ev’ts
 = 0;

1283 
	}
}

	@socket_base.hpp

20 #iâdeà
__ZMQ_SOCKET_BASE_HPP_INCLUDED__


21 
	#__ZMQ_SOCKET_BASE_HPP_INCLUDED__


	)

23 
	~<¡ršg
>

24 
	~<m­
>

25 
	~<¡d¬g.h
>

27 
	~"own.hµ
"

28 
	~"¬¿y.hµ
"

29 
	~"¡dšt.hµ
"

30 
	~"pŞËr.hµ
"

31 
	~"©omic_couÁ”.hµ
"

32 
	~"i_pŞl_ev’ts.hµ
"

33 
	~"mabox.hµ
"

34 
	~"¡dšt.hµ
"

35 
	~"şock.hµ
"

36 
	~"pe.hµ
"

40 
zmq_ä“_ev’t
 (*
d©a
, *
hšt
);

43 
Çme¥aû
 
zmq


46 
şass
 
ùx_t
;

47 
şass
 
msg_t
;

48 
şass
 
pe_t
;

50 
şass
 
sock‘_ba£_t
 :

51 
public
 
own_t
,

52 
public
 
¬¿y_™em_t
 <>,

53 
public
 
i_pŞl_ev’ts
,

54 
public
 
i_pe_ev’ts


56 
ä›nd
 
şass
 
»­”_t
;

58 
public
:

61 
boŞ
 
check_g
 ();

64 
sock‘_ba£_t
 *
ü—‹
 (
ty³_
, 
zmq
::
ùx_t
 *
·»Á_
,

65 
ušt32_t
 
tid_
, 
sid_
);

68 
mabox_t
 *
g‘_mabox
 ();

72 
¡İ
 ();

75 
£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
, 
size_t
 
İtv®Ën_
);

76 
g‘sockİt
 (
İtiÚ_
, *
İtv®_
, 
size_t
 *
İtv®Ën_
);

77 
bšd
 (cÚ¡ *
addr_
);

78 
cÚÃù
 (cÚ¡ *
addr_
);

79 
‹rm_’dpošt
 (cÚ¡ *
addr_
);

80 
£nd
 (
zmq
::
msg_t
 *
msg_
, 
æags_
);

81 
»cv
 (
zmq
::
msg_t
 *
msg_
, 
æags_
);

82 
şo£
 ();

86 
boŞ
 
has_š
 ();

87 
boŞ
 
has_out
 ();

91 
¡¬t_»­šg
 (
pŞËr_t
 *
pŞËr_
);

95 
š_ev’t
 ();

96 
out_ev’t
 ();

97 
tim”_ev’t
 (
id_
);

100 
»ad_aùiv©ed
 (
pe_t
 *
pe_
);

101 
wr™e_aùiv©ed
 (
pe_t
 *
pe_
);

102 
hiccu³d
 (
pe_t
 *
pe_
);

103 
pe_‹rmš©ed
 (
pe_t
 *
pe_
);

104 
lock
();

105 
uÆock
();

107 
mÚ™Ü
 (cÚ¡ *
’dpošt_
, 
ev’ts_
);

109 
ev’t_cÚÃùed
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
);

110 
ev’t_cÚÃù_d–ayed
 (
¡d
::
¡ršg
 &
addr_
, 
”r_
);

111 
ev’t_cÚÃù_»Œ›d
 (
¡d
::
¡ršg
 &
addr_
, 
š‹rv®_
);

112 
ev’t_li¡’šg
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
);

113 
ev’t_bšd_çed
 (
¡d
::
¡ršg
 &
addr_
, 
”r_
);

114 
ev’t_acû±ed
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
);

115 
ev’t_acû±_çed
 (
¡d
::
¡ršg
 &
addr_
, 
”r_
);

116 
ev’t_şo£d
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
);

117 
ev’t_şo£_çed
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
);

118 
ev’t_discÚÃùed
 (
¡d
::
¡ršg
 &
addr_
, 
fd_
);

120 
´Ùeùed
:

122 
sock‘_ba£_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
);

123 
vœtu®
 ~
sock‘_ba£_t
 ();

127 
vœtu®
 
x©ch_pe
 (
zmq
::
pe_t
 *
pe_
,

128 
boŞ
 
subsüibe_to_®l_
 = 
çl£
) = 0;

133 
vœtu®
 
x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
,

134 
size_t
 
İtv®Ën_
);

137 
vœtu®
 
boŞ
 
xhas_out
 ();

138 
vœtu®
 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

141 
vœtu®
 
boŞ
 
xhas_š
 ();

142 
vœtu®
 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

145 
vœtu®
 
x»ad_aùiv©ed
 (
pe_t
 *
pe_
);

146 
vœtu®
 
xwr™e_aùiv©ed
 (
pe_t
 *
pe_
);

147 
vœtu®
 
xhiccu³d
 (
pe_t
 *
pe_
);

148 
vœtu®
 
xpe_‹rmš©ed
 (
pe_t
 *
pe_
) = 0;

151 
´oûss_de¡roy
 ();

154 
mÚ™Ü_ev’t
 (
zmq_ev’t_t
 
d©a_
, cÚ¡ 
¡d
::
¡ršg
& 
addr_
);

157 
¡İ_mÚ™Ü
 ();

159 
´iv©e
:

161 
add_’dpošt
 (cÚ¡ *
addr_
, 
own_t
 *
’dpošt_
, 
pe_t
 *
pe
);

164 
¡d
::
	t·œ
 <
	town_t
 *, 
	tpe_t
*> 
	t’dpošt_pe_t
;

165 
¡d
::
	tmuÉim­
 <
	t¡d
::
	t¡ršg
, 
	t’dpošt_pe_t
> 
	t’dpošts_t
;

166 
’dpošts_t
 
’dpošts
;

169 
¡d
::
	tmuÉim­
 <
	t¡d
::
	t¡ršg
, 
	tpe_t
 *> 
	tš´ocs_t
;

170 
š´ocs_t
 
š´ocs
;

174 
check_de¡roy
 ();

178 
exŒaù_æags
 (
msg_t
 *
msg_
);

181 
ušt32_t
 
g
;

184 
boŞ
 
ùx_‹rmš©ed
;

189 
boŞ
 
de¡royed
;

192 
·r£_uri
 (cÚ¡ *
uri_
, 
¡d
::
¡ršg
 &
´ÙocŞ_
,

193 
¡d
::
¡ršg
 &
add»ss_
);

197 
check_´ÙocŞ
 (cÚ¡ 
¡d
::
¡ršg
 &
´ÙocŞ_
);

200 
©ch_pe
 (
zmq
::
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
 = 
çl£
);

206 
´oûss_commªds
 (
timeout_
, 
boŞ
 
thrÙe_
);

209 
´oûss_¡İ
 ();

210 
´oûss_bšd
 (
zmq
::
pe_t
 *
pe_
);

211 
´oûss_‹rm
 (
lšg”_
);

214 
mabox_t
 
mabox
;

217 
¬¿y_t
 <
	tpe_t
, 3> 
	tpes_t
;

218 
pes_t
 
pes
;

221 
pŞËr_t
 *
pŞËr
;

222 
pŞËr_t
::
hªdË_t
 
hªdË
;

225 
ušt64_t
 
Ï¡_tsc
;

228 
ticks
;

231 
boŞ
 
rcvmÜe
;

234 
şock_t
 
şock
;

237 *
mÚ™Ü_sock‘
;

240 
mÚ™Ü_ev’ts
;

243 
¡d
::
¡ršg
 
Ï¡_’dpošt
;

245 
sock‘_ba£_t
 (const socket_base_t&);

246 cÚ¡ 
sock‘_ba£_t
 &
İ”©Ü
 = (const socket_base_t&);

247 
mu‹x_t
 
sync
;

	@stdint.hpp

20 #iâdeà
__ZMQ_STDINT_HPP_INCLUDED__


21 
	#__ZMQ_STDINT_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ià
defšed
 
ZMQ_HAVE_SOLARIS
 || defšed 
ZMQ_HAVE_OPENVMS


27 
	~<š‰y³s.h
>

29 #–ià
defšed
 
_MSC_VER
 && _MSC_VER < 1600

31 #iâdeà
št8_t


32 
__št8
 
	tšt8_t
;

34 #iâdeà
št16_t


35 
__št16
 
	tšt16_t
;

37 #iâdeà
št32_t


38 
__št32
 
	tšt32_t
;

40 #iâdeà
št64_t


41 
__št64
 
	tšt64_t
;

43 #iâdeà
ušt8_t


44 
	t__št8
 
	tušt8_t
;

46 #iâdeà
ušt16_t


47 
	t__št16
 
	tušt16_t
;

49 #iâdeà
ušt32_t


50 
	t__št32
 
	tušt32_t
;

52 #iâdeà
ušt64_t


53 
	t__št64
 
	tušt64_t
;

58 
	~<¡dšt.h
>

	@stream.cpp

20 
	~"¡»am.hµ
"

21 
	~"pe.hµ
"

22 
	~"wœe.hµ
"

23 
	~"¿ndom.hµ
"

24 
	~"lik–y.hµ
"

25 
	~"”r.hµ
"

27 
	gzmq
::
¡»am_t
::
	$¡»am_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

28 
	`sock‘_ba£_t
 (
·»Á_
, 
tid_
, 
sid_
),

29 
	`´eãtched
 (
çl£
),

30 
	`id’t™y_£Á
 (
çl£
),

31 
	`cu¼’t_out
 (
NULL
),

32 
	`mÜe_out
 (
çl£
),

33 
	`Ãxt_³”_id
 (
	$g’”©e_¿ndom
 ())

35 
İtiÚs
.
ty³
 = 
ZMQ_STREAM
;

36 
İtiÚs
.
¿w_sock
 = 
Œue
;

38 
´eãtched_id
.
	`š™
 ();

39 
´eãtched_msg
.
	`š™
 ();

40 
	}
}

42 
	gzmq
::
¡»am_t
::~
	$¡»am_t
 ()

44 
	`zmq_as£¹
 (
oues
.
	`em±y
 ());

45 
´eãtched_id
.
	`şo£
 ();

46 
´eãtched_msg
.
	`şo£
 ();

47 
	}
}

49 
	gzmq
::
¡»am_t
::
	$x©ch_pe
 (
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
)

52 ()
subsüibe_to_®l_
;

54 
	`zmq_as£¹
 (
pe_
);

56 
	`id’tify_³”
 (
pe_
);

57 
fq
.
	`©ch
 (
pe_
);

58 
	}
}

60 
	gzmq
::
¡»am_t
::
	$xpe_‹rmš©ed
 (
pe_t
 *
pe_
)

62 
oues_t
::
™”©Ü
 
™
 = 
oues
.
	`fšd
 (
pe_
->
	`g‘_id’t™y
 ());

63 
	`zmq_as£¹
 (
™
 !ğ
oues
.
	`’d
 ());

64 
oues
.
	`”a£
 (
™
);

65 
fq
.
	`pe_‹rmš©ed
 (
pe_
);

66 ià(
pe_
 =ğ
cu¼’t_out
)

67 
cu¼’t_out
 = 
NULL
;

68 
	}
}

70 
	gzmq
::
¡»am_t
::
	$x»ad_aùiv©ed
 (
pe_t
 *
pe_
)

72 
fq
.
	`aùiv©ed
 (
pe_
);

73 
	}
}

75 
	gzmq
::
¡»am_t
::
	$xwr™e_aùiv©ed
 (
pe_t
 *
pe_
)

77 
oues_t
::
™”©Ü
 
™
;

78 
™
 = 
oues
.
	`begš
 (); iˆ!ğoues.
	`’d
 (); ++it)

79 ià(
™
->
£cÚd
.
pe
 =ğ
pe_
)

82 
	`zmq_as£¹
 (
™
 !ğ
oues
.
	`’d
 ());

83 
	`zmq_as£¹
 (!
™
->
£cÚd
.
aùive
);

84 
™
->
£cÚd
.
aùive
 = 
Œue
;

85 
	}
}

87 
	gzmq
::
¡»am_t
::
	$x£nd
 (
msg_t
 *
msg_
)

91 ià(!
mÜe_out
) {

92 
	`zmq_as£¹
 (!
cu¼’t_out
);

97 ià(
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
) {

101 
blob_t
 
	`id’t™y
 ((*è
msg_
->
	`d©a
 (), msg_->
	`size
 ());

102 
oues_t
::
™”©Ü
 
™
 = 
oues
.
	`fšd
 (
id’t™y
);

104 ià(
™
 !ğ
oues
.
	`’d
 ()) {

105 
cu¼’t_out
 = 
™
->
£cÚd
.
pe
;

106 ià(!
cu¼’t_out
->
	`check_wr™e
 ()) {

107 
™
->
£cÚd
.
aùive
 = 
çl£
;

108 
cu¼’t_out
 = 
NULL
;

109 
”ºo
 = 
EAGAIN
;

114 
”ºo
 = 
EHOSTUNREACH
;

120 
mÜe_out
 = 
Œue
;

122 
rc
 = 
msg_
->
	`şo£
 ();

123 
	`”ºo_as£¹
 (
rc
 == 0);

124 
rc
 = 
msg_
->
	`š™
 ();

125 
	`”ºo_as£¹
 (
rc
 == 0);

130 
msg_
->
	`»£t_æags
 (
msg_t
::
mÜe
);

133 
mÜe_out
 = 
çl£
;

136 ià(
cu¼’t_out
) {

141 ià(
msg_
->
	`size
 () == 0) {

142 
cu¼’t_out
->
	`‹rmš©e
 (
çl£
);

143 
rc
 = 
msg_
->
	`şo£
 ();

144 
	`”ºo_as£¹
 (
rc
 == 0);

145 
cu¼’t_out
 = 
NULL
;

148 
boŞ
 
ok
 = 
cu¼’t_out
->
	`wr™e
 (
msg_
);

149 ià(
	`lik–y
 (
ok
))

150 
cu¼’t_out
->
	`æush
 ();

151 
cu¼’t_out
 = 
NULL
;

154 
rc
 = 
msg_
->
	`şo£
 ();

155 
	`”ºo_as£¹
 (
rc
 == 0);

159 
rc
 = 
msg_
->
	`š™
 ();

160 
	`”ºo_as£¹
 (
rc
 == 0);

163 
	}
}

165 
	gzmq
::
¡»am_t
::
	$x»cv
 (
msg_t
 *
msg_
)

167 ià(
´eãtched
) {

168 ià(!
id’t™y_£Á
) {

169 
rc
 = 
msg_
->
	`move
 (
´eãtched_id
);

170 
	`”ºo_as£¹
 (
rc
 == 0);

171 
id’t™y_£Á
 = 
Œue
;

174 
rc
 = 
msg_
->
	`move
 (
´eãtched_msg
);

175 
	`”ºo_as£¹
 (
rc
 == 0);

176 
´eãtched
 = 
çl£
;

181 
pe_t
 *
pe
 = 
NULL
;

182 
rc
 = 
fq
.
	`»cvpe
 (&
´eãtched_msg
, &
pe
);

183 ià(
rc
 != 0)

186 
	`zmq_as£¹
 (
pe
 !ğ
NULL
);

187 
	`zmq_as£¹
 ((
´eãtched_msg
.
	`æags
 (è& 
msg_t
::
mÜe
) == 0);

192 
blob_t
 
id’t™y
 = 
pe
->
	`g‘_id’t™y
 ();

193 
rc
 = 
msg_
->
	`š™_size
 (
id’t™y
.
	`size
 ());

194 
	`”ºo_as£¹
 (
rc
 == 0);

195 
	`memıy
 (
msg_
->
	`d©a
 (), 
id’t™y
.d©¨(), id’t™y.
	`size
 ());

196 
msg_
->
	`£t_æags
 (
msg_t
::
mÜe
);

198 
´eãtched
 = 
Œue
;

199 
id’t™y_£Á
 = 
Œue
;

202 
	}
}

204 
boŞ
 
	gzmq
::
¡»am_t
::
	$xhas_š
 ()

207 ià(
´eãtched
)

208  
Œue
;

212 
pe_t
 *
pe
 = 
NULL
;

213 
rc
 = 
fq
.
	`»cvpe
 (&
´eãtched_msg
, &
pe
);

214 ià(
rc
 != 0)

215  
çl£
;

217 
	`zmq_as£¹
 (
pe
 !ğ
NULL
);

218 
	`zmq_as£¹
 ((
´eãtched_msg
.
	`æags
 (è& 
msg_t
::
mÜe
) == 0);

220 
blob_t
 
id’t™y
 = 
pe
->
	`g‘_id’t™y
 ();

221 
rc
 = 
´eãtched_id
.
	`š™_size
 (
id’t™y
.
	`size
 ());

222 
	`”ºo_as£¹
 (
rc
 == 0);

223 
	`memıy
 (
´eãtched_id
.
	`d©a
 (), 
id’t™y
.d©¨(), id’t™y.
	`size
 ());

224 
´eãtched_id
.
	`£t_æags
 (
msg_t
::
mÜe
);

226 
´eãtched
 = 
Œue
;

227 
id’t™y_£Á
 = 
çl£
;

229  
Œue
;

230 
	}
}

232 
boŞ
 
	gzmq
::
¡»am_t
::
	$xhas_out
 ()

237  
Œue
;

238 
	}
}

240 
	gzmq
::
¡»am_t
::
	$id’tify_³”
 (
pe_t
 *
pe_
)

243 
bufãr
 [5];

244 
bufãr
 [0] = 0;

245 
	`put_ušt32
 (
bufãr
 + 1, 
Ãxt_³”_id
++);

246 
blob_t
 
id’t™y
 = 
	`blob_t
 (
bufãr
,  buffer);

248 
	`memıy
 (
İtiÚs
.
id’t™y
, id’t™y.
	`d©a
 (), id’t™y.
	`size
 ());

249 
İtiÚs
.
id’t™y_size
 = 
id’t™y
.
	`size
 ();

251 
pe_
->
	`£t_id’t™y
 (
id’t™y
);

253 
oue_t
 
oue
 = {
pe_
, 
Œue
};

254 cÚ¡ 
boŞ
 
ok
 = 
oues
.
	`š£¹
 (

255 
oues_t
::
	`v®ue_ty³
 (
id’t™y
, 
oue
)).
£cÚd
;

256 
	`zmq_as£¹
 (
ok
);

257 
	}
}

	@stream.hpp

20 #iâdeà
__ZMQ_STREAM_HPP_INCLUDED__


21 
	#__ZMQ_STREAM_HPP_INCLUDED__


	)

23 
	~<m­
>

25 
	~"rou‹r.hµ
"

27 
Çme¥aû
 
	gzmq


30 
şass
 
	gùx_t
;

31 
şass
 
	gpe_t
;

33 şas 
	c¡»am_t
 :

34 
public
 
sock‘_ba£_t


36 
public
:

38 
¡»am_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid
);

39 ~
¡»am_t
 ();

42 
x©ch_pe
 (
zmq
::
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
);

43 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

44 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

45 
boŞ
 
xhas_š
 ();

46 
boŞ
 
xhas_out
 ();

47 
x»ad_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

48 
xwr™e_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

49 
xpe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

51 
	g´iv©e
:

53 
id’tify_³”
 (
pe_t
 *
pe_
);

56 
fq_t
 
	gfq
;

59 
boŞ
 
	g´eãtched
;

63 
boŞ
 
	gid’t™y_£Á
;

66 
msg_t
 
	g´eãtched_id
;

69 
msg_t
 
	g´eãtched_msg
;

71 
	soue_t


73 
	gzmq
::
pe_t
 *
pe
;

74 
boŞ
 
	gaùive
;

78 
	g¡d
::
	tm­
 <
	tblob_t
, 
	toue_t
> 
	toues_t
;

79 
oues_t
 
	goues
;

82 
	gzmq
::
pe_t
 *
cu¼’t_out
;

85 
boŞ
 
	gmÜe_out
;

89 
ušt32_t
 
	gÃxt_³”_id
;

91 
¡»am_t
 (const stream_t&);

92 cÚ¡ 
	g¡»am_t
 &
	gİ”©Ü
 = (cÚ¡ 
¡»am_t
&);

	@stream_engine.cpp

20 
	~"¶©fÜm.hµ
"

21 #ià
defšed
 
ZMQ_HAVE_WINDOWS


22 
	~"wšdows.hµ
"

24 
	~<uni¡d.h
>

25 
	~<sys/sock‘.h
>

26 
	~<¬·/š‘.h
>

27 
	~<Ãtš‘/tı.h
>

28 
	~<Ãtš‘/š.h
>

29 
	~<Ãtdb.h
>

30 
	~<fú.h
>

33 
	~<¡ršg.h
>

34 
	~<Ãw
>

36 
	~"¡»am_’gše.hµ
"

37 
	~"io_th»ad.hµ
"

38 
	~"£ssiÚ_ba£.hµ
"

39 
	~"v1_’cod”.hµ
"

40 
	~"v1_decod”.hµ
"

41 
	~"v2_’cod”.hµ
"

42 
	~"v2_decod”.hµ
"

43 
	~"nuÎ_mechªism.hµ
"

44 
	~"¶aš_mechªism.hµ
"

45 
	~"curve_ş›Á.hµ
"

46 
	~"curve_£rv”.hµ
"

47 
	~"¿w_decod”.hµ
"

48 
	~"¿w_’cod”.hµ
"

49 
	~"cÚfig.hµ
"

50 
	~"”r.hµ
"

51 
	~".hµ
"

52 
	~"lik–y.hµ
"

53 
	~"wœe.hµ
"

55 
	gzmq
::
¡»am_’gše_t
::
	$¡»am_’gše_t
 (
fd_t
 
fd_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

56 cÚ¡ 
¡d
::
¡ršg
 &
’dpošt_
) :

57 
	`s
 (
fd_
),

58 
	`špos
 (
NULL
),

59 
	`šsize
 (0),

60 
	`decod”
 (
NULL
),

61 
	`ouos
 (
NULL
),

62 
	`outsize
 (0),

63 
	`’cod”
 (
NULL
),

64 
	`hªdshakšg
 (
Œue
),

65 
	`g»‘šg_size
 (
v2_g»‘šg_size
),

66 
	`g»‘šg_by‹s_»ad
 (0),

67 
	`£ssiÚ
 (
NULL
),

68 
	`İtiÚs
 (
İtiÚs_
),

69 
	`’dpošt
 (
’dpošt_
),

70 
	`¶ugged
 (
çl£
),

71 
	`»ad_msg
 (&
¡»am_’gše_t
::
»ad_id’t™y
),

72 
	`wr™e_msg
 (&
¡»am_’gše_t
::
wr™e_id’t™y
),

73 
	`io_”rÜ
 (
çl£
),

74 
	`subsütiÚ_»quœed
 (
çl£
),

75 
	`mechªism
 (
NULL
),

76 
	`šput_¡İ³d
 (
çl£
),

77 
	`ouut_¡İ³d
 (
çl£
),

78 
	$sock‘
 (
NULL
)

80 
rc
 = 
tx_msg
.
	`š™
 ();

81 
	`”ºo_as£¹
 (
rc
 == 0);

84 
	`unblock_sock‘
 (
s
);

86 ià(!
	`g‘_³”__add»ss
 (
s
, 
³”_add»ss
))

87 
³”_add»ss
 = "";

89 #ifdeà
SO_NOSIGPIPE


92 
£t
 = 1;

93 
rc
 = 
	`£tsockİt
 (
s
, 
SOL_SOCKET
, 
SO_NOSIGPIPE
, &
£t
,  ());

94 
	`”ºo_as£¹
 (
rc
 == 0);

96 
	}
}

98 
	gzmq
::
¡»am_’gše_t
::~
	$¡»am_’gše_t
 ()

100 
	`zmq_as£¹
 (!
¶ugged
);

102 ià(
s
 !ğ
»tœed_fd
) {

103 #ifdeà
ZMQ_HAVE_WINDOWS


104 
rc
 = 
	`şo£sock‘
 (
s
);

105 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

107 
rc
 = 
	`şo£
 (
s
);

108 
	`”ºo_as£¹
 (
rc
 == 0);

110 
s
 = 
»tœed_fd
;

113 
rc
 = 
tx_msg
.
	`şo£
 ();

114 
	`”ºo_as£¹
 (
rc
 == 0);

116 
d–‘e
 
’cod”
;

117 
d–‘e
 
decod”
;

118 
d–‘e
 
mechªism
;

119 
	}
}

121 
	gzmq
::
¡»am_’gše_t
::
	$¶ug
 (
io_th»ad_t
 *
io_th»ad_
,

122 
£ssiÚ_ba£_t
 *
£ssiÚ_
)

124 
	`zmq_as£¹
 (!
¶ugged
);

125 
¶ugged
 = 
Œue
;

128 
	`zmq_as£¹
 (!
£ssiÚ
);

129 
	`zmq_as£¹
 (
£ssiÚ_
);

130 
£ssiÚ
 = 
£ssiÚ_
;

131 
sock‘
 = 
£ssiÚ
-> 
	`g‘_sock‘
 ();

134 
io_objeù_t
::
	`¶ug
 (
io_th»ad_
);

135 
hªdË
 = 
	`add_fd
 (
s
);

136 
io_”rÜ
 = 
çl£
;

138 ià(
İtiÚs
.
¿w_sock
) {

140 
’cod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`¿w_’cod”_t
 (
out_b©ch_size
);

141 
	`®loc_as£¹
 (
’cod”
);

143 
decod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`¿w_decod”_t
 (
š_b©ch_size
);

144 
	`®loc_as£¹
 (
decod”
);

147 
hªdshakšg
 = 
çl£
;

149 
»ad_msg
 = &
¡»am_’gše_t
::
puÎ_msg_äom_£ssiÚ
;

150 
wr™e_msg
 = &
¡»am_’gše_t
::
push_msg_to_£ssiÚ
;

155 
ouos
 = 
g»‘šg_£nd
;

156 
ouos
 [
outsize
++] = 0xff;

157 
	`put_ušt64
 (&
ouos
 [
outsize
], 
İtiÚs
.
id’t™y_size
 + 1);

158 
outsize
 += 8;

159 
ouos
 [
outsize
++] = 0x7f;

162 
	`£t_pŞlš
 (
hªdË
);

163 
	`£t_pŞlout
 (
hªdË
);

165 
	`š_ev’t
 ();

166 
	}
}

168 
	gzmq
::
¡»am_’gše_t
::
	$uÅlug
 ()

170 
	`zmq_as£¹
 (
¶ugged
);

171 
¶ugged
 = 
çl£
;

174 ià(!
io_”rÜ
)

175 
	`rm_fd
 (
hªdË
);

178 
io_objeù_t
::
	`uÅlug
 ();

180 
£ssiÚ
 = 
NULL
;

181 
	}
}

183 
	gzmq
::
¡»am_’gše_t
::
	$‹rmš©e
 ()

185 
	`uÅlug
 ();

186 
d–‘e
 
this
;

187 
	}
}

189 
	gzmq
::
¡»am_’gše_t
::
	$š_ev’t
 ()

191 
	`as£¹
 (!
io_”rÜ
);

194 ià(
	`uÆik–y
 (
hªdshakšg
))

195 ià(!
	`hªdshake
 ())

198 
	`zmq_as£¹
 (
decod”
);

201 ià(
šput_¡İ³d
) {

202 
	`rm_fd
 (
hªdË
);

203 
io_”rÜ
 = 
Œue
;

208 ià(!
šsize
) {

214 
size_t
 
bufsize
 = 0;

215 
decod”
->
	`g‘_bufãr
 (&
špos
, &
bufsize
);

217 cÚ¡ 
rc
 = 
	`»ad
 (
špos
, 
bufsize
);

218 ià(
rc
 == 0) {

219 
	`”rÜ
 ();

222 ià(
rc
 == -1) {

223 ià(
”ºo
 !ğ
EAGAIN
)

224 
	`”rÜ
 ();

229 
šsize
 = 
¡©ic_ÿ¡
 <
size_t
> (
rc
);

232 
rc
 = 0;

233 
size_t
 
´oûs£d
 = 0;

235 
šsize
 > 0) {

236 
rc
 = 
decod”
->
	`decode
 (
špos
, 
šsize
, 
´oûs£d
);

237 
	`zmq_as£¹
 (
´oûs£d
 <ğ
šsize
);

238 
špos
 +ğ
´oûs£d
;

239 
šsize
 -ğ
´oûs£d
;

240 ià(
rc
 == 0 ||„c == -1)

242 
rc
 = (
this
->*
wr™e_msg
è(
decod”
->
	`msg
 ());

243 ià(
rc
 == -1)

249 ià(
rc
 == -1) {

250 ià(
”ºo
 !ğ
EAGAIN
) {

251 
	`”rÜ
 ();

254 
šput_¡İ³d
 = 
Œue
;

255 
	`»£t_pŞlš
 (
hªdË
);

258 
£ssiÚ
->
	`æush
 ();

259 
	}
}

261 
	gzmq
::
¡»am_’gše_t
::
	$out_ev’t
 ()

263 
	`zmq_as£¹
 (!
io_”rÜ
);

266 ià(!
outsize
) {

271 ià(
	`uÆik–y
 (
’cod”
 =ğ
NULL
)) {

272 
	`zmq_as£¹
 (
hªdshakšg
);

276 
ouos
 = 
NULL
;

277 
outsize
 = 
’cod”
->
	`’code
 (&
ouos
, 0);

279 
outsize
 < 
out_b©ch_size
) {

280 ià((
this
->*
»ad_msg
è(&
tx_msg
) == -1)

282 
’cod”
->
	`lßd_msg
 (&
tx_msg
);

283 *
buåŒ
 = 
ouos
 + 
outsize
;

284 
size_t
 
n
 = 
’cod”
->
	`’code
 (&
buåŒ
, 
out_b©ch_size
 - 
outsize
);

285 
	`zmq_as£¹
 (
n
 > 0);

286 ià(
ouos
 =ğ
NULL
)

287 
ouos
 = 
buåŒ
;

288 
outsize
 +ğ
n
;

292 ià(
outsize
 == 0) {

293 
ouut_¡İ³d
 = 
Œue
;

294 
	`»£t_pŞlout
 (
hªdË
);

304 
nby‹s
 = 
	`wr™e
 (
ouos
, 
outsize
);

309 ià(
nby‹s
 == -1) {

310 
	`»£t_pŞlout
 (
hªdË
);

314 
ouos
 +ğ
nby‹s
;

315 
outsize
 -ğ
nby‹s
;

319 ià(
	`uÆik–y
 (
hªdshakšg
))

320 ià(
outsize
 == 0)

321 
	`»£t_pŞlout
 (
hªdË
);

322 
	}
}

324 
	gzmq
::
¡»am_’gše_t
::
	$»¡¬t_ouut
 ()

326 ià(
	`uÆik–y
 (
io_”rÜ
))

329 ià(
	`lik–y
 (
ouut_¡İ³d
)) {

330 
	`£t_pŞlout
 (
hªdË
);

331 
ouut_¡İ³d
 = 
çl£
;

338 
	`out_ev’t
 ();

339 
	}
}

341 
	gzmq
::
¡»am_’gše_t
::
	$»¡¬t_šput
 ()

343 
	`zmq_as£¹
 (
šput_¡İ³d
);

344 
	`zmq_as£¹
 (
£ssiÚ
 !ğ
NULL
);

345 
	`zmq_as£¹
 (
decod”
 !ğ
NULL
);

347 
rc
 = (
this
->*
wr™e_msg
è(
decod”
->
	`msg
 ());

348 ià(
rc
 == -1) {

349 ià(
”ºo
 =ğ
EAGAIN
)

350 
£ssiÚ
->
	`æush
 ();

352 
	`”rÜ
 ();

356 
šsize
 > 0) {

357 
size_t
 
´oûs£d
 = 0;

358 
rc
 = 
decod”
->
	`decode
 (
špos
, 
šsize
, 
´oûs£d
);

359 
	`zmq_as£¹
 (
´oûs£d
 <ğ
šsize
);

360 
špos
 +ğ
´oûs£d
;

361 
šsize
 -ğ
´oûs£d
;

362 ià(
rc
 == 0 ||„c == -1)

364 
rc
 = (
this
->*
wr™e_msg
è(
decod”
->
	`msg
 ());

365 ià(
rc
 == -1)

369 ià(
rc
 =ğ-1 && 
”ºo
 =ğ
EAGAIN
)

370 
£ssiÚ
->
	`æush
 ();

372 ià(
rc
 =ğ-1 || 
io_”rÜ
)

373 
	`”rÜ
 ();

375 
šput_¡İ³d
 = 
çl£
;

376 
	`£t_pŞlš
 (
hªdË
);

377 
£ssiÚ
->
	`æush
 ();

380 
	`š_ev’t
 ();

382 
	}
}

384 
boŞ
 
	gzmq
::
¡»am_’gše_t
::
	$hªdshake
 ()

386 
	`zmq_as£¹
 (
hªdshakšg
);

387 
	`zmq_as£¹
 (
g»‘šg_by‹s_»ad
 < 
g»‘šg_size
);

389 
g»‘šg_by‹s_»ad
 < 
g»‘šg_size
) {

390 cÚ¡ 
n
 = 
	`»ad
 (
g»‘šg_»cv
 + 
g»‘šg_by‹s_»ad
,

391 
g»‘šg_size
 - 
g»‘šg_by‹s_»ad
);

392 ià(
n
 == 0) {

393 
	`”rÜ
 ();

394  
çl£
;

396 ià(
n
 == -1) {

397 ià(
”ºo
 !ğ
EAGAIN
)

398 
	`”rÜ
 ();

399  
çl£
;

402 
g»‘šg_by‹s_»ad
 +ğ
n
;

407 ià(
g»‘šg_»cv
 [0] != 0xff)

410 ià(
g»‘šg_by‹s_»ad
 < 
sigÇtu»_size
)

417 ià(!(
g»‘šg_»cv
 [9] & 0x01))

422 ià(
ouos
 + 
outsize
 =ğ
g»‘šg_£nd
 + 
sigÇtu»_size
) {

423 ià(
outsize
 == 0)

424 
	`£t_pŞlout
 (
hªdË
);

425 
ouos
 [
outsize
++] = 3;

428 ià(
g»‘šg_by‹s_»ad
 > 
sigÇtu»_size
) {

429 ià(
ouos
 + 
outsize
 =ğ
g»‘šg_£nd
 + 
sigÇtu»_size
 + 1) {

430 ià(
outsize
 == 0)

431 
	`£t_pŞlout
 (
hªdË
);

434 ià(
g»‘šg_»cv
 [10] =ğ
ZMTP_1_0


435 || 
g»‘šg_»cv
 [10] =ğ
ZMTP_2_0
)

436 
ouos
 [
outsize
++] = 
İtiÚs
.
ty³
;

438 
ouos
 [
outsize
++] = 0;

439 
	`mem£t
 (
ouos
 + 
outsize
, 0, 20);

441 
	`zmq_as£¹
 (
İtiÚs
.
mechªism
 =ğ
ZMQ_NULL


442 || 
İtiÚs
.
mechªism
 =ğ
ZMQ_PLAIN


443 || 
İtiÚs
.
mechªism
 =ğ
ZMQ_CURVE
);

445 ià(
İtiÚs
.
mechªism
 =ğ
ZMQ_NULL
)

446 
	`memıy
 (
ouos
 + 
outsize
, "NULL", 4);

448 ià(
İtiÚs
.
mechªism
 =ğ
ZMQ_PLAIN
)

449 
	`memıy
 (
ouos
 + 
outsize
, "PLAIN", 5);

451 
	`memıy
 (
ouos
 + 
outsize
, "CURVE", 5);

452 
outsize
 += 20;

453 
	`mem£t
 (
ouos
 + 
outsize
, 0, 32);

454 
outsize
 += 32;

455 
g»‘šg_size
 = 
v3_g»‘šg_size
;

462 cÚ¡ 
size_t
 
»visiÚ_pos
 = 10;

466 ià(
g»‘šg_»cv
 [0] != 0xff || !(greeting_recv [9] & 0x01)) {

467 
’cod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`v1_’cod”_t
 (
out_b©ch_size
);

468 
	`®loc_as£¹
 (
’cod”
);

470 
decod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`v1_decod”_t
 (
š_b©ch_size
, 
İtiÚs
.
maxmsgsize
);

471 
	`®loc_as£¹
 (
decod”
);

477 cÚ¡ 
size_t
 
h—d”_size
 = 
İtiÚs
.
id’t™y_size
 + 1 >= 255 ? 10 : 2;

478 
tmp
 [10], *
bufã½
 =mp;

482 cÚ¡ 
rc
 = 
tx_msg
.
	`š™_size
 (
İtiÚs
.
id’t™y_size
);

483 
	`zmq_as£¹
 (
rc
 == 0);

484 
	`memıy
 (
tx_msg
.
	`d©a
 (), 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

485 
’cod”
->
	`lßd_msg
 (&
tx_msg
);

486 
size_t
 
bufãr_size
 = 
’cod”
->
	`’code
 (&
bufã½
, 
h—d”_size
);

487 
	`zmq_as£¹
 (
bufãr_size
 =ğ
h—d”_size
);

490 
špos
 = 
g»‘šg_»cv
;

491 
šsize
 = 
g»‘šg_by‹s_»ad
;

496 ià(
İtiÚs
.
ty³
 =ğ
ZMQ_PUB
 || o±iÚs.ty³ =ğ
ZMQ_XPUB
)

497 
subsütiÚ_»quœed
 = 
Œue
;

501 
»ad_msg
 = &
¡»am_’gše_t
::
puÎ_msg_äom_£ssiÚ
;

504 
wr™e_msg
 = &
¡»am_’gše_t
::
wr™e_id’t™y
;

507 ià(
g»‘šg_»cv
 [
»visiÚ_pos
] =ğ
ZMTP_1_0
) {

508 
’cod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`v1_’cod”_t
 (

509 
out_b©ch_size
);

510 
	`®loc_as£¹
 (
’cod”
);

512 
decod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`v1_decod”_t
 (

513 
š_b©ch_size
, 
İtiÚs
.
maxmsgsize
);

514 
	`®loc_as£¹
 (
decod”
);

517 ià(
g»‘šg_»cv
 [
»visiÚ_pos
] =ğ
ZMTP_2_0
) {

518 
’cod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`v2_’cod”_t
 (
out_b©ch_size
);

519 
	`®loc_as£¹
 (
’cod”
);

521 
decod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`v2_decod”_t
 (

522 
š_b©ch_size
, 
İtiÚs
.
maxmsgsize
);

523 
	`®loc_as£¹
 (
decod”
);

526 
’cod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`v2_’cod”_t
 (
out_b©ch_size
);

527 
	`®loc_as£¹
 (
’cod”
);

529 
decod”
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`v2_decod”_t
 (

530 
š_b©ch_size
, 
İtiÚs
.
maxmsgsize
);

531 
	`®loc_as£¹
 (
decod”
);

533 ià(
İtiÚs
.
mechªism
 =ğ
ZMQ_NULL


534 && 
	`memcmp
 (
g»‘šg_»cv
 + 12, "NULL\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0", 20) == 0) {

535 
mechªism
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

536 
	`nuÎ_mechªism_t
 (
£ssiÚ
, 
³”_add»ss
, 
İtiÚs
);

537 
	`®loc_as£¹
 (
mechªism
);

540 ià(
İtiÚs
.
mechªism
 =ğ
ZMQ_PLAIN


541 && 
	`memcmp
 (
g»‘šg_»cv
 + 12, "PLAIN\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0", 20) == 0) {

542 
mechªism
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

543 
	`¶aš_mechªism_t
 (
£ssiÚ
, 
³”_add»ss
, 
İtiÚs
);

544 
	`®loc_as£¹
 (
mechªism
);

546 #ifdeà
HAVE_LIBSODIUM


548 ià(
İtiÚs
.
mechªism
 =ğ
ZMQ_CURVE


549 && 
	`memcmp
 (
g»‘šg_»cv
 + 12, "CURVE\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0", 20) == 0) {

550 ià(
İtiÚs
.
as_£rv”
)

551 
mechªism
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

552 
	`curve_£rv”_t
 (
£ssiÚ
, 
³”_add»ss
, 
İtiÚs
);

554 
mechªism
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
	`curve_ş›Á_t
 (
İtiÚs
);

555 
	`®loc_as£¹
 (
mechªism
);

559 
	`”rÜ
 ();

560  
çl£
;

562 
»ad_msg
 = &
¡»am_’gše_t
::
Ãxt_hªdshake_commªd
;

563 
wr™e_msg
 = &
¡»am_’gše_t
::
´oûss_hªdshake_commªd
;

567 ià(
outsize
 == 0)

568 
	`£t_pŞlout
 (
hªdË
);

572 
hªdshakšg
 = 
çl£
;

574  
Œue
;

575 
	}
}

577 
	gzmq
::
¡»am_’gše_t
::
	$»ad_id’t™y
 (
msg_t
 *
msg_
)

579 
rc
 = 
msg_
->
	`š™_size
 (
İtiÚs
.
id’t™y_size
);

580 
	`”ºo_as£¹
 (
rc
 == 0);

581 ià(
İtiÚs
.
id’t™y_size
 > 0)

582 
	`memıy
 (
msg_
->
	`d©a
 (), 
İtiÚs
.
id’t™y
, o±iÚs.
id’t™y_size
);

583 
»ad_msg
 = &
¡»am_’gše_t
::
puÎ_msg_äom_£ssiÚ
;

585 
	}
}

587 
	gzmq
::
¡»am_’gše_t
::
	$wr™e_id’t™y
 (
msg_t
 *
msg_
)

589 ià(
İtiÚs
.
»cv_id’t™y
) {

590 
msg_
->
	`£t_æags
 (
msg_t
::
id’t™y
);

591 
rc
 = 
£ssiÚ
->
	`push_msg
 (
msg_
);

592 
	`”ºo_as£¹
 (
rc
 == 0);

595 
rc
 = 
msg_
->
	`şo£
 ();

596 
	`”ºo_as£¹
 (
rc
 == 0);

597 
rc
 = 
msg_
->
	`š™
 ();

598 
	`”ºo_as£¹
 (
rc
 == 0);

601 ià(
subsütiÚ_»quœed
)

602 
wr™e_msg
 = &
¡»am_’gše_t
::
wr™e_subsütiÚ_msg
;

604 
wr™e_msg
 = &
¡»am_’gše_t
::
push_msg_to_£ssiÚ
;

607 
	}
}

609 
	gzmq
::
¡»am_’gše_t
::
	$Ãxt_hªdshake_commªd
 (
msg_t
 *
msg_
)

611 
	`zmq_as£¹
 (
mechªism
 !ğ
NULL
);

613 cÚ¡ 
rc
 = 
mechªism
->
	`Ãxt_hªdshake_commªd
 (
msg_
);

614 ià(
rc
 == 0) {

615 
msg_
->
	`£t_æags
 (
msg_t
::
commªd
);

616 ià(
mechªism
->
	`is_hªdshake_com¶‘e
 ())

617 
	`mechªism_»ady
 ();

620  
rc
;

621 
	}
}

623 
	gzmq
::
¡»am_’gše_t
::
	$´oûss_hªdshake_commªd
 (
msg_t
 *
msg_
)

625 
	`zmq_as£¹
 (
mechªism
 !ğ
NULL
);

626 cÚ¡ 
rc
 = 
mechªism
->
	`´oûss_hªdshake_commªd
 (
msg_
);

627 ià(
rc
 == 0) {

628 ià(
mechªism
->
	`is_hªdshake_com¶‘e
 ())

629 
	`mechªism_»ady
 ();

630 ià(
ouut_¡İ³d
)

631 
	`»¡¬t_ouut
 ();

634  
rc
;

635 
	}
}

637 
	gzmq
::
¡»am_’gše_t
::
	$z­_msg_avaabË
 ()

639 
	`zmq_as£¹
 (
mechªism
 !ğ
NULL
);

641 cÚ¡ 
rc
 = 
mechªism
->
	`z­_msg_avaabË
 ();

642 ià(
rc
 == -1) {

643 
	`”rÜ
 ();

646 ià(
šput_¡İ³d
)

647 
	`»¡¬t_šput
 ();

648 ià(
ouut_¡İ³d
)

649 
	`»¡¬t_ouut
 ();

650 
	}
}

652 
	gzmq
::
¡»am_’gše_t
::
	$mechªism_»ady
 ()

654 ià(
İtiÚs
.
»cv_id’t™y
) {

655 
msg_t
 
id’t™y
;

656 
mechªism
->
	`³”_id’t™y
 (&
id’t™y
);

657 cÚ¡ 
rc
 = 
£ssiÚ
->
	`push_msg
 (&
id’t™y
);

658 ià(
rc
 =ğ-1 && 
”ºo
 =ğ
EAGAIN
) {

664 
	`”ºo_as£¹
 (
rc
 == 0);

665 
£ssiÚ
->
	`æush
 ();

668 
»ad_msg
 = &
¡»am_’gše_t
::
puÎ_ªd_’code
;

669 
wr™e_msg
 = &
¡»am_’gše_t
::
decode_ªd_push
;

670 
	}
}

672 
	gzmq
::
¡»am_’gše_t
::
	$puÎ_msg_äom_£ssiÚ
 (
msg_t
 *
msg_
)

674  
£ssiÚ
->
	`puÎ_msg
 (
msg_
);

675 
	}
}

677 
	gzmq
::
¡»am_’gše_t
::
	$push_msg_to_£ssiÚ
 (
msg_t
 *
msg_
)

679  
£ssiÚ
->
	`push_msg
 (
msg_
);

680 
	}
}

682 
	gzmq
::
¡»am_’gše_t
::
	$puÎ_ªd_’code
 (
msg_t
 *
msg_
)

684 
	`zmq_as£¹
 (
mechªism
 !ğ
NULL
);

686 ià(
£ssiÚ
->
	`puÎ_msg
 (
msg_
) == -1)

688 ià(
mechªism
->
	`’code
 (
msg_
) == -1)

691 
	}
}

693 
	gzmq
::
¡»am_’gše_t
::
	$decode_ªd_push
 (
msg_t
 *
msg_
)

695 
	`zmq_as£¹
 (
mechªism
 !ğ
NULL
);

697 ià(
mechªism
->
	`decode
 (
msg_
) == -1)

699 ià(
£ssiÚ
->
	`push_msg
 (
msg_
) == -1) {

700 ià(
”ºo
 =ğ
EAGAIN
)

701 
wr™e_msg
 = &
¡»am_’gše_t
::
push_Úe_th’_decode_ªd_push
;

705 
	}
}

707 
	gzmq
::
¡»am_’gše_t
::
	$push_Úe_th’_decode_ªd_push
 (
msg_t
 *
msg_
)

709 cÚ¡ 
rc
 = 
£ssiÚ
->
	`push_msg
 (
msg_
);

710 ià(
rc
 == 0)

711 
wr™e_msg
 = &
¡»am_’gše_t
::
decode_ªd_push
;

712  
rc
;

713 
	}
}

715 
	gzmq
::
¡»am_’gše_t
::
	$wr™e_subsütiÚ_msg
 (
msg_t
 *
msg_
)

717 
msg_t
 
subsütiÚ
;

721 
rc
 = 
subsütiÚ
.
	`š™_size
 (1);

722 
	`”ºo_as£¹
 (
rc
 == 0);

723 *(*è
subsütiÚ
.
	`d©a
 () = 1;

724 
rc
 = 
£ssiÚ
->
	`push_msg
 (&
subsütiÚ
);

725 ià(
rc
 == -1)

728 
wr™e_msg
 = &
¡»am_’gše_t
::
push_msg_to_£ssiÚ
;

729  
	`push_msg_to_£ssiÚ
 (
msg_
);

730 
	}
}

732 
	gzmq
::
¡»am_’gše_t
::
	$”rÜ
 ()

734 
	`zmq_as£¹
 (
£ssiÚ
);

735 
sock‘
->
	`ev’t_discÚÃùed
 (
’dpošt
, 
s
);

736 
£ssiÚ
->
	`æush
 ();

737 
£ssiÚ
->
	`d‘ach
 ();

738 
	`uÅlug
 ();

739 
d–‘e
 
this
;

740 
	}
}

742 
	gzmq
::
¡»am_’gše_t
::
	$wr™e
 (cÚ¡ *
d©a_
, 
size_t
 
size_
)

744 #ifdeà
ZMQ_HAVE_WINDOWS


746 
nby‹s
 = 
	`£nd
 (
s
, (*è
d©a_
, (è
size_
, 0);

750 ià(
nby‹s
 =ğ
SOCKET_ERROR
 && 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAEWOULDBLOCK
)

754 ià(
nby‹s
 =ğ
SOCKET_ERROR
 && (

755 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAENETDOWN
 ||

756 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAENETRESET
 ||

757 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAEHOSTUNREACH
 ||

758 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAECONNABORTED
 ||

759 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAETIMEDOUT
 ||

760 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAECONNRESET
))

763 
	`w§_as£¹
 (
nby‹s
 !ğ
SOCKET_ERROR
);

764  
nby‹s
;

768 
ssize_t
 
nby‹s
 = 
	`£nd
 (
s
, 
d©a_
, 
size_
, 0);

773 ià(
nby‹s
 =ğ-1 && (
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
EWOULDBLOCK
 ||

774 
”ºo
 =ğ
EINTR
))

778 ià(
nby‹s
 == -1) {

779 
	`”ºo_as£¹
 (
”ºo
 !ğ
EACCES


780 && 
”ºo
 !ğ
EBADF


781 && 
”ºo
 !ğ
EDESTADDRREQ


782 && 
”ºo
 !ğ
EFAULT


783 && 
”ºo
 !ğ
EINVAL


784 && 
”ºo
 !ğ
EISCONN


785 && 
”ºo
 !ğ
EMSGSIZE


786 && 
”ºo
 !ğ
ENOMEM


787 && 
”ºo
 !ğ
ENOTSOCK


788 && 
”ºo
 !ğ
EOPNOTSUPP
);

792  
¡©ic_ÿ¡
 <> (
nby‹s
);

795 
	}
}

797 
	gzmq
::
¡»am_’gše_t
::
	$»ad
 (*
d©a_
, 
size_t
 
size_
)

799 #ifdeà
ZMQ_HAVE_WINDOWS


801 cÚ¡ 
rc
 = 
	`»cv
 (
s
, (*è
d©a_
, (è
size_
, 0);

805 ià(
rc
 =ğ
SOCKET_ERROR
) {

806 ià(
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAEWOULDBLOCK
)

807 
”ºo
 = 
EAGAIN
;

809 
	`w§_as£¹
 (
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAENETDOWN


810 || 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAENETRESET


811 || 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAECONNABORTED


812 || 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAETIMEDOUT


813 || 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAECONNRESET


814 || 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAECONNREFUSED


815 || 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAENOTCONN
);

816 
”ºo
 = 
	`w§_”rÜ_to_”ºo
 (
	`WSAG‘La¡E¼Ü
 ());

820  
rc
 =ğ
SOCKET_ERROR
? -1:„c;

824 cÚ¡ 
ssize_t
 
rc
 = 
	`»cv
 (
s
, 
d©a_
, 
size_
, 0);

829 ià(
rc
 == -1) {

830 
	`”ºo_as£¹
 (
”ºo
 !ğ
EBADF


831 && 
”ºo
 !ğ
EFAULT


832 && 
”ºo
 !ğ
EINVAL


833 && 
”ºo
 !ğ
ENOMEM


834 && 
”ºo
 !ğ
ENOTSOCK
);

835 ià(
”ºo
 =ğ
EWOULDBLOCK
 ||ƒ¼nØ=ğ
EINTR
)

836 
”ºo
 = 
EAGAIN
;

839  
¡©ic_ÿ¡
 <> (
rc
);

842 
	}
}

	@stream_engine.hpp

20 #iâdeà
__ZMQ_STREAM_ENGINE_HPP_INCLUDED__


21 
	#__ZMQ_STREAM_ENGINE_HPP_INCLUDED__


	)

23 
	~<¡ddef.h
>

25 
	~"fd.hµ
"

26 
	~"i_’gše.hµ
"

27 
	~"io_objeù.hµ
"

28 
	~"i_’cod”.hµ
"

29 
	~"i_decod”.hµ
"

30 
	~"İtiÚs.hµ
"

31 
	~"sock‘_ba£.hµ
"

32 
	~"../šşude/zmq.h
"

34 
Çme¥aû
 
	gzmq


39 
	gZMTP_1_0
 = 0,

40 
	gZMTP_2_0
 = 1

43 
şass
 
	gio_th»ad_t
;

44 
şass
 
	gmsg_t
;

45 
şass
 
	g£ssiÚ_ba£_t
;

46 
şass
 
	gmechªism_t
;

51 
şass
 
	g¡»am_’gše_t
 : 
public
 
io_objeù_t
,…ubliø
	gi_’gše


53 
	gpublic
:

55 
¡»am_’gše_t
 (
fd_t
 
fd_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

56 cÚ¡ 
¡d
::
¡ršg
 &
’dpošt
);

57 ~
¡»am_’gše_t
 ();

60 
¶ug
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
,

61 
zmq
::
£ssiÚ_ba£_t
 *
£ssiÚ_
);

62 
‹rmš©e
 ();

63 
»¡¬t_šput
 ();

64 
»¡¬t_ouut
 ();

65 
z­_msg_avaabË
 ();

68 
š_ev’t
 ();

69 
out_ev’t
 ();

71 
	g´iv©e
:

74 
uÅlug
 ();

77 
”rÜ
 ();

80 
»ûive_g»‘šg
 ();

83 
boŞ
 
hªdshake
 ();

88 
wr™e
 (cÚ¡ *
d©a_
, 
size_t
 
size_
);

93 
»ad
 (*
d©a_
, 
size_t
 
size_
);

95 
»ad_id’t™y
 (
msg_t
 *
msg_
);

96 
wr™e_id’t™y
 (
msg_t
 *
msg_
);

98 
Ãxt_hªdshake_commªd
 (
msg_t
 *
msg
);

99 
´oûss_hªdshake_commªd
 (
msg_t
 *
msg
);

101 
puÎ_msg_äom_£ssiÚ
 (
msg_t
 *
msg_
);

102 
push_msg_to_£ssiÚ
 (
msg_t
 *
msg
);

104 
puÎ_ªd_’code
 (
msg_t
 *
msg_
);

105 
decode_ªd_push
 (
msg_t
 *
msg_
);

106 
push_Úe_th’_decode_ªd_push
 (
msg_t
 *
msg_
);

108 
mechªism_»ady
 ();

110 
wr™e_subsütiÚ_msg
 (
msg_t
 *
msg_
);

112 
size_t
 
add_´İ”ty
 (*
±r
,

113 cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
v®ue_Ën
);

116 
fd_t
 
	gs
;

119 
boŞ
 
	gas_£rv”
;

121 
msg_t
 
	gtx_msg
;

123 
hªdË_t
 
	ghªdË
;

125 *
	gšpos
;

126 
size_t
 
	gšsize
;

127 
i_decod”
 *
	gdecod”
;

129 *
	gouos
;

130 
size_t
 
	goutsize
;

131 
i_’cod”
 *
	g’cod”
;

136 
boŞ
 
	ghªdshakšg
;

138 cÚ¡ 
size_t
 
	gsigÇtu»_size
 = 10;

141 cÚ¡ 
size_t
 
	gv2_g»‘šg_size
 = 12;

144 cÚ¡ 
size_t
 
	gv3_g»‘šg_size
 = 64;

147 
size_t
 
	gg»‘šg_size
;

150 
	gg»‘šg_»cv
 [
v3_g»‘šg_size
];

151 
	gg»‘šg_£nd
 [
v3_g»‘šg_size
];

154 
	gg»‘šg_by‹s_»ad
;

157 
	gzmq
::
£ssiÚ_ba£_t
 *
£ssiÚ
;

159 
İtiÚs_t
 
	gİtiÚs
;

162 
	g¡d
::
¡ršg
 
’dpošt
;

164 
boŞ
 
	g¶ugged
;

166 (
	g¡»am_’gše_t
::*
»ad_msg
è(
msg_t
 *
msg_
);

168 (
	g¡»am_’gše_t
::*
wr™e_msg
è(
msg_t
 *
msg_
);

170 
boŞ
 
	gio_”rÜ
;

175 
boŞ
 
	gsubsütiÚ_»quœed
;

177 
mechªism_t
 *
	gmechªism
;

180 
boŞ
 
	gšput_¡İ³d
;

183 
boŞ
 
	gouut_¡İ³d
;

186 
	gzmq
::
sock‘_ba£_t
 *
sock‘
;

188 
	g¡d
::
¡ršg
 
³”_add»ss
;

190 
¡»am_’gše_t
 (const stream_engine_t&);

191 cÚ¡ 
	g¡»am_’gše_t
 &
	gİ”©Ü
 = (cÚ¡ 
¡»am_’gše_t
&);

	@sub.cpp

20 
	~"sub.hµ
"

21 
	~"msg.hµ
"

23 
	gzmq
::
sub_t
::
	$sub_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

24 
	$xsub_t
 (
·»Á_
, 
tid_
, 
sid_
)

26 
İtiÚs
.
ty³
 = 
ZMQ_SUB
;

30 
İtiÚs
.
f‹r
 = 
Œue
;

31 
	}
}

33 
	gzmq
::
sub_t
::~
	$sub_t
 ()

35 
	}
}

37 
zmq
::
sub_t
::
	$x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
,

38 
size_t
 
İtv®Ën_
)

40 ià(
İtiÚ_
 !ğ
ZMQ_SUBSCRIBE
 && o±iÚ_ !ğ
ZMQ_UNSUBSCRIBE
) {

41 
”ºo
 = 
EINVAL
;

46 
msg_t
 
msg
;

47 
rc
 = 
msg
.
	`š™_size
 (
İtv®Ën_
 + 1);

48 
	`”ºo_as£¹
 (
rc
 == 0);

49 *
d©a
 = (*è
msg
.
	`d©a
 ();

50 ià(
İtiÚ_
 =ğ
ZMQ_SUBSCRIBE
)

51 *
d©a
 = 1;

53 ià(
İtiÚ_
 =ğ
ZMQ_UNSUBSCRIBE
)

54 *
d©a
 = 0;

55 
	`memıy
 (
d©a
 + 1, 
İtv®_
, 
İtv®Ën_
);

58 
”r
 = 0;

59 
rc
 = 
xsub_t
::
	`x£nd
 (&
msg
);

60 ià(
rc
 != 0)

61 
”r
 = 
”ºo
;

62 
rc2
 = 
msg
.
	`şo£
 ();

63 
	`”ºo_as£¹
 (
rc2
 == 0);

64 ià(
rc
 != 0)

65 
”ºo
 = 
”r
;

66  
rc
;

67 
	}
}

69 
	gzmq
::
sub_t
::
	$x£nd
 (
msg_t
 *)

72 
”ºo
 = 
ENOTSUP
;

74 
	}
}

76 
boŞ
 
	gzmq
::
sub_t
::
	$xhas_out
 ()

79  
çl£
;

80 
	}
}

	@sub.hpp

20 #iâdeà
__ZMQ_SUB_HPP_INCLUDED__


21 
	#__ZMQ_SUB_HPP_INCLUDED__


	)

23 
	~"xsub.hµ
"

25 
Çme¥aû
 
	gzmq


28 
şass
 
	gùx_t
;

29 
şass
 
	gmsg_t
;

30 
şass
 
	gio_th»ad_t
;

31 
şass
 
	gsock‘_ba£_t
;

33 şas 
	csub_t
 : 
public
 
xsub_t


35 
public
:

37 
sub_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
);

38 ~
sub_t
 ();

40 
	g´Ùeùed
:

42 
x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
, 
size_t
 
İtv®Ën_
);

43 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

44 
boŞ
 
xhas_out
 ();

46 
	g´iv©e
:

48 
sub_t
 (const sub_t&);

49 cÚ¡ 
	gsub_t
 &
	gİ”©Ü
 = (cÚ¡ 
sub_t
&);

	@tcp.cpp

20 
	~".hµ
"

21 
	~"tı.hµ
"

22 
	~"”r.hµ
"

23 
	~"¶©fÜm.hµ
"

25 #ià
defšed
 
ZMQ_HAVE_WINDOWS


26 
	~"wšdows.hµ
"

28 
	~<fú.h
>

29 
	~<sys/ty³s.h
>

30 
	~<sys/sock‘.h
>

31 
	~<Ãtš‘/š.h
>

32 
	~<Ãtš‘/tı.h
>

35 #ià
defšed
 
ZMQ_HAVE_OPENVMS


36 
	~<ioùl.h
>

39 
	gzmq
::
	$tuÃ_tı_sock‘
 (
fd_t
 
s_
)

44 
nod–ay
 = 1;

45 
rc
 = 
	`£tsockİt
 (
s_
, 
IPPROTO_TCP
, 
TCP_NODELAY
, (*è&
nod–ay
,

47 #ifdeà
ZMQ_HAVE_WINDOWS


48 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

50 
	`”ºo_as£¹
 (
rc
 == 0);

53 #ifdeà
ZMQ_HAVE_OPENVMS


55 
nod–ack
 = 1;

56 
rc
 = 
	`£tsockİt
 (
s_
, 
IPPROTO_TCP
, 
TCP_NODELACK
, (*è&
nod–ack
,

58 
	`”ºo_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

60 
	}
}

62 
	gzmq
::
	$£t_tı_£nd_bufãr
 (
fd_t
 
sockfd_
, 
bufsize_
)

64 cÚ¡ 
rc
 = 
	`£tsockİt
 (
sockfd_
, 
SOL_SOCKET
, 
SO_SNDBUF
,

65 (*è&
bufsize_
,  bufsize_);

66 #ifdeà
ZMQ_HAVE_WINDOWS


67 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

69 
	`”ºo_as£¹
 (
rc
 == 0);

71 
	}
}

73 
	gzmq
::
	$£t_tı_»ûive_bufãr
 (
fd_t
 
sockfd_
, 
bufsize_
)

75 cÚ¡ 
rc
 = 
	`£tsockİt
 (
sockfd_
, 
SOL_SOCKET
, 
SO_RCVBUF
,

76 (*è&
bufsize_
,  bufsize_);

77 #ifdeà
ZMQ_HAVE_WINDOWS


78 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

80 
	`”ºo_as£¹
 (
rc
 == 0);

82 
	}
}

84 
	gzmq
::
	$tuÃ_tı_k“·lives
 (
fd_t
 
s_
, 
k“·live_
, 
k“·live_út_
, 
k“·live_idË_
, 
k“·live_štvl_
)

87 ()
k“·live_
;

88 ()
k“·live_út_
;

89 ()
k“·live_idË_
;

90 ()
k“·live_štvl_
;

93 ()
s_
;

97 #ifdeà
ZMQ_HAVE_WINDOWS


98 ià(
k“·live_
 != -1) {

99 
tı_k“·live
 
k“·live_İts
;

100 
k“·live_İts
.
Úoff
 = 
k“·live_
;

101 
k“·live_İts
.
k“·liv‘ime
 = 
k“·live_idË_
 != -1 ? keepalive_idle_ * 1000 : 7200000;

102 
k“·live_İts
.
k“·liveš‹rv®
 = 
k“·live_štvl_
 != -1 ? keepalive_intvl_ * 1000 : 1000;

103 
DWORD
 
num_by‹s_»tuºed
;

104 
rc
 = 
	`WSAIoùl
(
s_
, 
SIO_KEEPALIVE_VALS
, &
k“·live_İts
, (k“·live_İts), 
NULL
, 0, &
num_by‹s_»tuºed
, NULL, NULL);

105 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

108 #ifdeà
ZMQ_HAVE_SO_KEEPALIVE


109 ià(
k“·live_
 != -1) {

110 
rc
 = 
	`£tsockİt
 (
s_
, 
SOL_SOCKET
, 
SO_KEEPALIVE
, (*è&
k“·live_
,  ());

111 
	`”ºo_as£¹
 (
rc
 == 0);

113 #ifdeà
ZMQ_HAVE_TCP_KEEPCNT


114 ià(
k“·live_út_
 != -1) {

115 
rc
 = 
	`£tsockİt
 (
s_
, 
IPPROTO_TCP
, 
TCP_KEEPCNT
, &
k“·live_út_
,  ());

116 
	`”ºo_as£¹
 (
rc
 == 0);

120 #ifdeà
ZMQ_HAVE_TCP_KEEPIDLE


121 ià(
k“·live_idË_
 != -1) {

122 
rc
 = 
	`£tsockİt
 (
s_
, 
IPPROTO_TCP
, 
TCP_KEEPIDLE
, &
k“·live_idË_
,  ());

123 
	`”ºo_as£¹
 (
rc
 == 0);

126 #ifdeà
ZMQ_HAVE_TCP_KEEPALIVE


127 ià(
k“·live_idË_
 != -1) {

128 
rc
 = 
	`£tsockİt
 (
s_
, 
IPPROTO_TCP
, 
TCP_KEEPALIVE
, &
k“·live_idË_
,  ());

129 
	`”ºo_as£¹
 (
rc
 == 0);

134 #ifdeà
ZMQ_HAVE_TCP_KEEPINTVL


135 ià(
k“·live_štvl_
 != -1) {

136 
rc
 = 
	`£tsockİt
 (
s_
, 
IPPROTO_TCP
, 
TCP_KEEPINTVL
, &
k“·live_štvl_
,  ());

137 
	`”ºo_as£¹
 (
rc
 == 0);

143 
	}
}

	@tcp.hpp

20 #iâdeà
__ZMQ_TCP_HPP_INCLUDED__


21 
	#__ZMQ_TCP_HPP_INCLUDED__


	)

23 
	~"fd.hµ
"

25 
Çme¥aû
 
	gzmq


29 
tuÃ_tı_sock‘
 (
fd_t
 
s_
);

32 
£t_tı_£nd_bufãr
 (
fd_t
 
sockfd_
, 
bufsize_
);

35 
£t_tı_»ûive_bufãr
 (
fd_t
 
sockfd_
, 
bufsize_
);

38 
tuÃ_tı_k“·lives
 (
fd_t
 
s_
, 
k“·live_
, 
k“·live_út_
, 
k“·live_idË_
, 
k“·live_štvl_
);

	@tcp_address.cpp

20 
	~<¡ršg
>

21 
	~<s¡»am
>

23 
	~"tı_add»ss.hµ
"

24 
	~"¶©fÜm.hµ
"

25 
	~"¡dšt.hµ
"

26 
	~"”r.hµ
"

27 
	~".hµ
"

29 #ifdeà
ZMQ_HAVE_WINDOWS


30 
	~"wšdows.hµ
"

32 
	~<sys/ty³s.h
>

33 
	~<¬·/š‘.h
>

34 
	~<Ãtš‘/tı.h
>

35 
	~<Ãtdb.h
>

41 #iâdeà
AI_ADDRCONFIG


42 
	#AI_ADDRCONFIG
 0

	)

45 #ià
defšed
 
ZMQ_HAVE_SOLARIS


47 
	~<sys/sockio.h
>

48 
	~<Ãt/if.h
>

49 
	~<uni¡d.h
>

50 
	~<¡dlib.h
>

53 
	gzmq
::
tı_add»ss_t
::
	$»sŞve_nic_Çme
 (cÚ¡ *
nic_
, 
boŞ
 
v6_
)

56 (è
v6_
;

59 
fd
 = 
	`İ’_sock‘
 (
AF_INET
, 
SOCK_DGRAM
, 0);

60 
	`”ºo_as£¹
 (
fd
 != -1);

63 
liâum
 
iâ
;

64 
iâ
.
liâ_çmy
 = 
AF_INET
;

65 
iâ
.
liâ_æags
 = 0;

66 
rc
 = 
	`ioùl
 (
fd
, 
SIOCGLIFNUM
, (*è&
iâ
);

67 
	`”ºo_as£¹
 (
rc
 != -1);

70 
size_t
 
iä_size
 =  (
liäeq
è* 
iâ
.
liâ_couÁ
;

71 *
iä
 = (*è
	`m®loc
 (
iä_size
);

72 
	`®loc_as£¹
 (
iä
);

75 
lifcÚf
 
ifc
;

76 
ifc
.
lifc_çmy
 = 
AF_INET
;

77 
ifc
.
lifc_æags
 = 0;

78 
ifc
.
lifc_Ën
 = 
iä_size
;

79 
ifc
.
lifc_buf
 = 
iä
;

80 
rc
 = 
	`ioùl
 (
fd
, 
SIOCGLIFCONF
, (*è&
ifc
);

81 
	`”ºo_as£¹
 (
rc
 != -1);

84 
boŞ
 
found
 = 
çl£
;

85 
liäeq
 *
iäp
 = 
ifc
.
lifc_»q
;

86 
n
 = 0;‚ < (è(
ifc
.
lifc_Ën
 /  (
liäeq
));

87 
n
 ++, 
iäp
 ++) {

88 ià(!
	`¡rcmp
 (
nic_
, 
iäp
->
liä_Çme
)) {

89 
rc
 = 
	`ioùl
 (
fd
, 
SIOCGLIFADDR
, (*è
iäp
);

90 
	`”ºo_as£¹
 (
rc
 != -1);

91 ià(
iäp
->
liä_addr
.
ss_çmy
 =ğ
AF_INET
) {

92 
add»ss
.
v4
 = *(
sockaddr_š
*è&
iäp
->
liä_addr
;

93 
found
 = 
Œue
;

100 
	`ä“
 (
iä
);

101 
	`şo£
 (
fd
);

103 ià(!
found
) {

104 
”ºo
 = 
ENODEV
;

108 
	}
}

110 #–ià
defšed
 
ZMQ_HAVE_AIX
 || defšed 
ZMQ_HAVE_HPUX
 || defšed 
ZMQ_HAVE_ANDROID


112 
	~<sys/ty³s.h
>

113 
	~<uni¡d.h
>

114 
	~<sys/ioùl.h
>

115 
	~<Ãt/if.h
>

117 
	gzmq
::
tı_add»ss_t
::
	$»sŞve_nic_Çme
 (cÚ¡ *
nic_
, 
boŞ
 
v6_
)

120 (è
v6_
;

123 
sd
 = 
	`İ’_sock‘
 (
AF_INET
, 
SOCK_DGRAM
, 0);

124 
	`”ºo_as£¹
 (
sd
 != -1);

126 
iäeq
 
iä
;

129 
	`¡ºıy
 (
iä
.
iä_Çme
, 
nic_
,  (ifr.ifr_name));

132 
rc
 = 
	`ioùl
 (
sd
, 
SIOCGIFADDR
, (
ÿddr_t
è&
iä
,  (
iäeq
));

135 
	`şo£
 (
sd
);

137 ià(
rc
 == -1) {

138 
”ºo
 = 
ENODEV
;

141 
	`memıy
 (&
add»ss
.
v4
.
sš_addr
, &((
sockaddr_š
*è&
iä
.
iä_addr
)->sin_addr,

142  (
š_addr
));

145 
	}
}

147 #–ià((
defšed
 
ZMQ_HAVE_LINUX
 || defšed 
ZMQ_HAVE_FREEBSD
 ||\

148 
defšed
 
	gZMQ_HAVE_OSX
 || defšed 
	gZMQ_HAVE_OPENBSD
 ||\

149 
defšed
 
	gZMQ_HAVE_QNXNTO
 || defšed 
	gZMQ_HAVE_NETBSD
)\

150 && 
defšed
 
	gZMQ_HAVE_IFADDRS
)

152 
	~<içddrs.h
>

156 
	gzmq
::
tı_add»ss_t
::
	$»sŞve_nic_Çme
 (cÚ¡ *
nic_
, 
boŞ
 
v6_
)

159 
içddrs
 *
iç
 = 
NULL
;

160 
rc
 = 
	`g‘içddrs
 (&
iç
);

161 
	`”ºo_as£¹
 (
rc
 == 0);

162 
	`zmq_as£¹
 (
iç
 !ğ
NULL
);

165 
boŞ
 
found
 = 
çl£
;

166 
içddrs
 *
iå
 = 
iç
; iå !ğ
NULL
 ;iå = iå->
iç_Ãxt
)

168 ià(
iå
->
iç_addr
 =ğ
NULL
)

171 
çmy
 = 
iå
->
iç_addr
->
§_çmy
;

172 ià((
çmy
 =ğ
AF_INET
 || (
v6_
 && famy =ğ
AF_INET6
))

173 && !
	`¡rcmp
 (
nic_
, 
iå
->
iç_Çme
)) {

174 
	`memıy
 (&
add»ss
, 
iå
->
iç_addr
,

175 (
çmy
 =ğ
AF_INET
è?  (
sockaddr_š
)

176 :  (
sockaddr_š6
));

177 
found
 = 
Œue
;

183 
	`ä“içddrs
 (
iç
);

185 ià(!
found
) {

186 
”ºo
 = 
ENODEV
;

190 
	}
}

196 
	gzmq
::
tı_add»ss_t
::
	$»sŞve_nic_Çme
 (cÚ¡ *
nic_
, 
boŞ
 
v6_
)

199 (è
nic_
;

200 (è
v6_
;

202 
”ºo
 = 
ENODEV
;

204 
	}
}

208 
	gzmq
::
tı_add»ss_t
::
	$»sŞve_š‹rçû
 (cÚ¡ *
š‹rçû_
, 
boŞ
 
v6_
)

211 
sockaddr_¡Üage
 
ss
;

212 
sockaddr
 *
out_addr
 = (sockaddr*è&
ss
;

213 
size_t
 
out_add¾’
;

217 ià(
v6_
) {

218 
sockaddr_š6
 
6_addr
;

219 
	`mem£t
 (&
6_addr
, 0,  (ip6_addr));

220 
6_addr
.
sš6_çmy
 = 
AF_INET6
;

221 
	`memıy
 (&
6_addr
.
sš6_addr
, &
š6addr_ªy
,  (in6addr_any));

222 
out_add¾’
 =  
6_addr
;

223 
	`memıy
 (
out_addr
, &
6_addr
, 
out_add¾’
);

226 
sockaddr_š
 
4_addr
;

227 
	`mem£t
 (&
4_addr
, 0,  (ip4_addr));

228 
4_addr
.
sš_çmy
 = 
AF_INET
;

229 
4_addr
.
sš_addr
.
s_addr
 = 
	`htÚl
 (
INADDR_ANY
);

230 
out_add¾’
 =  
4_addr
;

231 
	`memıy
 (
out_addr
, &
4_addr
, 
out_add¾’
);

234 ià(
	`¡rcmp
 (
š‹rçû_
, "*") == 0) {

235 
	`zmq_as£¹
 (
out_add¾’
 <ğ 
add»ss
);

236 
	`memıy
 (&
add»ss
, 
out_addr
, 
out_add¾’
);

241 
rc
 = 
	`»sŞve_nic_Çme
 (
š‹rçû_
, 
v6_
);

242 ià(
rc
 !ğ0 && 
”ºo
 !ğ
ENODEV
)

243  
rc
;

244 ià(
rc
 == 0)

248 #ià
defšed
 
ZMQ_HAVE_OPENVMS
 && defšed 
__Ÿ64


249 
__addršfo64
 *
»s
 = 
NULL
;

250 
__addršfo64
 
»q
;

252 
addršfo
 *
»s
 = 
NULL
;

253 
addršfo
 
»q
;

255 
	`mem£t
 (&
»q
, 0,  (req));

259 
»q
.
ai_çmy
 = 
v6_
? 
AF_INET6
: 
AF_INET
;

262 
»q
.
ai_sockty³
 = 
SOCK_STREAM
;

266 
»q
.
ai_æags
 = 
AI_PASSIVE
 | 
AI_NUMERICHOST
;

268 #ià
defšed
 
AI_V4MAPPED
 && !defšed 
ZMQ_HAVE_FREEBSD


274 ià(
»q
.
ai_çmy
 =ğ
AF_INET6
)

275 
»q
.
ai_æags
 |ğ
AI_V4MAPPED
;

280 
rc
 = 
	`g‘addršfo
 (
š‹rçû_
, 
NULL
, &
»q
, &
»s
);

281 ià(
rc
) {

282 
”ºo
 = 
ENODEV
;

287 
	`zmq_as£¹
 (
»s
 !ğ
NULL
);

288 
	`zmq_as£¹
 ((
size_t
è(
»s
->
ai_add¾’
è<ğ (
add»ss
));

289 
	`memıy
 (&
add»ss
, 
»s
->
ai_addr
,„es->
ai_add¾’
);

292 
	`ä“addršfo
 (
»s
);

295 
	}
}

297 
	gzmq
::
tı_add»ss_t
::
	$»sŞve_ho¡Çme
 (cÚ¡ *
ho¡Çme_
, 
boŞ
 
v6_
)

300 #ià
defšed
 
ZMQ_HAVE_OPENVMS
 && defšed 
__Ÿ64
 && 
__INITIAL_POINTER_SIZE
 == 64

301 
__addršfo64
 
»q
;

303 
addršfo
 
»q
;

305 
	`mem£t
 (&
»q
, 0,  (req));

309 
»q
.
ai_çmy
 = 
v6_
? 
AF_INET6
: 
AF_INET
;

313 
»q
.
ai_sockty³
 = 
SOCK_STREAM
;

315 #ià
defšed
 
AI_V4MAPPED
 && !defšed 
ZMQ_HAVE_FREEBSD


321 ià(
»q
.
ai_çmy
 =ğ
AF_INET6
)

322 
»q
.
ai_æags
 |ğ
AI_V4MAPPED
;

327 #ià
defšed
 
ZMQ_HAVE_OPENVMS
 && defšed 
__Ÿ64
 && 
__INITIAL_POINTER_SIZE
 == 64

328 
__addršfo64
 *
»s
;

330 
addršfo
 *
»s
;

332 
rc
 = 
	`g‘addršfo
 (
ho¡Çme_
, 
NULL
, &
»q
, &
»s
);

333 ià(
rc
) {

334 
rc
) {

335 
EAI_MEMORY
:

336 
”ºo
 = 
ENOMEM
;

339 
”ºo
 = 
EINVAL
;

346 
	`zmq_as£¹
 ((
size_t
è(
»s
->
ai_add¾’
è<ğ (
add»ss
));

347 
	`memıy
 (&
add»ss
, 
»s
->
ai_addr
,„es->
ai_add¾’
);

349 
	`ä“addršfo
 (
»s
);

352 
	}
}

354 
	gzmq
::
tı_add»ss_t
::
	$tı_add»ss_t
 ()

356 
	`mem£t
 (&
add»ss
, 0,  (address));

357 
	}
}

359 
	gzmq
::
tı_add»ss_t
::
	$tı_add»ss_t
 (cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§_Ën
)

361 
	`zmq_as£¹
(
§
 && 
§_Ën
 > 0);

363 
	`mem£t
 (&
add»ss
, 0,  (address));

364 ià(
§
->
§_çmy
 =ğ
AF_INET
 && 
§_Ën
 >ğ(
sockËn_t
è (
add»ss
.
v4
))

365 
	`memıy
(&
add»ss
.
v4
, 
§
,  (address.ipv4));

367 ià(
§
->
§_çmy
 =ğ
AF_INET6
 && 
§_Ën
 >ğ(
sockËn_t
è (
add»ss
.
v6
))

368 
	`memıy
(&
add»ss
.
v6
, 
§
,  (address.ipv6));

369 
	}
}

371 
	gzmq
::
tı_add»ss_t
::~
	$tı_add»ss_t
 ()

373 
	}
}

375 
zmq
::
tı_add»ss_t
::
	$»sŞve
 (cÚ¡ *
Çme_
, 
boŞ
 
loÿl_
, boŞ 
v6_
)

378 cÚ¡ *
d–im™”
 = 
	`¡¼chr
 (
Çme_
, ':');

379 ià(!
d–im™”
) {

380 
”ºo
 = 
EINVAL
;

384 
¡d
::
¡ršg
 
	`addr_¡r
 (
Çme_
, 
d–im™”
 -‚ame_);

385 
¡d
::
¡ršg
 
	`pÜt_¡r
 (
d–im™”
 + 1);

388 ià(
addr_¡r
.
	`size
 () >= 2 &&‡ddr_str [0] == '[' &&

389 
addr_¡r
 [addr_¡r.
	`size
 () - 1] == ']')

390 
addr_¡r
 =‡ddr_¡r.
	`sub¡r
 (1,‡ddr_¡r.
	`size
 () - 2);

393 
ušt16_t
 
pÜt
;

394 ià(
pÜt_¡r
 == "*" ||…ort_str == "0")

396 
pÜt
 = 0;

399 
pÜt
 = (
ušt16_t
è
	`©oi
 (
pÜt_¡r
.
	`c_¡r
 ());

400 ià(
pÜt
 == 0) {

401 
”ºo
 = 
EINVAL
;

407 
rc
;

408 ià(
loÿl_
)

409 
rc
 = 
	`»sŞve_š‹rçû
 (
addr_¡r
.
	`c_¡r
 (), 
v6_
);

411 
rc
 = 
	`»sŞve_ho¡Çme
 (
addr_¡r
.
	`c_¡r
 (), 
v6_
);

412 ià(
rc
 != 0)

416 ià(
add»ss
.
g’”ic
.
§_çmy
 =ğ
AF_INET6
)

417 
add»ss
.
v6
.
sš6_pÜt
 = 
	`htÚs
 (
pÜt
);

419 
add»ss
.
v4
.
sš_pÜt
 = 
	`htÚs
 (
pÜt
);

422 
	}
}

424 
	gzmq
::
tı_add»ss_t
::
	$to_¡ršg
 (
¡d
::
¡ršg
 &
addr_
)

426 ià(
add»ss
.
g’”ic
.
§_çmy
 !ğ
AF_INET


427 && 
add»ss
.
g’”ic
.
§_çmy
 !ğ
AF_INET6
) {

428 
addr_
.
	`ş—r
 ();

433 
hbuf
[
NI_MAXHOST
];

434 
rc
 = 
	`g‘Çmešfo
 (
	`addr
 (), 
	`add¾’
 (), 
hbuf
,  (hbuf), 
NULL
, 0, 
NI_NUMERICHOST
);

435 ià(
rc
 != 0) {

436 
addr_
.
	`ş—r
 ();

437  
rc
;

440 ià(
add»ss
.
g’”ic
.
§_çmy
 =ğ
AF_INET6
) {

441 
¡d
::
¡ršg¡»am
 
s
;

442 
s
 << "tı://[" << 
hbuf
 << "]:" << 
	`Áohs
 (
add»ss
.
v6
.
sš6_pÜt
);

443 
addr_
 = 
s
.
	`¡r
 ();

446 
¡d
::
¡ršg¡»am
 
s
;

447 
s
 << "tı://" << 
hbuf
 << ":" << 
	`Áohs
 (
add»ss
.
v4
.
sš_pÜt
);

448 
addr_
 = 
s
.
	`¡r
 ();

451 
	}
}

453 cÚ¡ 
sockaddr
 *
	gzmq
::
tı_add»ss_t
::
	$addr
 () const

455  &
add»ss
.
g’”ic
;

456 
	}
}

458 
sockËn_t
 
	gzmq
::
tı_add»ss_t
::
	$add¾’
 () const

460 ià(
add»ss
.
g’”ic
.
§_çmy
 =ğ
AF_INET6
)

461  (
sockËn_t
è (
add»ss
.
v6
);

463  (
sockËn_t
è (
add»ss
.
v4
);

464 
	}
}

466 #ià
defšed
 
ZMQ_HAVE_WINDOWS


467 
	gzmq
::
tı_add»ss_t
::
	$çmy
 () const

469 
§_çmy_t
 
zmq
::
tı_add»ss_t
::
	$çmy
 () const

472  
add»ss
.
g’”ic
.
§_çmy
;

473 
	}
}

475 
	gzmq
::
tı_add»ss_mask_t
::
	$tı_add»ss_mask_t
 () :

476 
	$tı_add»ss_t
 ()

478 
add»ss_mask
 = -1;

479 
	}
}

481 
	gzmq
::
tı_add»ss_mask_t
::
	$mask
 () const

483  
add»ss_mask
;

484 
	}
}

486 
	gzmq
::
tı_add»ss_mask_t
::
	$»sŞve
 (cÚ¡ *
Çme_
, 
boŞ
 
v6_
)

490 
¡d
::
¡ršg
 
addr_¡r
, 
mask_¡r
;

491 cÚ¡ *
d–im™”
 = 
	`¡¼chr
 (
Çme_
, '/');

492 ià(
d–im™”
 !ğ
NULL
) {

493 
addr_¡r
.
	`assign
 (
Çme_
, 
d–im™”
 -‚ame_);

494 
mask_¡r
.
	`assign
 (
d–im™”
 + 1);

495 ià(
mask_¡r
.
	`em±y
 ()) {

496 
”ºo
 = 
EINVAL
;

501 
addr_¡r
.
	`assign
 (
Çme_
);

504 
rc
 = 
tı_add»ss_t
::
	`»sŞve_ho¡Çme
 (
addr_¡r
.
	`c_¡r
 (), 
v6_
);

505 ià(
rc
 != 0)

506  
rc
;

509 ià(
mask_¡r
.
	`em±y
 ()) {

510 ià(
add»ss
.
g’”ic
.
§_çmy
 =ğ
AF_INET6
)

511 
add»ss_mask
 = 128;

513 
add»ss_mask
 = 32;

516 ià(
mask_¡r
 == "0") {

517 
add»ss_mask
 = 0;

520 
mask
 = 
	`©oi
 (
mask_¡r
.
	`c_¡r
 ());

522 (
mask
 < 1) ||

523 (
add»ss
.
g’”ic
.
§_çmy
 =ğ
AF_INET6
 && 
mask
 > 128) ||

524 (
add»ss
.
g’”ic
.
§_çmy
 !ğ
AF_INET6
 && 
mask
 > 32)

526 
”ºo
 = 
EINVAL
;

529 
add»ss_mask
 = 
mask
;

533 
	}
}

535 
	gzmq
::
tı_add»ss_mask_t
::
	$to_¡ršg
 (
¡d
::
¡ršg
 &
addr_
)

537 ià(
add»ss
.
g’”ic
.
§_çmy
 !ğ
AF_INET
 &&‡dd»ss.g’”ic.§_çmy !ğ
AF_INET6
) {

538 
addr_
.
	`ş—r
 ();

541 ià(
add»ss_mask
 == -1) {

542 
addr_
.
	`ş—r
 ();

546 
hbuf
[
NI_MAXHOST
];

547 
rc
 = 
	`g‘Çmešfo
 (
	`addr
 (), 
	`add¾’
 (), 
hbuf
,  (hbuf), 
NULL
, 0, 
NI_NUMERICHOST
);

548 ià(
rc
 != 0) {

549 
addr_
.
	`ş—r
 ();

550  
rc
;

553 ià(
add»ss
.
g’”ic
.
§_çmy
 =ğ
AF_INET6
) {

554 
¡d
::
¡ršg¡»am
 
s
;

555 
s
 << "[" << 
hbuf
 << "]/" << 
add»ss_mask
;

556 
addr_
 = 
s
.
	`¡r
 ();

559 
¡d
::
¡ršg¡»am
 
s
;

560 
s
 << 
hbuf
 << "/" << 
add»ss_mask
;

561 
addr_
 = 
s
.
	`¡r
 ();

564 
	}
}

566 
boŞ
 
	gzmq
::
tı_add»ss_mask_t
::
	$m©ch_add»ss
 (cÚ¡ 
sockaddr
 *
ss
, cÚ¡ 
sockËn_t
 
ss_Ën
) const

568 
	`zmq_as£¹
 (
add»ss_mask
 !ğ-1 && 
ss
 !ğ
NULL
 && 
ss_Ën
 >ğ(
sockËn_t
è (
sockaddr
));

570 ià(
ss
->
§_çmy
 !ğ
add»ss
.
g’”ic
.sa_family)

571  
çl£
;

573 ià(
add»ss_mask
 > 0) {

574 
mask
;

575 cÚ¡ 
ušt8_t
 *
our_by‹s
, *
theœ_by‹s
;

576 ià(
ss
->
§_çmy
 =ğ
AF_INET6
) {

577 
	`zmq_as£¹
 (
ss_Ën
 =ğ (
sockaddr_š6
));

578 
theœ_by‹s
 = (cÚ¡ 
ušt8_t
 *è&(((cÚ¡ 
sockaddr_š6
 *è
ss
)->
sš6_addr
);

579 
our_by‹s
 = (cÚ¡ 
ušt8_t
 *è&
add»ss
.
v6
.
sš6_addr
;

580 
mask
 =  (
š6_addr
) * 8;

583 
	`zmq_as£¹
 (
ss_Ën
 =ğ (
sockaddr_š
));

584 
theœ_by‹s
 = (cÚ¡ 
ušt8_t
 *è&(((cÚ¡ 
sockaddr_š
 *è
ss
)->
sš_addr
);

585 
our_by‹s
 = (cÚ¡ 
ušt8_t
 *è&
add»ss
.
v4
.
sš_addr
;

586 
mask
 =  (
š_addr
) * 8;

588 ià(
add»ss_mask
 < 
mask
) mask =‡ddress_mask;

590 
size_t
 
fuÎ_by‹s
 = 
mask
 / 8;

591 ià(
	`memcmp
(
our_by‹s
, 
theœ_by‹s
, 
fuÎ_by‹s
))

592  
çl£
;

594 
ušt8_t
 
Ï¡_by‹_b™s
 = (0xffU << (8 - (
mask
 % 8))) & 0xffU;

595 ià(
Ï¡_by‹_b™s
) {

596 ià((
theœ_by‹s
[
fuÎ_by‹s
] & 
Ï¡_by‹_b™s
è!ğ(
our_by‹s
[full_bytes] &†ast_byte_bits))

597  
çl£
;

601  
Œue
;

602 
	}
}

	@tcp_address.hpp

20 #iâdeà
__ZMQ_TCP_ADDRESS_HPP_INCLUDED__


21 
	#__ZMQ_TCP_ADDRESS_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ià
defšed
 
ZMQ_HAVE_WINDOWS


26 
	~"wšdows.hµ
"

28 
	~<sys/sock‘.h
>

29 
	~<Ãtš‘/š.h
>

32 
Çme¥aû
 
	gzmq


35 şas 
	ctı_add»ss_t


37 
	gpublic
:

39 
tı_add»ss_t
 ();

40 
tı_add»ss_t
 (cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§_Ën
);

41 
	gvœtu®
 ~
tı_add»ss_t
 ();

47 
»sŞve
 (cÚ¡ *
Çme_
, 
boŞ
 
loÿl_
, boŞ 
v6_
);

50 
vœtu®
 
to_¡ršg
 (
¡d
::
¡ršg
 &
addr_
);

52 #ià
defšed
 
ZMQ_HAVE_WINDOWS


53 
çmy
 () const;

55 
§_çmy_t
 
çmy
 () const;

57 cÚ¡ 
sockaddr
 *
addr
 () const;

58 
sockËn_t
 
add¾’
 () const;

60 
	g´Ùeùed
:

61 
»sŞve_nic_Çme
 (cÚ¡ *
nic_
, 
boŞ
 
v6_
);

62 
»sŞve_š‹rçû
 (cÚ¡ *
š‹rçû_
, 
boŞ
 
v6_
);

63 
»sŞve_ho¡Çme
 (cÚ¡ *
ho¡Çme_
, 
boŞ
 
v6_
);

66 
sockaddr
 
	gg’”ic
;

67 
sockaddr_š
 
	gv4
;

68 
sockaddr_š6
 
	gv6
;

69 } 
	gadd»ss
;

72 şas 
	ctı_add»ss_mask_t
 : 
public
 
tı_add»ss_t


74 
public
:

75 
tı_add»ss_mask_t
 ();

80 
»sŞve
 (cÚ¡ *
Çme_
, 
boŞ
 
v6_
);

83 
to_¡ršg
 (
¡d
::
¡ršg
 &
addr_
);

85 
mask
 () const;

87 
boŞ
 
m©ch_add»ss
 (cÚ¡ 
sockaddr
 *
ss
, cÚ¡ 
sockËn_t
 
ss_Ën
) const;

89 
	g´iv©e
:

90 
add»ss_mask
;

	@tcp_connecter.cpp

20 
	~<Ãw
>

21 
	~<¡ršg
>

23 
	~"tı_cÚÃù”.hµ
"

24 
	~"¡»am_’gše.hµ
"

25 
	~"io_th»ad.hµ
"

26 
	~"¶©fÜm.hµ
"

27 
	~"¿ndom.hµ
"

28 
	~"”r.hµ
"

29 
	~".hµ
"

30 
	~"tı.hµ
"

31 
	~"add»ss.hµ
"

32 
	~"tı_add»ss.hµ
"

33 
	~"£ssiÚ_ba£.hµ
"

35 #ià
defšed
 
ZMQ_HAVE_WINDOWS


36 
	~"wšdows.hµ
"

38 
	~<uni¡d.h
>

39 
	~<sys/ty³s.h
>

40 
	~<sys/sock‘.h
>

41 
	~<¬·/š‘.h
>

42 
	~<Ãtš‘/tı.h
>

43 
	~<Ãtš‘/š.h
>

44 
	~<Ãtdb.h
>

45 
	~<fú.h
>

46 #ifdeà
ZMQ_HAVE_OPENVMS


47 
	~<ioùl.h
>

51 
	gzmq
::
tı_cÚÃù”_t
::
	$tı_cÚÃù”_t
 (
şass
 
io_th»ad_t
 *
io_th»ad_
,

52 
şass
 
£ssiÚ_ba£_t
 *
£ssiÚ_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

53 cÚ¡ 
add»ss_t
 *
addr_
, 
boŞ
 
d–ayed_¡¬t_
) :

54 
	`own_t
 (
io_th»ad_
, 
İtiÚs_
),

55 
	`io_objeù_t
 (
io_th»ad_
),

56 
	`addr
 (
addr_
),

57 
	`s
 (
»tœed_fd
),

58 
	`hªdË_v®id
 (
çl£
),

59 
	`d–ayed_¡¬t
 (
d–ayed_¡¬t_
),

60 
	`tim”_¡¬‹d
 (
çl£
),

61 
	`£ssiÚ
 (
£ssiÚ_
),

62 
	$cu¼’t_»cÚÃù_ivl
(
İtiÚs
.
»cÚÃù_ivl
)

64 
	`zmq_as£¹
 (
addr
);

65 
	`zmq_as£¹
 (
addr
->
´ÙocŞ
 == "tcp");

66 
addr
->
	`to_¡ršg
 (
’dpošt
);

67 
sock‘
 = 
£ssiÚ
-> 
	`g‘_sock‘
();

68 
	}
}

70 
	gzmq
::
tı_cÚÃù”_t
::~
	$tı_cÚÃù”_t
 ()

72 
	`zmq_as£¹
 (!
tim”_¡¬‹d
);

73 
	`zmq_as£¹
 (!
hªdË_v®id
);

74 
	`zmq_as£¹
 (
s
 =ğ
»tœed_fd
);

75 
	}
}

77 
	gzmq
::
tı_cÚÃù”_t
::
	$´oûss_¶ug
 ()

79 ià(
d–ayed_¡¬t
)

80 
	`add_»cÚÃù_tim”
 ();

82 
	`¡¬t_cÚÃùšg
 ();

83 
	}
}

85 
	gzmq
::
tı_cÚÃù”_t
::
	$´oûss_‹rm
 (
lšg”_
)

87 ià(
tim”_¡¬‹d
) {

88 
	`ÿnûl_tim”
 (
»cÚÃù_tim”_id
);

89 
tim”_¡¬‹d
 = 
çl£
;

92 ià(
hªdË_v®id
) {

93 
	`rm_fd
 (
hªdË
);

94 
hªdË_v®id
 = 
çl£
;

97 ià(
s
 !ğ
»tœed_fd
)

98 
	`şo£
 ();

100 
own_t
::
	`´oûss_‹rm
 (
lšg”_
);

101 
	}
}

103 
	gzmq
::
tı_cÚÃù”_t
::
	$š_ev’t
 ()

108 
	`out_ev’t
 ();

109 
	}
}

111 
	gzmq
::
tı_cÚÃù”_t
::
	$out_ev’t
 ()

113 
fd_t
 
fd
 = 
	`cÚÃù
 ();

114 
	`rm_fd
 (
hªdË
);

115 
hªdË_v®id
 = 
çl£
;

118 ià(
fd
 =ğ
»tœed_fd
) {

119 
	`şo£
 ();

120 
	`add_»cÚÃù_tim”
();

124 
	`tuÃ_tı_sock‘
 (
fd
);

125 
	`tuÃ_tı_k“·lives
 (
fd
, 
İtiÚs
.
tı_k“·live
, o±iÚs.
tı_k“·live_út
, o±iÚs.
tı_k“·live_idË
, o±iÚs.
tı_k“·live_štvl
);

128 
¡»am_’gše_t
 *
’gše
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

129 
	`¡»am_’gše_t
 (
fd
, 
İtiÚs
, 
’dpošt
);

130 
	`®loc_as£¹
 (
’gše
);

133 
	`£nd_©ch
 (
£ssiÚ
, 
’gše
);

136 
	`‹rmš©e
 ();

138 
sock‘
->
	`ev’t_cÚÃùed
 (
’dpošt
, 
fd
);

139 
	}
}

141 
	gzmq
::
tı_cÚÃù”_t
::
	$tim”_ev’t
 (
id_
)

143 
	`zmq_as£¹
 (
id_
 =ğ
»cÚÃù_tim”_id
);

144 
tim”_¡¬‹d
 = 
çl£
;

145 
	`¡¬t_cÚÃùšg
 ();

146 
	}
}

148 
	gzmq
::
tı_cÚÃù”_t
::
	$¡¬t_cÚÃùšg
 ()

151 
rc
 = 
	`İ’
 ();

154 ià(
rc
 == 0) {

155 
hªdË
 = 
	`add_fd
 (
s
);

156 
hªdË_v®id
 = 
Œue
;

157 
	`out_ev’t
 ();

162 ià(
rc
 =ğ-1 && 
”ºo
 =ğ
EINPROGRESS
) {

163 
hªdË
 = 
	`add_fd
 (
s
);

164 
hªdË_v®id
 = 
Œue
;

165 
	`£t_pŞlout
 (
hªdË
);

166 
sock‘
->
	`ev’t_cÚÃù_d–ayed
 (
’dpošt
, 
	`zmq_”ºo
());

171 ià(
s
 !ğ
»tœed_fd
)

172 
	`şo£
 ();

173 
	`add_»cÚÃù_tim”
 ();

175 
	}
}

177 
	gzmq
::
tı_cÚÃù”_t
::
	$add_»cÚÃù_tim”
()

179 
rc_ivl
 = 
	`g‘_Ãw_»cÚÃù_ivl
();

180 
	`add_tim”
 (
rc_ivl
, 
»cÚÃù_tim”_id
);

181 
sock‘
->
	`ev’t_cÚÃù_»Œ›d
 (
’dpošt
, 
rc_ivl
);

182 
tim”_¡¬‹d
 = 
Œue
;

183 
	}
}

185 
	gzmq
::
tı_cÚÃù”_t
::
	$g‘_Ãw_»cÚÃù_ivl
 ()

188 
this_š‹rv®
 = 
cu¼’t_»cÚÃù_ivl
 +

189 (
	`g’”©e_¿ndom
 (è% 
İtiÚs
.
»cÚÃù_ivl
);

193 ià(
İtiÚs
.
»cÚÃù_ivl_max
 > 0 &&

194 
İtiÚs
.
»cÚÃù_ivl_max
 > o±iÚs.
»cÚÃù_ivl
) {

197 
cu¼’t_»cÚÃù_ivl
 = current_reconnect_ivl * 2;

198 if(
cu¼’t_»cÚÃù_ivl
 >ğ
İtiÚs
.
»cÚÃù_ivl_max
) {

199 
cu¼’t_»cÚÃù_ivl
 = 
İtiÚs
.
»cÚÃù_ivl_max
;

202  
this_š‹rv®
;

203 
	}
}

205 
	gzmq
::
tı_cÚÃù”_t
::
	$İ’
 ()

207 
	`zmq_as£¹
 (
s
 =ğ
»tœed_fd
);

210 
s
 = 
	`İ’_sock‘
 (
addr
->
»sŞved
.
tı_addr
->
	`çmy
 (), 
SOCK_STREAM
, 
IPPROTO_TCP
);

211 #ifdeà
ZMQ_HAVE_WINDOWS


212 ià(
s
 =ğ
INVALID_SOCKET
) {

213 
”ºo
 = 
	`w§_”rÜ_to_”ºo
 (
	`WSAG‘La¡E¼Ü
 ());

217 ià(
s
 == -1)

223 ià(
addr
->
»sŞved
.
tı_addr
->
	`çmy
 (è=ğ
AF_INET6
)

224 
	`’abË_v4_m­pšg
 (
s
);

227 
	`unblock_sock‘
 (
s
);

230 ià(
İtiÚs
.
¢dbuf
 != 0)

231 
	`£t_tı_£nd_bufãr
 (
s
, 
İtiÚs
.
¢dbuf
);

232 ià(
İtiÚs
.
rcvbuf
 != 0)

233 
	`£t_tı_»ûive_bufãr
 (
s
, 
İtiÚs
.
rcvbuf
);

236 
rc
 = ::
	`cÚÃù
 (

237 
s
, 
addr
->
»sŞved
.
tı_addr
->
	`addr
 (),

238 
addr
->
»sŞved
.
tı_addr
->
	`add¾’
 ());

241 ià(
rc
 == 0)

246 #ifdeà
ZMQ_HAVE_WINDOWS


247 cÚ¡ 
”rÜ_code
 = 
	`WSAG‘La¡E¼Ü
 ();

248 ià(
”rÜ_code
 =ğ
WSAEINPROGRESS
 ||ƒ¼Ü_cod=ğ
WSAEWOULDBLOCK
)

249 
”ºo
 = 
EINPROGRESS
;

251 
”ºo
 = 
	`w§_”rÜ_to_”ºo
 (
”rÜ_code
);

253 ià(
”ºo
 =ğ
EINTR
)

254 
”ºo
 = 
EINPROGRESS
;

257 
	}
}

259 
	gzmq
::
fd_t
 
zmq
::
tı_cÚÃù”_t
::
	$cÚÃù
 ()

262 
”r
 = 0;

263 #ià
defšed
 
ZMQ_HAVE_HPUX


264 
Ën
 =  (
”r
);

266 
sockËn_t
 
Ën
 =  (
”r
);

269 
rc
 = 
	`g‘sockİt
 (
s
, 
SOL_SOCKET
, 
SO_ERROR
, (*è&
”r
, &
Ën
);

273 #ifdeà
ZMQ_HAVE_WINDOWS


274 
	`zmq_as£¹
 (
rc
 == 0);

275 ià(
”r
 != 0) {

276 ià(
”r
 =ğ
WSAECONNREFUSED
 ||

277 
”r
 =ğ
WSAETIMEDOUT
 ||

278 
”r
 =ğ
WSAECONNABORTED
 ||

279 
”r
 =ğ
WSAEHOSTUNREACH
 ||

280 
”r
 =ğ
WSAENETUNREACH
 ||

281 
”r
 =ğ
WSAENETDOWN
 ||

282 
”r
 =ğ
WSAEINVAL
)

283  
»tœed_fd
;

284 
	`w§_as£¹_no
 (
”r
);

290 ià(
rc
 == -1)

291 
”r
 = 
”ºo
;

292 ià(
”r
 != 0) {

293 
”ºo
 = 
”r
;

294 
	`”ºo_as£¹
 (

295 
”ºo
 =ğ
ECONNREFUSED
 ||

296 
”ºo
 =ğ
ECONNRESET
 ||

297 
”ºo
 =ğ
ETIMEDOUT
 ||

298 
”ºo
 =ğ
EHOSTUNREACH
 ||

299 
”ºo
 =ğ
ENETUNREACH
 ||

300 
”ºo
 =ğ
ENETDOWN
 ||

301 
”ºo
 =ğ
EINVAL
);

302  
»tœed_fd
;

307 
fd_t
 
»suÉ
 = 
s
;

308 
s
 = 
»tœed_fd
;

309  
»suÉ
;

310 
	}
}

312 
	gzmq
::
tı_cÚÃù”_t
::
	$şo£
 ()

314 
	`zmq_as£¹
 (
s
 !ğ
»tœed_fd
);

315 #ifdeà
ZMQ_HAVE_WINDOWS


316 
rc
 = 
	`şo£sock‘
 (
s
);

317 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

319 
rc
 = ::
	`şo£
 (
s
);

320 
	`”ºo_as£¹
 (
rc
 == 0);

322 
sock‘
->
	`ev’t_şo£d
 (
’dpošt
, 
s
);

323 
s
 = 
»tœed_fd
;

324 
	}
}

	@tcp_connecter.hpp

20 #iâdeà
__TCP_CONNECTER_HPP_INCLUDED__


21 
	#__TCP_CONNECTER_HPP_INCLUDED__


	)

23 
	~"fd.hµ
"

24 
	~"own.hµ
"

25 
	~"¡dšt.hµ
"

26 
	~"io_objeù.hµ
"

27 
	~"../šşude/zmq.h
"

29 
Çme¥aû
 
	gzmq


32 
şass
 
	gio_th»ad_t
;

33 
şass
 
	g£ssiÚ_ba£_t
;

34 
	gadd»ss_t
;

36 
şass
 
	gtı_cÚÃù”_t
 : 
public
 
own_t
,…ubliø
	gio_objeù_t


38 
	gpublic
:

42 
tı_cÚÃù”_t
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
,

43 
zmq
::
£ssiÚ_ba£_t
 *
£ssiÚ_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
,

44 cÚ¡ 
add»ss_t
 *
addr_
, 
boŞ
 
d–ayed_¡¬t_
);

45 ~
tı_cÚÃù”_t
 ();

47 
	g´iv©e
:

50 ’um {
»cÚÃù_tim”_id
 = 1};

53 
´oûss_¶ug
 ();

54 
´oûss_‹rm
 (
lšg”_
);

57 
š_ev’t
 ();

58 
out_ev’t
 ();

59 
tim”_ev’t
 (
id_
);

62 
¡¬t_cÚÃùšg
 ();

65 
add_»cÚÃù_tim”
();

70 
g‘_Ãw_»cÚÃù_ivl
 ();

75 
İ’
 ();

78 
şo£
 ();

82 
fd_t
 
cÚÃù
 ();

85 cÚ¡ 
add»ss_t
 *
	gaddr
;

88 
fd_t
 
	gs
;

91 
hªdË_t
 
	ghªdË
;

95 
boŞ
 
	ghªdË_v®id
;

98 cÚ¡ 
boŞ
 
	gd–ayed_¡¬t
;

101 
boŞ
 
	gtim”_¡¬‹d
;

104 
	gzmq
::
£ssiÚ_ba£_t
 *
£ssiÚ
;

107 
	gcu¼’t_»cÚÃù_ivl
;

110 
	g¡d
::
¡ršg
 
’dpošt
;

113 
	gzmq
::
sock‘_ba£_t
 *
sock‘
;

115 
tı_cÚÃù”_t
 (constcp_connecter_t&);

116 cÚ¡ 
	gtı_cÚÃù”_t
 &
	gİ”©Ü
 = (cÚ¡ 
tı_cÚÃù”_t
&);

	@tcp_listener.cpp

20 
	~<Ãw
>

22 
	~<¡ršg
>

24 
	~"¶©fÜm.hµ
"

25 
	~"tı_li¡’”.hµ
"

26 
	~"¡»am_’gše.hµ
"

27 
	~"io_th»ad.hµ
"

28 
	~"£ssiÚ_ba£.hµ
"

29 
	~"cÚfig.hµ
"

30 
	~"”r.hµ
"

31 
	~".hµ
"

32 
	~"tı.hµ
"

33 
	~"sock‘_ba£.hµ
"

35 #ifdeà
ZMQ_HAVE_WINDOWS


36 
	~"wšdows.hµ
"

38 
	~<uni¡d.h
>

39 
	~<sys/sock‘.h
>

40 
	~<¬·/š‘.h
>

41 
	~<Ãtš‘/tı.h
>

42 
	~<Ãtš‘/š.h
>

43 
	~<Ãtdb.h
>

44 
	~<fú.h
>

47 #ifdeà
ZMQ_HAVE_OPENVMS


48 
	~<ioùl.h
>

51 
	gzmq
::
tı_li¡’”_t
::
	$tı_li¡’”_t
 (
io_th»ad_t
 *
io_th»ad_
,

52 
sock‘_ba£_t
 *
sock‘_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
) :

53 
	`own_t
 (
io_th»ad_
, 
İtiÚs_
),

54 
	`io_objeù_t
 (
io_th»ad_
),

55 
	`s
 (
»tœed_fd
),

56 
	$sock‘
 (
sock‘_
)

58 
	}
}

60 
	gzmq
::
tı_li¡’”_t
::~
	$tı_li¡’”_t
 ()

62 
	`zmq_as£¹
 (
s
 =ğ
»tœed_fd
);

63 
	}
}

65 
	gzmq
::
tı_li¡’”_t
::
	$´oûss_¶ug
 ()

68 
hªdË
 = 
	`add_fd
 (
s
);

69 
	`£t_pŞlš
 (
hªdË
);

70 
	}
}

72 
	gzmq
::
tı_li¡’”_t
::
	$´oûss_‹rm
 (
lšg”_
)

74 
	`rm_fd
 (
hªdË
);

75 
	`şo£
 ();

76 
own_t
::
	`´oûss_‹rm
 (
lšg”_
);

77 
	}
}

79 
	gzmq
::
tı_li¡’”_t
::
	$š_ev’t
 ()

81 
fd_t
 
fd
 = 
	`acû±
 ();

85 ià(
fd
 =ğ
»tœed_fd
) {

86 
sock‘
->
	`ev’t_acû±_çed
 (
’dpošt
, 
	`zmq_”ºo
());

90 
	`tuÃ_tı_sock‘
 (
fd
);

91 
	`tuÃ_tı_k“·lives
 (
fd
, 
İtiÚs
.
tı_k“·live
, o±iÚs.
tı_k“·live_út
, o±iÚs.
tı_k“·live_idË
, o±iÚs.
tı_k“·live_štvl
);

94 
¡»am_’gše_t
 *
’gše
 = 
	`Ãw
 (
¡d
::
nÙhrow
)

95 
	`¡»am_’gše_t
 (
fd
, 
İtiÚs
, 
’dpošt
);

96 
	`®loc_as£¹
 (
’gše
);

100 
io_th»ad_t
 *
io_th»ad
 = 
	`choo£_io_th»ad
 (
İtiÚs
.
affš™y
);

101 
	`zmq_as£¹
 (
io_th»ad
);

104 
£ssiÚ_ba£_t
 *
£ssiÚ
 = sessiÚ_ba£_t::
	`ü—‹
 (
io_th»ad
, 
çl£
, 
sock‘
,

105 
İtiÚs
, 
NULL
);

106 
	`”ºo_as£¹
 (
£ssiÚ
);

107 
£ssiÚ
->
	`šc_£qnum
 ();

108 
	`Ïunch_chd
 (
£ssiÚ
);

109 
	`£nd_©ch
 (
£ssiÚ
, 
’gše
, 
çl£
);

110 
sock‘
->
	`ev’t_acû±ed
 (
’dpošt
, 
fd
);

111 
	}
}

113 
	gzmq
::
tı_li¡’”_t
::
	$şo£
 ()

115 
	`zmq_as£¹
 (
s
 !ğ
»tœed_fd
);

116 #ifdeà
ZMQ_HAVE_WINDOWS


117 
rc
 = 
	`şo£sock‘
 (
s
);

118 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

120 
rc
 = ::
	`şo£
 (
s
);

121 
	`”ºo_as£¹
 (
rc
 == 0);

123 
sock‘
->
	`ev’t_şo£d
 (
’dpošt
, 
s
);

124 
s
 = 
»tœed_fd
;

125 
	}
}

127 
	gzmq
::
tı_li¡’”_t
::
	$g‘_add»ss
 (
¡d
::
¡ršg
 &
addr_
)

130 
sockaddr_¡Üage
 
ss
;

131 #ifdeà
ZMQ_HAVE_HPUX


132 
¦
 =  (
ss
);

134 
sockËn_t
 
¦
 =  (
ss
);

136 
rc
 = 
	`g‘sockÇme
 (
s
, (
sockaddr
 *è&
ss
, &
¦
);

138 ià(
rc
 != 0) {

139 
addr_
.
	`ş—r
 ();

140  
rc
;

143 
tı_add»ss_t
 
	`addr
 ((
sockaddr
 *è&
ss
, 
¦
);

144  
addr
.
	`to_¡ršg
 (
addr_
);

145 
	}
}

147 
	gzmq
::
tı_li¡’”_t
::
	$£t_add»ss
 (cÚ¡ *
addr_
)

150 
rc
 = 
add»ss
.
	`»sŞve
 (
addr_
, 
Œue
, 
İtiÚs
.
v6
);

151 ià(
rc
 != 0)

155 
s
 = 
	`İ’_sock‘
 (
add»ss
.
	`çmy
 (), 
SOCK_STREAM
, 
IPPROTO_TCP
);

156 #ifdeà
ZMQ_HAVE_WINDOWS


157 ià(
s
 =ğ
INVALID_SOCKET
)

158 
”ºo
 = 
	`w§_”rÜ_to_”ºo
 (
	`WSAG‘La¡E¼Ü
 ());

162 ià(
add»ss
.
	`çmy
 (è=ğ
AF_INET6


163 && 
”ºo
 =ğ
EAFNOSUPPORT


164 && 
İtiÚs
.
v6
) {

165 
rc
 = 
add»ss
.
	`»sŞve
 (
addr_
, 
Œue
,rue);

166 ià(
rc
 != 0)

167  
rc
;

168 
s
 = ::
	`sock‘
 (
add»ss
.
	`çmy
 (), 
SOCK_STREAM
, 
IPPROTO_TCP
);

171 #ifdeà
ZMQ_HAVE_WINDOWS


172 ià(
s
 =ğ
INVALID_SOCKET
) {

173 
”ºo
 = 
	`w§_”rÜ_to_”ºo
 (
	`WSAG‘La¡E¼Ü
 ());

176 #ià!
defšed
 
_WIN32_WCE


178 
BOOL
 
brc
 = 
	`S‘HªdËInfÜm©iÚ
 ((
HANDLE
è
s
, 
HANDLE_FLAG_INHERIT
, 0);

179 
	`wš_as£¹
 (
brc
);

182 ià(
s
 == -1)

188 ià(
add»ss
.
	`çmy
 (è=ğ
AF_INET6
)

189 
	`’abË_v4_m­pšg
 (
s
);

192 ià(
İtiÚs
.
¢dbuf
 != 0)

193 
	`£t_tı_£nd_bufãr
 (
s
, 
İtiÚs
.
¢dbuf
);

194 ià(
İtiÚs
.
rcvbuf
 != 0)

195 
	`£t_tı_»ûive_bufãr
 (
s
, 
İtiÚs
.
rcvbuf
);

198 
æag
 = 1;

199 #ifdeà
ZMQ_HAVE_WINDOWS


200 
rc
 = 
	`£tsockİt
 (
s
, 
SOL_SOCKET
, 
SO_EXCLUSIVEADDRUSE
,

201 (cÚ¡ *è&
æag
,  ());

202 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

204 
rc
 = 
	`£tsockİt
 (
s
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
æag
,  ());

205 
	`”ºo_as£¹
 (
rc
 == 0);

208 
add»ss
.
	`to_¡ršg
 (
’dpošt
);

211 
rc
 = 
	`bšd
 (
s
, 
add»ss
.
	`addr
 (),‡dd»ss.
	`add¾’
 ());

212 #ifdeà
ZMQ_HAVE_WINDOWS


213 ià(
rc
 =ğ
SOCKET_ERROR
) {

214 
”ºo
 = 
	`w§_”rÜ_to_”ºo
 (
	`WSAG‘La¡E¼Ü
 ());

215 
”rÜ
;

218 ià(
rc
 != 0)

219 
”rÜ
;

223 
rc
 = 
	`li¡’
 (
s
, 
İtiÚs
.
backlog
);

224 #ifdeà
ZMQ_HAVE_WINDOWS


225 ià(
rc
 =ğ
SOCKET_ERROR
) {

226 
”ºo
 = 
	`w§_”rÜ_to_”ºo
 (
	`WSAG‘La¡E¼Ü
 ());

227 
”rÜ
;

230 ià(
rc
 != 0)

231 
”rÜ
;

234 
sock‘
->
	`ev’t_li¡’šg
 (
’dpošt
, 
s
);

237 
”rÜ
:

238 
”r
 = 
”ºo
;

239 
	`şo£
 ();

240 
”ºo
 = 
”r
;

242 
	}
}

244 
	gzmq
::
fd_t
 
zmq
::
tı_li¡’”_t
::
	$acû±
 ()

249 
	`zmq_as£¹
 (
s
 !ğ
»tœed_fd
);

251 
sockaddr_¡Üage
 
ss
;

252 
	`mem£t
 (&
ss
, 0,  (ss));

253 #ifdeà
ZMQ_HAVE_HPUX


254 
ss_Ën
 =  (
ss
);

256 
sockËn_t
 
ss_Ën
 =  (
ss
);

258 
fd_t
 
sock
 = ::
	`acû±
 (
s
, (
sockaddr
 *è&
ss
, &
ss_Ën
);

260 #ifdeà
ZMQ_HAVE_WINDOWS


261 ià(
sock
 =ğ
INVALID_SOCKET
) {

262 
	`w§_as£¹
 (
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAEWOULDBLOCK
 ||

263 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAECONNRESET
 ||

264 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAEMFILE
 ||

265 
	`WSAG‘La¡E¼Ü
 (è=ğ
WSAENOBUFS
);

266  
»tœed_fd
;

268 #ià!
defšed
 
_WIN32_WCE


270 
BOOL
 
brc
 = 
	`S‘HªdËInfÜm©iÚ
 ((
HANDLE
è
sock
, 
HANDLE_FLAG_INHERIT
, 0);

271 
	`wš_as£¹
 (
brc
);

274 ià(
sock
 == -1) {

275 
	`”ºo_as£¹
 (
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
EWOULDBLOCK
 ||

276 
”ºo
 =ğ
EINTR
 ||ƒ¼nØ=ğ
ECONNABORTED
 ||ƒ¼nØ=ğ
EPROTO
 ||

277 
”ºo
 =ğ
ENOBUFS
 ||ƒ¼nØ=ğ
ENOMEM
 ||ƒ¼nØ=ğ
EMFILE
 ||

278 
”ºo
 =ğ
ENFILE
);

279  
»tœed_fd
;

283 ià(!
İtiÚs
.
tı_acû±_f‹rs
.
	`em±y
 ()) {

284 
boŞ
 
m©ched
 = 
çl£
;

285 
İtiÚs_t
::
tı_acû±_f‹rs_t
::
size_ty³
 
i
 = 0; i !ğ
İtiÚs
.
tı_acû±_f‹rs
.
	`size
 (); ++i) {

286 ià(
İtiÚs
.
tı_acû±_f‹rs
[
i
].
	`m©ch_add»ss
 ((
sockaddr
 *è&
ss
, 
ss_Ën
)) {

287 
m©ched
 = 
Œue
;

291 ià(!
m©ched
) {

292 #ifdeà
ZMQ_HAVE_WINDOWS


293 
rc
 = 
	`şo£sock‘
 (
sock
);

294 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

296 
rc
 = ::
	`şo£
 (
sock
);

297 
	`”ºo_as£¹
 (
rc
 == 0);

299  
»tœed_fd
;

303  
sock
;

304 
	}
}

	@tcp_listener.hpp

20 #iâdeà
__ZMQ_TCP_LISTENER_HPP_INCLUDED__


21 
	#__ZMQ_TCP_LISTENER_HPP_INCLUDED__


	)

23 
	~"fd.hµ
"

24 
	~"own.hµ
"

25 
	~"¡dšt.hµ
"

26 
	~"io_objeù.hµ
"

27 
	~"tı_add»ss.hµ
"

28 
	~"../šşude/zmq.h
"

30 
Çme¥aû
 
	gzmq


33 
şass
 
	gio_th»ad_t
;

34 
şass
 
	gsock‘_ba£_t
;

36 
şass
 
	gtı_li¡’”_t
 : 
public
 
own_t
,…ubliø
	gio_objeù_t


38 
	gpublic
:

40 
tı_li¡’”_t
 (
zmq
::
io_th»ad_t
 *
io_th»ad_
,

41 
zmq
::
sock‘_ba£_t
 *
sock‘_
, cÚ¡ 
İtiÚs_t
 &
İtiÚs_
);

42 ~
tı_li¡’”_t
 ();

45 
£t_add»ss
 (cÚ¡ *
addr_
);

48 
g‘_add»ss
 (
¡d
::
¡ršg
 &
addr_
);

50 
	g´iv©e
:

53 
´oûss_¶ug
 ();

54 
´oûss_‹rm
 (
lšg”_
);

57 
š_ev’t
 ();

60 
şo£
 ();

66 
fd_t
 
acû±
 ();

69 
tı_add»ss_t
 
	gadd»ss
;

72 
fd_t
 
	gs
;

75 
hªdË_t
 
	ghªdË
;

78 
	gzmq
::
sock‘_ba£_t
 *
sock‘
;

81 
	g¡d
::
¡ršg
 
’dpošt
;

83 
tı_li¡’”_t
 (constcp_listener_t&);

84 cÚ¡ 
	gtı_li¡’”_t
 &
	gİ”©Ü
 = (cÚ¡ 
tı_li¡’”_t
&);

	@thread.cpp

20 
	~"th»ad.hµ
"

21 
	~"”r.hµ
"

22 
	~"¶©fÜm.hµ
"

24 #ifdeà
ZMQ_HAVE_WINDOWS


28 #ià
defšed
 
_WIN32_WCE


29 
DWORD
 
th»ad_routše
 (
LPVOID
 
¬g_
)

31 
__¡dÿÎ
 
th»ad_routše
 (*
¬g_
)

34 
zmq
::
th»ad_t
 *
£lf
 = (zmq::th»ad_t*è
¬g_
;

35 
£lf
->
tâ
 (£lf->
¬g
);

40 
zmq
::
th»ad_t
::
	$¡¬t
 (
th»ad_â
 *
tâ_
, *
¬g_
)

42 
tâ
 = 
tâ_
;

43 
¬g
 =
¬g_
;

44 #ià
defšed
 
_WIN32_WCE


45 
desütÜ
 = (
HANDLE
è
	`C»©eTh»ad
 (
NULL
, 0,

46 &::
th»ad_routše
, 
this
, 0 , 
NULL
);

48 
desütÜ
 = (
HANDLE
è
	`_begšth»adex
 (
NULL
, 0,

49 &::
th»ad_routše
, 
this
, 0 , 
NULL
);

51 
	`wš_as£¹
 (
desütÜ
 !ğ
NULL
);

52 
	}
}

54 
zmq
::
th»ad_t
::
	$¡İ
 ()

56 
DWORD
 
rc
 = 
	`Wa™FÜSšgËObjeù
 (
desütÜ
, 
INFINITE
);

57 
	`wš_as£¹
 (
rc
 !ğ
WAIT_FAILED
);

58 
BOOL
 
rc2
 = 
	`Clo£HªdË
 (
desütÜ
);

59 
	`wš_as£¹
 (
rc2
 != 0);

60 
	}
}

64 
	~<sigÇl.h
>

68 *
th»ad_routše
 (*
¬g_
)

70 #ià!
defšed
 
ZMQ_HAVE_OPENVMS
 && !defšed 
ZMQ_HAVE_ANDROID


73 
sig£t_t
 
sigÇl_£t
;

74 
rc
 = 
sigfl£t
 (&
sigÇl_£t
);

75 
”ºo_as£¹
 (
rc
 == 0);

76 
rc
 = 
±h»ad_sigmask
 (
SIG_BLOCK
, &
sigÇl_£t
, 
NULL
);

77 
posix_as£¹
 (
rc
);

80 
zmq
::
th»ad_t
 *
£lf
 = (zmq::th»ad_t*è
¬g_
;

81 
£lf
->
tâ
 (£lf->
¬g
);

82  
NULL
;

86 
zmq
::
th»ad_t
::
	$¡¬t
 (
th»ad_â
 *
tâ_
, *
¬g_
)

88 
tâ
 = 
tâ_
;

89 
¬g
 =
¬g_
;

90 
rc
 = 
	`±h»ad_ü—‹
 (&
desütÜ
, 
NULL
, 
th»ad_routše
, 
this
);

91 
	`posix_as£¹
 (
rc
);

92 
	}
}

94 
zmq
::
th»ad_t
::
	$¡İ
 ()

96 
rc
 = 
	`±h»ad_još
 (
desütÜ
, 
NULL
);

97 
	`posix_as£¹
 (
rc
);

98 
	}
}

	@thread.hpp

20 #iâdeà
__ZMQ_THREAD_HPP_INCLUDED__


21 
	#__ZMQ_THREAD_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

25 #ifdeà
ZMQ_HAVE_WINDOWS


26 
	~"wšdows.hµ
"

28 
	~<±h»ad.h
>

31 
Çme¥aû
 
	gzmq


34 (
	gth»ad_â
) (*);

43 şas 
	cth»ad_t


45 
	gpublic
:

47 
šlše
 
th»ad_t
 ()

53 
¡¬t
 (
th»ad_â
 *
tâ_
, *
¬g_
);

56 
¡İ
 ();

60 
th»ad_â
 *
	gtâ
;

61 *
	g¬g
;

63 
	g´iv©e
:

65 #ifdeà
ZMQ_HAVE_WINDOWS


66 
HANDLE
 
desütÜ
;

68 
±h»ad_t
 
	gdesütÜ
;

71 
th»ad_t
 (consthread_t&);

72 cÚ¡ 
	gth»ad_t
 &
	gİ”©Ü
 = (cÚ¡ 
th»ad_t
&);

	@trie.cpp

20 
	~<¡dlib.h
>

22 
	~<Ãw
>

23 
	~<®gÜ™hm
>

25 
	~"¶©fÜm.hµ
"

26 #ià
defšed
 
ZMQ_HAVE_WINDOWS


27 
	~"wšdows.hµ
"

30 
	~"”r.hµ
"

31 
	~"Œ›.hµ
"

33 
	gzmq
::
Œ›_t
::
	$Œ›_t
 () :

34 
	`»fút
 (0),

35 
	`mš
 (0),

36 
	`couÁ
 (0),

37 
	$live_nodes
 (0)

39 
	}
}

41 
	gzmq
::
Œ›_t
::~
	$Œ›_t
 ()

43 ià(
couÁ
 == 1) {

44 
	`zmq_as£¹
 (
Ãxt
.
node
);

45 
d–‘e
 
Ãxt
.
node
;

46 
Ãxt
.
node
 = 0;

49 ià(
couÁ
 > 1) {

50 
i
 = 0; i !ğ
couÁ
; ++i)

51 
d–‘e
 
Ãxt
.
bË
 [
i
];

52 
	`ä“
 (
Ãxt
.
bË
);

54 
	}
}

56 
boŞ
 
	gzmq
::
Œ›_t
::
	$add
 (*
´efix_
, 
size_t
 
size_
)

59 ià(!
size_
) {

60 ++
»fút
;

61  
»fút
 == 1;

64 
c
 = *
´efix_
;

65 ià(
c
 < 
mš
 || c >ğmš + 
couÁ
) {

69 ià(!
couÁ
) {

70 
mš
 = 
c
;

71 
couÁ
 = 1;

72 
Ãxt
.
node
 = 
NULL
;

75 ià(
couÁ
 == 1) {

76 
Şdc
 = 
mš
;

77 
Œ›_t
 *
Şdp
 = 
Ãxt
.
node
;

78 
couÁ
 = (
mš
 < 
c
 ? c - min : min - c) + 1;

79 
Ãxt
.
bË
 = (
Œ›_t
**)

80 
	`m®loc
 ( (
Œ›_t
*è* 
couÁ
);

81 
	`®loc_as£¹
 (
Ãxt
.
bË
);

82 
i
 = 0; i !ğ
couÁ
; ++i)

83 
Ãxt
.
bË
 [
i
] = 0;

84 
mš
 = 
¡d
::
	`mš
 (mš, 
c
);

85 
Ãxt
.
bË
 [
Şdc
 - 
mš
] = 
Şdp
;

88 ià(
mš
 < 
c
) {

90 
Şd_couÁ
 = 
couÁ
;

91 
couÁ
 = 
c
 - 
mš
 + 1;

92 
Ãxt
.
bË
 = (
Œ›_t
**è
	`»®loc
 ((*)‚ext.table,

93  (
Œ›_t
*è* 
couÁ
);

94 
	`zmq_as£¹
 (
Ãxt
.
bË
);

95 
i
 = 
Şd_couÁ
; i !ğ
couÁ
; i++)

96 
Ãxt
.
bË
 [
i
] = 
NULL
;

101 
Şd_couÁ
 = 
couÁ
;

102 
couÁ
 = (
mš
 + 
Şd_couÁ
è- 
c
;

103 
Ãxt
.
bË
 = (
Œ›_t
**è
	`»®loc
 ((*)‚ext.table,

104  (
Œ›_t
*è* 
couÁ
);

105 
	`zmq_as£¹
 (
Ãxt
.
bË
);

106 
	`memmove
 (
Ãxt
.
bË
 + 
mš
 - 
c
,‚ext.table,

107 
Şd_couÁ
 *  (
Œ›_t
*));

108 
i
 = 0; i !ğ
mš
 - 
c
; i++)

109 
Ãxt
.
bË
 [
i
] = 
NULL
;

110 
mš
 = 
c
;

115 ià(
couÁ
 == 1) {

116 ià(!
Ãxt
.
node
) {

117 
Ãxt
.
node
 = 
	`Ãw
 (
¡d
::
nÙhrow
è
Œ›_t
;

118 
	`®loc_as£¹
 (
Ãxt
.
node
);

119 ++
live_nodes
;

120 
	`zmq_as£¹
 (
live_nodes
 == 1);

122  
Ãxt
.
node
->
	`add
 (
´efix_
 + 1, 
size_
 - 1);

125 ià(!
Ãxt
.
bË
 [
c
 - 
mš
]) {

126 
Ãxt
.
bË
 [
c
 - 
mš
] = 
	`Ãw
 (
¡d
::
nÙhrow
è
Œ›_t
;

127 
	`®loc_as£¹
 (
Ãxt
.
bË
 [
c
 - 
mš
]);

128 ++
live_nodes
;

129 
	`zmq_as£¹
 (
live_nodes
 > 1);

131  
Ãxt
.
bË
 [
c
 - 
mš
]->
	`add
 (
´efix_
 + 1, 
size_
 - 1);

133 
	}
}

135 
boŞ
 
	gzmq
::
Œ›_t
::
	$rm
 (*
´efix_
, 
size_t
 
size_
)

138 ià(!
size_
) {

139 ià(!
»fút
)

140  
çl£
;

141 
»fút
--;

142  
»fút
 == 0;

144 
c
 = *
´efix_
;

145 ià(!
couÁ
 || 
c
 < 
mš
 || c >= min + count)

146  
çl£
;

148 
Œ›_t
 *
Ãxt_node
 =

149 
couÁ
 =ğ1 ? 
Ãxt
.
node
 :‚ext.
bË
 [
c
 - 
mš
];

151 ià(!
Ãxt_node
)

152  
çl£
;

154 
boŞ
 
»t
 = 
Ãxt_node
->
	`rm
 (
´efix_
 + 1, 
size_
 - 1);

157 ià(
Ãxt_node
->
	`is_»dundªt
 ()) {

158 
d–‘e
 
Ãxt_node
;

159 
	`zmq_as£¹
 (
couÁ
 > 0);

161 ià(
couÁ
 == 1) {

163 
Ãxt
.
node
 = 0;

164 
couÁ
 = 0;

165 --
live_nodes
;

166 
	`zmq_as£¹
 (
live_nodes
 == 0);

169 
Ãxt
.
bË
 [
c
 - 
mš
] = 0;

170 
	`zmq_as£¹
 (
live_nodes
 > 1);

171 --
live_nodes
;

174 ià(
live_nodes
 == 1) {

177 
Œ›_t
 *
node
 = 0;

181 ià(
c
 =ğ
mš
) {

184 
node
 = 
Ãxt
.
bË
 [
couÁ
 - 1];

185 
mš
 +ğ
couÁ
 - 1;

188 ià(
c
 =ğ
mš
 + 
couÁ
 - 1) {

191 
node
 = 
Ãxt
.
bË
 [0];

193 
	`zmq_as£¹
 (
node
);

194 
	`ä“
 (
Ãxt
.
bË
);

195 
Ãxt
.
node
 =‚ode;

196 
couÁ
 = 1;

199 ià(
c
 =ğ
mš
) {

203 
Ãw_mš
 = 
mš
;

204 
i
 = 1; i < 
couÁ
; ++i) {

205 ià(
Ãxt
.
bË
 [
i
]) {

206 
Ãw_mš
 = 
i
 + 
mš
;

210 
	`zmq_as£¹
 (
Ãw_mš
 !ğ
mš
);

212 
Œ›_t
 **
Şd_bË
 = 
Ãxt
.
bË
;

213 
	`zmq_as£¹
 (
Ãw_mš
 > 
mš
);

214 
	`zmq_as£¹
 (
couÁ
 > 
Ãw_mš
 - 
mš
);

216 
couÁ
 = couÁ - (
Ãw_mš
 - 
mš
);

217 
Ãxt
.
bË
 = (
Œ›_t
**è
	`m®loc
 ( (Œ›_t*è* 
couÁ
);

218 
	`®loc_as£¹
 (
Ãxt
.
bË
);

220 
	`memmove
 (
Ãxt
.
bË
, 
Şd_bË
 + (
Ãw_mš
 - 
mš
),

221  (
Œ›_t
*è* 
couÁ
);

222 
	`ä“
 (
Şd_bË
);

224 
mš
 = 
Ãw_mš
;

227 ià(
c
 =ğ
mš
 + 
couÁ
 - 1) {

231 
Ãw_couÁ
 = 
couÁ
;

232 
i
 = 1; i < 
couÁ
; ++i) {

233 ià(
Ãxt
.
bË
 [
couÁ
 - 1 - 
i
]) {

234 
Ãw_couÁ
 = 
couÁ
 - 
i
;

238 
	`zmq_as£¹
 (
Ãw_couÁ
 !ğ
couÁ
);

239 
couÁ
 = 
Ãw_couÁ
;

241 
Œ›_t
 **
Şd_bË
 = 
Ãxt
.
bË
;

242 
Ãxt
.
bË
 = (
Œ›_t
**è
	`m®loc
 ( (Œ›_t*è* 
couÁ
);

243 
	`®loc_as£¹
 (
Ãxt
.
bË
);

245 
	`memmove
 (
Ãxt
.
bË
, 
Şd_bË
,  (
Œ›_t
*è* 
couÁ
);

246 
	`ä“
 (
Şd_bË
);

250  
»t
;

251 
	}
}

253 
boŞ
 
	gzmq
::
Œ›_t
::
	$check
 (*
d©a_
, 
size_t
 
size_
)

257 
Œ›_t
 *
cu¼’t
 = 
this
;

258 
Œue
) {

261 ià(
cu¼’t
->
»fút
)

262  
Œue
;

265 ià(!
size_
)

266  
çl£
;

270 
c
 = *
d©a_
;

271 ià(
c
 < 
cu¼’t
->
mš
 || c >ğcu¼’t->mš + cu¼’t->
couÁ
)

272  
çl£
;

275 ià(
cu¼’t
->
couÁ
 == 1)

276 
cu¼’t
 = cu¼’t->
Ãxt
.
node
;

278 
cu¼’t
 = cu¼’t->
Ãxt
.
bË
 [
c
 - cu¼’t->
mš
];

279 ià(!
cu¼’t
)

280  
çl£
;

282 
d©a_
++;

283 
size_
--;

285 
	}
}

287 
	gzmq
::
Œ›_t
::
­¶y
 ((*
func_
è(*
d©a_
, 
size_t
 
size_
,

288 *
¬g_
), *arg_)

290 *
buff
 = 
NULL
;

291 
	`­¶y_h–³r
 (&
buff
, 0, 0, 
func_
, 
¬g_
);

292 
	`ä“
 (
buff
);

293 
	}
}

295 
	gzmq
::
Œ›_t
::
­¶y_h–³r
 (

296 **
buff_
, 
size_t
 
buffsize_
, size_ˆ
maxbuffsize_
,

297 (*
func_
è(*
d©a_
, 
size_t
 
size_
, *
¬g_
), *arg_)

300 ià(
»fút
)

301 
	`func_
 (*
buff_
, 
buffsize_
, 
¬g_
);

304 ià(
buffsize_
 >ğ
maxbuffsize_
) {

305 
maxbuffsize_
 = 
buffsize_
 + 256;

306 *
buff_
 = (*è
	`»®loc
 (*buff_, 
maxbuffsize_
);

307 
	`zmq_as£¹
 (*
buff_
);

311 ià(
couÁ
 == 0)

315 ià(
couÁ
 == 1) {

316 (*
buff_
è[
buffsize_
] = 
mš
;

317 
buffsize_
++;

318 
Ãxt
.
node
->
	`­¶y_h–³r
 (
buff_
, 
buffsize_
, 
maxbuffsize_
, 
func_
, 
¬g_
);

323 
c
 = 0; c !ğ
couÁ
; c++) {

324 (*
buff_
è[
buffsize_
] = 
mš
 + 
c
;

325 ià(
Ãxt
.
bË
 [
c
])

326 
Ãxt
.
bË
 [
c
]->
	`­¶y_h–³r
 (
buff_
, 
buffsize_
 + 1, 
maxbuffsize_
,

327 
func_
, 
¬g_
);

329 
	}
}

331 
boŞ
 
	gzmq
::
Œ›_t
::
	$is_»dundªt
 () const

333  
»fút
 =ğ0 && 
live_nodes
 == 0;

334 
	}
}

	@trie.hpp

20 #iâdeà
__ZMQ_TRIE_HPP_INCLUDED__


21 
	#__ZMQ_TRIE_HPP_INCLUDED__


	)

23 
	~<¡ddef.h
>

25 
	~"¡dšt.hµ
"

27 
Çme¥aû
 
	gzmq


30 şas 
	cŒ›_t


32 
	gpublic
:

34 
Œ›_t
 ();

35 ~
Œ›_t
 ();

39 
boŞ
 
add
 (*
´efix_
, 
size_t
 
size_
);

43 
boŞ
 
rm
 (*
´efix_
, 
size_t
 
size_
);

46 
boŞ
 
check
 (*
d©a_
, 
size_t
 
size_
);

49 
­¶y
 ((*
func_
è(*
d©a_
, 
size_t
 
size_
,

50 *
¬g_
), *arg_);

52 
	g´iv©e
:

54 
­¶y_h–³r
 (

55 **
buff_
, 
size_t
 
buffsize_
, size_ˆ
maxbuffsize_
,

56 (*
func_
è(*
d©a_
, 
size_t
 
size_
, *
¬g_
),

57 *
¬g_
);

58 
boŞ
 
is_»dundªt
 () const;

60 
ušt32_t
 
	g»fút
;

61 
	gmš
;

62 
	gcouÁ
;

63 
	glive_nodes
;

65 
şass
 
Œ›_t
 *
	gnode
;

66 
şass
 
Œ›_t
 **
	gbË
;

67 } 
	gÃxt
;

69 
Œ›_t
 (constrie_t&);

70 cÚ¡ 
	gŒ›_t
 &
	gİ”©Ü
 = (cÚ¡ 
Œ›_t
&);

	@v1_decoder.cpp

20 
	~<¡dlib.h
>

21 
	~<¡ršg.h
>

22 
	~<lim™s
>

24 
	~"¶©fÜm.hµ
"

25 #ià
defšed
 
ZMQ_HAVE_WINDOWS


26 
	~"wšdows.hµ
"

29 
	~"decod”.hµ
"

30 
	~"v1_decod”.hµ
"

31 
	~"lik–y.hµ
"

32 
	~"wœe.hµ
"

33 
	~"”r.hµ
"

35 
	gzmq
::
v1_decod”_t
::
	$v1_decod”_t
 (
size_t
 
bufsize_
, 
št64_t
 
maxmsgsize_
) :

36 
decod”_ba£_t
 <
v1_decod”_t
> (
bufsize_
),

37 
	$maxmsgsize
 (
maxmsgsize_
)

39 
rc
 = 
š_´og»ss
.
	`š™
 ();

40 
	`”ºo_as£¹
 (
rc
 == 0);

43 
	`Ãxt_¡•
 (
tmpbuf
, 1, &
v1_decod”_t
::
Úe_by‹_size_»ady
);

44 
	}
}

46 
	gzmq
::
v1_decod”_t
::~
	$v1_decod”_t
 ()

48 
rc
 = 
š_´og»ss
.
	`şo£
 ();

49 
	`”ºo_as£¹
 (
rc
 == 0);

50 
	}
}

52 
	gzmq
::
v1_decod”_t
::
	$Úe_by‹_size_»ady
 ()

57 ià(*
tmpbuf
 == 0xff)

58 
	`Ãxt_¡•
 (
tmpbuf
, 8, &
v1_decod”_t
::
eight_by‹_size_»ady
);

62 ià(!*
tmpbuf
) {

63 
”ºo
 = 
EPROTO
;

67 ià(
maxmsgsize
 >ğ0 && (
št64_t
è(*
tmpbuf
 - 1) > maxmsgsize) {

68 
”ºo
 = 
EMSGSIZE
;

75 
rc
 = 
š_´og»ss
.
	`š™_size
 (*
tmpbuf
 - 1);

76 ià(
rc
 != 0) {

77 
	`”ºo_as£¹
 (
”ºo
 =ğ
ENOMEM
);

78 
rc
 = 
š_´og»ss
.
	`š™
 ();

79 
	`”ºo_as£¹
 (
rc
 == 0);

80 
”ºo
 = 
ENOMEM
;

84 
	`Ãxt_¡•
 (
tmpbuf
, 1, &
v1_decod”_t
::
æags_»ady
);

87 
	}
}

89 
	gzmq
::
v1_decod”_t
::
	$eight_by‹_size_»ady
 ()

93 cÚ¡ 
ušt64_t
 
·ylßd_Ëngth
 = 
	`g‘_ušt64
 (
tmpbuf
);

96 ià(
·ylßd_Ëngth
 == 0) {

97 
”ºo
 = 
EPROTO
;

102 ià(
maxmsgsize
 >ğ0 && 
·ylßd_Ëngth
 - 1 > (
ušt64_t
) maxmsgsize) {

103 
”ºo
 = 
EMSGSIZE
;

108 ià(
·ylßd_Ëngth
 - 1 > 
¡d
::
num”ic_lim™s
 <
size_t
>::
	`max
 ()) {

109 
”ºo
 = 
EMSGSIZE
;

113 cÚ¡ 
size_t
 
msg_size
 = 
¡©ic_ÿ¡
 <size_t> (
·ylßd_Ëngth
 - 1);

118 
rc
 = 
š_´og»ss
.
	`š™_size
 (
msg_size
);

119 ià(
rc
 != 0) {

120 
	`”ºo_as£¹
 (
”ºo
 =ğ
ENOMEM
);

121 
rc
 = 
š_´og»ss
.
	`š™
 ();

122 
	`”ºo_as£¹
 (
rc
 == 0);

123 
”ºo
 = 
ENOMEM
;

127 
	`Ãxt_¡•
 (
tmpbuf
, 1, &
v1_decod”_t
::
æags_»ady
);

129 
	}
}

131 
	gzmq
::
v1_decod”_t
::
	$æags_»ady
 ()

134 
š_´og»ss
.
	`£t_æags
 (
tmpbuf
 [0] & 
msg_t
::
mÜe
);

136 
	`Ãxt_¡•
 (
š_´og»ss
.
	`d©a
 (), in_´og»ss.
	`size
 (),

137 &
v1_decod”_t
::
mes§ge_»ady
);

140 
	}
}

142 
	gzmq
::
v1_decod”_t
::
	$mes§ge_»ady
 ()

146 
	`Ãxt_¡•
 (
tmpbuf
, 1, &
v1_decod”_t
::
Úe_by‹_size_»ady
);

148 
	}
}

	@v1_decoder.hpp

20 #iâdeà
__ZMQ_V1_DECODER_HPP_INCLUDED__


21 
	#__ZMQ_V1_DECODER_HPP_INCLUDED__


	)

23 
	~"decod”.hµ
"

25 
Çme¥aû
 
	gzmq


29 
şass
 
	gv1_decod”_t
 : 
public
 
decod”_ba£_t
 <
v1_decod”_t
>

31 
public
:

33 
v1_decod”_t
 (
size_t
 
bufsize_
, 
št64_t
 
maxmsgsize_
);

34 ~
v1_decod”_t
 ();

36 
vœtu®
 
msg_t
 *
msg
 (è{  &
	gš_´og»ss
; }

38 
	g´iv©e
:

40 
Úe_by‹_size_»ady
 ();

41 
eight_by‹_size_»ady
 ();

42 
æags_»ady
 ();

43 
mes§ge_»ady
 ();

45 
	gtmpbuf
 [8];

46 
msg_t
 
	gš_´og»ss
;

48 
št64_t
 
	gmaxmsgsize
;

50 
v1_decod”_t
 (const v1_decoder_t&);

51 
	gİ”©Ü
 = (cÚ¡ 
v1_decod”_t
&);

	@v1_encoder.cpp

20 
	~"’cod”.hµ
"

21 
	~"v1_’cod”.hµ
"

22 
	~"lik–y.hµ
"

23 
	~"wœe.hµ
"

25 
	gzmq
::
v1_’cod”_t
::
	$v1_’cod”_t
 (
size_t
 
bufsize_
) :

26 
’cod”_ba£_t
 <
v1_’cod”_t
> (
bufsize_
)

29 
	`Ãxt_¡•
 (
NULL
, 0, &
v1_’cod”_t
::
mes§ge_»ady
, 
Œue
);

30 
	}
}

32 
	gzmq
::
v1_’cod”_t
::~
	$v1_’cod”_t
 ()

34 
	}
}

36 
zmq
::
v1_’cod”_t
::
	$size_»ady
 ()

39 
	`Ãxt_¡•
 (
š_´og»ss
->
	`d©a
 (), in_´og»ss->
	`size
 (),

40 &
v1_’cod”_t
::
mes§ge_»ady
, 
Œue
);

41 
	}
}

43 
	gzmq
::
v1_’cod”_t
::
	$mes§ge_»ady
 ()

46 
size_t
 
size
 = 
š_´og»ss
->
	`size
 ();

49 
size
++;

54 ià(
size
 < 255) {

55 
tmpbuf
 [0] = (è
size
;

56 
tmpbuf
 [1] = (
š_´og»ss
->
	`æags
 (è& 
msg_t
::
mÜe
);

57 
	`Ãxt_¡•
 (
tmpbuf
, 2, &
v1_’cod”_t
::
size_»ady
, 
çl£
);

60 
tmpbuf
 [0] = 0xff;

61 
	`put_ušt64
 (
tmpbuf
 + 1, 
size
);

62 
tmpbuf
 [9] = (
š_´og»ss
->
	`æags
 (è& 
msg_t
::
mÜe
);

63 
	`Ãxt_¡•
 (
tmpbuf
, 10, &
v1_’cod”_t
::
size_»ady
, 
çl£
);

65 
	}
}

	@v1_encoder.hpp

20 #iâdeà
__ZMQ_V1_ENCODER_HPP_INCLUDED__


21 
	#__ZMQ_V1_ENCODER_HPP_INCLUDED__


	)

23 
	~"’cod”.hµ
"

25 
Çme¥aû
 
	gzmq


29 
şass
 
	gv1_’cod”_t
 : 
public
 
’cod”_ba£_t
 <
v1_’cod”_t
>

31 
public
:

33 
v1_’cod”_t
 (
size_t
 
bufsize_
);

34 ~
v1_’cod”_t
 ();

36 
	g´iv©e
:

38 
size_»ady
 ();

39 
mes§ge_»ady
 ();

41 
	gtmpbuf
 [10];

43 
v1_’cod”_t
 (const v1_encoder_t&);

44 cÚ¡ 
	gv1_’cod”_t
 &
	gİ”©Ü
 = (cÚ¡ 
v1_’cod”_t
&);

	@v2_decoder.cpp

20 
	~<¡dlib.h
>

21 
	~<¡ršg.h
>

23 
	~"¶©fÜm.hµ
"

24 #ifdeà
ZMQ_HAVE_WINDOWS


25 
	~"wšdows.hµ
"

28 
	~"v2_´ÙocŞ.hµ
"

29 
	~"v2_decod”.hµ
"

30 
	~"lik–y.hµ
"

31 
	~"wœe.hµ
"

32 
	~"”r.hµ
"

34 
	gzmq
::
v2_decod”_t
::
	$v2_decod”_t
 (
size_t
 
bufsize_
, 
št64_t
 
maxmsgsize_
) :

35 
decod”_ba£_t
 <
v2_decod”_t
> (
bufsize_
),

36 
	`msg_æags
 (0),

37 
	$maxmsgsize
 (
maxmsgsize_
)

39 
rc
 = 
š_´og»ss
.
	`š™
 ();

40 
	`”ºo_as£¹
 (
rc
 == 0);

43 
	`Ãxt_¡•
 (
tmpbuf
, 1, &
v2_decod”_t
::
æags_»ady
);

44 
	}
}

46 
	gzmq
::
v2_decod”_t
::~
	$v2_decod”_t
 ()

48 
rc
 = 
š_´og»ss
.
	`şo£
 ();

49 
	`”ºo_as£¹
 (
rc
 == 0);

50 
	}
}

52 
	gzmq
::
v2_decod”_t
::
	$æags_»ady
 ()

54 
msg_æags
 = 0;

55 ià(
tmpbuf
 [0] & 
v2_´ÙocŞ_t
::
mÜe_æag
)

56 
msg_æags
 |ğ
msg_t
::
mÜe
;

57 ià(
tmpbuf
 [0] & 
v2_´ÙocŞ_t
::
commªd_æag
)

58 
msg_æags
 |ğ
msg_t
::
commªd
;

62 ià(
tmpbuf
 [0] & 
v2_´ÙocŞ_t
::
Ïrge_æag
)

63 
	`Ãxt_¡•
 (
tmpbuf
, 8, &
v2_decod”_t
::
eight_by‹_size_»ady
);

65 
	`Ãxt_¡•
 (
tmpbuf
, 1, &
v2_decod”_t
::
Úe_by‹_size_»ady
);

68 
	}
}

70 
	gzmq
::
v2_decod”_t
::
	$Úe_by‹_size_»ady
 ()

73 ià(
maxmsgsize
 >= 0)

74 ià(
	`uÆik–y
 (
tmpbuf
 [0] > 
¡©ic_ÿ¡
 <
ušt64_t
> (
maxmsgsize
))) {

75 
”ºo
 = 
EMSGSIZE
;

82 
rc
 = 
š_´og»ss
.
	`š™_size
 (
tmpbuf
 [0]);

83 ià(
	`uÆik–y
 (
rc
)) {

84 
	`”ºo_as£¹
 (
”ºo
 =ğ
ENOMEM
);

85 
rc
 = 
š_´og»ss
.
	`š™
 ();

86 
	`”ºo_as£¹
 (
rc
 == 0);

87 
”ºo
 = 
ENOMEM
;

91 
š_´og»ss
.
	`£t_æags
 (
msg_æags
);

92 
	`Ãxt_¡•
 (
š_´og»ss
.
	`d©a
 (), in_´og»ss.
	`size
 (),

93 &
v2_decod”_t
::
mes§ge_»ady
);

96 
	}
}

98 
	gzmq
::
v2_decod”_t
::
	$eight_by‹_size_»ady
 ()

102 cÚ¡ 
ušt64_t
 
msg_size
 = 
	`g‘_ušt64
 (
tmpbuf
);

105 ià(
maxmsgsize
 >= 0)

106 ià(
	`uÆik–y
 (
msg_size
 > 
¡©ic_ÿ¡
 <
ušt64_t
> (
maxmsgsize
))) {

107 
”ºo
 = 
EMSGSIZE
;

112 ià(
	`uÆik–y
 (
msg_size
 !ğ
¡©ic_ÿ¡
 <
size_t
> (msg_size))) {

113 
”ºo
 = 
EMSGSIZE
;

120 
rc
 = 
š_´og»ss
.
	`š™_size
 (
¡©ic_ÿ¡
 <
size_t
> (
msg_size
));

121 ià(
	`uÆik–y
 (
rc
)) {

122 
	`”ºo_as£¹
 (
”ºo
 =ğ
ENOMEM
);

123 
rc
 = 
š_´og»ss
.
	`š™
 ();

124 
	`”ºo_as£¹
 (
rc
 == 0);

125 
”ºo
 = 
ENOMEM
;

129 
š_´og»ss
.
	`£t_æags
 (
msg_æags
);

130 
	`Ãxt_¡•
 (
š_´og»ss
.
	`d©a
 (), in_´og»ss.
	`size
 (),

131 &
v2_decod”_t
::
mes§ge_»ady
);

134 
	}
}

136 
	gzmq
::
v2_decod”_t
::
	$mes§ge_»ady
 ()

140 
	`Ãxt_¡•
 (
tmpbuf
, 1, &
v2_decod”_t
::
æags_»ady
);

142 
	}
}

	@v2_decoder.hpp

20 #iâdeà
__ZMQ_V2_DECODER_HPP_INCLUDED__


21 
	#__ZMQ_V2_DECODER_HPP_INCLUDED__


	)

23 
	~"decod”.hµ
"

25 
Çme¥aû
 
	gzmq


28 
şass
 
	gv2_decod”_t
 : 
public
 
decod”_ba£_t
 <
v2_decod”_t
>

30 
public
:

32 
v2_decod”_t
 (
size_t
 
bufsize_
, 
št64_t
 
maxmsgsize_
);

33 
	gvœtu®
 ~
v2_decod”_t
 ();

36 
vœtu®
 
msg_t
 *
msg
 (è{  &
	gš_´og»ss
; }

38 
	g´iv©e
:

40 
æags_»ady
 ();

41 
Úe_by‹_size_»ady
 ();

42 
eight_by‹_size_»ady
 ();

43 
mes§ge_»ady
 ();

45 
	gtmpbuf
 [8];

46 
	gmsg_æags
;

47 
msg_t
 
	gš_´og»ss
;

49 cÚ¡ 
št64_t
 
	gmaxmsgsize
;

51 
v2_decod”_t
 (const v2_decoder_t&);

52 
	gİ”©Ü
 = (cÚ¡ 
v2_decod”_t
&);

	@v2_encoder.cpp

20 
	~"v2_´ÙocŞ.hµ
"

21 
	~"v2_’cod”.hµ
"

22 
	~"lik–y.hµ
"

23 
	~"wœe.hµ
"

25 
	gzmq
::
v2_’cod”_t
::
	$v2_’cod”_t
 (
size_t
 
bufsize_
) :

26 
’cod”_ba£_t
 <
v2_’cod”_t
> (
bufsize_
)

29 
	`Ãxt_¡•
 (
NULL
, 0, &
v2_’cod”_t
::
mes§ge_»ady
, 
Œue
);

30 
	}
}

32 
	gzmq
::
v2_’cod”_t
::~
	$v2_’cod”_t
 ()

34 
	}
}

36 
zmq
::
v2_’cod”_t
::
	$mes§ge_»ady
 ()

39 &
´ÙocŞ_æags
 = 
tmpbuf
 [0];

40 
´ÙocŞ_æags
 = 0;

41 ià(
š_´og»ss
->
	`æags
 (è& 
msg_t
::
mÜe
)

42 
´ÙocŞ_æags
 |ğ
v2_´ÙocŞ_t
::
mÜe_æag
;

43 ià(
š_´og»ss
->
	`size
 () > 255)

44 
´ÙocŞ_æags
 |ğ
v2_´ÙocŞ_t
::
Ïrge_æag
;

45 ià(
š_´og»ss
->
	`æags
 (è& 
msg_t
::
commªd
)

46 
´ÙocŞ_æags
 |ğ
v2_´ÙocŞ_t
::
commªd_æag
;

51 cÚ¡ 
size_t
 
size
 = 
š_´og»ss
->
	`size
 ();

52 ià(
	`uÆik–y
 (
size
 > 255)) {

53 
	`put_ušt64
 (
tmpbuf
 + 1, 
size
);

54 
	`Ãxt_¡•
 (
tmpbuf
, 9, &
v2_’cod”_t
::
size_»ady
, 
çl£
);

57 
tmpbuf
 [1] = 
¡©ic_ÿ¡
 <
ušt8_t
> (
size
);

58 
	`Ãxt_¡•
 (
tmpbuf
, 2, &
v2_’cod”_t
::
size_»ady
, 
çl£
);

60 
	}
}

62 
	gzmq
::
v2_’cod”_t
::
	$size_»ady
 ()

65 
	`Ãxt_¡•
 (
š_´og»ss
->
	`d©a
 (), in_´og»ss->
	`size
 (),

66 &
v2_’cod”_t
::
mes§ge_»ady
, 
Œue
);

67 
	}
}

	@v2_encoder.hpp

20 #iâdeà
__ZMQ_V2_ENCODER_HPP_INCLUDED__


21 
	#__ZMQ_V2_ENCODER_HPP_INCLUDED__


	)

23 
	~"’cod”.hµ
"

25 
Çme¥aû
 
	gzmq


29 
şass
 
	gv2_’cod”_t
 : 
public
 
’cod”_ba£_t
 <
v2_’cod”_t
>

31 
public
:

33 
v2_’cod”_t
 (
size_t
 
bufsize_
);

34 
	gvœtu®
 ~
v2_’cod”_t
 ();

36 
	g´iv©e
:

38 
size_»ady
 ();

39 
mes§ge_»ady
 ();

41 
	gtmpbuf
 [9];

43 
v2_’cod”_t
 (const v2_encoder_t&);

44 cÚ¡ 
	gv2_’cod”_t
 &
	gİ”©Ü
 = (cÚ¡ 
v2_’cod”_t
&);

	@v2_protocol.hpp

20 #iâdeà
__ZMQ_V2_PROTOCOL_HPP_INCLUDED__


21 
	#__ZMQ_V2_PROTOCOL_HPP_INCLUDED__


	)

23 
Çme¥aû
 
	gzmq


26 şas 
	cv2_´ÙocŞ_t


28 
	gpublic
:

32 
mÜe_æag
 = 1,

33 
	gÏrge_æag
 = 2,

34 
	gcommªd_æag
 = 4

	@windows.hpp

20 #iâdeà
__ZMQ_WINDOWS_HPP_INCLUDED__


21 
	#__ZMQ_WINDOWS_HPP_INCLUDED__


	)

26 #iâdeà
_CRT_SECURE_NO_WARNINGS


27 
	#_CRT_SECURE_NO_WARNINGS


	)

29 #iâdeà
WIN32_LEAN_AND_MEAN


30 
	#WIN32_LEAN_AND_MEAN


	)

32 #iâdeà
NOGDICAPMASKS


33 
	#NOGDICAPMASKS


35 #iâdeà
NOVIRTUALKEYCODES


	)

36 
	#NOVIRTUALKEYCODES


38 #iâdeà
NOWINMESSAGES


	)

39 
	#NOWINMESSAGES


41 #iâdeà
NOWINSTYLES


	)

42 
	#NOWINSTYLES


44 #iâdeà
NOSYSMETRICS


	)

45 
	#NOSYSMETRICS


47 #iâdeà
NOMENUS


	)

48 
	#NOMENUS


50 #iâdeà
NOICONS


	)

51 
	#NOICONS


53 #iâdeà
NOKEYSTATES


	)

54 
	#NOKEYSTATES


56 #iâdeà
NOSYSCOMMANDS


	)

57 
	#NOSYSCOMMANDS


59 #iâdeà
NORASTEROPS


	)

60 
	#NORASTEROPS


62 #iâdeà
NOSHOWWINDOW


	)

63 
	#NOSHOWWINDOW


65 #iâdeà
OEMRESOURCE


	)

66 
	#OEMRESOURCE


68 #iâdeà
NOATOM


	)

69 
	#NOATOM


71 #iâdeà
NOCLIPBOARD


	)

72 
	#NOCLIPBOARD


74 #iâdeà
NOCOLOR


	)

75 
	#NOCOLOR


77 #iâdeà
NOCTLMGR


	)

78 
	#NOCTLMGR


80 #iâdeà
NODRAWTEXT


	)

81 
	#NODRAWTEXT


83 #iâdeà
NOGDI


	)

84 
	#NOGDI


86 #iâdeà
NOKERNEL


	)

87 
	#NOKERNEL


89 #iâdeà
NOUSER


	)

90 
	#NOUSER


92 #iâdeà
NONLS


	)

93 
	#NONLS


95 #iâdeà
NOMB


	)

96 
	#NOMB


98 #iâdeà
NOMEMMGR


	)

99 
	#NOMEMMGR


101 #iâdeà
NOMETAFILE


	)

102 
	#NOMETAFILE


104 #iâdeà
NOMINMAX


	)

105 
	#NOMINMAX


107 #iâdeà
NOMSG


	)

108 
	#NOMSG


110 #iâdeà
NOOPENFILE


	)

111 
	#NOOPENFILE


113 #iâdeà
NOSCROLL


	)

114 
	#NOSCROLL


116 #iâdeà
NOSERVICE


	)

117 
	#NOSERVICE


119 #iâdeà
NOSOUND


	)

120 
	#NOSOUND


122 #iâdeà
NOTEXTMETRIC


	)

123 
	#NOTEXTMETRIC


125 #iâdeà
NOWH


	)

126 
	#NOWH


128 #iâdeà
NOWINOFFSETS


	)

129 
	#NOWINOFFSETS


131 #iâdeà
NOCOMM


	)

132 
	#NOCOMM


134 #iâdeà
NOKANJI


	)

135 
	#NOKANJI


137 #iâdeà
NOHELP


	)

138 
	#NOHELP


140 #iâdeà
NOPROFILER


	)

141 
	#NOPROFILER


143 #iâdeà
NODEFERWINDOWPOS


	)

144 
	#NODEFERWINDOWPOS


146 #iâdeà
NOMCX


	)

147 
	#NOMCX


149 

	)

151 #iâdeà
_WIN32_WINNT


152 
	#_WIN32_WINNT
 0x0501

	)

155 #ifdeà
__MINGW32__


157 #if(
_WIN32_WINNT
 >= 0x0501)

159 #undeà
_WIN32_WINNT


160 
	#_WIN32_WINNT
 0x0501

	)

164 
	~<wšsock2.h
>

165 
	~<wšdows.h
>

166 
	~<mswsock.h
>

168 #ià!
defšed
 
__MINGW32__


169 
	~<M¡ı.h
>

175 #ià
defšed
 
__MINGW32__
 && !defšed 
SIO_KEEPALIVE_VALS
 && !defšed 
__MINGW64_VERSION_MAJOR


176 
	stı_k“·live
 {

177 
u_lÚg
 
	mÚoff
;

178 
u_lÚg
 
	mk“·liv‘ime
;

179 
u_lÚg
 
	mk“·liveš‹rv®
;

181 
	#SIO_KEEPALIVE_VALS
 
	`_WSAIOW
(
IOC_VENDOR
,4)

	)

184 
	~<ws2tı.h
>

185 
	~<expÜt.h
>

186 #ià!
defšed
 
_WIN32_WCE


187 
	~<´oûss.h
>

191 #iâdeà
AI_NUMERICSERV


192 
	#AI_NUMERICSERV
 0x0400

	)

	@wire.hpp

20 #iâdeà
__ZMQ_WIRE_HPP_INCLUDED__


21 
	#__ZMQ_WIRE_HPP_INCLUDED__


	)

23 
	~"¡dšt.hµ
"

25 
Çme¥aû
 
	gzmq


31 
šlše
 
put_ušt8
 (*
bufãr_
, 
ušt8_t
 
v®ue
)

33 *
	gbufãr_
 = 
v®ue
;

36 
šlše
 
ušt8_t
 
g‘_ušt8
 (cÚ¡ *
bufãr_
)

38  *
	gbufãr_
;

41 
šlše
 
put_ušt16
 (*
bufãr_
, 
ušt16_t
 
v®ue
)

43 
	gbufãr_
 [0] = (è(((
v®ue
) >> 8) & 0xff);

44 
	gbufãr_
 [1] = (è(
v®ue
 & 0xff);

47 
šlše
 
ušt16_t
 
g‘_ušt16
 (cÚ¡ *
bufãr_
)

50 (((
	gušt16_t
è
	gbufãr_
 [0]) << 8) |

51 ((
	gušt16_t
è
	gbufãr_
 [1]);

54 
šlše
 
put_ušt32
 (*
bufãr_
, 
ušt32_t
 
v®ue
)

56 
	gbufãr_
 [0] = (è(((
v®ue
) >> 24) & 0xff);

57 
	gbufãr_
 [1] = (è(((
v®ue
) >> 16) & 0xff);

58 
	gbufãr_
 [2] = (è(((
v®ue
) >> 8) & 0xff);

59 
	gbufãr_
 [3] = (è(
v®ue
 & 0xff);

62 
šlše
 
ušt32_t
 
g‘_ušt32
 (cÚ¡ *
bufãr_
)

65 (((
	gušt32_t
è
	gbufãr_
 [0]) << 24) |

66 (((
	gušt32_t
è
	gbufãr_
 [1]) << 16) |

67 (((
	gušt32_t
è
	gbufãr_
 [2]) << 8) |

68 ((
	gušt32_t
è
	gbufãr_
 [3]);

71 
šlše
 
put_ušt64
 (*
bufãr_
, 
ušt64_t
 
v®ue
)

73 
	gbufãr_
 [0] = (è(((
v®ue
) >> 56) & 0xff);

74 
	gbufãr_
 [1] = (è(((
v®ue
) >> 48) & 0xff);

75 
	gbufãr_
 [2] = (è(((
v®ue
) >> 40) & 0xff);

76 
	gbufãr_
 [3] = (è(((
v®ue
) >> 32) & 0xff);

77 
	gbufãr_
 [4] = (è(((
v®ue
) >> 24) & 0xff);

78 
	gbufãr_
 [5] = (è(((
v®ue
) >> 16) & 0xff);

79 
	gbufãr_
 [6] = (è(((
v®ue
) >> 8) & 0xff);

80 
	gbufãr_
 [7] = (è(
v®ue
 & 0xff);

83 
šlše
 
ušt64_t
 
g‘_ušt64
 (cÚ¡ *
bufãr_
)

86 (((
	gušt64_t
è
	gbufãr_
 [0]) << 56) |

87 (((
	gušt64_t
è
	gbufãr_
 [1]) << 48) |

88 (((
	gušt64_t
è
	gbufãr_
 [2]) << 40) |

89 (((
	gušt64_t
è
	gbufãr_
 [3]) << 32) |

90 (((
	gušt64_t
è
	gbufãr_
 [4]) << 24) |

91 (((
	gušt64_t
è
	gbufãr_
 [5]) << 16) |

92 (((
	gušt64_t
è
	gbufãr_
 [6]) << 8) |

93 ((
	gušt64_t
è
	gbufãr_
 [7]);

	@xpub.cpp

20 
	~<¡ršg.h
>

22 
	~"xpub.hµ
"

23 
	~"pe.hµ
"

24 
	~"”r.hµ
"

25 
	~"msg.hµ
"

27 
	gzmq
::
xpub_t
::
	$xpub_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

28 
	`sock‘_ba£_t
 (
·»Á_
, 
tid_
, 
sid_
),

29 
	`v”bo£
(
çl£
),

30 
	$mÜe
 (
çl£
)

32 
İtiÚs
.
ty³
 = 
ZMQ_XPUB
;

33 
	}
}

35 
	gzmq
::
xpub_t
::~
	$xpub_t
 ()

37 
	}
}

39 
zmq
::
xpub_t
::
	$x©ch_pe
 (
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
)

41 
	`zmq_as£¹
 (
pe_
);

42 
di¡
.
	`©ch
 (
pe_
);

46 ià(
subsüibe_to_®l_
)

47 
subsütiÚs
.
	`add
 (
NULL
, 0, 
pe_
);

51 
	`x»ad_aùiv©ed
 (
pe_
);

52 
	}
}

54 
	gzmq
::
xpub_t
::
	$x»ad_aùiv©ed
 (
pe_t
 *
pe_
)

57 
msg_t
 
sub
;

58 
pe_
->
	`»ad
 (&
sub
)) {

60 *cÚ¡ 
d©a
 = (*è
sub
.
	`d©a
 ();

61 cÚ¡ 
size_t
 
size
 = 
sub
.
	`size
 ();

62 ià(
size
 > 0 && (*
d©a
 == 0 || *data == 1)) {

63 
boŞ
 
unique
;

64 ià(*
d©a
 == 0)

65 
unique
 = 
subsütiÚs
.
	`rm
 (
d©a
 + 1, 
size
 - 1, 
pe_
);

67 
unique
 = 
subsütiÚs
.
	`add
 (
d©a
 + 1, 
size
 - 1, 
pe_
);

71 ià(
İtiÚs
.
ty³
 =ğ
ZMQ_XPUB
 && (
unique
 || (*
d©a
 && 
v”bo£
))) {

72 
³ndšg_d©a
.
	`push_back
 (
	`blob_t
 (
d©a
, 
size
));

73 
³ndšg_æags
.
	`push_back
 (0);

78 
³ndšg_d©a
.
	`push_back
 (
	`blob_t
 (
d©a
, 
size
));

79 
³ndšg_æags
.
	`push_back
 (
sub
.
	`æags
 ());

81 
sub
.
	`şo£
 ();

83 
	}
}

85 
	gzmq
::
xpub_t
::
	$xwr™e_aùiv©ed
 (
pe_t
 *
pe_
)

87 
di¡
.
	`aùiv©ed
 (
pe_
);

88 
	}
}

90 
	gzmq
::
xpub_t
::
	$x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
,

91 
size_t
 
İtv®Ën_
)

93 ià(
İtiÚ_
 !ğ
ZMQ_XPUB_VERBOSE
) {

94 
”ºo
 = 
EINVAL
;

97 ià(
İtv®Ën_
 !ğ (è|| *
¡©ic_ÿ¡
 <cÚ¡ *> (
İtv®_
) < 0) {

98 
”ºo
 = 
EINVAL
;

101 
v”bo£
 = (*
¡©ic_ÿ¡
 <cÚ¡ *> (
İtv®_
) != 0);

103 
	}
}

105 
	gzmq
::
xpub_t
::
	$xpe_‹rmš©ed
 (
pe_t
 *
pe_
)

110 
subsütiÚs
.
	`rm
 (
pe_
, 
£nd_unsubsütiÚ
, 
this
);

112 
di¡
.
	`pe_‹rmš©ed
 (
pe_
);

113 
	}
}

115 
	gzmq
::
xpub_t
::
	$m¬k_as_m©chšg
 (
pe_t
 *
pe_
, *
¬g_
)

117 
xpub_t
 *
£lf
 = (xpub_t*è
¬g_
;

118 
£lf
->
di¡
.
	`m©ch
 (
pe_
);

119 
	}
}

121 
	gzmq
::
xpub_t
::
	$x£nd
 (
msg_t
 *
msg_
)

123 
boŞ
 
msg_mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
 ? 
Œue
 : 
çl£
;

126 ià(!
mÜe
)

127 
subsütiÚs
.
	`m©ch
 ((*è
msg_
->
	`d©a
 (), msg_->
	`size
 (),

128 
m¬k_as_m©chšg
, 
this
);

132 
rc
 = 
di¡
.
	`£nd_to_m©chšg
 (
msg_
);

133 ià(
rc
 != 0)

134  
rc
;

138 ià(!
msg_mÜe
)

139 
di¡
.
	`unm©ch
 ();

141 
mÜe
 = 
msg_mÜe
;

144 
	}
}

146 
boŞ
 
	gzmq
::
xpub_t
::
	$xhas_out
 ()

148  
di¡
.
	`has_out
 ();

149 
	}
}

151 
	gzmq
::
xpub_t
::
	$x»cv
 (
msg_t
 *
msg_
)

154 ià(
³ndšg_d©a
.
	`em±y
 ()) {

155 
”ºo
 = 
EAGAIN
;

159 
rc
 = 
msg_
->
	`şo£
 ();

160 
	`”ºo_as£¹
 (
rc
 == 0);

161 
rc
 = 
msg_
->
	`š™_size
 (
³ndšg_d©a
.
	`äÚt
 ().
	`size
 ());

162 
	`”ºo_as£¹
 (
rc
 == 0);

163 
	`memıy
 (
msg_
->
	`d©a
 (),

164 
³ndšg_d©a
.
	`äÚt
 ().
	`d©a
 (),

165 
³ndšg_d©a
.
	`äÚt
 ().
	`size
 ());

166 
msg_
->
	`£t_æags
 (
³ndšg_æags
.
	`äÚt
 ());

167 
³ndšg_d©a
.
	`pİ_äÚt
 ();

168 
³ndšg_æags
.
	`pİ_äÚt
 ();

170 
	}
}

172 
boŞ
 
	gzmq
::
xpub_t
::
	$xhas_š
 ()

174  !
³ndšg_d©a
.
	`em±y
 ();

175 
	}
}

177 
	gzmq
::
xpub_t
::
	$£nd_unsubsütiÚ
 (*
d©a_
, 
size_t
 
size_
,

178 *
¬g_
)

180 
xpub_t
 *
£lf
 = (xpub_t*è
¬g_
;

182 ià(
£lf
->
İtiÚs
.
ty³
 !ğ
ZMQ_PUB
) {

185 
blob_t
 
	`unsub
 (
size_
 + 1, 0);

186 
unsub
 [0] = 0;

187 
	`memıy
 (&
unsub
 [1], 
d©a_
, 
size_
);

188 
£lf
->
³ndšg_d©a
.
	`push_back
 (
unsub
);

189 
£lf
->
³ndšg_æags
.
	`push_back
 (0);

191 
	}
}

	@xpub.hpp

20 #iâdeà
__ZMQ_XPUB_HPP_INCLUDED__


21 
	#__ZMQ_XPUB_HPP_INCLUDED__


	)

23 
	~<deque
>

24 
	~<¡ršg
>

26 
	~"sock‘_ba£.hµ
"

27 
	~"£ssiÚ_ba£.hµ
"

28 
	~"mŒ›.hµ
"

29 
	~"¬¿y.hµ
"

30 
	~"di¡.hµ
"

32 
Çme¥aû
 
	gzmq


35 
şass
 
	gùx_t
;

36 
şass
 
	gmsg_t
;

37 
şass
 
	gpe_t
;

38 
şass
 
	gio_th»ad_t
;

40 şas 
	cxpub_t
 :

41 
public
 
sock‘_ba£_t


43 
public
:

45 
xpub_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
);

46 ~
xpub_t
 ();

49 
x©ch_pe
 (
zmq
::
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
 = 
çl£
);

50 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

51 
boŞ
 
xhas_out
 ();

52 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

53 
boŞ
 
xhas_š
 ();

54 
x»ad_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

55 
xwr™e_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

56 
x£tsockİt
 (
İtiÚ_
, cÚ¡ *
İtv®_
, 
size_t
 
İtv®Ën_
);

57 
xpe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

59 
	g´iv©e
:

63 
£nd_unsubsütiÚ
 (*
d©a_
, 
size_t
 
size_
,

64 *
¬g_
);

67 
m¬k_as_m©chšg
 (
zmq
::
pe_t
 *
pe_
, *
¬g_
);

70 
mŒ›_t
 
	gsubsütiÚs
;

73 
di¡_t
 
	gdi¡
;

77 
boŞ
 
	gv”bo£
;

80 
boŞ
 
	gmÜe
;

84 
	g¡d
::
	tbasic_¡ršg
 <> 
	tblob_t
;

85 
	g¡d
::
deque
 <
blob_t
> 
³ndšg_d©a
;

86 
	g¡d
::
deque
 <> 
³ndšg_æags
;

88 
xpub_t
 (const xpub_t&);

89 cÚ¡ 
	gxpub_t
 &
	gİ”©Ü
 = (cÚ¡ 
xpub_t
&);

	@xsub.cpp

20 
	~<¡ršg.h
>

22 
	~"xsub.hµ
"

23 
	~"”r.hµ
"

25 
	gzmq
::
xsub_t
::
	$xsub_t
 (
şass
 
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
) :

26 
	`sock‘_ba£_t
 (
·»Á_
, 
tid_
, 
sid_
),

27 
	`has_mes§ge
 (
çl£
),

28 
	$mÜe
 (
çl£
)

30 
İtiÚs
.
ty³
 = 
ZMQ_XSUB
;

34 
İtiÚs
.
lšg”
 = 0;

36 
rc
 = 
mes§ge
.
	`š™
 ();

37 
	`”ºo_as£¹
 (
rc
 == 0);

38 
	}
}

40 
	gzmq
::
xsub_t
::~
	$xsub_t
 ()

42 
rc
 = 
mes§ge
.
	`şo£
 ();

43 
	`”ºo_as£¹
 (
rc
 == 0);

44 
	}
}

46 
	gzmq
::
xsub_t
::
	$x©ch_pe
 (
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
)

49 (è
subsüibe_to_®l_
;

51 
	`zmq_as£¹
 (
pe_
);

52 
fq
.
	`©ch
 (
pe_
);

53 
di¡
.
	`©ch
 (
pe_
);

56 
subsütiÚs
.
	`­¶y
 (
£nd_subsütiÚ
, 
pe_
);

57 
pe_
->
	`æush
 ();

58 
	}
}

60 
	gzmq
::
xsub_t
::
	$x»ad_aùiv©ed
 (
pe_t
 *
pe_
)

62 
fq
.
	`aùiv©ed
 (
pe_
);

63 
	}
}

65 
	gzmq
::
xsub_t
::
	$xwr™e_aùiv©ed
 (
pe_t
 *
pe_
)

67 
di¡
.
	`aùiv©ed
 (
pe_
);

68 
	}
}

70 
	gzmq
::
xsub_t
::
	$xpe_‹rmš©ed
 (
pe_t
 *
pe_
)

72 
fq
.
	`pe_‹rmš©ed
 (
pe_
);

73 
di¡
.
	`pe_‹rmš©ed
 (
pe_
);

74 
	}
}

76 
	gzmq
::
xsub_t
::
	$xhiccu³d
 (
pe_t
 *
pe_
)

79 
subsütiÚs
.
	`­¶y
 (
£nd_subsütiÚ
, 
pe_
);

80 
pe_
->
	`æush
 ();

81 
	}
}

83 
	gzmq
::
xsub_t
::
	$x£nd
 (
msg_t
 *
msg_
)

85 
size_t
 
size
 = 
msg_
->
	`size
 ();

86 *
d©a
 = (*è
msg_
->
	`d©a
 ();

88 ià(
size
 > 0 && *
d©a
 == 1) {

94 
subsütiÚs
.
	`add
 (
d©a
 + 1, 
size
 - 1);

95  
di¡
.
	`£nd_to_®l
 (
msg_
);

98 ià(
size
 > 0 && *
d©a
 == 0) {

100 ià(
subsütiÚs
.
	`rm
 (
d©a
 + 1, 
size
 - 1))

101  
di¡
.
	`£nd_to_®l
 (
msg_
);

105  
di¡
.
	`£nd_to_®l
 (
msg_
);

107 
rc
 = 
msg_
->
	`şo£
 ();

108 
	`”ºo_as£¹
 (
rc
 == 0);

109 
rc
 = 
msg_
->
	`š™
 ();

110 
	`”ºo_as£¹
 (
rc
 == 0);

113 
	}
}

115 
boŞ
 
	gzmq
::
xsub_t
::
	$xhas_out
 ()

118  
Œue
;

119 
	}
}

121 
	gzmq
::
xsub_t
::
	$x»cv
 (
msg_t
 *
msg_
)

125 ià(
has_mes§ge
) {

126 
rc
 = 
msg_
->
	`move
 (
mes§ge
);

127 
	`”ºo_as£¹
 (
rc
 == 0);

128 
has_mes§ge
 = 
çl£
;

129 
mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::mÜ? 
Œue
 : 
çl£
;

136 
Œue
) {

139 
rc
 = 
fq
.
	`»cv
 (
msg_
);

143 ià(
rc
 != 0)

148 ià(
mÜe
 || !
İtiÚs
.
f‹r
 || 
	`m©ch
 (
msg_
)) {

149 
mÜe
 = 
msg_
->
	`æags
 (è& 
msg_t
::mÜ? 
Œue
 : 
çl£
;

155 
msg_
->
	`æags
 (è& 
msg_t
::
mÜe
) {

156 
rc
 = 
fq
.
	`»cv
 (
msg_
);

157 
	`”ºo_as£¹
 (
rc
 == 0);

160 
	}
}

162 
boŞ
 
	gzmq
::
xsub_t
::
	$xhas_š
 ()

165 ià(
mÜe
)

166  
Œue
;

170 ià(
has_mes§ge
)

171  
Œue
;

175 
Œue
) {

178 
rc
 = 
fq
.
	`»cv
 (&
mes§ge
);

182 ià(
rc
 != 0) {

183 
	`”ºo_as£¹
 (
”ºo
 =ğ
EAGAIN
);

184  
çl£
;

188 ià(!
İtiÚs
.
f‹r
 || 
	`m©ch
 (&
mes§ge
)) {

189 
has_mes§ge
 = 
Œue
;

190  
Œue
;

195 
mes§ge
.
	`æags
 (è& 
msg_t
::
mÜe
) {

196 
rc
 = 
fq
.
	`»cv
 (&
mes§ge
);

197 
	`”ºo_as£¹
 (
rc
 == 0);

200 
	}
}

202 
boŞ
 
	gzmq
::
xsub_t
::
	$m©ch
 (
msg_t
 *
msg_
)

204  
subsütiÚs
.
	`check
 ((*è
msg_
->
	`d©a
 (), msg_->
	`size
 ());

205 
	}
}

207 
	gzmq
::
xsub_t
::
	$£nd_subsütiÚ
 (*
d©a_
, 
size_t
 
size_
,

208 *
¬g_
)

210 
pe_t
 *
pe
 = (pe_t*è
¬g_
;

213 
msg_t
 
msg
;

214 
rc
 = 
msg
.
	`š™_size
 (
size_
 + 1);

215 
	`”ºo_as£¹
 (
rc
 == 0);

216 *
d©a
 = (*è
msg
.
	`d©a
 ();

217 
d©a
 [0] = 1;

218 
	`memıy
 (
d©a
 + 1, 
d©a_
, 
size_
);

221 
boŞ
 
£Á
 = 
pe
->
	`wr™e
 (&
msg
);

226 ià(!
£Á
)

227 
msg
.
	`şo£
 ();

228 
	}
}

	@xsub.hpp

20 #iâdeà
__ZMQ_XSUB_HPP_INCLUDED__


21 
	#__ZMQ_XSUB_HPP_INCLUDED__


	)

23 
	~"sock‘_ba£.hµ
"

24 
	~"£ssiÚ_ba£.hµ
"

25 
	~"di¡.hµ
"

26 
	~"fq.hµ
"

27 
	~"Œ›.hµ
"

29 
Çme¥aû
 
	gzmq


32 
şass
 
	gùx_t
;

33 
şass
 
	gpe_t
;

34 
şass
 
	gio_th»ad_t
;

36 şas 
	cxsub_t
 :

37 
public
 
sock‘_ba£_t


39 
public
:

41 
xsub_t
 (
zmq
::
ùx_t
 *
·»Á_
, 
ušt32_t
 
tid_
, 
sid_
);

42 ~
xsub_t
 ();

44 
	g´Ùeùed
:

47 
x©ch_pe
 (
zmq
::
pe_t
 *
pe_
, 
boŞ
 
subsüibe_to_®l_
);

48 
x£nd
 (
zmq
::
msg_t
 *
msg_
);

49 
boŞ
 
xhas_out
 ();

50 
x»cv
 (
zmq
::
msg_t
 *
msg_
);

51 
boŞ
 
xhas_š
 ();

52 
x»ad_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

53 
xwr™e_aùiv©ed
 (
zmq
::
pe_t
 *
pe_
);

54 
xhiccu³d
 (
pe_t
 *
pe_
);

55 
xpe_‹rmš©ed
 (
zmq
::
pe_t
 *
pe_
);

57 
	g´iv©e
:

60 
boŞ
 
m©ch
 (
zmq
::
msg_t
 *
msg_
);

64 
£nd_subsütiÚ
 (*
d©a_
, 
size_t
 
size_
,

65 *
¬g_
);

68 
fq_t
 
	gfq
;

71 
di¡_t
 
	gdi¡
;

74 
Œ›_t
 
	gsubsütiÚs
;

78 
boŞ
 
	ghas_mes§ge
;

79 
msg_t
 
	gmes§ge
;

83 
boŞ
 
	gmÜe
;

85 
xsub_t
 (const xsub_t&);

86 cÚ¡ 
	gxsub_t
 &
	gİ”©Ü
 = (cÚ¡ 
xsub_t
&);

	@ypipe.hpp

20 #iâdeà
__ZMQ_YPIPE_HPP_INCLUDED__


21 
	#__ZMQ_YPIPE_HPP_INCLUDED__


	)

23 
	~"©omic_±r.hµ
"

24 
	~"yqueue.hµ
"

25 
	~"¶©fÜm.hµ
"

26 
	~"ype_ba£.hµ
"

28 
Çme¥aû
 
	gzmq


38 
	g‹m¶©e
 <
ty³Çme
 
	gT
, 
	gN
> 
şass
 
	gype_t
 : 
public
 
ype_ba£_t
<
T
,N>

40 
	gpublic
:

43 
šlše
 
ype_t
 ()

46 
queue
.
push
 ();

50 
	gr
 = 
w
 = 
f
 = &
queue
.
back
 ();

51 
	gc
.
£t
 (&
queue
.
back
 ());

56 
šlše
 
	gvœtu®
 ~
ype_t
 ()

64 #ifdeà
ZMQ_HAVE_OPENVMS


65 #´agm¨
mes§ge
 
§ve


66 #´agm¨
mes§ge
 
di§bË
(
UNINIT
)

73 
šlše
 
wr™e
 (cÚ¡ 
T
 &
v®ue_
, 
boŞ
 
šcom¶‘e_
)

76 
	gqueue
.
back
 (èğ
v®ue_
;

77 
	gqueue
.
push
 ();

80 ià(!
	gšcom¶‘e_
)

81 
	gf
 = &
queue
.
back
 ();

84 #ifdeà
ZMQ_HAVE_OPENVMS


85 #´agm¨
mes§ge
 
»¡Üe


90 
šlše
 
boŞ
 
unwr™e
 (
T
 *
v®ue_
)

92 ià(
	gf
 =ğ&
queue
.
back
 ())

93  
çl£
;

94 
	gqueue
.
uÅush
 ();

95 *
	gv®ue_
 = 
queue
.
back
 ();

96  
	gŒue
;

102 
šlše
 
boŞ
 
æush
 ()

105 ià(
	gw
 =ğ
f
)

106  
Œue
;

109 ià(
	gc
.
ÿs
 (
w
, 
f
) != w) {

116 
c
.
£t
 (
f
);

117 
	gw
 = 
f
;

118  
	gçl£
;

123 
	gw
 = 
f
;

124  
	gŒue
;

128 
šlše
 
boŞ
 
check_»ad
 ()

131 ià(&
	gqueue
.
äÚt
 (è!ğ
r
 &&„)

132  
Œue
;

138 
	gr
 = 
c
.
ÿs
 (&
queue
.
äÚt
 (), 
NULL
);

144 ià(&
	gqueue
.
äÚt
 (è=ğ
r
 || !r)

145  
çl£
;

148  
	gŒue
;

153 
šlše
 
boŞ
 
»ad
 (
T
 *
v®ue_
)

156 ià(!
check_»ad
 ())

157  
	gçl£
;

161 *
	gv®ue_
 = 
queue
.
äÚt
 ();

162 
	gqueue
.
pİ
 ();

163  
	gŒue
;

169 
šlše
 
boŞ
 
´obe
 (boŞ (*
â
)(
T
 &))

171 
boŞ
 
	grc
 = 
check_»ad
 ();

172 
zmq_as£¹
 (
rc
);

174  (*
	gâ
è(
	gqueue
.
äÚt
 ());

177 
	g´Ùeùed
:

183 
yqueue_t
 <
T
, 
	gN
> 
	gqueue
;

187 
T
 *
	gw
;

191 
T
 *
	gr
;

194 
T
 *
	gf
;

200 
	g©omic_±r_t
 <
	gT
> 
	gc
;

203 
ype_t
 (const ypipe_t&);

204 cÚ¡ 
	gype_t
 &
	gİ”©Ü
 = (cÚ¡ 
ype_t
&);

	@ypipe_base.hpp

21 #iâdeà
__ZMQ_YPIPE_BASE_HPP_INCLUDED__


22 
	#__ZMQ_YPIPE_BASE_HPP_INCLUDED__


	)

25 
Çme¥aû
 
	gzmq


31 
	g‹m¶©e
 <
ty³Çme
 
	gT
, 
	gN
> cÏs 
	cype_ba£_t


33 
	gpublic
:

34 
vœtu®
 ~
ype_ba£_t
 () {}

35 
vœtu®
 
wr™e
 (cÚ¡ 
T
 &
v®ue_
, 
boŞ
 
šcom¶‘e_
) = 0;

36 
vœtu®
 
boŞ
 
unwr™e
 (
T
 *
v®ue_
) = 0;

37 
vœtu®
 
boŞ
 
æush
 () = 0;

38 
vœtu®
 
boŞ
 
check_»ad
 () = 0;

39 
vœtu®
 
boŞ
 
»ad
 (
T
 *
v®ue_
) = 0;

40 
vœtu®
 
boŞ
 
´obe
 (boŞ (*
â
)(
T
 &)) = 0;

	@ypipe_conflate.hpp

20 #iâdeà
__ZMQ_YPIPE_CONFLATE_HPP_INCLUDED__


21 
	#__ZMQ_YPIPE_CONFLATE_HPP_INCLUDED__


	)

23 
	~"¶©fÜm.hµ
"

24 
	~"dbufãr.hµ
"

25 
	~"ype_ba£.hµ
"

27 
Çme¥aû
 
	gzmq


37 
	g‹m¶©e
 <
ty³Çme
 
	gT
, 
	gN
> 
şass
 
	gype_cÚæ©e_t
 : 
public
 
ype_ba£_t
<
T
,N>

39 
	gpublic
:

42 
šlše
 
ype_cÚæ©e_t
 ()

43 : 
»ad”_awake
(
çl£
)

49 
šlše
 
vœtu®
 ~
ype_cÚæ©e_t
 ()

57 #ifdeà
ZMQ_HAVE_OPENVMS


58 #´agm¨
mes§ge
 
§ve


59 #´agm¨
mes§ge
 
di§bË
(
UNINIT
)

61 
šlše
 
wr™e
 (cÚ¡ 
T
 &
v®ue_
, 
boŞ
 
šcom¶‘e_
)

63 ()
	gšcom¶‘e_
;

65 
	gdbufãr
.
wr™e
 (
v®ue_
);

68 #ifdeà
ZMQ_HAVE_OPENVMS


69 #´agm¨
mes§ge
 
»¡Üe


73 
šlše
 
boŞ
 
unwr™e
 (
T
 *
v®ue_
)

75  
	gçl£
;

82 
šlše
 
boŞ
 
æush
 ()

84  
	g»ad”_awake
;

88 
šlše
 
boŞ
 
check_»ad
 ()

90 
boŞ
 
	g»s
 = 
dbufãr
.
check_»ad
 ();

91 ià(!
	g»s
)

92 
	g»ad”_awake
 = 
çl£
;

94  
	g»s
;

99 
šlše
 
boŞ
 
»ad
 (
T
 *
v®ue_
)

101 ià(!
check_»ad
 ())

102  
	gçl£
;

104  
	gdbufãr
.
»ad
 (
v®ue_
);

110 
šlše
 
boŞ
 
´obe
 (boŞ (*
â
)(
T
 &))

112  
	gdbufãr
.
´obe
 (
â
);

115 
	g´Ùeùed
:

117 
dbufãr_t
 <
T
> 
dbufãr
;

118 
boŞ
 
	g»ad”_awake
;

121 
ype_cÚæ©e_t
 (const ypipe_conflate_t&);

122 cÚ¡ 
	gype_cÚæ©e_t
 &
	gİ”©Ü
 = (cÚ¡ 
ype_cÚæ©e_t
&);

	@yqueue.hpp

20 #iâdeà
__ZMQ_YQUEUE_HPP_INCLUDED__


21 
	#__ZMQ_YQUEUE_HPP_INCLUDED__


	)

23 
	~<¡dlib.h
>

24 
	~<¡ddef.h
>

26 
	~"”r.hµ
"

27 
	~"©omic_±r.hµ
"

29 
Çme¥aû
 
	gzmq


45 
	g‹m¶©e
 <
ty³Çme
 
	gT
, 
	gN
> cÏs 
	cyqueue_t


47 
	gpublic
:

50 
šlše
 
yqueue_t
 ()

52 
begš_chunk
 = (
chunk_t
*è
m®loc
 ( (chunk_t));

53 
®loc_as£¹
 (
begš_chunk
);

54 
	gbegš_pos
 = 0;

55 
	gback_chunk
 = 
NULL
;

56 
	gback_pos
 = 0;

57 
	g’d_chunk
 = 
begš_chunk
;

58 
	g’d_pos
 = 0;

62 
	gšlše
 ~
yqueue_t
 ()

64 
	gŒue
) {

65 ià(
	gbegš_chunk
 =ğ
’d_chunk
) {

66 
ä“
 (
begš_chunk
);

69 
chunk_t
 *
	go
 = 
begš_chunk
;

70 
	gbegš_chunk
 = 
begš_chunk
->
Ãxt
;

71 
ä“
 (
o
);

74 
chunk_t
 *
	gsc
 = 
¥¬e_chunk
.
xchg
 (
NULL
);

75 
ä“
 (
sc
);

80 
šlše
 
	gT
 &
äÚt
 ()

82  
	gbegš_chunk
->
	gv®ues
 [
begš_pos
];

87 
šlše
 
	gT
 &
back
 ()

89  
	gback_chunk
->
	gv®ues
 [
back_pos
];

93 
šlše
 
push
 ()

95 
	gback_chunk
 = 
’d_chunk
;

96 
	gback_pos
 = 
’d_pos
;

98 ià(++
	g’d_pos
 !ğ
N
)

101 
chunk_t
 *
	gsc
 = 
¥¬e_chunk
.
xchg
 (
NULL
);

102 ià(
	gsc
) {

103 
	g’d_chunk
->
	gÃxt
 = 
sc
;

104 
	gsc
->
	g´ev
 = 
’d_chunk
;

106 
	g’d_chunk
->
	gÃxt
 = (
chunk_t
*è
m®loc
 ( (chunk_t));

107 
®loc_as£¹
 (
’d_chunk
->
Ãxt
);

108 
	g’d_chunk
->
	gÃxt
->
	g´ev
 = 
’d_chunk
;

110 
	g’d_chunk
 = 
’d_chunk
->
Ãxt
;

111 
	g’d_pos
 = 0;

121 
šlše
 
uÅush
 ()

124 ià(
	gback_pos
)

125 --
	gback_pos
;

127 
	gback_pos
 = 
N
 - 1;

128 
	gback_chunk
 = 
back_chunk
->
´ev
;

135 ià(
	g’d_pos
)

136 --
	g’d_pos
;

138 
	g’d_pos
 = 
N
 - 1;

139 
	g’d_chunk
 = 
’d_chunk
->
´ev
;

140 
ä“
 (
’d_chunk
->
Ãxt
);

141 
	g’d_chunk
->
	gÃxt
 = 
NULL
;

146 
šlše
 
pİ
 ()

148 ià(++ 
	gbegš_pos
 =ğ
N
) {

149 
chunk_t
 *
o
 = 
begš_chunk
;

150 
	gbegš_chunk
 = 
begš_chunk
->
Ãxt
;

151 
	gbegš_chunk
->
	g´ev
 = 
NULL
;

152 
	gbegš_pos
 = 0;

157 
chunk_t
 *
	gcs
 = 
¥¬e_chunk
.
xchg
 (
o
);

158 
ä“
 (
cs
);

162 
	g´iv©e
:

165 
	schunk_t


167 
T
 
v®ues
 [
N
];

168 
chunk_t
 *
	g´ev
;

169 
chunk_t
 *
	gÃxt
;

176 
chunk_t
 *
	gbegš_chunk
;

177 
	gbegš_pos
;

178 
chunk_t
 *
	gback_chunk
;

179 
	gback_pos
;

180 
chunk_t
 *
	g’d_chunk
;

181 
	g’d_pos
;

186 
	g©omic_±r_t
<
	gchunk_t
> 
	g¥¬e_chunk
;

189 
yqueue_t
 (const yqueue_t&);

190 cÚ¡ 
	gyqueue_t
 &
	gİ”©Ü
 = (cÚ¡ 
yqueue_t
&);

	@zmq.cpp

19 
	#ZMQ_TYPE_UNSAFE


	)

21 
	~"¶©fÜm.hµ
"

23 #ià
defšed
 
ZMQ_FORCE_SELECT


24 
	#ZMQ_POLL_BASED_ON_SELECT


	)

25 #–ià
defšed
 
ZMQ_FORCE_POLL


26 
	#ZMQ_POLL_BASED_ON_POLL


	)

27 #–ià
defšed
 
ZMQ_HAVE_LINUX
 || defšed 
ZMQ_HAVE_FREEBSD
 ||\

28 
defšed
 
	gZMQ_HAVE_OPENBSD
 || defšed 
	gZMQ_HAVE_SOLARIS
 ||\

29 
defšed
 
	gZMQ_HAVE_OSX
 || defšed 
	gZMQ_HAVE_QNXNTO
 ||\

30 
defšed
 
	gZMQ_HAVE_HPUX
 || defšed 
	gZMQ_HAVE_AIX
 ||\

31 
defšed
 
	gZMQ_HAVE_NETBSD


32 
	#ZMQ_POLL_BASED_ON_POLL


	)

33 #–ià
defšed
 
ZMQ_HAVE_WINDOWS
 || defšed 
ZMQ_HAVE_OPENVMS
 ||\

34 
defšed
 
	gZMQ_HAVE_CYGWIN


35 
	#ZMQ_POLL_BASED_ON_SELECT


	)

42 #ià
defšed
 
ZMQ_POLL_BASED_ON_POLL


43 
	~<pŞl.h
>

47 
	~"../šşude/zmq.h
"

49 #ià
defšed
 
ZMQ_HAVE_WINDOWS


50 
	~"wšdows.hµ
"

52 
	~<uni¡d.h
>

57 #ià
defšed
 
ZMQ_HAVE_UIO


58 
	~<sys/uio.h
>

60 
	siovec
 {

61 *
	miov_ba£
;

62 
size_t
 
	miov_Ën
;

67 
	~<¡ršg.h
>

68 
	~<¡dlib.h
>

69 
	~<Ãw
>

71 
	~"´oxy.hµ
"

72 
	~"sock‘_ba£.hµ
"

73 
	~"¡dšt.hµ
"

74 
	~"cÚfig.hµ
"

75 
	~"lik–y.hµ
"

76 
	~"şock.hµ
"

77 
	~"ùx.hµ
"

78 
	~"”r.hµ
"

79 
	~"msg.hµ
"

80 
	~"fd.hµ
"

82 #ià!
defšed
 
ZMQ_HAVE_WINDOWS


83 
	~<uni¡d.h
>

86 #ià
defšed
 
ZMQ_HAVE_OPENPGM


87 
	#__PGM_WININT_H__


	)

88 
	~<pgm/pgm.h
>

92 
	tcheck_msg_t_size


93 [ (
zmq
::
msg_t
è=ğ (
zmq_msg_t
) ? 1 : -1];

96 
	$zmq_v”siÚ
 (*
majÜ_
, *
mšÜ_
, *
·tch_
)

98 *
majÜ_
 = 
ZMQ_VERSION_MAJOR
;

99 *
mšÜ_
 = 
ZMQ_VERSION_MINOR
;

100 *
·tch_
 = 
ZMQ_VERSION_PATCH
;

101 
	}
}

104 cÚ¡ *
	$zmq_¡»¼Ü
 (
”ºum_
)

106  
zmq
::
	`”ºo_to_¡ršg
 (
”ºum_
);

107 
	}
}

109 
	$zmq_”ºo
 ()

111  
”ºo
;

112 
	}
}

117 *
	$zmq_ùx_Ãw
 ()

119 #ià
defšed
 
ZMQ_HAVE_OPENPGM


125 
pgm_”rÜ_t
 *
pgm_”rÜ
 = 
NULL
;

126 cÚ¡ 
boŞ
 
ok
 = 
	`pgm_š™
 (&
pgm_”rÜ
);

127 ià(
ok
 !ğ
TRUE
) {

130 
	`zmq_as£¹
 (
pgm_”rÜ
 !ğ
NULL
);

131 ià(
pgm_”rÜ
->
domaš
 =ğ
PGM_ERROR_DOMAIN_TIME
 && (

132 
pgm_”rÜ
->
code
 =ğ
PGM_ERROR_FAILED
)) {

135 
	`pgm_”rÜ_ä“
 (
pgm_”rÜ
);

136 
”ºo
 = 
EINVAL
;

137  
NULL
;

141 
	`zmq_as£¹
 (
çl£
);

145 #ifdeà
ZMQ_HAVE_WINDOWS


150 
WORD
 
v”siÚ_»que¡ed
 = 
	`MAKEWORD
 (2, 2);

151 
WSADATA
 
w§_d©a
;

152 
rc
 = 
	`WSAS¹up
 (
v”siÚ_»que¡ed
, &
w§_d©a
);

153 
	`zmq_as£¹
 (
rc
 == 0);

154 
	`zmq_as£¹
 (
	`LOBYTE
 (
w§_d©a
.
wV”siÚ
) == 2 &&

155 
	`HIBYTE
 (
w§_d©a
.
wV”siÚ
) == 2);

159 
zmq
::
ùx_t
 *
ùx
 = 
	`Ãw
 (
¡d
::
nÙhrow
) zmq::ctx_t;

160 
	`®loc_as£¹
 (
ùx
);

161  
ùx
;

162 
	}
}

164 
	$zmq_ùx_‹rm
 (*
ùx_
)

166 ià(!
ùx_
 || !((
zmq
::
ùx_t
*èùx_)->
	`check_g
 ()) {

167 
”ºo
 = 
EFAULT
;

171 
rc
 = ((
zmq
::
ùx_t
*è
ùx_
)->
	`‹rmš©e
 ();

172 
’
 = 
”ºo
;

175 ià(!
rc
 || 
’
 !ğ
EINTR
) {

176 #ifdeà
ZMQ_HAVE_WINDOWS


178 
rc
 = 
	`WSACËªup
 ();

179 
	`w§_as£¹
 (
rc
 !ğ
SOCKET_ERROR
);

182 #ià
defšed
 
ZMQ_HAVE_OPENPGM


184 ià(
	`pgm_shutdown
 (è!ğ
TRUE
)

185 
	`zmq_as£¹
 (
çl£
);

189 
”ºo
 = 
’
;

190  
rc
;

191 
	}
}

193 
	$zmq_ùx_shutdown
 (*
ùx_
)

195 ià(!
ùx_
 || !((
zmq
::
ùx_t
*èùx_)->
	`check_g
 ()) {

196 
”ºo
 = 
EFAULT
;

200  ((
zmq
::
ùx_t
*è
ùx_
)->
	`shutdown
 ();

201 
	}
}

203 
	$zmq_ùx_£t
 (*
ùx_
, 
İtiÚ_
, 
İtv®_
)

205 ià(!
ùx_
 || !((
zmq
::
ùx_t
*èùx_)->
	`check_g
 ()) {

206 
”ºo
 = 
EFAULT
;

209  ((
zmq
::
ùx_t
*è
ùx_
)->
	`£t
 (
İtiÚ_
, 
İtv®_
);

210 
	}
}

212 
	$zmq_ùx_g‘
 (*
ùx_
, 
İtiÚ_
)

214 ià(!
ùx_
 || !((
zmq
::
ùx_t
*èùx_)->
	`check_g
 ()) {

215 
”ºo
 = 
EFAULT
;

218  ((
zmq
::
ùx_t
*è
ùx_
)->
	`g‘
 (
İtiÚ_
);

219 
	}
}

223 *
	$zmq_š™
 (
io_th»ads_
)

225 ià(
io_th»ads_
 >= 0) {

226 *
ùx
 = 
	`zmq_ùx_Ãw
 ();

227 
	`zmq_ùx_£t
 (
ùx
, 
ZMQ_IO_THREADS
, 
io_th»ads_
);

228  
ùx
;

230 
”ºo
 = 
EINVAL
;

231  
NULL
;

232 
	}
}

234 
	$zmq_‹rm
 (*
ùx_
)

236  
	`zmq_ùx_‹rm
 (
ùx_
);

237 
	}
}

239 
	$zmq_ùx_de¡roy
 (*
ùx_
)

241  
	`zmq_ùx_‹rm
 (
ùx_
);

242 
	}
}

247 *
	$zmq_sock‘
 (*
ùx_
, 
ty³_
)

249 ià(!
ùx_
 || !((
zmq
::
ùx_t
*èùx_)->
	`check_g
 ()) {

250 
”ºo
 = 
EFAULT
;

251  
NULL
;

253 
zmq
::
ùx_t
 *
ùx
 = (zmq::ùx_t*è
ùx_
;

254 
zmq
::
sock‘_ba£_t
 *
s
 = 
ùx
->
	`ü—‹_sock‘
 (
ty³_
);

255  (*è
s
;

256 
	}
}

258 
	$zmq_şo£
 (*
s_
)

260 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

261 
”ºo
 = 
ENOTSOCK
;

264 ((
zmq
::
sock‘_ba£_t
*è
s_
)->
	`şo£
 ();

266 
	}
}

268 
	$zmq_£tsockİt
 (*
s_
, 
İtiÚ_
, cÚ¡ *
İtv®_
,

269 
size_t
 
İtv®Ën_
)

271 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

272 
”ºo
 = 
ENOTSOCK
;

275 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

276 
»suÉ
 = 
s
->
	`£tsockİt
 (
İtiÚ_
, 
İtv®_
, 
İtv®Ën_
);

277  
»suÉ
;

278 
	}
}

280 
	$zmq_g‘sockİt
 (*
s_
, 
İtiÚ_
, *
İtv®_
, 
size_t
 *
İtv®Ën_
)

282 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

283 
”ºo
 = 
ENOTSOCK
;

286 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

287 
»suÉ
 = 
s
->
	`g‘sockİt
 (
İtiÚ_
, 
İtv®_
, 
İtv®Ën_
);

288  
»suÉ
;

289 
	}
}

291 
	$zmq_sock‘_mÚ™Ü
 (*
s_
, cÚ¡ *
addr_
, 
ev’ts_
)

293 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

294 
”ºo
 = 
ENOTSOCK
;

297 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

298 
»suÉ
 = 
s
->
	`mÚ™Ü
 (
addr_
, 
ev’ts_
);

299  
»suÉ
;

300 
	}
}

302 
	$zmq_bšd
 (*
s_
, cÚ¡ *
addr_
)

304 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

305 
”ºo
 = 
ENOTSOCK
;

308 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

309 
»suÉ
 = 
s
->
	`bšd
 (
addr_
);

310  
»suÉ
;

311 
	}
}

313 
	$zmq_cÚÃù
 (*
s_
, cÚ¡ *
addr_
)

315 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

316 
”ºo
 = 
ENOTSOCK
;

319 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

320 
»suÉ
 = 
s
->
	`cÚÃù
 (
addr_
);

321  
»suÉ
;

322 
	}
}

324 
	$zmq_unbšd
 (*
s_
, cÚ¡ *
addr_
)

326 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

327 
”ºo
 = 
ENOTSOCK
;

330 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

331  
s
->
	`‹rm_’dpošt
 (
addr_
);

332 
	}
}

334 
	$zmq_discÚÃù
 (*
s_
, cÚ¡ *
addr_
)

336 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

337 
”ºo
 = 
ENOTSOCK
;

340 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

341  
s
->
	`‹rm_’dpošt
 (
addr_
);

342 
	}
}

347 
	$s_£ndmsg
 (
zmq
::
sock‘_ba£_t
 *
s_
, 
zmq_msg_t
 *
msg_
, 
æags_
)

349 
sz
 = (è
	`zmq_msg_size
 (
msg_
);

350 
rc
 = 
s_
->
	`£nd
 ((
zmq
::
msg_t
*è
msg_
, 
æags_
);

351 ià(
	`uÆik–y
 (
rc
 < 0))

353  
sz
;

354 
	}
}

357 
	$zmq_£ndmsg
 (*
s_
, 
zmq_msg_t
 *
msg_
, 
æags_
)

359  
	`zmq_msg_£nd
 (
msg_
, 
s_
, 
æags_
);

360 
	}
}

362 
	$zmq_£nd
 (*
s_
, cÚ¡ *
buf_
, 
size_t
 
Ën_
, 
æags_
)

364 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

365 
”ºo
 = 
ENOTSOCK
;

368 
zmq_msg_t
 
msg
;

369 
rc
 = 
	`zmq_msg_š™_size
 (&
msg
, 
Ën_
);

370 ià(
rc
 != 0)

372 
	`memıy
 (
	`zmq_msg_d©a
 (&
msg
), 
buf_
, 
Ën_
);

374 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

375 
rc
 = 
	`s_£ndmsg
 (
s
, &
msg
, 
æags_
);

376 ià(
	`uÆik–y
 (
rc
 < 0)) {

377 
”r
 = 
”ºo
;

378 
rc2
 = 
	`zmq_msg_şo£
 (&
msg
);

379 
	`”ºo_as£¹
 (
rc2
 == 0);

380 
”ºo
 = 
”r
;

386  
rc
;

387 
	}
}

389 
	$zmq_£nd_cÚ¡
 (*
s_
, cÚ¡ *
buf_
, 
size_t
 
Ën_
, 
æags_
)

391 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

392 
”ºo
 = 
ENOTSOCK
;

395 
zmq_msg_t
 
msg
;

396 
rc
 = 
	`zmq_msg_š™_d©a
 (&
msg
, (*)
buf_
, 
Ën_
, 
NULL
, NULL);

397 ià(
rc
 != 0)

400 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

401 
rc
 = 
	`s_£ndmsg
 (
s
, &
msg
, 
æags_
);

402 ià(
	`uÆik–y
 (
rc
 < 0)) {

403 
”r
 = 
”ºo
;

404 
rc2
 = 
	`zmq_msg_şo£
 (&
msg
);

405 
	`”ºo_as£¹
 (
rc2
 == 0);

406 
”ºo
 = 
”r
;

412  
rc
;

413 
	}
}

423 
	$zmq_£ndiov
 (*
s_
, 
iovec
 *
a_
, 
size_t
 
couÁ_
, 
æags_
)

425 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

426 
”ºo
 = 
ENOTSOCK
;

429 
rc
 = 0;

430 
zmq_msg_t
 
msg
;

431 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

433 
size_t
 
i
 = 0; i < 
couÁ_
; ++i) {

434 
rc
 = 
	`zmq_msg_š™_size
 (&
msg
, 
a_
[
i
].
iov_Ën
);

435 ià(
rc
 != 0) {

436 
rc
 = -1;

439 
	`memıy
 (
	`zmq_msg_d©a
 (&
msg
), 
a_
[
i
].
iov_ba£
,‡_[i].
iov_Ën
);

440 ià(
i
 =ğ
couÁ_
 - 1)

441 
æags_
 = fÏgs_ & ~
ZMQ_SNDMORE
;

442 
rc
 = 
	`s_£ndmsg
 (
s
, &
msg
, 
æags_
);

443 ià(
	`uÆik–y
 (
rc
 < 0)) {

444 
”r
 = 
”ºo
;

445 
rc2
 = 
	`zmq_msg_şo£
 (&
msg
);

446 
	`”ºo_as£¹
 (
rc2
 == 0);

447 
”ºo
 = 
”r
;

448 
rc
 = -1;

452  
rc
;

453 
	}
}

458 
	$s_»cvmsg
 (
zmq
::
sock‘_ba£_t
 *
s_
, 
zmq_msg_t
 *
msg_
, 
æags_
)

460 
rc
 = 
s_
->
	`»cv
 ((
zmq
::
msg_t
*è
msg_
, 
æags_
);

461 ià(
	`uÆik–y
 (
rc
 < 0))

463  (è
	`zmq_msg_size
 (
msg_
);

464 
	}
}

467 
	$zmq_»cvmsg
 (*
s_
, 
zmq_msg_t
 *
msg_
, 
æags_
)

469  
	`zmq_msg_»cv
 (
msg_
, 
s_
, 
æags_
);

470 
	}
}

473 
	$zmq_»cv
 (*
s_
, *
buf_
, 
size_t
 
Ën_
, 
æags_
)

475 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

476 
”ºo
 = 
ENOTSOCK
;

479 
zmq_msg_t
 
msg
;

480 
rc
 = 
	`zmq_msg_š™
 (&
msg
);

481 
	`”ºo_as£¹
 (
rc
 == 0);

483 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

484 
nby‹s
 = 
	`s_»cvmsg
 (
s
, &
msg
, 
æags_
);

485 ià(
	`uÆik–y
 (
nby‹s
 < 0)) {

486 
”r
 = 
”ºo
;

487 
rc
 = 
	`zmq_msg_şo£
 (&
msg
);

488 
	`”ºo_as£¹
 (
rc
 == 0);

489 
”ºo
 = 
”r
;

495 
size_t
 
to_cİy
 = 
	`size_t
 (
nby‹s
è< 
Ën_
 ? size_t (nbytes) :†en_;

496 
	`memıy
 (
buf_
, 
	`zmq_msg_d©a
 (&
msg
), 
to_cİy
);

498 
rc
 = 
	`zmq_msg_şo£
 (&
msg
);

499 
	`”ºo_as£¹
 (
rc
 == 0);

501  
nby‹s
;

502 
	}
}

520 
	$zmq_»cviov
 (*
s_
, 
iovec
 *
a_
, 
size_t
 *
couÁ_
, 
æags_
)

522 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

523 
”ºo
 = 
ENOTSOCK
;

526 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

528 
size_t
 
couÁ
 = *
couÁ_
;

529 
Ä—d
 = 0;

530 
boŞ
 
»cvmÜe
 = 
Œue
;

532 *
couÁ_
 = 0;

534 
size_t
 
i
 = 0; 
»cvmÜe
 && i < 
couÁ
; ++i) {

536 
zmq_msg_t
 
msg
;

537 
rc
 = 
	`zmq_msg_š™
 (&
msg
);

538 
	`”ºo_as£¹
 (
rc
 == 0);

540 
nby‹s
 = 
	`s_»cvmsg
 (
s
, &
msg
, 
æags_
);

541 ià(
	`uÆik–y
 (
nby‹s
 < 0)) {

542 
”r
 = 
”ºo
;

543 
rc
 = 
	`zmq_msg_şo£
 (&
msg
);

544 
	`”ºo_as£¹
 (
rc
 == 0);

545 
”ºo
 = 
”r
;

546 
Ä—d
 = -1;

550 
a_
[
i
].
iov_Ën
 = 
	`zmq_msg_size
 (&
msg
);

551 
a_
[
i
].
iov_ba£
 = 
	`m®loc
×_[i].
iov_Ën
);

552 ià(
	`uÆik–y
 (!
a_
[
i
].
iov_ba£
)) {

553 
”ºo
 = 
ENOMEM
;

556 
	`memıy
(
a_
[
i
].
iov_ba£
,
¡©ic_ÿ¡
<*> (
	`zmq_msg_d©a
 (&
msg
)),

557 
a_
[
i
].
iov_Ën
);

559 
»cvmÜe
 = ((
zmq
::
msg_t
*è(*è&
msg
)->
	`æags
 (è& zmq::msg_t::
mÜe
;

560 
rc
 = 
	`zmq_msg_şo£
(&
msg
);

561 
	`”ºo_as£¹
 (
rc
 == 0);

562 ++*
couÁ_
;

563 ++
Ä—d
;

565  
Ä—d
;

566 
	}
}

570 
	$zmq_msg_š™
 (
zmq_msg_t
 *
msg_
)

572  ((
zmq
::
msg_t
*è
msg_
)->
	`š™
 ();

573 
	}
}

575 
	$zmq_msg_š™_size
 (
zmq_msg_t
 *
msg_
, 
size_t
 
size_
)

577  ((
zmq
::
msg_t
*è
msg_
)->
	`š™_size
 (
size_
);

578 
	}
}

580 
	$zmq_msg_š™_d©a
 (
zmq_msg_t
 *
msg_
, *
d©a_
, 
size_t
 
size_
,

581 
zmq_ä“_â
 *
fâ_
, *
hšt_
)

583  ((
zmq
::
msg_t
*è
msg_
)->
	`š™_d©a
 (
d©a_
, 
size_
, 
fâ_
, 
hšt_
);

584 
	}
}

586 
	$zmq_msg_£nd
 (
zmq_msg_t
 *
msg_
, *
s_
, 
æags_
)

588 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

589 
”ºo
 = 
ENOTSOCK
;

592 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

593 
»suÉ
 = 
	`s_£ndmsg
 (
s
, 
msg_
, 
æags_
);

594  
»suÉ
;

595 
	}
}

597 
	$zmq_msg_»cv
 (
zmq_msg_t
 *
msg_
, *
s_
, 
æags_
)

599 ià(!
s_
 || !((
zmq
::
sock‘_ba£_t
*ès_)->
	`check_g
 ()) {

600 
”ºo
 = 
ENOTSOCK
;

603 
zmq
::
sock‘_ba£_t
 *
s
 = (zmq::sock‘_ba£_ˆ*è
s_
;

604 
»suÉ
 = 
	`s_»cvmsg
 (
s
, 
msg_
, 
æags_
);

605  
»suÉ
;

606 
	}
}

608 
	$zmq_msg_şo£
 (
zmq_msg_t
 *
msg_
)

610  ((
zmq
::
msg_t
*è
msg_
)->
	`şo£
 ();

611 
	}
}

613 
	$zmq_msg_move
 (
zmq_msg_t
 *
de¡_
, zmq_msg_ˆ*
¤c_
)

615  ((
zmq
::
msg_t
*è
de¡_
)->
	`move
 (*(zmq::msg_t*è
¤c_
);

616 
	}
}

618 
	$zmq_msg_cİy
 (
zmq_msg_t
 *
de¡_
, zmq_msg_ˆ*
¤c_
)

620  ((
zmq
::
msg_t
*è
de¡_
)->
	`cİy
 (*(zmq::msg_t*è
¤c_
);

621 
	}
}

623 *
	$zmq_msg_d©a
 (
zmq_msg_t
 *
msg_
)

625  ((
zmq
::
msg_t
*è
msg_
)->
	`d©a
 ();

626 
	}
}

628 
size_t
 
	$zmq_msg_size
 (
zmq_msg_t
 *
msg_
)

630  ((
zmq
::
msg_t
*è
msg_
)->
	`size
 ();

631 
	}
}

633 
	$zmq_msg_mÜe
 (
zmq_msg_t
 *
msg_
)

635  
	`zmq_msg_g‘
 (
msg_
, 
ZMQ_MORE
);

636 
	}
}

638 
	$zmq_msg_g‘
 (
zmq_msg_t
 *
msg_
, 
İtiÚ_
)

640 
İtiÚ_
) {

641 
ZMQ_MORE
:

642  (((
zmq
::
msg_t
*è
msg_
)->
	`æags
 (è& zmq::msg_t::
mÜe
)? 1: 0;

644 
”ºo
 = 
EINVAL
;

647 
	}
}

649 
	$zmq_msg_£t
 (
zmq_msg_t
 *, , )

652 
”ºo
 = 
EINVAL
;

654 
	}
}

658 
	$zmq_pŞl
 (
zmq_pŞl™em_t
 *
™ems_
, 
n™ems_
, 
timeout_
)

660 #ià
defšed
 
ZMQ_POLL_BASED_ON_POLL


661 ià(
	`uÆik–y
 (
n™ems_
 < 0)) {

662 
”ºo
 = 
EINVAL
;

665 ià(
	`uÆik–y
 (
n™ems_
 == 0)) {

666 ià(
timeout_
 == 0)

668 #ià
defšed
 
ZMQ_HAVE_WINDOWS


669 
	`SË•
 (
timeout_
 > 0 ?imeout_ : 
INFINITE
);

671 #–ià
defšed
 
ZMQ_HAVE_ANDROID


672 
	`u¦“p
 (
timeout_
 * 1000);

675  
	`u¦“p
 (
timeout_
 * 1000);

679 ià(!
™ems_
) {

680 
”ºo
 = 
EFAULT
;

684 
zmq
::
şock_t
 
şock
;

685 
ušt64_t
 
now
 = 0;

686 
ušt64_t
 
’d
 = 0;

687 
pŞlfd
 
¥Şlfds
[
ZMQ_POLLITEMS_DFLT
];

688 
pŞlfd
 *
pŞlfds
 = 
¥Şlfds
;

690 ià(
n™ems_
 > 
ZMQ_POLLITEMS_DFLT
) {

691 
pŞlfds
 = (
pŞlfd
*è
	`m®loc
 (
n™ems_
 *  (pollfd));

692 
	`®loc_as£¹
 (
pŞlfds
);

696 
i
 = 0; i !ğ
n™ems_
; i++) {

700 ià(
™ems_
 [
i
].
sock‘
) {

701 
size_t
 
zmq_fd_size
 =  (
zmq
::
fd_t
);

702 ià(
	`zmq_g‘sockİt
 (
™ems_
 [
i
].
sock‘
, 
ZMQ_FD
, &
pŞlfds
 [i].
fd
,

703 &
zmq_fd_size
) == -1) {

704 ià(
pŞlfds
 !ğ
¥Şlfds
)

705 
	`ä“
 (
pŞlfds
);

708 
pŞlfds
 [
i
].
ev’ts
 = 
™ems_
 [i].ev’t ? 
POLLIN
 : 0;

713 
pŞlfds
 [
i
].
fd
 = 
™ems_
 [i].fd;

714 
pŞlfds
 [
i
].
ev’ts
 =

715 (
™ems_
 [
i
].
ev’ts
 & 
ZMQ_POLLIN
 ? 
POLLIN
 : 0) |

716 (
™ems_
 [
i
].
ev’ts
 & 
ZMQ_POLLOUT
 ? 
POLLOUT
 : 0);

720 
boŞ
 
fœ¡_·ss
 = 
Œue
;

721 
Ãv’ts
 = 0;

723 
Œue
) {

725 
timeout
;

726 ià(
fœ¡_·ss
)

727 
timeout
 = 0;

729 ià(
timeout_
 < 0)

730 
timeout
 = -1;

732 
timeout
 = 
’d
 - 
now
;

735 
Œue
) {

736 
rc
 = 
	`pŞl
 (
pŞlfds
, 
n™ems_
, 
timeout
);

737 ià(
rc
 =ğ-1 && 
”ºo
 =ğ
EINTR
) {

738 ià(
pŞlfds
 !ğ
¥Şlfds
)

739 
	`ä“
 (
pŞlfds
);

742 
	`”ºo_as£¹
 (
rc
 >= 0);

746 
i
 = 0; i !ğ
n™ems_
; i++) {

748 
™ems_
 [
i
].
»v’ts
 = 0;

752 ià(
™ems_
 [
i
].
sock‘
) {

753 
size_t
 
zmq_ev’ts_size
 =  (
ušt32_t
);

754 
ušt32_t
 
zmq_ev’ts
;

755 ià(
	`zmq_g‘sockİt
 (
™ems_
 [
i
].
sock‘
, 
ZMQ_EVENTS
, &
zmq_ev’ts
,

756 &
zmq_ev’ts_size
) == -1) {

757 ià(
pŞlfds
 !ğ
¥Şlfds
)

758 
	`ä“
 (
pŞlfds
);

761 ià((
™ems_
 [
i
].
ev’ts
 & 
ZMQ_POLLOUT
) &&

762 (
zmq_ev’ts
 & 
ZMQ_POLLOUT
))

763 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLOUT
;

764 ià((
™ems_
 [
i
].
ev’ts
 & 
ZMQ_POLLIN
) &&

765 (
zmq_ev’ts
 & 
ZMQ_POLLIN
))

766 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLIN
;

771 ià(
pŞlfds
 [
i
].
»v’ts
 & 
POLLIN
)

772 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLIN
;

773 ià(
pŞlfds
 [
i
].
»v’ts
 & 
POLLOUT
)

774 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLOUT
;

775 ià(
pŞlfds
 [
i
].
»v’ts
 & ~(
POLLIN
 | 
POLLOUT
))

776 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLERR
;

779 ià(
™ems_
 [
i
].
»v’ts
)

780 
Ãv’ts
++;

784 ià(
timeout_
 == 0)

788 ià(
Ãv’ts
)

793 ià(
timeout_
 < 0) {

794 ià(
fœ¡_·ss
)

795 
fœ¡_·ss
 = 
çl£
;

803 ià(
fœ¡_·ss
) {

804 
now
 = 
şock
.
	`now_ms
 ();

805 
’d
 = 
now
 + 
timeout_
;

806 ià(
now
 =ğ
’d
)

808 
fœ¡_·ss
 = 
çl£
;

813 
now
 = 
şock
.
	`now_ms
 ();

814 ià(
now
 >ğ
’d
)

818 ià(
pŞlfds
 !ğ
¥Şlfds
)

819 
	`ä“
 (
pŞlfds
);

820  
Ãv’ts
;

822 #–ià
defšed
 
ZMQ_POLL_BASED_ON_SELECT


824 ià(
	`uÆik–y
 (
n™ems_
 < 0)) {

825 
”ºo
 = 
EINVAL
;

828 ià(
	`uÆik–y
 (
n™ems_
 == 0)) {

829 ià(
timeout_
 == 0)

831 #ià
defšed
 
ZMQ_HAVE_WINDOWS


832 
	`SË•
 (
timeout_
 > 0 ?imeout_ : 
INFINITE
);

835  
	`u¦“p
 (
timeout_
 * 1000);

838 
zmq
::
şock_t
 
şock
;

839 
ušt64_t
 
now
 = 0;

840 
ušt64_t
 
’d
 = 0;

844 
	`zmq_as£¹
 (
n™ems_
 <ğ
FD_SETSIZE
);

846 
fd_£t
 
pŞl£t_š
;

847 
	`FD_ZERO
 (&
pŞl£t_š
);

848 
fd_£t
 
pŞl£t_out
;

849 
	`FD_ZERO
 (&
pŞl£t_out
);

850 
fd_£t
 
pŞl£t_”r
;

851 
	`FD_ZERO
 (&
pŞl£t_”r
);

853 
zmq
::
fd_t
 
maxfd
 = 0;

856 
i
 = 0; i !ğ
n™ems_
; i++) {

860 ià(
™ems_
 [
i
].
sock‘
) {

861 
size_t
 
zmq_fd_size
 =  (
zmq
::
fd_t
);

862 
zmq
::
fd_t
 
nÙify_fd
;

863 ià(
	`zmq_g‘sockİt
 (
™ems_
 [
i
].
sock‘
, 
ZMQ_FD
, &
nÙify_fd
,

864 &
zmq_fd_size
) == -1)

866 ià(
™ems_
 [
i
].
ev’ts
) {

867 
	`FD_SET
 (
nÙify_fd
, &
pŞl£t_š
);

868 ià(
maxfd
 < 
nÙify_fd
)

869 
maxfd
 = 
nÙify_fd
;

875 ià(
™ems_
 [
i
].
ev’ts
 & 
ZMQ_POLLIN
)

876 
	`FD_SET
 (
™ems_
 [
i
].
fd
, &
pŞl£t_š
);

877 ià(
™ems_
 [
i
].
ev’ts
 & 
ZMQ_POLLOUT
)

878 
	`FD_SET
 (
™ems_
 [
i
].
fd
, &
pŞl£t_out
);

879 ià(
™ems_
 [
i
].
ev’ts
 & 
ZMQ_POLLERR
)

880 
	`FD_SET
 (
™ems_
 [
i
].
fd
, &
pŞl£t_”r
);

881 ià(
maxfd
 < 
™ems_
 [
i
].
fd
)

882 
maxfd
 = 
™ems_
 [
i
].
fd
;

886 
boŞ
 
fœ¡_·ss
 = 
Œue
;

887 
Ãv’ts
 = 0;

888 
fd_£t
 
š£t
, 
out£t
, 
”r£t
;

890 
Œue
) {

893 
timev®
 
timeout
;

894 
timev®
 *
±imeout
;

895 ià(
fœ¡_·ss
) {

896 
timeout
.
tv_£c
 = 0;

897 
timeout
.
tv_u£c
 = 0;

898 
±imeout
 = &
timeout
;

901 ià(
timeout_
 < 0)

902 
±imeout
 = 
NULL
;

904 
timeout
.
tv_£c
 = (è((
’d
 - 
now
) / 1000);

905 
timeout
.
tv_u£c
 = (è((
’d
 - 
now
) % 1000 * 1000);

906 
±imeout
 = &
timeout
;

910 
Œue
) {

911 
	`memıy
 (&
š£t
, &
pŞl£t_š
,  (
fd_£t
));

912 
	`memıy
 (&
out£t
, &
pŞl£t_out
,  (
fd_£t
));

913 
	`memıy
 (&
”r£t
, &
pŞl£t_”r
,  (
fd_£t
));

914 #ià
defšed
 
ZMQ_HAVE_WINDOWS


915 
rc
 = 
	`£Ëù
 (0, &
š£t
, &
out£t
, &
”r£t
, 
±imeout
);

916 ià(
	`uÆik–y
 (
rc
 =ğ
SOCKET_ERROR
)) {

917 
”ºo
 = 
zmq
::
	`w§_”rÜ_to_”ºo
 (
	`WSAG‘La¡E¼Ü
 ());

918 
	`w§_as£¹
 (
”ºo
 =ğ
ENOTSOCK
);

922 
rc
 = 
	`£Ëù
 (
maxfd
 + 1, &
š£t
, &
out£t
, &
”r£t
, 
±imeout
);

923 ià(
	`uÆik–y
 (
rc
 == -1)) {

924 
	`”ºo_as£¹
 (
”ºo
 =ğ
EINTR
 ||ƒ¼nØ=ğ
EBADF
);

932 
i
 = 0; i !ğ
n™ems_
; i++) {

934 
™ems_
 [
i
].
»v’ts
 = 0;

938 ià(
™ems_
 [
i
].
sock‘
) {

939 
size_t
 
zmq_ev’ts_size
 =  (
ušt32_t
);

940 
ušt32_t
 
zmq_ev’ts
;

941 ià(
	`zmq_g‘sockİt
 (
™ems_
 [
i
].
sock‘
, 
ZMQ_EVENTS
, &
zmq_ev’ts
,

942 &
zmq_ev’ts_size
) == -1)

944 ià((
™ems_
 [
i
].
ev’ts
 & 
ZMQ_POLLOUT
) &&

945 (
zmq_ev’ts
 & 
ZMQ_POLLOUT
))

946 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLOUT
;

947 ià((
™ems_
 [
i
].
ev’ts
 & 
ZMQ_POLLIN
) &&

948 (
zmq_ev’ts
 & 
ZMQ_POLLIN
))

949 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLIN
;

954 ià(
	`FD_ISSET
 (
™ems_
 [
i
].
fd
, &
š£t
))

955 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLIN
;

956 ià(
	`FD_ISSET
 (
™ems_
 [
i
].
fd
, &
out£t
))

957 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLOUT
;

958 ià(
	`FD_ISSET
 (
™ems_
 [
i
].
fd
, &
”r£t
))

959 
™ems_
 [
i
].
»v’ts
 |ğ
ZMQ_POLLERR
;

962 ià(
™ems_
 [
i
].
»v’ts
)

963 
Ãv’ts
++;

967 ià(
timeout_
 == 0)

971 ià(
Ãv’ts
)

976 ià(
timeout_
 < 0) {

977 ià(
fœ¡_·ss
)

978 
fœ¡_·ss
 = 
çl£
;

986 ià(
fœ¡_·ss
) {

987 
now
 = 
şock
.
	`now_ms
 ();

988 
’d
 = 
now
 + 
timeout_
;

989 ià(
now
 =ğ
’d
)

991 
fœ¡_·ss
 = 
çl£
;

996 
now
 = 
şock
.
	`now_ms
 ();

997 ià(
now
 >ğ
’d
)

1001  
Ãv’ts
;

1005 
”ºo
 = 
ENOTSUP
;

1008 
	}
}

1010 #ià
defšed
 
ZMQ_POLL_BASED_ON_SELECT


1011 #undeà
ZMQ_POLL_BASED_ON_SELECT


1013 #ià
defšed
 
ZMQ_POLL_BASED_ON_POLL


1014 #undeà
ZMQ_POLL_BASED_ON_POLL


1019 
	$zmq_´oxy
 (*
äÚ‹nd_
, *
back’d_
, *
ÿ±u»_
)

1021 ià(!
äÚ‹nd_
 || !
back’d_
) {

1022 
”ºo
 = 
EFAULT
;

1025  
zmq
::
	`´oxy
 (

1026 (
zmq
::
sock‘_ba£_t
*è
äÚ‹nd_
,

1027 (
zmq
::
sock‘_ba£_t
*è
back’d_
,

1028 (
zmq
::
sock‘_ba£_t
*è
ÿ±u»_
);

1029 
	}
}

1031 
	$zmq_´oxy_¡“¿bË
 (*
äÚ‹nd_
, *
back’d_
, *
ÿ±u»_
, *
cÚŒŞ_
)

1033 ià(!
äÚ‹nd_
 || !
back’d_
) {

1034 
”ºo
 = 
EFAULT
;

1037  
zmq
::
	`´oxy
 (

1038 (
zmq
::
sock‘_ba£_t
*è
äÚ‹nd_
,

1039 (
zmq
::
sock‘_ba£_t
*è
back’d_
,

1040 (
zmq
::
sock‘_ba£_t
*è
ÿ±u»_
,

1041 (
zmq
::
sock‘_ba£_t
*è
cÚŒŞ_
);

1042 
	}
}

1046 
	$zmq_deviû
 (, *
äÚ‹nd_
, *
back’d_
)

1048  
zmq
::
	`´oxy
 (

1049 (
zmq
::
sock‘_ba£_t
*è
äÚ‹nd_
,

1050 (
zmq
::
sock‘_ba£_t
*è
back’d_
, 
NULL
);

1051 
	}
}

	@zmq_utils.cpp

20 
	~"¶©fÜm.hµ
"

22 
	~"şock.hµ
"

23 
	~"”r.hµ
"

24 
	~"th»ad.hµ
"

25 
	~<as£¹.h
>

26 
	~"../šşude/zmq_uts.h
"

28 #ià!
defšed
 
ZMQ_HAVE_WINDOWS


29 
	~<uni¡d.h
>

31 
	~"wšdows.hµ
"

33 #ifdeà
HAVE_LIBSODIUM


34 
	~<sodium.h
>

38 
	$zmq_¦“p
 (
£cÚds_
)

40 #ià
defšed
 
ZMQ_HAVE_WINDOWS


41 
	`SË•
 (
£cÚds_
 * 1000);

43 
	`¦“p
 (
£cÚds_
);

45 
	}
}

47 *
	$zmq_¡İw©ch_¡¬t
 ()

49 
ušt64_t
 *
w©ch
 = (ušt64_t*è
	`m®loc
 ( (uint64_t));

50 
	`®loc_as£¹
 (
w©ch
);

51 *
w©ch
 = 
zmq
::
şock_t
::
	`now_us
 ();

52  (*è
w©ch
;

53 
	}
}

55 
	$zmq_¡İw©ch_¡İ
 (*
w©ch_
)

57 
ušt64_t
 
’d
 = 
zmq
::
şock_t
::
	`now_us
 ();

58 
ušt64_t
 
¡¬t
 = *(ušt64_t*è
w©ch_
;

59 
	`ä“
 (
w©ch_
);

60  (è(
’d
 - 
¡¬t
);

61 
	}
}

63 *
	$zmq_th»ad¡¬t
(
zmq_th»ad_â
* 
func
, * 
¬g
)

65 
zmq
::
th»ad_t
* 
th»ad
 = 
Ãw
 zmq::thread_t;

66 
th»ad
->
	`¡¬t
(
func
, 
¬g
);

67  
th»ad
;

68 
	}
}

70 
	$zmq_th»adşo£
(* 
th»ad
)

72 
zmq
::
th»ad_t
* 
pTh»ad
 = 
¡©ic_ÿ¡
<zmq::th»ad_t*>(
th»ad
);

73 
pTh»ad
->
	`¡İ
();

74 
d–‘e
 
pTh»ad
;

75 
	}
}

80 
	g’cod”
 [85 + 1] = {

88 
ušt8_t
 
	gdecod”
 [96] = {

109 *
	$zmq_z85_’code
 (*
de¡
, 
ušt8_t
 *
d©a
, 
size_t
 
size
)

111 ià(
size
 % 4 != 0) {

112 
”ºo
 = 
EINVAL
;

113  
NULL
;

115 
ch¬_nbr
 = 0;

116 
by‹_nbr
 = 0;

117 
ušt32_t
 
v®ue
 = 0;

118 
by‹_nbr
 < 
size
) {

120 
v®ue
 = v®u* 256 + 
d©a
 [
by‹_nbr
++];

121 ià(
by‹_nbr
 % 4 == 0) {

123 
divisÜ
 = 85 * 85 * 85 * 85;

124 
divisÜ
) {

125 
de¡
 [
ch¬_nbr
++] = 
’cod”
 [
v®ue
 / 
divisÜ
 % 85];

126 
divisÜ
 /= 85;

128 
v®ue
 = 0;

131 
	`as£¹
 (
ch¬_nbr
 =ğ
size
 * 5 / 4);

132 
de¡
 [
ch¬_nbr
] = 0;

133  
de¡
;

134 
	}
}

143 
ušt8_t
 *
	$zmq_z85_decode
 (
ušt8_t
 *
de¡
, *
¡ršg
)

145 ià(
	`¡¾’
 (
¡ršg
) % 5 != 0) {

146 
”ºo
 = 
EINVAL
;

147  
NULL
;

149 
by‹_nbr
 = 0;

150 
ch¬_nbr
 = 0;

151 
¡ršg_Ën
 = 
	`¡¾’
 (
¡ršg
);

152 
ušt32_t
 
v®ue
 = 0;

153 
ch¬_nbr
 < 
¡ršg_Ën
) {

155 
v®ue
 = v®u* 85 + 
decod”
 [(
ušt8_t
è
¡ršg
 [
ch¬_nbr
++] - 32];

156 ià(
ch¬_nbr
 % 5 == 0) {

158 
divisÜ
 = 256 * 256 * 256;

159 
divisÜ
) {

160 
de¡
 [
by‹_nbr
++] = 
v®ue
 / 
divisÜ
 % 256;

161 
divisÜ
 /= 256;

163 
v®ue
 = 0;

166 
	`as£¹
 (
by‹_nbr
 =ğ
	`¡¾’
 (
¡ršg
) * 4 / 5);

167  
de¡
;

168 
	}
}

176 
	$zmq_curve_key·œ
 (*
z85_public_key
, *
z85_£ü‘_key
)

178 #ifdeà
HAVE_LIBSODIUM


179 #ià
üy±o_box_PUBLICKEYBYTES
 != 32 \

180 || 
üy±o_box_SECRETKEYBYTES
 != 32

184 
ušt8_t
 
public_key
 [32];

185 
ušt8_t
 
£ü‘_key
 [32];

187 
rc
 = 
	`üy±o_box_key·œ
 (
public_key
, 
£ü‘_key
);

189 ià(
rc
)

190  
rc
;

192 
	`zmq_z85_’code
 (
z85_public_key
, 
public_key
, 32);

193 
	`zmq_z85_’code
 (
z85_£ü‘_key
, 
£ü‘_key
, 32);

197 
”ºo
 = 
ENOTSUP
;

200 
	}
}

	@../include/zmq.h

28 #iâdeà
__ZMQ_H_INCLUDED__


29 
	#__ZMQ_H_INCLUDED__


	)

32 
	#ZMQ_VERSION_MAJOR
 4

	)

33 
	#ZMQ_VERSION_MINOR
 0

	)

34 
	#ZMQ_VERSION_PATCH
 5

	)

36 
	#ZMQ_MAKE_VERSION
(
majÜ
, 
mšÜ
, 
·tch
) \

37 ((
majÜ
è* 10000 + (
mšÜ
è* 100 + (
·tch
))

	)

38 
	#ZMQ_VERSION
 \

39 
	`ZMQ_MAKE_VERSION
(
ZMQ_VERSION_MAJOR
, 
ZMQ_VERSION_MINOR
, 
ZMQ_VERSION_PATCH
)

	)

41 #ifdeà
__ılu¥lus


45 #ià!
defšed
 
_WIN32_WCE


46 
	~<”ºo.h
>

48 
	~<¡ddef.h
>

49 
	~<¡dio.h
>

50 #ià
defšed
 
_WIN32


51 
	~<wšsock2.h
>

55 #ià
defšed
 
_WIN32


56 #ià
defšed
 
ZMQ_STATIC


57 
	#ZMQ_EXPORT


	)

58 #–ià
defšed
 
DLL_EXPORT


59 
	#ZMQ_EXPORT
 
	`__deş¥ec
(
dÎexpÜt
)

	)

61 
	#ZMQ_EXPORT
 
	`__deş¥ec
(
dÎimpÜt
)

	)

64 #ià
defšed
 
__SUNPRO_C
 || defšed 
__SUNPRO_CC


65 
	#ZMQ_EXPORT
 
__glob®


	)

66 #–ià(
defšed
 
__GNUC__
 && __GNUC__ >ğ4è|| defšed 
__INTEL_COMPILER


67 
	#ZMQ_EXPORT
 
	`__©Œibu‹__
 ((
	`visib™y
("deçuÉ")))

	)

69 
	#ZMQ_EXPORT


	)

74 #ià
defšed
 
ZMQ_HAVE_SOLARIS
 || defšed 
ZMQ_HAVE_OPENVMS


75 
	~<š‰y³s.h
>

76 #–ià
defšed
 
_MSC_VER
 && _MSC_VER < 1600

77 #iâdeà
št32_t


78 
__št32
 
	tšt32_t
;

80 #iâdeà
ušt16_t


81 
	t__št16
 
	tušt16_t
;

83 #iâdeà
ušt8_t


84 
	t__št8
 
	tušt8_t
;

87 
	~<¡dšt.h
>

97 
	#ZMQ_HAUSNUMERO
 156384712

	)

100 #iâdeà
ENOTSUP


101 
	#ENOTSUP
 (
ZMQ_HAUSNUMERO
 + 1)

	)

103 #iâdeà
EPROTONOSUPPORT


104 
	#EPROTONOSUPPORT
 (
ZMQ_HAUSNUMERO
 + 2)

	)

106 #iâdeà
ENOBUFS


107 
	#ENOBUFS
 (
ZMQ_HAUSNUMERO
 + 3)

	)

109 #iâdeà
ENETDOWN


110 
	#ENETDOWN
 (
ZMQ_HAUSNUMERO
 + 4)

	)

112 #iâdeà
EADDRINUSE


113 
	#EADDRINUSE
 (
ZMQ_HAUSNUMERO
 + 5)

	)

115 #iâdeà
EADDRNOTAVAIL


116 
	#EADDRNOTAVAIL
 (
ZMQ_HAUSNUMERO
 + 6)

	)

118 #iâdeà
ECONNREFUSED


119 
	#ECONNREFUSED
 (
ZMQ_HAUSNUMERO
 + 7)

	)

121 #iâdeà
EINPROGRESS


122 
	#EINPROGRESS
 (
ZMQ_HAUSNUMERO
 + 8)

	)

124 #iâdeà
ENOTSOCK


125 
	#ENOTSOCK
 (
ZMQ_HAUSNUMERO
 + 9)

	)

127 #iâdeà
EMSGSIZE


128 
	#EMSGSIZE
 (
ZMQ_HAUSNUMERO
 + 10)

	)

130 #iâdeà
EAFNOSUPPORT


131 
	#EAFNOSUPPORT
 (
ZMQ_HAUSNUMERO
 + 11)

	)

133 #iâdeà
ENETUNREACH


134 
	#ENETUNREACH
 (
ZMQ_HAUSNUMERO
 + 12)

	)

136 #iâdeà
ECONNABORTED


137 
	#ECONNABORTED
 (
ZMQ_HAUSNUMERO
 + 13)

	)

139 #iâdeà
ECONNRESET


140 
	#ECONNRESET
 (
ZMQ_HAUSNUMERO
 + 14)

	)

142 #iâdeà
ENOTCONN


143 
	#ENOTCONN
 (
ZMQ_HAUSNUMERO
 + 15)

	)

145 #iâdeà
ETIMEDOUT


146 
	#ETIMEDOUT
 (
ZMQ_HAUSNUMERO
 + 16)

	)

148 #iâdeà
EHOSTUNREACH


149 
	#EHOSTUNREACH
 (
ZMQ_HAUSNUMERO
 + 17)

	)

151 #iâdeà
ENETRESET


152 
	#ENETRESET
 (
ZMQ_HAUSNUMERO
 + 18)

	)

156 
	#EFSM
 (
ZMQ_HAUSNUMERO
 + 51)

	)

157 
	#ENOCOMPATPROTO
 (
ZMQ_HAUSNUMERO
 + 52)

	)

158 
	#ETERM
 (
ZMQ_HAUSNUMERO
 + 53)

	)

159 
	#EMTHREAD
 (
ZMQ_HAUSNUMERO
 + 54)

	)

162 
ZMQ_EXPORT
 
zmq_v”siÚ
 (*
majÜ
, *
mšÜ
, *
·tch
);

168 
ZMQ_EXPORT
 
zmq_”ºo
 ();

171 
ZMQ_EXPORT
 cÚ¡ *
zmq_¡»¼Ü
 (
”ºum
);

179 
	#ZMQ_IO_THREADS
 1

	)

180 
	#ZMQ_MAX_SOCKETS
 2

	)

183 
	#ZMQ_IO_THREADS_DFLT
 1

	)

184 
	#ZMQ_MAX_SOCKETS_DFLT
 1023

	)

186 
ZMQ_EXPORT
 *
zmq_ùx_Ãw
 ();

187 
ZMQ_EXPORT
 
zmq_ùx_‹rm
 (*
cÚ‹xt
);

188 
ZMQ_EXPORT
 
zmq_ùx_shutdown
 (*
ùx_
);

189 
ZMQ_EXPORT
 
zmq_ùx_£t
 (*
cÚ‹xt
, 
İtiÚ
, 
İtv®
);

190 
ZMQ_EXPORT
 
zmq_ùx_g‘
 (*
cÚ‹xt
, 
İtiÚ
);

193 
ZMQ_EXPORT
 *
zmq_š™
 (
io_th»ads
);

194 
ZMQ_EXPORT
 
zmq_‹rm
 (*
cÚ‹xt
);

195 
ZMQ_EXPORT
 
zmq_ùx_de¡roy
 (*
cÚ‹xt
);

202 
	szmq_msg_t
 {
_
 [32];} 
	tzmq_msg_t
;

204 (
zmq_ä“_â
è(*
	td©a
, *
	thšt
);

206 
ZMQ_EXPORT
 
zmq_msg_š™
 (
zmq_msg_t
 *
msg
);

207 
ZMQ_EXPORT
 
zmq_msg_š™_size
 (
zmq_msg_t
 *
msg
, 
size_t
 
size
);

208 
ZMQ_EXPORT
 
zmq_msg_š™_d©a
 (
zmq_msg_t
 *
msg
, *
d©a
,

209 
size_t
 
size
, 
zmq_ä“_â
 *
fâ
, *
hšt
);

210 
ZMQ_EXPORT
 
zmq_msg_£nd
 (
zmq_msg_t
 *
msg
, *
s
, 
æags
);

211 
ZMQ_EXPORT
 
zmq_msg_»cv
 (
zmq_msg_t
 *
msg
, *
s
, 
æags
);

212 
ZMQ_EXPORT
 
zmq_msg_şo£
 (
zmq_msg_t
 *
msg
);

213 
ZMQ_EXPORT
 
zmq_msg_move
 (
zmq_msg_t
 *
de¡
, zmq_msg_ˆ*
¤c
);

214 
ZMQ_EXPORT
 
zmq_msg_cİy
 (
zmq_msg_t
 *
de¡
, zmq_msg_ˆ*
¤c
);

215 
ZMQ_EXPORT
 *
zmq_msg_d©a
 (
zmq_msg_t
 *
msg
);

216 
ZMQ_EXPORT
 
size_t
 
zmq_msg_size
 (
zmq_msg_t
 *
msg
);

217 
ZMQ_EXPORT
 
zmq_msg_mÜe
 (
zmq_msg_t
 *
msg
);

218 
ZMQ_EXPORT
 
zmq_msg_g‘
 (
zmq_msg_t
 *
msg
, 
İtiÚ
);

219 
ZMQ_EXPORT
 
zmq_msg_£t
 (
zmq_msg_t
 *
msg
, 
İtiÚ
, 
İtv®
);

227 
	#ZMQ_PAIR
 0

	)

228 
	#ZMQ_PUB
 1

	)

229 
	#ZMQ_SUB
 2

	)

230 
	#ZMQ_REQ
 3

	)

231 
	#ZMQ_REP
 4

	)

232 
	#ZMQ_DEALER
 5

	)

233 
	#ZMQ_ROUTER
 6

	)

234 
	#ZMQ_PULL
 7

	)

235 
	#ZMQ_PUSH
 8

	)

236 
	#ZMQ_XPUB
 9

	)

237 
	#ZMQ_XSUB
 10

	)

238 
	#ZMQ_STREAM
 11

	)

241 
	#ZMQ_XREQ
 
ZMQ_DEALER


	)

242 
	#ZMQ_XREP
 
ZMQ_ROUTER


	)

245 
	#ZMQ_AFFINITY
 4

	)

246 
	#ZMQ_IDENTITY
 5

	)

247 
	#ZMQ_SUBSCRIBE
 6

	)

248 
	#ZMQ_UNSUBSCRIBE
 7

	)

249 
	#ZMQ_RATE
 8

	)

250 
	#ZMQ_RECOVERY_IVL
 9

	)

251 
	#ZMQ_SNDBUF
 11

	)

252 
	#ZMQ_RCVBUF
 12

	)

253 
	#ZMQ_RCVMORE
 13

	)

254 
	#ZMQ_FD
 14

	)

255 
	#ZMQ_EVENTS
 15

	)

256 
	#ZMQ_TYPE
 16

	)

257 
	#ZMQ_LINGER
 17

	)

258 
	#ZMQ_RECONNECT_IVL
 18

	)

259 
	#ZMQ_BACKLOG
 19

	)

260 
	#ZMQ_RECONNECT_IVL_MAX
 21

	)

261 
	#ZMQ_MAXMSGSIZE
 22

	)

262 
	#ZMQ_SNDHWM
 23

	)

263 
	#ZMQ_RCVHWM
 24

	)

264 
	#ZMQ_MULTICAST_HOPS
 25

	)

265 
	#ZMQ_RCVTIMEO
 27

	)

266 
	#ZMQ_SNDTIMEO
 28

	)

267 
	#ZMQ_LAST_ENDPOINT
 32

	)

268 
	#ZMQ_ROUTER_MANDATORY
 33

	)

269 
	#ZMQ_TCP_KEEPALIVE
 34

	)

270 
	#ZMQ_TCP_KEEPALIVE_CNT
 35

	)

271 
	#ZMQ_TCP_KEEPALIVE_IDLE
 36

	)

272 
	#ZMQ_TCP_KEEPALIVE_INTVL
 37

	)

273 
	#ZMQ_TCP_ACCEPT_FILTER
 38

	)

274 
	#ZMQ_IMMEDIATE
 39

	)

275 
	#ZMQ_XPUB_VERBOSE
 40

	)

276 
	#ZMQ_ROUTER_RAW
 41

	)

277 
	#ZMQ_IPV6
 42

	)

278 
	#ZMQ_MECHANISM
 43

	)

279 
	#ZMQ_PLAIN_SERVER
 44

	)

280 
	#ZMQ_PLAIN_USERNAME
 45

	)

281 
	#ZMQ_PLAIN_PASSWORD
 46

	)

282 
	#ZMQ_CURVE_SERVER
 47

	)

283 
	#ZMQ_CURVE_PUBLICKEY
 48

	)

284 
	#ZMQ_CURVE_SECRETKEY
 49

	)

285 
	#ZMQ_CURVE_SERVERKEY
 50

	)

286 
	#ZMQ_PROBE_ROUTER
 51

	)

287 
	#ZMQ_REQ_CORRELATE
 52

	)

288 
	#ZMQ_REQ_RELAXED
 53

	)

289 
	#ZMQ_CONFLATE
 54

	)

290 
	#ZMQ_ZAP_DOMAIN
 55

	)

293 
	#ZMQ_MORE
 1

	)

296 
	#ZMQ_DONTWAIT
 1

	)

297 
	#ZMQ_SNDMORE
 2

	)

300 
	#ZMQ_NULL
 0

	)

301 
	#ZMQ_PLAIN
 1

	)

302 
	#ZMQ_CURVE
 2

	)

305 
	#ZMQ_IPV4ONLY
 31

	)

306 
	#ZMQ_DELAY_ATTACH_ON_CONNECT
 
ZMQ_IMMEDIATE


	)

307 
	#ZMQ_NOBLOCK
 
ZMQ_DONTWAIT


	)

308 
	#ZMQ_FAIL_UNROUTABLE
 
ZMQ_ROUTER_MANDATORY


	)

309 
	#ZMQ_ROUTER_BEHAVIOR
 
ZMQ_ROUTER_MANDATORY


	)

316 
	#ZMQ_EVENT_CONNECTED
 1

	)

317 
	#ZMQ_EVENT_CONNECT_DELAYED
 2

	)

318 
	#ZMQ_EVENT_CONNECT_RETRIED
 4

	)

320 
	#ZMQ_EVENT_LISTENING
 8

	)

321 
	#ZMQ_EVENT_BIND_FAILED
 16

	)

323 
	#ZMQ_EVENT_ACCEPTED
 32

	)

324 
	#ZMQ_EVENT_ACCEPT_FAILED
 64

	)

326 
	#ZMQ_EVENT_CLOSED
 128

	)

327 
	#ZMQ_EVENT_CLOSE_FAILED
 256

	)

328 
	#ZMQ_EVENT_DISCONNECTED
 512

	)

329 
	#ZMQ_EVENT_MONITOR_STOPPED
 1024

	)

331 
	#ZMQ_EVENT_ALL
 ( 
ZMQ_EVENT_CONNECTED
 | 
ZMQ_EVENT_CONNECT_DELAYED
 | \

332 
ZMQ_EVENT_CONNECT_RETRIED
 | 
ZMQ_EVENT_LISTENING
 | \

333 
ZMQ_EVENT_BIND_FAILED
 | 
ZMQ_EVENT_ACCEPTED
 | \

334 
ZMQ_EVENT_ACCEPT_FAILED
 | 
ZMQ_EVENT_CLOSED
 | \

335 
ZMQ_EVENT_CLOSE_FAILED
 | 
ZMQ_EVENT_DISCONNECTED
 | \

336 
ZMQ_EVENT_MONITOR_STOPPED
)

	)

340 
ušt16_t
 
ev’t
;

341 
št32_t
 
v®ue
 ;

342 } 
	tzmq_ev’t_t
;

344 
ZMQ_EXPORT
 *
zmq_sock‘
 (*, 
ty³
);

345 
ZMQ_EXPORT
 
zmq_şo£
 (*
s
);

346 
ZMQ_EXPORT
 
zmq_£tsockİt
 (*
s
, 
İtiÚ
, cÚ¡ *
İtv®
,

347 
size_t
 
İtv®Ën
);

348 
ZMQ_EXPORT
 
zmq_g‘sockİt
 (*
s
, 
İtiÚ
, *
İtv®
,

349 
size_t
 *
İtv®Ën
);

350 
ZMQ_EXPORT
 
zmq_bšd
 (*
s
, cÚ¡ *
addr
);

351 
ZMQ_EXPORT
 
zmq_cÚÃù
 (*
s
, cÚ¡ *
addr
);

352 
ZMQ_EXPORT
 
zmq_unbšd
 (*
s
, cÚ¡ *
addr
);

353 
ZMQ_EXPORT
 
zmq_discÚÃù
 (*
s
, cÚ¡ *
addr
);

354 
ZMQ_EXPORT
 
zmq_£nd
 (*
s
, cÚ¡ *
buf
, 
size_t
 
Ën
, 
æags
);

355 
ZMQ_EXPORT
 
zmq_£nd_cÚ¡
 (*
s
, cÚ¡ *
buf
, 
size_t
 
Ën
, 
æags
);

356 
ZMQ_EXPORT
 
zmq_»cv
 (*
s
, *
buf
, 
size_t
 
Ën
, 
æags
);

357 
ZMQ_EXPORT
 
zmq_sock‘_mÚ™Ü
 (*
s
, cÚ¡ *
addr
, 
ev’ts
);

359 
ZMQ_EXPORT
 
zmq_£ndmsg
 (*
s
, 
zmq_msg_t
 *
msg
, 
æags
);

360 
ZMQ_EXPORT
 
zmq_»cvmsg
 (*
s
, 
zmq_msg_t
 *
msg
, 
æags
);

363 
iovec
;

365 
ZMQ_EXPORT
 
zmq_£ndiov
 (*
s
, 
iovec
 *
iov
, 
size_t
 
couÁ
, 
æags
);

366 
ZMQ_EXPORT
 
zmq_»cviov
 (*
s
, 
iovec
 *
iov
, 
size_t
 *
couÁ
, 
æags
);

372 
	#ZMQ_POLLIN
 1

	)

373 
	#ZMQ_POLLOUT
 2

	)

374 
	#ZMQ_POLLERR
 4

	)

378 *
sock‘
;

379 #ià
defšed
 
_WIN32


380 
SOCKET
 
fd
;

382 
fd
;

384 
ev’ts
;

385 
»v’ts
;

386 } 
	tzmq_pŞl™em_t
;

388 
	#ZMQ_POLLITEMS_DFLT
 16

	)

390 
ZMQ_EXPORT
 
zmq_pŞl
 (
zmq_pŞl™em_t
 *
™ems
, 
n™ems
, 
timeout
);

394 
ZMQ_EXPORT
 
zmq_´oxy
 (*
äÚ‹nd
, *
back’d
, *
ÿ±u»
);

395 
ZMQ_EXPORT
 
zmq_´oxy_¡“¿bË
 (*
äÚ‹nd
, *
back’d
, *
ÿ±u»
, *
cÚŒŞ
);

398 
ZMQ_EXPORT
 *
zmq_z85_’code
 (*
de¡
, 
ušt8_t
 *
d©a
, 
size_t
 
size
);

401 
ZMQ_EXPORT
 
ušt8_t
 *
zmq_z85_decode
 (ušt8_ˆ*
de¡
, *
¡ršg
);

404 
	#ZMQ_STREAMER
 1

	)

405 
	#ZMQ_FORWARDER
 2

	)

406 
	#ZMQ_QUEUE
 3

	)

408 
ZMQ_EXPORT
 
zmq_deviû
 (
ty³
, *
äÚ‹nd
, *
back’d
);

410 #undeà
ZMQ_EXPORT


412 #ifdeà
__ılu¥lus


	@../include/zmq_utils.h

20 #iâdeà
__ZMQ_UTILS_H_INCLUDED__


21 
	#__ZMQ_UTILS_H_INCLUDED__


	)

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<¡dlib.h
>

28 #ià
defšed
 
ZMQ_HAVE_SOLARIS
 || defšed 
ZMQ_HAVE_OPENVMS


29 
	~<š‰y³s.h
>

30 #–ià
defšed
 
_MSC_VER
 && _MSC_VER < 1600

31 #iâdeà
št32_t


32 
__št32
 
	tšt32_t
;

34 #iâdeà
ušt16_t


35 
	t__št16
 
	tušt16_t
;

38 
	~<¡dšt.h
>

41 #ifdeà
__ılu¥lus


46 #ià
defšed
 
_WIN32


47 #ià
defšed
 
ZMQ_STATIC


48 
	#ZMQ_EXPORT


	)

49 #–ià
defšed
 
DLL_EXPORT


50 
	#ZMQ_EXPORT
 
	`__deş¥ec
(
dÎexpÜt
)

	)

52 
	#ZMQ_EXPORT
 
	`__deş¥ec
(
dÎimpÜt
)

	)

55 #ià
defšed
 
__SUNPRO_C
 || defšed 
__SUNPRO_CC


56 
	#ZMQ_EXPORT
 
__glob®


	)

57 #–ià(
defšed
 
__GNUC__
 && __GNUC__ >ğ4è|| defšed 
__INTEL_COMPILER


58 
	#ZMQ_EXPORT
 
	`__©Œibu‹__
 ((
	`visib™y
("deçuÉ")))

	)

60 
	#ZMQ_EXPORT


	)

67 
ZMQ_EXPORT
 *
zmq_z85_’code
 (*
de¡
, 
ušt8_t
 *
d©a
, 
size_t
 
size
);

70 
ZMQ_EXPORT
 
ušt8_t
 *
zmq_z85_decode
 (ušt8_ˆ*
de¡
, *
¡ršg
);

74 
ZMQ_EXPORT
 
zmq_curve_key·œ
 (*
z85_public_key
, *
z85_£ü‘_key
);

76 (
zmq_th»ad_â
) (*);

84 
ZMQ_EXPORT
 *
zmq_¡İw©ch_¡¬t
 ();

88 
ZMQ_EXPORT
 
zmq_¡İw©ch_¡İ
 (*
w©ch_
);

91 
ZMQ_EXPORT
 
zmq_¦“p
 (
£cÚds_
);

94 
ZMQ_EXPORT
 *
zmq_th»ad¡¬t
 (
zmq_th»ad_â
* 
func
, * 
¬g
);

97 
ZMQ_EXPORT
 
zmq_th»adşo£
 (* 
th»ad
);

99 #undeà
ZMQ_EXPORT


101 #ifdeà
__ılu¥lus


	@
1
.
0
161
2001
address.cpp
address.hpp
array.hpp
atomic_counter.hpp
atomic_ptr.hpp
blob.hpp
clock.cpp
clock.hpp
command.hpp
config.hpp
ctx.cpp
ctx.hpp
curve_client.cpp
curve_client.hpp
curve_server.cpp
curve_server.hpp
dbuffer.hpp
dealer.cpp
dealer.hpp
decoder.hpp
devpoll.cpp
devpoll.hpp
dist.cpp
dist.hpp
encoder.hpp
epoll.cpp
epoll.hpp
err.cpp
err.hpp
fd.hpp
fq.cpp
fq.hpp
i_decoder.hpp
i_encoder.hpp
i_engine.hpp
i_poll_events.hpp
io_object.cpp
io_object.hpp
io_thread.cpp
io_thread.hpp
ip.cpp
ip.hpp
ipc_address.cpp
ipc_address.hpp
ipc_connecter.cpp
ipc_connecter.hpp
ipc_listener.cpp
ipc_listener.hpp
kqueue.cpp
kqueue.hpp
lb.cpp
lb.hpp
likely.hpp
mailbox.cpp
mailbox.hpp
mechanism.cpp
mechanism.hpp
msg.cpp
msg.hpp
mtrie.cpp
mtrie.hpp
mutex.hpp
null_mechanism.cpp
null_mechanism.hpp
object.cpp
object.hpp
options.cpp
options.hpp
own.cpp
own.hpp
pair.cpp
pair.hpp
pgm_receiver.cpp
pgm_receiver.hpp
pgm_sender.cpp
pgm_sender.hpp
pgm_socket.cpp
pgm_socket.hpp
pipe.cpp
pipe.hpp
plain_mechanism.cpp
plain_mechanism.hpp
poll.cpp
poll.hpp
poller.hpp
poller_base.cpp
poller_base.hpp
precompiled.cpp
precompiled.hpp
proxy.cpp
proxy.hpp
pub.cpp
pub.hpp
pull.cpp
pull.hpp
push.cpp
push.hpp
random.cpp
random.hpp
raw_decoder.cpp
raw_decoder.hpp
raw_encoder.cpp
raw_encoder.hpp
reaper.cpp
reaper.hpp
rep.cpp
rep.hpp
req.cpp
req.hpp
router.cpp
router.hpp
select.cpp
select.hpp
session_base.cpp
session_base.hpp
signaler.cpp
signaler.hpp
socket_base.cpp
socket_base.hpp
stdint.hpp
stream.cpp
stream.hpp
stream_engine.cpp
stream_engine.hpp
sub.cpp
sub.hpp
tcp.cpp
tcp.hpp
tcp_address.cpp
tcp_address.hpp
tcp_connecter.cpp
tcp_connecter.hpp
tcp_listener.cpp
tcp_listener.hpp
thread.cpp
thread.hpp
trie.cpp
trie.hpp
v1_decoder.cpp
v1_decoder.hpp
v1_encoder.cpp
v1_encoder.hpp
v2_decoder.cpp
v2_decoder.hpp
v2_encoder.cpp
v2_encoder.hpp
v2_protocol.hpp
windows.hpp
wire.hpp
xpub.cpp
xpub.hpp
xsub.cpp
xsub.hpp
ypipe.hpp
ypipe_base.hpp
ypipe_conflate.hpp
yqueue.hpp
zmq.cpp
zmq_utils.cpp
../include/zmq.h
../include/zmq_utils.h
